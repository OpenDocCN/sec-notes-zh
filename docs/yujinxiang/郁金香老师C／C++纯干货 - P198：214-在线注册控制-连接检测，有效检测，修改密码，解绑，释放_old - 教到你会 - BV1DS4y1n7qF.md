# 郁金香老师C／C++纯干货 - P198：214-在线注册控制-连接检测，有效检测，修改密码，解绑，释放_old - 教到你会 - BV1DS4y1n7qF

大家好，我是玉溪谦老师，这一节课我们了解以下午课api函数啊，那么这几个都是我们微正提供的啊，a api接口函数，那么第一个是用来检测我们是否与我们的服务器啊，微正的服务器啊有效的进行了链接。

那么第二个呢是用来检测我们的啊，用户伺服呢嗯正常的登录通过了验证啊，那么如果通过验证的话，那么它是有效的，它会返回一个增值啊，也就是一个非零的一个数值成功的话，那么第三个呢是解绑解绑的。

这个呢需要我们在创建的时候啊，这里有一个属性啊，绑定机器，那么一般呢我们是选择不绑机的话，那么这个就没有多大的作用，那么在绑定机器的情况下，绑机这行呢我们选择了相应的台数的情况下呢。

那么我们可以实现一个解法啊，比如说我们在这里的话选择的是绑定一台电脑，那么在我们当前的电脑上使用的话，就不能在其他的电脑上使用啊，那么我就呃如果要在其他的电脑上使用的话，就需要调用这个解绑的函数。

在当前的机器上解绑之后呢，然后才能盖在其他的电脑上正常的登录啊工作，那么另外还有一个用到比较多的呢，就是修改我们的用户名和密码啊，那么最后这一个呢这个我们一般没有调用这个函数呢。

一般是在退出我们u盾的时候呢啊使用啊，那么一般我们是在关闭这个游戏进程前，那么会调用这个函数，用来做一些善后的工作。



![](img/574c8f8d395b71c09d710019d613e9ba_1.png)

好的，接下来我们编写代码来进行相应的测试。

![](img/574c8f8d395b71c09d710019d613e9ba_3.png)

哈哈哈。

![](img/574c8f8d395b71c09d710019d613e9ba_5.png)

![](img/574c8f8d395b71c09d710019d613e9ba_6.png)

![](img/574c8f8d395b71c09d710019d613e9ba_7.png)

![](img/574c8f8d395b71c09d710019d613e9ba_8.png)

那么我们打开213课的代码，那么首先我们做第一个函数的测试，那么我们添加一个按钮，复制一下这段代码。

![](img/574c8f8d395b71c09d710019d613e9ba_10.png)

那么如果已经链接的话，这里呢它会返回一个增值啊，不值，那么如果它是未连接到服务器的话，那么呢它会返回数字零啊，那么所以说在这里判断的时候呢，我们可以直接用一个条件语句哈，内附加二次元来进行一个判断。

好的，那么我们运行一下，那么这个时候呢我们服务器服务器的话呃，是链接上的啊，因为我们最先的话开始的时候他有一个初始化的工作，那么实际上呢也就是嗯会链接我们的服务器啊，那么只要我们网络没有问题的话。

我们只要初始化成功之后，一般来说我们调用这个函数的话，它返回的都会是一个增值啊，那么除非你掉线人了。

![](img/574c8f8d395b71c09d710019d613e9ba_12.png)

那么接着我们来看一下第二个函数检测是否有效。

![](img/574c8f8d395b71c09d710019d613e9ba_14.png)

啊。

![](img/574c8f8d395b71c09d710019d613e9ba_16.png)

那么这个函数的话如果是有效的啊，也就是我们用户名密码验证成功之后呢，调用这个函数的话，它也会返回一个增值，那么如果它是调用失败啊，就是说呃是无效的，那么呢会返回一个零值法，会返回数值零fa。



![](img/574c8f8d395b71c09d710019d613e9ba_18.png)

那么这个时候我们没有登录我们的用户啊，验证没有通过，那么这个时候呢它是无效的，但是呢现在他已经链接到我们的服务器，那么我们登陆一个账户啊，做一下测试，啊真的，那么这个时候呢我们的密码输错了，啊登录成功。

因为这里的密码的话是33322，登录成功之后的话，我们再次检测，这个时候啊登录成功，验证成功的话，那么用这个函数检测的时候呢。



![](img/574c8f8d395b71c09d710019d613e9ba_20.png)

就是有效的，好我们接着看下一个函数，那么另外一个呢是解绑，但是这个呢看不到效果，那么我们只能够取得它的一个法定值，那么解绑这个函数的话，它也是要我们的用户啊登录验证成功之后啊。

也就是在有效的状态下才能够解绑成功，那么我们可以在呃在它的基础上进行修改，然后这个时候我们解绑的话，由于没有登录啊，没有进行登录的一个操作，那么他会说啊这个无效，那么我们先登录一下账号，登录之后呢。

那么这个时候呢首先呢是有效的，那么解绑失败啊，这个时候我们看一下，呃为什么会解绑失败呢，啊因为这里呢它返回零值哈，结果的话广东零的话是成功，那么其他的情况呢是失败啊，因为这个返回值的话他不是不值的啊。

注意在这里，那么我们也可以看它相关的呃，这个函数的说明，那么您呢表示成功啊，实际上刚才的这个解绑的话是成功的。



![](img/574c8f8d395b71c09d710019d613e9ba_22.png)

![](img/574c8f8d395b71c09d710019d613e9ba_23.png)

好的，那么这是一个解绑的作用啊，解绑之后呢，那么我们就可以了，在另外的电脑上登录使用，但是它同时呢都只能在一台电脑上登录，那么如果如果是我们在当前的电脑上登录之后，成功登录之后，如果没有解绑的话。

那么在其他的电脑上的话，就是不能够正常的使用的，不能够正常的登录使用，那么我们接着来了解第四个函数，接口函数修改密码它也是非常简单，第一个密码呢是以前的密码啊，这个是新密码，当然它也有一个前提。

就是我们需要是在一个有效的啊情况下来来修改，也就是说我们首先呢要登录成功，不然的话我们也是不能够修改这个密码的，那么修改密码的话，一般来说我们在这里呢会另外的用一个窗口来来修改我们的密码，看看。

然后我们再添加两个啊编辑框，编辑框一编辑框二啊，那么你可以对它进行一下调整修改，好的在确定这里呢我们添加修改的代码，取消这里的话，那么我们用添加相应的代码。

那么直接呢它通过这个相应的i d呢就有关联相应的代码。

![](img/574c8f8d395b71c09d710019d613e9ba_25.png)

![](img/574c8f8d395b71c09d710019d613e9ba_26.png)

那么在确定这里呢，实际上我们就是修改了，我们把它提3。2，修改密码，然后呢我们在这里呢添加我们的代码，那么首先我们需要取得的是我们两个编辑框的内容啊，那么这里呢我们有一段示例的代码。

那么首先呢我们这两个临时变量用来存放我们呃从编辑框获得的密码，那么取得之后呢，放在这个缓冲区之类，然后调用这个相应的函数，当然我们需要包含相应的图文件，好的，我们首先呢便宜生成一下，啊。

那么实际上这个呢它是已经定义了的啊，就是我们这里的相应的控件的id啊，那么修改的话，好了，那么我们接下来进行一下相应的测试，当然我们在这里呢也可以做一个相应的判断，那么如果是无效的。

我们可以让它先进行登录，好，那么如果他没有登录的话，我们先让他登录一下，在这里我们直接调用这个r o k退出，好的接着在这里让我们添加一个修改密码的功能，那么首先呢包含我们新建的窗口类图文件。

然后在这里呢创建一个月的对象，然后这里以模态的方式呢来显示，然后这里呢会弹出一个修改密码的方，包括我我们无论怎么改，这里呢，因为呢我们没有进行登录啊，所以说修改都不会成功。

那么首先呢我们这里呢需要进行一下登录，那么登录成功之后呢，我们才可以进行修改密码，这是之前的密码。

![](img/574c8f8d395b71c09d710019d613e9ba_28.png)

那么这是一个新的秘密。

![](img/574c8f8d395b71c09d710019d613e9ba_30.png)

这个时候呢它会提示修改成功，但是我们在这里的话，他不能够看到新的密码，为什么呢，因为在这里的话，它还没有从我们的服务器把这个数据呢更新过来，我们需要把这个呃作者端需要把它关掉。



![](img/574c8f8d395b71c09d710019d613e9ba_32.png)

再重新登录一下。

![](img/574c8f8d395b71c09d710019d613e9ba_34.png)

那么这个时候呢数据才会更新过来，这才是我们新的密码。

![](img/574c8f8d395b71c09d710019d613e9ba_36.png)

好的我们再做一下测试。

![](img/574c8f8d395b71c09d710019d613e9ba_38.png)

![](img/574c8f8d395b71c09d710019d613e9ba_39.png)

![](img/574c8f8d395b71c09d710019d613e9ba_40.png)

好的，这是我们新修改的密码。

![](img/574c8f8d395b71c09d710019d613e9ba_42.png)

![](img/574c8f8d395b71c09d710019d613e9ba_43.png)

那么最后一个呢就是我们呃退出的时候呢，这个需要进行一个清理的工作啊，按照他的说法的话，我们这个纯动态链接库的话呃，在退出的时候呢，需要将我们的微dom停止工作啊，用于关闭啊进程的当前进程的一个调用。

那么在这里的话我们可以选择我们的一对视图，那么然后呢这里有一个a p p的论，那么我们重写一下它的相关函数。



![](img/574c8f8d395b71c09d710019d613e9ba_45.png)

在这里呢就是在退出应用程序或者是线程。

![](img/574c8f8d395b71c09d710019d613e9ba_47.png)

这时候呢它会调用这一个相应的函数吗，那么做一些清理的工作，那么我们可以在这里添加代码，进行一个释放的一个操作，另外停止你的调用，相当于做一个清理的工作，那么在这里呢我们也需要包含相应的头文件说明。



![](img/574c8f8d395b71c09d710019d613e9ba_49.png)

好的，那么这节课的话我们就讨论到这里嗯，那么在后面的章节呢，我们再讨论了其他的接口啊函数，那么我们下一节课再见，那么下去之后的话，大家可以看一下他的帮助文档，那么可以啊。

看一下我们的这个啊扣除点数以及扣除这个时间啊，这些函数呢我们用的比较多啊。

![](img/574c8f8d395b71c09d710019d613e9ba_51.png)

那么其他的后边的这些函数的话，我们相对应的就比较少，那么可以大家有需要的可以直接去看一下他的啊。

![](img/574c8f8d395b71c09d710019d613e9ba_53.png)

关注文档好的。

![](img/574c8f8d395b71c09d710019d613e9ba_55.png)