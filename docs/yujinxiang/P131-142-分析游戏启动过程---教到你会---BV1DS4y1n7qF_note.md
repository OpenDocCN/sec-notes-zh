# 课程 P131：游戏启动过程分析 🎮

![](img/4c5091b153e5357650aaa1e79906bc44_1.png)

在本节课中，我们将学习如何分析一个游戏的启动过程。掌握这一过程，能为后续制作自动登录工具、游戏登录器，以及分析游戏多开限制打下基础。

![](img/4c5091b153e5357650aaa1e79906bc44_3.png)

![](img/4c5091b153e5357650aaa1e79906bc44_5.png)

![](img/4c5091b153e5357650aaa1e79906bc44_7.png)

## 准备工作与核心概念

![](img/4c5091b153e5357650aaa1e79906bc44_9.png)

![](img/4c5091b153e5357650aaa1e79906bc44_11.png)

![](img/4c5091b153e5357650aaa1e79906bc44_13.png)

上一节我们明确了课程目标，本节中我们来看看需要准备哪些知识。分析游戏启动，关键在于理解Windows系统创建外部进程的几个核心API函数。

![](img/4c5091b153e5357650aaa1e79906bc44_14.png)

![](img/4c5091b153e5357650aaa1e79906bc44_16.png)

![](img/4c5091b153e5357650aaa1e79906bc44_18.png)

以下是三个常用的进程创建函数及其Unicode宽字符版本：
*   `WinExec`
*   `ShellExecute` / `ShellExecuteEx`
*   `CreateProcess` / `CreateProcessW`

最终，这些函数通常都会调用 `CreateProcess` 或 `CreateProcessW` 来完成实际的进程创建工作。因此，**`CreateProcessW`** 是分析启动流程的必经之路。

![](img/4c5091b153e5357650aaa1e79906bc44_20.png)

## 实战分析：下断点与追踪

![](img/4c5091b153e5357650aaa1e79906bc44_22.png)

了解了核心函数后，我们进入实战环节，使用调试器对游戏启动过程进行动态分析。

首先，打开调试器并附加到目标程序。待相关系统模块加载后，对 `CreateProcessW` 函数下断点。这是最关键的断点，能捕获到最终的进程创建调用。

![](img/4c5091b153e5357650aaa1e79906bc44_24.png)

为了更全面地观察启动链，我们也可以对 `WinExec` 和 `ShellExecute` 等相关函数下断点。

![](img/4c5091b153e5357650aaa1e79906bc44_26.png)

设置好断点后，通过游戏登录器选择服务器（例如“网通四区”）并点击“开始”。此时，调试器会在 `CreateProcessW` 处中断。

![](img/4c5091b153e5357650aaa1e79906bc44_28.png)

从调用堆栈和函数参数中，我们可以观察到关键的启动信息。最重要的参数是 **命令行（Command Line）**，它包含了程序路径和启动参数。例如，我们可能看到类似这样的结构：
```
"D:\Game\Client.exe" 120.0.0.1 10031 0 0 123456789
```
其中，`120.0.0.1` 和 `10031` 很可能是服务器地址和端口，后面的数字可能是动态生成的令牌或标识。

![](img/4c5091b153e5357650aaa1e79906bc44_30.png)

让程序继续运行，可能会观察到它先调用了 `ShellExecuteW`，最终再调用 `CreateProcessW` 完成启动。记录下 `CreateProcessW` 中的完整命令行参数。

![](img/4c5091b153e5357650aaa1e79906bc44_32.png)

## 应用：提取参数与独立启动

![](img/4c5091b153e5357650aaa1e79906bc44_34.png)

![](img/4c5091b153e5357650aaa1e79906bc44_36.png)

上一节我们捕获了启动参数，本节中我们来看看如何利用这些参数。

![](img/4c5091b153e5357650aaa1e79906bc44_38.png)

![](img/4c5091b153e5357650aaa1e79906bc44_40.png)

获取到完整的命令行后，我们就可以脱离原版登录器，直接启动游戏客户端。具体操作是：在命令行或批处理文件中，使用获取到的完整命令。

![](img/4c5091b153e5357650aaa1e79906bc44_42.png)

![](img/4c5091b153e5357650aaa1e79906bc44_44.png)

![](img/4c5091b153e5357650aaa1e79906bc44_46.png)

例如，直接运行：
```
"D:\Game\Client.exe" 120.0.0.1 10031 0 0 123456789
```

![](img/4c5091b153e5357650aaa1e79906bc44_48.png)

![](img/4c5091b153e5357650aaa1e79906bc44_50.png)

这种方法的意义在于：
1.  **制作自定义登录器**：我们可以编写程序，模拟登录器行为，直接调用 `CreateProcessW` 并传入对应的服务器参数来启动游戏。
2.  **绕过登录器多开限制**：如果游戏的多开检测机制集成在官方登录器中，那么通过自定义登录器直接启动客户端，有可能绕过该限制。

![](img/4c5091b153e5357650aaa1e79906bc44_52.png)

![](img/4c5091b153e5357650aaa1e79906bc44_53.png)

我们可以通过选择不同的游戏区服，重复上述分析过程，来获取不同区服的启动参数。通过对比可以发现，命令行中通常只有服务器地址/域名和少数几个参数会随区服变化，其余参数可能固定或随时间动态生成。

![](img/4c5091b153e5357650aaa1e79906bc44_55.png)

## 总结与展望

![](img/4c5091b153e5357650aaa1e79906bc44_57.png)

本节课中我们一起学习了游戏启动过程的分析方法。

我们首先认识了创建进程的核心API函数，特别是 `CreateProcessW`。接着，通过调试器下断点实战，追踪并提取了游戏启动时的关键命令行参数。最后，我们探讨了如何利用这些参数实现独立启动游戏客户端，并阐述了其在制作登录器和分析多开机制方面的应用价值。

通过本课的学习，你已经掌握了分析程序启动流程的基本技能。后续课程中，我们将在此基础上，进一步深入分析游戏的具体保护机制和实现更复杂的工具。