# P28：039-修改技能对象属性，分析修练功能 - 教到你会 - BV1DS4y1n7qF

大家好，我是欲金星老师，那么在前面我们分析了技能的使用的，功能，但是相应的功能，它还有一些可以改进的地方，比如说我们的某一些技能，比如说劣势陀螺技能，那么我们在使用技能的时候。

首先它就不能够放置在我们的技能栏上，因为它没有修炼，但是它可以学习的条件已经达到了，那么这个时候的话，如果我们判断它条件达到了可以学习的话，那么我们又调用了技能的话，我们可以来自己的分析一下修炼的课。

让它自动的修炼相关的技能，可以，那么这几个我们就分析一下修炼技能的课，因为修炼的技能是否修炼，它这个数据的话，它会发向我们的服务器，所以说我们可以从封包这里来回溯，那么发包的函数它有这几个。

那么一般的发包的函数有这4个，今天我们这个游戏它用的发包的函数是用的第1个，所以说我们给它加一个BPWSS的段点，来摘取它的封包，通过封包我们来回溯，找到它修炼技能的这个地方，好的。

那么我们打开我们的OD。

![](img/e39e2706c72e288b51ea7efa52c80365_1.png)

附加到我们的游戏里面。

![](img/e39e2706c72e288b51ea7efa52c80365_3.png)

那么附加之后，我们下一个PP信得的一个段点，按下回溯键，切换到游戏，那么我们这里点击修炼，那么这个时候它会断下来，断下来之后我们把段点取消掉，然后按Ctrl+F9执行到返回，或者执行菜单这里都可以。

那么在这里我们可以看到它是调用了我们发包的函数，那么我们再返回一层，一般要返回两到三层才是真正的扩，那么在这里的时候我们可以注视一下，修炼技能1，那么只是说这个扩然它可能是修炼技能的。

那么我们在这里下个段，然后再执行到返回，在这个地方也有一个扩，那么我们也下一个段点F2，然后再执行一次，执行到返回，在这个地方我们再下一次段，F2，然后再执行到返回，在这里下个段，随便标一个数字F2。

好，然后我们再按运行让它跑起来，这个时候我们发现这个地方它会一直断下，但我们点修炼技能的话只点了一次，它不应该是在一个循环的执行，所以说这个的话我们就排除掉它的可能性的话就极小。

那么另外三个可能性要大一些，好，那么这个时候我们需要反复的测试，但是我们这里已经没有相应的技能给我们做测试了，这个时候当我们没有修炼技能的时候，我们点它的时候，这个地方它也断下了。

所以说这个地方的可能性它要小一些，要小一些，但是我们这几个课我们一个一个的来分析来执行，首先我们用OT附加到游戏，用C1，在前面我们的分析当中，我们有一项EF6这个地方有两个字。

用来表示某项技能已经学习，那么我们通过修改这个属性来看一下是否会出现修炼的按钮。

![](img/e39e2706c72e288b51ea7efa52c80365_5.png)

那么它有两个偏移，一个是410加后面的一个数字的下标，是4，另外一个是EF6，所以说这里要添加两个偏移，这里是410的话，我们是那一本书，那么第一个技能的话应该是414，后面EF6，这里是两字节。

我们跟他写个技能E，那么这里我们把它改动一下，改为0，再回到游戏，我们这个时候我们看一下，它这里修炼的按钮又会出现，那么我们再点击它，让它断下来，我们分析一下它的参数。

那么这个时候我们看到只有一个参数是可变的，就是EAX这个参数，那么现在它的参数是0D，那么把它记录一下，另外还有一个ECX的值，一般它会做一个参数，它来源于前面的ESI+4，那么这是ECX的值。

我们把它记录一下，让它跑起来，那么这里我们来看一下这几个参数，这是第一个参数，18A，18A4CC，那么第二个参数是1870，1870，那么这个参数是319F，319F，好的，让它跑起来。

那么这里还有一个参数，这个参数就只有一个，EAX，那么这个EAX我们可以看到，它的来源的话，也就是上面的最后压占了一个参数，最后压占了一个参数，然后再做一个地址，进行一个压占，最后都到我们的发包了。

这里可能是一个数据发包，数据的一个版权区，因为我们EAX是它的首地址，它最大地址，这里有个13E，说明比13E还要大一点，大一些，好，那么我们再让它跑起来，然后为了我们方便区分参数，我们再把后面。

把这个数字先改成，然后我们414代表的是，技能1，那么418也就是410+4=2，那么它的下表是2，也就是我们的第二个技能，技能2，这个数字，那么我们也把它改为1，那么这里我们可以把它复制一下。

那么前面一个我们改为技能1，这里偏移，我们改成414，就是技能1，再复制一下，技能3，技能3的话，我们还需要在前面的下表的基础上，+4，就成了41416性机能，我们就把它改一下，方便我们的一个测试。

那么我们先测试第一个库，后面两个禁止掉，那么再点一下修炼，那么再点修炼之后，我们看一下EX的值变成了01，一个是13，一个是14，好，我们再测试一下下面一个，这个时候EX的值刚才没有变，0第8。

但是他服务器他一下服务器发送数据了，服务器发送数据回来，就把这些所有的都更新了，就更新了一次，好，再点击一下，那么这个时候我们EX的值，来点1，F15，那么它是一个序列，是挨着的，那么可能是一个下标的。

这个可能是一个数据的下标，也可能是我们的技能的一个编号，在服务器上的一个ID也有可能，但是这个参数我们看这个库的话，它还是比较简单的，一个就是ECX，然后也是从ECX里面取出来的。

那么我们尝试主要写一下这个库，先进行一下测试，PUSH 0，PUSH我们的EX，那么EX我们就是从0D这样开始的，它来源于是ESI，24C这个地方，那么我们直接，PUSH D，PUSH 13，试一下。

PUSH 0X3F4，然后再扩EDX，但是EDX我们说的库里面一个来源，来源就是前面的ECX，那么我们看一下ECX的数值，把它复制进来，复制一下，那么复制进来了之后，它要先把它取出来，取到EDX。

墨译ECX，长寇EDX，加上4，它是这样的调用的，那么这样它就能够学习技能1了，那么我们把技能1改一下，看有没有效果，然后我们调用一下，输入到我们的游戏里面，再看一下。

这个时候它就已经学习了相应的一个技能，但是最好我们再换一个号再测试一下，是最好的，那么如果是进了2，我们也可以调一下01，这样的，输入一下，它这里也能够学习，那么这个扩，但是它有点麻烦。

就是要找ECX的一个来源，不知道它怎么与我们的相应的扩，怎么关联起来，有相应的技能，哪一个是接红灭火，哪一个是接红断目，哪一个是接红场景，这样的它不能够关联起来，它们之间应该是有一个关联的一个联系的。

那么接下来另外还有两个扩，我们按Water B来打开这个系列，这里还有一个。

![](img/e39e2706c72e288b51ea7efa52c80365_7.png)

我们可以通过分析这个扩来区分一下，看两个扩之间哪一个扩更简单一些，这三个，断下的地方我们都可以分析，都可以分析，那么今天我们这一期先到这里，那么大家下去之后。

把这个扩的一个参数来当成是一个座列来分析一下，好的，那么我们下期再见，这几个比较简单。