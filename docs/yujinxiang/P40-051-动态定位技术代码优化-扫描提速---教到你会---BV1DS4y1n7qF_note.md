# è¯¾ç¨‹ P40ï¼š051-åŠ¨æ€å®šä½æŠ€æœ¯ä»£ç ä¼˜åŒ–-æ‰«ææé€Ÿ ğŸš€

![](img/27eb916b60a77671287e0fe96bea88e3_1.png)

åœ¨æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ä¼˜åŒ–ä¸Šä¸€èŠ‚è¯¾ç¼–å†™çš„ç‰¹å¾ç æœç´¢å‡½æ•°ï¼Œä»¥è§£å†³å…¶è¿è¡Œé€Ÿåº¦æ…¢ã€CPUå ç”¨ç‡é«˜çš„é—®é¢˜ã€‚æˆ‘ä»¬å°†é€šè¿‡ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰çš„å­—èŠ‚è½¬åå…­è¿›åˆ¶å­—ç¬¦ä¸²å‡½æ•°æ¥æ›¿æ¢åŸæœ‰çš„`sprintf`è°ƒç”¨ï¼Œä»è€Œæ˜¾è‘—æå‡æ‰«ææ•ˆç‡ã€‚

---

## æ¦‚è¿°

ä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†ç‰¹å¾ç æœç´¢å‡½æ•°çš„åŸºæœ¬å®ç°ï¼Œä½†åœ¨æµ‹è¯•ä¸­å‘ç°å…¶æœç´¢å®šä½é€Ÿåº¦ç‰¹åˆ«æ…¢ï¼ŒCPUèµ„æºå ç”¨éå¸¸é«˜ã€‚æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•é€šè¿‡ä»£ç ä¼˜åŒ–æ¥è¿›è¡Œç›¸å…³çš„æé€Ÿå¤„ç†ã€‚

æ‰“å¼€ç¬¬50è¯¾çš„ä»£ç ã€‚

![](img/27eb916b60a77671287e0fe96bea88e3_1.png)

ç»è¿‡æµ‹è¯•å‘ç°ï¼Œæˆ‘ä»¬æ‰€ç¼–å†™çš„ä»£ç å¤§éƒ¨åˆ†æ˜¯æ‰‹å†™çš„ã€‚åœ¨å¾ªç¯å†…éƒ¨ï¼Œæˆ‘ä»¬åå¤è°ƒç”¨ä¸€ä¸ªå°†å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²çš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°æ˜¯æˆ‘ä»¬çº¯æ‰‹å·¥ç¼–å†™çš„ï¼Œé€»è¾‘æœ¬èº«åº”è¯¥æ²¡æœ‰é—®é¢˜ã€‚é—®é¢˜å¯èƒ½å‡ºåœ¨å¾ªç¯å¤–éƒ¨è°ƒç”¨çš„`itoa`æˆ–`BytesToHexString`å‡½æ•°ï¼Œä»¥åŠåœ¨å¾ªç¯å†…éƒ¨é¢‘ç¹ä½¿ç”¨çš„`sprintf`æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°ã€‚æœ¬èŠ‚è¯¾æˆ‘ä»¬å°†å°è¯•è‡ªå·±ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥æ›¿æ¢`sprintf`ã€‚

åœ¨æ›¿æ¢çš„åŒæ—¶ï¼Œå¿…é¡»ä¿è¯åŠŸèƒ½ä¸å˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±å®ç°å°†å­—èŠ‚æ•°æ®è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²å½¢å¼çš„åŠŸèƒ½ã€‚

åœ¨ä¹¦å†™æ–°å‡½æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆåšä¸€ä¸‹åˆ†æã€‚

## è½¬æ¢åŸç†åˆ†æ

é¦–å…ˆï¼Œå‡è®¾æˆ‘ä»¬ç”¨`c`æ¥è¡¨ç¤ºä¸€ä¸ªå­—èŠ‚çš„æ•°å€¼ï¼ˆä¾‹å¦‚`255`ï¼‰ï¼Œæˆ‘ä»¬è¦å°†å…¶è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²`"FF"`ã€‚åº”è¯¥å¦‚ä½•è½¬æ¢å‘¢ï¼Ÿ

æˆ‘ä»¬å¯ä»¥å°†`c`æ‹†åˆ†ä¸ºé«˜ä½å’Œä½ä½ä¸¤éƒ¨åˆ†ï¼š
*   **ä½ä½**ï¼šå¯ä»¥é€šè¿‡ `c % 16` å–ä½™æ•°è·å¾—ã€‚
*   **é«˜ä½**ï¼šå¯ä»¥é€šè¿‡ `c / 16` å–æ•´é™¤ç»“æœè·å¾—ã€‚

ä¾‹å¦‚ï¼Œå¯¹äºæ•°å€¼`255`ï¼š
*   `255 / 16 = 15` (é«˜ä½)
*   `255 % 16 = 15` (ä½ä½)

ä¸¤ä¸ª`15`åœ¨åå…­è¿›åˆ¶ä¸­éƒ½ç”¨`F`è¡¨ç¤ºï¼Œå› æ­¤ç»“æœä¸º`"FF"`ã€‚

å†ä¾‹å¦‚ï¼Œæ•°å€¼`10`ï¼š
*   `10 / 16 = 0` (é«˜ä½)
*   `10 % 16 = 10` (ä½ä½)

`0`ç”¨`0`è¡¨ç¤ºï¼Œ`10`ç”¨`A`è¡¨ç¤ºï¼Œå› æ­¤ç»“æœä¸º`"0A"`ã€‚

åˆä¾‹å¦‚ï¼Œæ•°å€¼`30`ï¼š
*   `30 / 16 = 1` (é«˜ä½)
*   `30 % 16 = 14` (ä½ä½)

`1`ç”¨`1`è¡¨ç¤ºï¼Œ`14`ç”¨`E`è¡¨ç¤ºï¼Œå› æ­¤ç»“æœä¸º`"1E"`ã€‚

äº†è§£äº†å¤§è‡´åŸç†åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ç¼–å†™ä»£ç äº†ã€‚

## ç¼–å†™è‡ªå®šä¹‰è½¬æ¢å‡½æ•°

æˆ‘ä»¬å°†å‡½æ•°çš„è¯´æ˜å¤åˆ¶è¿‡æ¥ï¼Œåœ¨å…¶å‰é¢ç¼–å†™æ–°çš„ä»£ç ã€‚

é¦–å…ˆï¼Œå‡½æ•°éœ€è¦æ¥æ”¶ä¸€ä¸ªå­—èŠ‚`c`ï¼Œå¹¶è¿”å›å…¶å¯¹åº”çš„ä¸¤ä½åå…­è¿›åˆ¶å­—ç¬¦ä¸²ã€‚

```c
char* ByteToHex(char* buffer, unsigned char c) {
    // åˆå§‹åŒ–é«˜ä½å’Œä½ä½å˜é‡
    unsigned char high = 0;
    unsigned char low = 0;

    // è®¡ç®—é«˜ä½å’Œä½ä½
    low = c % 16;
    high = c / 16;

    // å¤„ç†é«˜ä½çš„è½¬æ¢
    if (high > 9) {
        // å¤§äº9æ—¶ï¼Œè½¬æ¢ä¸ºA-F
        buffer[0] = 'A' + (high - 10);
    } else {
        // å°äºç­‰äº9æ—¶ï¼Œè½¬æ¢ä¸º0-9
        buffer[0] = '0' + high;
    }

    // å¤„ç†ä½ä½çš„è½¬æ¢
    if (low > 9) {
        // å¤§äº9æ—¶ï¼Œè½¬æ¢ä¸ºA-F
        buffer[1] = 'A' + (low - 10);
    } else {
        // å°äºç­‰äº9æ—¶ï¼Œè½¬æ¢ä¸º0-9
        buffer[1] = '0' + low;
    }

    // ä¸ºå­—ç¬¦ä¸²æ·»åŠ ç»“æŸæ ‡å¿—
    buffer[2] = '\0';

    // è¿”å›ç¼“å†²åŒºåœ°å€
    return buffer;
}
```

ä»£ç ç¼–å†™å¥½åï¼Œæˆ‘ä»¬éœ€è¦å…ˆè¿›è¡Œæµ‹è¯•ï¼Œç¡®ä¿åŠŸèƒ½æ­£ç¡®ã€‚

![](img/27eb916b60a77671287e0fe96bea88e3_3.png)

## æµ‹è¯•è‡ªå®šä¹‰å‡½æ•°

![](img/27eb916b60a77671287e0fe96bea88e3_5.png)

![](img/27eb916b60a77671287e0fe96bea88e3_7.png)

æˆ‘ä»¬åœ¨ä¸»å‡½æ•°ä¸­è°ƒç”¨è¿™ä¸ªæ–°å‡½æ•°è¿›è¡Œæµ‹è¯•ã€‚

![](img/27eb916b60a77671287e0fe96bea88e3_9.png)

```c
// æµ‹è¯•ä»£ç 
unsigned char c = 222;
char hexBuffer[3];
ByteToHex(hexBuffer, c);
printf("c = %d, Hex = %s\n", c, hexBuffer);
```

![](img/27eb916b60a77671287e0fe96bea88e3_11.png)

![](img/27eb916b60a77671287e0fe96bea88e3_13.png)

è¿è¡Œæµ‹è¯•ï¼Œå¦‚æœè½¬æ¢æ­£ç¡®ï¼Œåº”è¯¥è¾“å‡º `c = 222, Hex = DE`ã€‚

![](img/27eb916b60a77671287e0fe96bea88e3_11.png)

![](img/27eb916b60a77671287e0fe96bea88e3_15.png)

![](img/27eb916b60a77671287e0fe96bea88e3_17.png)

æµ‹è¯•ç»“æœæ˜¾ç¤º`222`è½¬æ¢æˆäº†åå…­è¿›åˆ¶å­—ç¬¦ä¸²`DE`ï¼Œè¯æ˜æˆ‘ä»¬çš„è®¡ç®—å’Œå‡½æ•°é€»è¾‘æ˜¯æ­£ç¡®çš„ã€‚

![](img/27eb916b60a77671287e0fe96bea88e3_19.png)

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨è¿™ä¸ªè‡ªå®šä¹‰å‡½æ•°æ›¿æ¢æ‰åŸæœç´¢å‡½æ•°ä¸­é¢‘ç¹è°ƒç”¨çš„`sprintf`éƒ¨åˆ†ã€‚

![](img/27eb916b60a77671287e0fe96bea88e3_21.png)

![](img/27eb916b60a77671287e0fe96bea88e3_23.png)

![](img/27eb916b60a77671287e0fe96bea88e3_24.png)

## æ›¿æ¢å¹¶éªŒè¯ä¼˜åŒ–æ•ˆæœ

![](img/27eb916b60a77671287e0fe96bea88e3_26.png)

å°†åŸæœç´¢å¾ªç¯ä¸­çš„`sprintf`è°ƒç”¨æ›¿æ¢ä¸ºæˆ‘ä»¬çš„`ByteToHex`å‡½æ•°ã€‚

![](img/27eb916b60a77671287e0fe96bea88e3_28.png)

![](img/27eb916b60a77671287e0fe96bea88e3_30.png)

```c
// æ›¿æ¢å‰
// sprintf(tempHex, "%02X", data[i]);

![](img/27eb916b60a77671287e0fe96bea88e3_32.png)

// æ›¿æ¢å
ByteToHex(tempHex, data[i]);
```

æ›¿æ¢å®Œæˆåï¼Œé‡æ–°ç¼–è¯‘å¹¶è¿è¡Œç‰¹å¾ç æœç´¢ç¨‹åºã€‚

![](img/27eb916b60a77671287e0fe96bea88e3_34.png)

![](img/27eb916b60a77671287e0fe96bea88e3_36.png)

![](img/27eb916b60a77671287e0fe96bea88e3_36.png)

![](img/27eb916b60a77671287e0fe96bea88e3_38.png)

ä¼˜åŒ–åï¼Œæœç´¢é€Ÿåº¦å˜å¾—éå¸¸å¿«ï¼Œèƒ½å¤Ÿç¬é—´å®šä½åˆ°ç‰¹å¾ç åœ°å€ã€‚å³ä½¿ä¸é™å®šèµ·å§‹å’Œç»“æŸèŒƒå›´è¿›è¡Œå…¨å†…å­˜æ‰«æï¼Œé€Ÿåº¦ä¹Ÿæœ‰æ˜¾è‘—æå‡ã€‚

![](img/27eb916b60a77671287e0fe96bea88e3_40.png)

![](img/27eb916b60a77671287e0fe96bea88e3_42.png)

![](img/27eb916b60a77671287e0fe96bea88e3_44.png)

![](img/27eb916b60a77671287e0fe96bea88e3_44.png)

![](img/27eb916b60a77671287e0fe96bea88e3_46.png)

## æ€»ç»“

![](img/27eb916b60a77671287e0fe96bea88e3_47.png)

![](img/27eb916b60a77671287e0fe96bea88e3_48.png)

æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†å¦‚ä½•é€šè¿‡ä¼˜åŒ–ä»£ç æ¥æå‡ç‰¹å¾ç æ‰«æçš„é€Ÿåº¦ã€‚æˆ‘ä»¬åˆ†æäº†åŸå‡½æ•°æ€§èƒ½ç“¶é¢ˆåœ¨äºå¾ªç¯å†…é¢‘ç¹è°ƒç”¨`sprintf`ï¼Œç„¶åè‡ªå·±å®ç°äº†ä¸€ä¸ªé«˜æ•ˆçš„å­—èŠ‚è½¬åå…­è¿›åˆ¶å­—ç¬¦ä¸²å‡½æ•°`ByteToHex`æ¥æ›¿ä»£å®ƒã€‚é€šè¿‡è¿™ä¸ªç®€å•çš„ä¼˜åŒ–ï¼Œæˆ‘ä»¬æˆåŠŸè§£å†³äº†æ‰«æé€Ÿåº¦æ…¢å’ŒCPUå ç”¨é«˜çš„é—®é¢˜ï¼Œä½¿å¾—åŠ¨æ€å®šä½æŠ€æœ¯çš„å®ç”¨æ€§å¤§å¤§å¢å¼ºã€‚