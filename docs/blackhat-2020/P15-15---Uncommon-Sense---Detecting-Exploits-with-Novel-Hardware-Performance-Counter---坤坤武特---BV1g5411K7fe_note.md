# P15：15 - Uncommon Sense - Detecting Exploits with Novel Hardware Performance Counter - 坤坤武特 - BV1g5411K7fe

![](img/25a94c777e6c53a55a1b1a48b02aaea7_1.png)

## 概述

在本节课中，我们将学习如何使用新型硬件性能计数器检测漏洞。我们将探讨硬件性能计数器的工作原理，以及如何利用它们来检测Spectre和Meltdown等漏洞。

## 硬件性能计数器

**什么是硬件性能计数器**？

* 硬件性能计数器是用于计数事件硬件设备。
* 它们通常用于调试系统或程序性能问题，例如缓存未命中或分支预测错误。
* **公式**： 硬件性能计数器 = 计数器事件 / 时间

**硬件性能计数器的类型**

* **CPU PMU**： 每个CPU核心或超线程上的性能监控单元。
* **其他PMU**： 用于特定功能的硬件监控单元，例如内存或I/O。

## Spectre和Meltdown漏洞

**Spectre和Meltdown漏洞**：

* 这些漏洞利用了现代处理器的推测执行功能。
* 攻击者可以读取其他进程的内存内容，从而窃取敏感信息。

**检测Spectre和Meltdown漏洞**

* 我们使用三个计数器来检测Spectre和Meltdown漏洞：缓存未命中数、缓存引用数和分支错误数。
* **公式**： 缓存未命中率 = 缓存未命中数 / 缓存引用数

## 新型硬件性能计数器

**新型硬件性能计数器**：

* 这些计数器尚未由英特尔公开文档记录。
* 我们使用Linux Perf计数器来收集这些计数器的数据。

**实验结果**

* 我们使用SVM、随机森林、XGBoost和HGB模型来分析这些计数器。
* XGBoost模型在检测Spectre和Meltdown漏洞方面表现最佳。

## 模型解释

* 我们使用SHAP库来解释模型的预测结果。
* **公式**： SHAP值 = 特征值 * 模型系数

## 其他漏洞检测

* 我们还尝试使用这些计数器来检测ROP和栈溢出攻击。
* 结果表明，这些计数器可以有效地检测这些漏洞。

![](img/25a94c777e6c53a55a1b1a48b02aaea7_3.png)

## 未来工作

* 我们计划将数据收集自动化，并扩展到其他微架构。
* 我们还计划探索其他PMU，例如未核计数器。

## 总结

在本节课中，我们学习了如何使用新型硬件性能计数器检测漏洞。我们探讨了硬件性能计数器的工作原理，以及如何利用它们来检测Spectre和Meltdown等漏洞。我们还展示了如何使用机器学习模型来分析这些计数器，并解释了模型的预测结果。