# 【B站最系统的网络安全教程】北大大佬196小时讲完的网安教程，全程干货无废话！学完即可就业，别在盲目自学了！！！ - P23：第21天：命令执行漏洞-命令执行漏洞利用及防御 - 网络安全就业推荐 - BV1Zu411s79i

呃我们上节课的话是讲了，给大家介绍了一个命令执行，然后在我们呃我们这节课的话呃，上节课是讲了命令执行漏洞的一个简介，就是我们通过对命令执行就造成命令执行，还有代码执行的一些函数。

他的一个介绍以及它的一个基本的一个原理，来理解命令执行漏洞，它是什么样子的一个呃过程，那我们呃这节课的话主要是讲一下，命令执行漏洞的一些利用，然后的话还有就是呃命令执行漏洞的一个防护。

然后在上课之前的话呃，我们先大概的过一遍，我们上节课所讲的一个内容好吧，跟大家跟我一起来过一遍，加深一下印象，首先的话我们是有讲了命令执行漏洞，它产生的一个原因就是啊。

跟我们的一个circle注入以及xx s s这种哦，漏洞也是类似的，就说他没有对用户的一个输入，做严格的一个警察过滤，然后把用户的一个输入，当成了它的一个呃代码去进行一个执行。

然后的话就导致啊命令执行的一个漏洞，然后它的一个危害的话，跟我们的就之前讲web share是类似的，就说我们的一个命令执行漏洞的话，就相当于就是说我们可以利用web服务器对啊。

利用应用系统上面的这样子的一个漏洞来去啊，执行服务器的一些命令来得到服务器的一个shell，好的话就是呃我们有介绍呃命令执行的两种，第一种的话就是一个远程的一个代码执行，第二种的话就是一个呃远啊。

远程的一个命令执行，就它的一个区别的话，就在于我们的执行的这样的一些函数，它是它的一个作用是不一样的，就说我们的一个代码执行的话，它是一个代码逻辑，它存在这样子子的一个漏洞，然后的话它是它执行的呃。

就是能够去进行一个命令执行的一个效果的话，它是执行我们的一个菲律宾代码，然后的话，如果他是想要去执行我们的一个系统命令的话，就同样的需要调用我们的，而在菲律宾当中去调用系统命令，执行的这样的一些函数。

来去执行一个系统的命令，而我们的一个系统命令执行的话，就是说他啊应用系统，它本身就存在这样子的一些功能点，就说去调用系统的一个命令，然后的话它的这个功能点，它呃，就是说要嗯要设计这样子的一个功能点的话。

在菲律宾当中，它是需要去调用这样子的一些调用系统命令的，一些函数的，所以说的话如果没有对我们的一个用户做一个，对我们用户的一个输入，做一个严格的一个过滤的话，就很容易去导。

导致这样子的一个命令执行的一个漏洞，然后的话在远程代码之前的话，我们主要介绍了error函数哦，还有set函数啊等等的，这样的一些就是能够去进行一个，命令执行的一些函数，然后这些函数的话。

其实啊我们最常见的就是这种ever，还有asset对吧，就是说在这种函数我们再去进行一个构造，我们的一个一句话码的时候也会去使用到，因因为它就说我们的一个一句话码，也是需要去使用到这样子的一些函数。

来去执行我们的一个菲律宾代码，来进行一个命令的一个执行，然后呃这里的一些函数的话，而这里的一些函数对了，就说我今天的话有发了这样子的一个文档啊，昨天的话是忘记发给大家，就是在刻晴的时候好。

我这里有发了这样子的两个文档，在这里的话是我写的，就相当于一个笔记给大家去进行一个查看，就是啊，这就是这里的话有详细的，就是说明了这样的一些函数，它的一个作用以及它的一个使用好的话，我们怎么去啊。

如果说大家看不懂这样子的一些，菲律宾代码的话，就说不知道怎么去使用的话，我这里也有这样子的一个截图，大家可以去尝试一下啊，其实你尝试之后的话，你就能够基本的理解它的一个作用。

这个的话我有有让大家去进行一个预习，大家有没有去查看呢，看这里的话没没有多少人看啊，还有的话就是一个菲律宾的一个命令，执行的一个函数，好这里的话呃我们上节课也大概的有介绍啊。

就是ph命令执行的一个函数的话，主要的话就是这四个e x e c system，还有这个pass思路，还有这一个需要x1 c，这是呃比较常用的，能够啊，就是专门的去执行，我们的一个外部命令的一个函数。

呃然后具体的他的一个怎么去，我上节课的话是讲了前面的对吧，后面的话有两个是没有给大家做一个，基本的一个介绍，后面这两个的话大家其实在本地啊，或者是说，呃这里的一个昨天的话，忘记放到这个服务器上面去了。

大家可以在这个服务器上面去进行一个呃尝试，然后的话在本地的话大家也可以，就是我昨天的话也有发代码，然后在服务端的话，在这个服务器啊，在这个靶场上面，我是今天的话有把一些代码做了一个更改。



![](img/27ecec39c1c1422d0612814eb1b56ab4_1.png)

![](img/27ecec39c1c1422d0612814eb1b56ab4_2.png)

![](img/27ecec39c1c1422d0612814eb1b56ab4_3.png)

![](img/27ecec39c1c1422d0612814eb1b56ab4_4.png)

咳咳，啊我把代码的话是放在了这一个目录。

![](img/27ecec39c1c1422d0612814eb1b56ab4_6.png)

就大家嗯因为这个这里的话。

![](img/27ecec39c1c1422d0612814eb1b56ab4_8.png)

这些的话是不是很全啊。

![](img/27ecec39c1c1422d0612814eb1b56ab4_10.png)

没没有写全。

![](img/27ecec39c1c1422d0612814eb1b56ab4_12.png)

就是大家想看就是详细的，详细的一个的话，大家可以呃就用之前的一个shell对吧，大家大家在这个服务器上面的话，上面的一个shell都是没有删除的，大家可以用之前的一个shell。

然后的话呃用菜刀啊连上这个服务器，服务器好的话，在这个目录下面查看他的一个文件名啊，没有啊。

![](img/27ecec39c1c1422d0612814eb1b56ab4_14.png)

没有写，没有把它全部写到那个页面上去了，好的话，我这里的话。

![](img/27ecec39c1c1422d0612814eb1b56ab4_16.png)

我就是对昨天的一些代码的话做了一个修改，就是便于大家的一个理解，嗯比如说。

![](img/27ecec39c1c1422d0612814eb1b56ab4_18.png)

大哥。

![](img/27ecec39c1c1422d0612814eb1b56ab4_20.png)

诶。

![](img/27ecec39c1c1422d0612814eb1b56ab4_22.png)

我今天的话是把昨天的一个代码的话，做了一个修改，就是说呃之前的话是没有说有这种输入的，这种界面啊，我这样的话就随意的写了一个，简单的一个这种页面啊，比如说这一个函数，大家想要去进行一个操作对吧。

这个every feat我们嗯，诶对照一下它的一个使用是这个对吧。

![](img/27ecec39c1c1422d0612814eb1b56ab4_24.png)

然后他的一个源代码的话是像这样子哦，大家可以在需要上面直接去连接。

![](img/27ecec39c1c1422d0612814eb1b56ab4_26.png)

去查看它的一个源代码。

![](img/27ecec39c1c1422d0612814eb1b56ab4_28.png)

然后它的一个使用的话就是呃。

![](img/27ecec39c1c1422d0612814eb1b56ab4_30.png)

我这样的话，前面呃就是这个函数。

![](img/27ecec39c1c1422d0612814eb1b56ab4_32.png)

我先看一下，看一下代码。

![](img/27ecec39c1c1422d0612814eb1b56ab4_34.png)

这个的话就是呃我这个页面的一个源代码，其实呃主要他的一个代码的话就是。

![](img/27ecec39c1c1422d0612814eb1b56ab4_36.png)

这里的话就是一个写了一个div，就是前端的一个代码，就是这里的显示的这样的一个界面。

![](img/27ecec39c1c1422d0612814eb1b56ab4_38.png)

然后的话主要的话就是这里，这里的话就是呃，我们通过post的方式来去提交。

![](img/27ecec39c1c1422d0612814eb1b56ab4_40.png)

我们的这样子的两个参数对吧，就然后我们可以在这里输入我们的呃一个，比如说出了一个字符，我这里的话想要去执行我们的一个命令，然后就利用这样子的一个函数去进行一个执行，然后可以看到的话。

我这里的话传递的是一个system，然后我们这里传递的一个post的方式。

![](img/27ecec39c1c1422d0612814eb1b56ab4_42.png)

传到传递到服务端的话，它就会传到这里来啊，传到这里来对吧，传到这里来之后的话，呃会呃放到这里，传到这里就是呃在利用这一个函数去进行一个，就调用这里我们传递的这样的一个，f u n c的这个函数。

来去处理，我们这一个数组里面所传递的一个参数。

![](img/27ecec39c1c1422d0612814eb1b56ab4_44.png)

然后我们这里的话就是要传递我们的一个呃，想要让我们上面所传递的这一个函数，去处理的一个参数，比如说我们这里想要去啊，用这个system去执行我们的一个系统命令对吧，执行我们的一个外卖。

你看到他这样的话是一个返回的是一个阿帕奇，就当前的一个呃权限的话，就是一个阿帕奇的一个用户权限。

![](img/27ecec39c1c1422d0612814eb1b56ab4_46.png)

这样的话还有其他的一些命令，我这样的话就不一一演示了。

![](img/27ecec39c1c1422d0612814eb1b56ab4_48.png)

呃然后的话还有其他的一些函数，上节课的话有讲过了，我就这里的话我就不不再啰嗦了。

![](img/27ecec39c1c1422d0612814eb1b56ab4_50.png)

然后呃在这个服务器上面的，有，这么多的一些啊，就是代码，每一个代码的话它都有一个页面，大家可以去尝试一下，然后这个的话是留做一个课后作业哦，还有就是一个。

s y s s y s的话就是我们的一个系统命令，执行系统命令的这样的一些函数。

![](img/27ecec39c1c1422d0612814eb1b56ab4_52.png)

![](img/27ecec39c1c1422d0612814eb1b56ab4_53.png)

然后的话我们还有就是呃，上节课的话我介绍了一些就是在命令执行当中，常用的一些特殊字符，但是的话只是通过这样子的一个例子，来给大家做了一个而表示，然后没有可能没有实际的去进行一个嗯演示。

就说通过实例去进行一个演示，我们如何去使用这样子的一些特殊字符，来执行我们想要的一个命令，然后这里的话呃。



![](img/27ecec39c1c1422d0612814eb1b56ab4_55.png)

我们就以一些啊例子来演示，我们的这样子的一个命令执行，如何去呃，使用我们的这样的一些特殊字符，来构造我们的一个payload，来进行一个命令的一个执行。



![](img/27ecec39c1c1422d0612814eb1b56ab4_57.png)

而这里的话呃，大家访问一下这几个网址，发群里了，这样子的几个丸子呃，我这样的话总共的话是有四个页面，然后在大家访问的时候，就在后面改一下就可以了，比如说二他都是这样子的一个页面。

然后这里的一个这里的一个页面的话，功能的话比较简单，就我们可以看到他这样的话是请了，那你说那你输入测试目标的一个ip地址对吧，他这里提示我们输入一个ip地址，我们来呃。

出了一个随意随意的输入一个ip地址，来去进行一个尝试，我这样的话输入一个呃，本地的一个回环地址来去执行一下，发送一下，然后可以看到它这里画是执行的是一个p命令，对啊就是啊就是前面我们有说到的。

我们从这里的话，它的一个返回的一个结果来看的话，可以啊，知道它是调用了我们的一个系统的一个ping命令，然后我们在这里输入的话，就是输入我们的这样子的一个ip，就这里的话相当于就是一个检测你指定主机的。

一个就是呃存活，就是能否去访问到，你这里测试的一个目标ip地址，它就提供了这样子的一个功能，然后的话这里的，这里的这个功能点，我们知道它是调用了一些系统命令对吧，然后的话我们这里的一个输入的话。

是我们可以去进行一个控制的，然后在这里的话，我们可以去进行一个命令执行的一个呃测试，看它是否存在这样子的一个漏洞是吧，然后这里的话我们就需要去呃，使用到我们这里有介绍的，这样子的一些特殊字符。

比如说第一个第一个的话就是一个树干，树干的话，而我们也可以叫它广道服，就是说它可以去迎接我们的前后两个命令呃，管道服，它的一个意思就是说我们前面的一个执行，把我们前面的这个命令的一个执行结果。

作为我们后面的一个命令的一个参数，然后我这里的话，同样的就是输入这样子的一个i p对吧，然后我们在后面再，我们想要执行其他的一些命令，尝试一下，我们输一个树干对吧，我们如果前面我们知道前面的话。

它是可以执行成功的对吧，执行成功，然后我们后面再接一个命令，比如说我这里的话啊，这一个换mi这样子的一个命令，然后去进行一个尝试，尝试的话，我们看他返回的一个结果是什么样的，然后可以看到这里的话。

它只返回了一个阿帕奇，那这个阿帕奇的话我们可以知道他是啊，它的它就是我们刚刚执行的一个mi命令，所返回的一个结果对吧，然后呃为什么它是只返回了这样子的一个呃，或m i的一个命令呢。

就是这里的一个就说我们的这个树干的话，他无论前面它是否执行成功，后面的这一个命令都会被执行，就是说我们前面他不管是否执行成功了，是否有执行，它都会执行我们后面的一个命令，然后我们这里其实也可以尝试。

比如说我们一个test，然后后面接我们的一个，外卖，来尝试看是否能够去执行命令，然后可以看到的话，我这里，我们啊回车可以看到他这里的话是返回了，我们想要的一个结果。

也就是一个户外mi的执行命令之后的一个结果，然后大家可能看到这里的话可能会有疑问，为什么能够去执行我们啊，为什么我们家这样子的一个呃树干的一个符号。



![](img/27ecec39c1c1422d0612814eb1b56ab4_59.png)

就能够执行命令呢。

![](img/27ecec39c1c1422d0612814eb1b56ab4_61.png)

啊这里的话哦，我们通过我们的一个云代码来对它做一个分析，呃那个页面的一个源代码的话，就是像这样子跟前面的一个页面的话是类似的，呃，主要的主要的一个核心代码，就是在这里就在这一串。

然后在这一块呢我们先来捋一下啊，它的一个代码的一个逻辑，首先的话我们可以在这里我们先从下面开始吧，这里的话就是一个div，就是我们的这样子的一个页面对吧，刚刚那个输入框的一个页面。

我们写的一个htm的一个代码，然后的话他这里的话是呃有一个输入框对吧，然后这个输入框的话，就是我们要向我们的一个服务端传递的，那个呃字符，或者说要向服务端去传递的一个命令，也就是我们啊用户或者说攻击者。

能够去可以控制的一个输入，然后的话呃这里的一个输入的话，它就会好传到这里，这里的一个代码，这里的一个代码的话就是呃检测你的excel的话，而这里的一个绿色的话就是判断啊，你的这里的一个变量它是否好。

是否含有这样子的一个和数据，好在这里的一个意思的话，就是呃你是否有接收到啊，这个summit这个参数参数，然后这里的一个值的话，就是从这里来传传过来的，就其实我们再去进行一个呃，上传文件的时候对吧。

我们要点击这样子的一个按钮，点击这样子的一个呃按钮的一个事件，点击之后的话，它就会呃，有，就在前端的话会传递这样子的一个name的一个值，对吧，然后的话啊k h p代码的话。

它是从你传递的这里的这一根啊，内部的一个值来获取你传递的一个参数。

![](img/27ecec39c1c1422d0612814eb1b56ab4_63.png)

而这句话他是判断你是否有提交，就如果说你没有提交哦。

![](img/27ecec39c1c1422d0612814eb1b56ab4_65.png)

你没有点那个按钮的话，它是啊就没有触发这个事件的话，他是不会去啊传递到服务端的，然后第二个参数的话就是判断我们这里的啊，你这里的一个post的方式所传递的这一个啊，用户输入的一个数据。

然后通过post的方式来接收，接受这里的接收之后的话，做一个判断，你的这里的一个参数它是否有传递。

![](img/27ecec39c1c1422d0612814eb1b56ab4_67.png)

就说你直接这样子去进行一个提交的话。

![](img/27ecec39c1c1422d0612814eb1b56ab4_69.png)

它是不会啊，在服务端不会继续走下去。

![](img/27ecec39c1c1422d0612814eb1b56ab4_71.png)

走到下面的一个代码，如果判断你的这两个，这两个值都有了，他就会继续下面的一个代码的一个执行，然后然后的话就执行到这里，这里的话就是把我们的前面的所用户输入的，一个呃字符，把它给给到这个ip的这个变量。

给到这个变量的话，呃，这里的话这里的一个代码的话就是判断哦，你当前的一个服务端，它是什么，它是什么样子的一个系统啊，主要的就是这个kp your name这个函数。



![](img/27ecec39c1c1422d0612814eb1b56ab4_73.png)

这个函数的话是返回运行p h p系统的相关的，一个信息，就是说返回你啊运行这个p h p代码，它的一个服务器，它的一个系统的一些信息。



![](img/27ecec39c1c1422d0612814eb1b56ab4_75.png)

然后这些信息里面的话就包含有，包含有你当前的一个系统的一个类型，然后这里的一个代码的话，就是从你返回了这里的一个信息当中来去啊，匹配你是否有这样这样的一个windows的一个信息。

如果说呃有你返回了这些一个系统信息，里面有这个windows的话，就说明你的一个系统是一个windows的一个系统对吧，然后的话它就会执行下面的这样子的一个命令，这个执行命令的话。

它是使用的这个shell杠ex e c的这个函数，前面的话有讲到对吧，但是能够去调用我们的一个系统命令去执行啊，去执行的，然后这里它执行的一个命令就是一个ping命令，然后他的一个问题就是出在这里。

就是说我们用户输入的这样子的一个呃数据啊，把它传到了这个变量之后，传到这里的话，好判断了它的一个系统之后，他直接就把它拼接到了这里的一个，需要干1x一这个命令执行函数里面，然后的话他没有对我们的这。

这里的传入的一个数据做任何的一些处理，就是说没有对它的一个合法性，做一个判断以及过滤，然后的话攻击者的话就能够利用我们前面有啊。



![](img/27ecec39c1c1422d0612814eb1b56ab4_77.png)

我们。

![](img/27ecec39c1c1422d0612814eb1b56ab4_79.png)

前面提到的这样子的一些特殊的一个字符，来去啊啊拼接我们的一个命令，然后在这里的话，其实它的一个命令就是在服务端，它是这样子的一个显示，他其实在服务端去进行一个处理的话，就是他首先啊用这个需要按e 11。



![](img/27ecec39c1c1422d0612814eb1b56ab4_81.png)

调用这个ping命令对吧，然后ping的话ping命令的话，因为是在windows呃。

![](img/27ecec39c1c1422d0612814eb1b56ab4_83.png)

我这里的话，在windows上面，在windows上面去进行一个p。

![](img/27ecec39c1c1422d0612814eb1b56ab4_85.png)

然后ping的话啊，因为用户因为服务端它没有对我啊，用户的一个输入做任何的过滤，然后我们如果说是一个正常的一个输入对吧。



![](img/27ecec39c1c1422d0612814eb1b56ab4_87.png)

我们在这里输入一个正常的一个ip地址。

![](img/27ecec39c1c1422d0612814eb1b56ab4_89.png)

然后他就会把我们的这个ip地址，把它给拼接到这里，就是等于是就是在我们本地去执行，我们这样子的一个ping本地的一个ip，然后的话它的一个返回的一个结果。



![](img/27ecec39c1c1422d0612814eb1b56ab4_91.png)

就是这样子对吧，然后的话也返回到。

![](img/27ecec39c1c1422d0612814eb1b56ab4_93.png)

它会返回到我们的一个浏览器，就是像这样子。

![](img/27ecec39c1c1422d0612814eb1b56ab4_95.png)

好的话，我们因为他没有对我们的一个用户的一个输入，做一个过滤，我们可以使用这样子的一个管道服，我们在后面接一个管道符，然后的话在街上我们想要啊，额外执行的一个命令，比如说外卖查看当前的一个用户。

我们来执行一下，然后可以看到在这里的话执行之后，它返回的一个结果就是呃，一个mi执行之后的一个结果对吧，因为我们的这个管道符，它就是说它不管前面的一个命令，它是否执行成功或者失败。

它后面的一个命令它都会执行，然后他前面pin pin接，ping这一个本地的一个i p地址对吧，他执行了执行成功了，但是执行成功之后的话，我们后面的用这一个管道符连接的这一个命令。

后面的这个命令它同样的会去进行一个执行，执行之后的话，它返回了一个结果，就是这里的一个命令的一个执行结果。



![](img/27ecec39c1c1422d0612814eb1b56ab4_97.png)

所以说的话，我们就能够通过这样子的特殊的字符。

![](img/27ecec39c1c1422d0612814eb1b56ab4_99.png)

来进行一个拼接来执行，我们想要和服务端额外执行一个命令，比如说if can be对吧，查看。

![](img/27ecec39c1c1422d0612814eb1b56ab4_101.png)

查看他的ip信息对吧。

![](img/27ecec39c1c1422d0612814eb1b56ab4_103.png)

然后这里的话是在windows上面，然后如果说呃他返回的这样子的一个信息，他不是有windows的话，那么就说明的话他是这种unit x，或者是说linux系统对吧，然后的话linux系统上面的话。

跟windows上面的一个区别的话，就是在于命令它的一个不同啊。

![](img/27ecec39c1c1422d0612814eb1b56ab4_105.png)

就是你在linux里面，大家如果玩linux的话，就是你在linux里面去骗一个ip对吧，去骗一个ip的话，如果你不指定他发他发送pin数据的一pin的，就是他去pin的一个次数的话。

他就会一直拼下去对吧，他不会他不会停，他会一直骗下去，所以说的话这里他其实就是一个命令的一个不，同的话，就是我们通过杠c这样的一个参数，来指定他拼的一个次数。



![](img/27ecec39c1c1422d0612814eb1b56ab4_107.png)

然后的话在windows上面的话，默认的话就是它会进行一个，就是进行他会拼四次。

![](img/27ecec39c1c1422d0612814eb1b56ab4_109.png)

然后的话拼完四次之后，它就会啊结束，然后这样的话在历史上面的话，我们需要用这杠c的这样的一个参数。

![](img/27ecec39c1c1422d0612814eb1b56ab4_111.png)

来指定他pin的一个次数，因为如果你不指定的话，他就呃在服务端对吧，在服务端它会一直骗一直ping的话。



![](img/27ecec39c1c1422d0612814eb1b56ab4_113.png)

它的等于你的这个ping的一个呃程序，它是没有执行完毕的，如果你没有执行完毕的话，在这里服务在这里的一个浏览器的话，它就会一直在等待，就一直会在转，就是一直转，然后直到服务端它处理完。

这处理完这个程序之后的话。

![](img/27ecec39c1c1422d0612814eb1b56ab4_115.png)

他才会返回一个结果，显示在我们的一个浏览器上面，然后这里的话就是呃。

![](img/27ecec39c1c1422d0612814eb1b56ab4_117.png)

这一个例子它的一个嗯演示以及讲解啊，不知道大家有没有听懂呢，就大家对这一个有没有什么疑问。

![](img/27ecec39c1c1422d0612814eb1b56ab4_119.png)

大家有没有什么疑问呢，哦哦大家可以去进行一个尝试，i，链接的话就是这里学，需要的话，因为你这里的话，你能够通过这样子的一个啊管道符对吧，来去拼接我们的一个命令对吧，如果你你既然能够执行命令了对吧。

比如说我可以用echo来啊，就执行这样子的一个echo命令对吧，来像我们的这样子的，比如说写入一个一点tt这样子的一个文件。



![](img/27ecec39c1c1422d0612814eb1b56ab4_121.png)

那我们来执行一下，执行之后的话，我们可以来诶。

![](img/27ecec39c1c1422d0612814eb1b56ab4_123.png)

max mic。

![](img/27ecec39c1c1422d0612814eb1b56ab4_125.png)

![](img/27ecec39c1c1422d0612814eb1b56ab4_126.png)

我们可以用来测试一下，用echo执行就是一个写入的一个命令。

![](img/27ecec39c1c1422d0612814eb1b56ab4_128.png)

我们写入到一个一点text来就进行一个尝试，然后执行之后的话，我们可以来看一下哦，应该是有了的。

![](img/27ecec39c1c1422d0612814eb1b56ab4_130.png)

可以看到我们在这里的话啊，已经写入了这样子的一个文件对吧。

![](img/27ecec39c1c1422d0612814eb1b56ab4_132.png)

我们可以查看一下里面的内容，就是123是吧，我这里先可以测试一下呃，然后的话我们可以来访问一下，你们一点text这样的一个文件对吧，就是123的一个内容，然后我们我们就可以通过echo。

来去写我们的一个一句话嘛对吧，写我们的一句话码，把我们的一句话码命令呃，把它写到服务端，就能够直接去进行一个连接，然后的话呃还有就是呃，其实我后面的话也会有介绍的，就是通过啊通过这样子的一个命令执行。

来反弹一个shell，就说直接反弹shell，因为它能够它能够直接执行，我们的一个系统命令对吧，那么我们可以利用它来直用，就是说啊在link上面或者说windows上面。

把它需要的一些方式来直接反弹一个shell给我们，就不需要去进行一个闯码什么的，好的话，当然的话也可以去用命令执行来写shell对吧，我们可以直接用echo这样子的一个语句，写我们的一个一句话嘛对吧。

然后的话呃还有的话就是我们之前有讲到的，用这样子的，就是呃如果想你想要用大嘛对吧，想要上传一个大码的话，你就是啊可以用这样子的一个f puts，来写我们的一个小码，然后通过小码来上传我们的一个代码。

这样的话我前面的话有讲到了，呃，这里的话我等会再细讲吧，好我们先呃说前面的吧，这里的话啊你明白了吗，就理解了没有，就说你都能够去执行命令了对吧，你能够通过这样子的一个方式执行命令。

那么等于就是说你直接是在这样子的一个呃。

![](img/27ecec39c1c1422d0612814eb1b56ab4_134.png)

等于是直接在这样子的一个需要环境下面，去执行命令了，对，因为你单，因为你默认的一般的就是一个呃。

![](img/27ecec39c1c1422d0612814eb1b56ab4_136.png)

阿帕奇的一个权限对吧，然后的话你的这样的一个目录，你要想你要能够去写文件的话，因为我这里的话是直接用root用户，然后的话呃这里的这样的一个文件，文件权限的话是啊note组的，所以的话你阿帕奇的话呃。

然后的话呃之前的话是一个rx，他没有写的一个权限，没有一个写的权限的话，你是无法向这个目录下面去写文件的，可以的话，我这里的话是图方便。



![](img/27ecec39c1c1422d0612814eb1b56ab4_138.png)

就改了一个777的一个权限，好大啊，就是说一般的就是说你的一个web服务器的话，它会有存在这样子的一些目的，就是说你的一个阿帕奇用户，比如说你写这种日志，你啊或者说还有其他的一些一个要求。

或者说上传文件的这些目录的话，他呃阿帕奇的一个用户都是能够去进行一个呃，写文件的，出牌的话有额额外的一些性质，好理解了是吧啊，对有啊，有问题的扣一，没问题的扣二，啊还有问题吗，没问题的。



![](img/27ecec39c1c1422d0612814eb1b56ab4_140.png)

好的，没问题的话，那么我们继续，啊，前面的话我只是啊测试了这样子的一个管道服，对吧，然后的话我们还有其他的这样子的一些字符，它同样的能够去达到我们的这样子的一个目的，然后我们可以看一下这里呃。

我这里的话有贴了一个线程的一个代码。

![](img/27ecec39c1c1422d0612814eb1b56ab4_142.png)

呃大家可以去访问这个地址啊。

![](img/27ecec39c1c1422d0612814eb1b56ab4_144.png)

能够直接访问到。

![](img/27ecec39c1c1422d0612814eb1b56ab4_146.png)

![](img/27ecec39c1c1422d0612814eb1b56ab4_147.png)

然后就是这里的诶这里的四个，这里的四个题目大家可以去尝试做一下，然后这里的话啊，我刚刚的话是只讲讲到了用这个管道符对吧。



![](img/27ecec39c1c1422d0612814eb1b56ab4_149.png)

然后的话还有其他的一些符号，特殊的一个字符，能够去进行一个命令的一个拼接好，我们依次来做一个演示，首先第一个的话就是这个and符号，啊不是这个搞错了，是，这个，好的话就是这个n n的方呃。

这个这个是叫n的吗，还是叫那个叫啥，反正就是这样子的一个符号，这个符号的话，我们同样的可以跟前面的一个啊类似，能够去进行一个命令的一个拼接，又在后面拼接我们的一个命令来进行一个执行。

pso可以看到他这里的话，输出了一个pin的一个命令的一个结果，以及我们，它连接符后面的一个命令的执行结果哦。



![](img/27ecec39c1c1422d0612814eb1b56ab4_151.png)

还有其他的这样子的一些字符，这样的话我就不一一的一个尝试了，还有一个呃，大家可以也可以直接在我们的一个，就其实嗯可以直接在一个linux。



![](img/27ecec39c1c1422d0612814eb1b56ab4_153.png)

系统里面去进行一个尝试，就其实就是啊我这里这里这一张图片，其实就是啊列举了这样子的一些特殊字符，它的一个效果，好的话，我们继续，这样的话是第一个例子，第二个的话就是，我们同样的呃。

我这样的话我就不做一个测试了，我只对啊，我直接通过代码来去进行一个讲解啊，前面的话这里的一个代码的话呃，大家应该理解了吧，就就是他没有对我们的一个啊传入的一个，数据做一个处理。

然后直接的话带入到了这样子的一个啊，执行系统命令这样的一个函数去进行一个执行，好的话，执行系统命令的话，我们就可以通过这样子的一些特殊字符对吧，来去连接啊，我们的一个命令执行，我们想要的。

想要服务端执行的一个额外的一个命令，然后这里的话我们看一下这个代码，这里的一个代码跟前面的一个不同之处的话，就在于，就是我这里的话设置了这样子的一个黑名单，就这一个black list。

这里的一个黑名单的话，其实跟我们前面的一个文件上传的话，也是类似的，就是这里的话我们可以看到，这里的话是有一个数组，这个数组的话里面啊存储了这样这样子的啊，这个数组它里面定义的话。

就是把我们的这里的一个啊，and then的符号把它给替换为空，然后这里实际的一个替换的话，替换的一个操作的话，就是这这里的一个string path，我们的一个呃，替换我们的指定字符串的。

嗯呃诶这个应该讲了吧，就是字符串的一个替换的一个函数，就是说这个函数的话，他会呃把我们指定的这样子的这个subject，比如说不管它是字符串或者是说数组，他都会把我们就这里给定的这一个啊。

我们看这个圆形吧，就是这里的给定的这个字符串或者数，数组里面所有的这种元素，它都会被啊这里的一个rpace，就是说我们这里指定的这里的一个啊，替换的一个字符都会被它进行一个t服啊，不是被它进行一个替换。

然后替换的话这个strategy配置，它需要定义这样子的一个就是一个啊规则，就说你要匹配什么样的一些字符，然后的话去进行一个替换，在这里的话体现在代码上面的话，就是我们啊从我们的一个黑名单当中。

就从我们黑名单中取出我们的这样子的一个key，就是我们这里的一个and，还有这里的一个分号对吧，取出我们的这里的这两个字符，然后的话啊，再去进行一个呃，进行一个替换，我们这里输入的一个啊数据。

或者说字符串里面，是否有包含有这样子的一个啊黑名单当中，定义的这种字符，如果说包含有这种n的，还有封号这种字符的话，它就会啊把它进行一个替换为空的一个操作，这样的话就是啊这里的一个意思就是啊。

概括来说的话，就是移除所有包含在我们这里，黑名单当中的一个字符，就是把我们这里的一个字符替换为空，然后后面的话就是跟前面的一个代码的话，是一样的一个意思，这里的话主要的话就是在这里的定义了。

这样的一个黑名单对吧好，然后前面的话我们有说到，就是我们可以用这样子的一个嗯，它还有分号来去做，我们作为我们的一个命令的一个连接符对吧，然后执行我们的一个命令，然后的话这里定义了一个黑名单的话。

就过过滤了我们这样子的两个字符，但是的话我们其实从前面的一个文件上传，他们的一个黑名单那些规则当中也能够了解到，就是说黑名单它的一个啊这种策略的话，它是有很大的一个缺陷的，因为你黑名单的话。

你不可能把所有的这种特殊的一些字符，都能够把它给列进去，然后的话进行一个过滤对吧，这就是它的一个局限性，所以说的话我们就而能够寻找，或者说通过其他的这样的一些特殊字符。

来去进行一个绕过他的一个黑名单的一个过滤，然后的话我们就可以构造以下这样子的，一些payload，我们首先的话来看一下第一个，第一个的话就是通过这一个and封号，and这样子的一个字符对啊。

为什么这样子的话能够去进行一个logo呢，我们从代码里面代码的一个流程来看一下对吧，我们把我们这样子的一个数据，把它给传到服务端对吧，用post的方式获取到之后，给到这里的这里的一个ip的一个变量。

好的话，然后这个ip的话，他会给这一个string path这个函数做一个替换替换，里面的一个and fire有分号对吧，然后的话在这里的呃一个字符的话，它会把我们的这里的一个分号给匹配到。

然后的话进行一个替换，替换之后的话就是这样子的一个形式，关麦，然后的话它替换之后的话，就是把我们这里的一个分号给替换为空对吧，替换为空之后的话就是这样子的一个字符。



![](img/27ecec39c1c1422d0612814eb1b56ab4_155.png)

这样子的一个字符串，然后这个字符串的话他会继续往下面走，然后继续走到下面的话，它就会执行。

![](img/27ecec39c1c1422d0612814eb1b56ab4_157.png)

它会把它带入到这里的一个执行系统命令对吧，就是p，就是ping，然后的话接我们的一个这样呢，这样的一个字符是吧，然后其实从这里的话我们就可以看到，我们这里执行之后的话，同样的是能够得到我们的一个结果的。

因为他这里的话，我们虽然把我看到这里的一个分号给替换掉了，然后我们通过它就这一个黑名单，替换这个分号的一个规则，我们构造这样子的一个啊形式，它把它替换掉之后的话。



![](img/27ecec39c1c1422d0612814eb1b56ab4_159.png)

我们就能够，我们同样的能够组成这样子的一个，n的一个形式，同样的能够去执行我们的一个系统的一个命令，然后这句话。



![](img/27ecec39c1c1422d0612814eb1b56ab4_161.png)

看到这里的话就是他的执行的一个结果，前面是ping，后面的话是执行我们的外卖，然后自然的话我们就可以延伸的，啊不好意思啊，就可以延申去构造其他的这样子的一些pload，对吧。

还有还有的话他的一个黑名单是没有替换全的，就说没有规则，它是不全的，我们还有其他的一些字符，前面我们也说了这种管道服，还有两个树干的这种，还有的话呃一个人的符号也是可以的，然后的话还有就是通过这种呃。

它它的一个替换规则对吧，我们把这里的一个替换轴的话，能够构造成其他的，能够能够构造成其他的，同样能够去呃达到啊，命令执行的一个连接符的一个啊符号，就构造这样子的一个符号，哦还有其他的一些。

比如说它替换很能的嘛对吧，你可以把你能的放在中间，然后他把他一替换掉之后的话，就组合成了这样子的一个啊两个树干，然后的话带到这里执行系统命的话，它同样都能够执行我们的一个外卖的一个命令，这就是这个例子。

然后粒子三的话我们同样的看一下代码，从代码的话，我们其实也可以观察到，如果说你不看代码的话，你去进行一个测试的话，它你可能会发现我们前面啊，我们前面能去使用到的一些特殊的一些字符。

它都不能够进行一个使用了对吧，好的话，他把呃他这里的话跟前面的一个不同，就是他的一个黑名单的话，是就是它的一个规则的话变多了对吧，替换了这种我们的啊两个竖杠的，还有呃封号and符号对吧。

而其他的一些符号啊，他都给他做了一个过滤，然后这里的话就是他同样的，是一个黑名单的一个策略，然后这里的话就是要注意的一个地方的话，就是他这里过滤的话啊，我们进行一个logo的话。

就是这里它过滤的是一个树干，后面加一个空格对吧，但是的话它没有过滤我们的这样子的一个树干，所以说的话我们可以通过这样子的一个，特殊的一个字符来去进行一个logo啊，配料的话就是像这样子。

这个的话就是呃比较严格的一个，黑名单的一个机制，它把我们能够去进行一个命令拼接的一些字符，都给它进行了一个过滤，当然的话黑名单那个局限性就体现在这里，它无法过滤，完全啊过滤所有的这样子的一些呃字符。

这就是它的一个呃缺陷，也就是我们能够去进行一个利用的一些点，然后第四个的话这个例子的话呃，我这样的话就是特意把它给拿出来，就是说这里的话这个例子就是一个呃比较正常，就说没有漏洞的这样子的一个例子。

然后他为什么会没有漏洞的漏洞呢，我们从代码来给大家做一个分析。

![](img/27ecec39c1c1422d0612814eb1b56ab4_163.png)

呃这样的话可能看的话比较小。

![](img/27ecec39c1c1422d0612814eb1b56ab4_165.png)

我这样的话，编辑器里面进行一个查看，我们同样的，就代码的话我都有做一个注释啊，就大家在服务器上面查看这些代码的话，应该其实也是没有问题的啊，有做一个注释，就是其实这里的话主要的话，就是给大家过一下流程。

就是说好以这一个例子，我们如何通过，就是比较好的一个代码的一个啊，书写了一个方式来去呃，防御这样子的一个命令执行的一个漏洞，当然的话是只限于这样的一个例子，那我们可以从头的话来过一下啊。

前面的话就是同样的，就是接受我们的一个传递的一个数据对吧，那么post的方式给到这样子的一个i p变量。



![](img/27ecec39c1c1422d0612814eb1b56ab4_167.png)

然后的话传到了这里的一个strip resix，这样的一个函数，这个函数的话啊，调用这样子的一个函数，对我们所传入的一个i p啊，这里的一个字符做一个处理好的话，这里的一个strip呃，这个函数的话。

它的一个意思就是呃凡引用一个引用字符，然后的话返回一个去除，就是转移反斜线后的一个字符串，要转移转移，大家能够理解吗，就说这里的一个反斜杠，就是我们的一个转移的一个字符。

然后的话如果碰到这样子的一个字符的话，他就会把它给替换啊，就是反转反引用，把它给啊，反引用为这样子的一个原来的一个字符，就说你原来是所传递的是这样子的，一个有带有一个转移符号的一个字符。

它会把它给转化成啊，它有个转转一符给去除的。

![](img/27ecec39c1c1422d0612814eb1b56ab4_169.png)

这样的一个原始的一个字符，这就是它的一个函数的一个意思，然后的话他做了这样子的一个转移的一个处理，之后的话，它会带到这样子的一个函数，这个explode，这个exp函数的话，就是以我们这里的一个字符。

在这里的话，就是以点这一个字符。

![](img/27ecec39c1c1422d0612814eb1b56ab4_171.png)

来对我们的一个数据做一个分割哦，分割的话它是以点为一个分割，因为我们知道我们的一个ip的话，是一个顶分十进制对吧，点分十进制的一个形式，比如说这样子的127000001对吧。



![](img/27ecec39c1c1422d0612814eb1b56ab4_173.png)

他是你点做一个分隔的，然后的话他在这里的话，他把我们的一个i p，以我们的一个点字符做一个分隔，把它分割成了四个字节对吧，就是四个部分，然后的话再把它带，把我们的每一个部分都做了一个警察。

这个函数的话就是警察你的这里的一个啊，呃这里的一个数据它是否是一个整数，就是判断它是否是一个整数的一个类型，因为我们的一个i p它是顶分十进制对吧，我们所传递的这样子的一个啊。

就是说正常的一个ip它分开之后的话，它都是以一个整数的一个形式存在的对吧，好，这样的话他就把我们的分开之后，就说一点分隔之后的这样子的四个部分，都做了一个判断，判断你的这这些数据它是否是一个整数。

就是判判断它是否是一个ip对吧，然后判断完完毕之后的话，如果是都是整数的话，就说明能它是一个ip地址对吧，然后的话再对他做一个呃，就是一个拼接，拼接成一个ip，然后拼接成ip的话，下面的话就是啊。

执行我们就调用我们的一个系统命令，去进行一个执行对吧，然而为什么通过这样子的一个代码的。

![](img/27ecec39c1c1422d0612814eb1b56ab4_175.png)

一个过滤操作的话。

![](img/27ecec39c1c1422d0612814eb1b56ab4_177.png)

就能够去啊，就防御我们的这样子的一个命令执行漏洞呢，在这里的话我们啊以这一个payload为例啊，就以这一个吧。



![](img/27ecec39c1c1422d0612814eb1b56ab4_179.png)

对吧，就这一个我们像我们的，在这里传递我们的a。

![](img/27ecec39c1c1422d0612814eb1b56ab4_181.png)

输入我们的这样子的一个直线命令的一个语句，对吧。

![](img/27ecec39c1c1422d0612814eb1b56ab4_183.png)

然后他输入之后的话，它就会给到我们的这里的一个代码，给到之后的话，它会呃首先对我们那些转移字符做一个处理，对吧，我这里的话是没有的，然后处理之后的话，它就会把我们的一个ip分成四个字节。

然后他分的话会是这样分你一个点，就是嗯，以我们的一个点的这个字符来进行一个分隔，分隔成四个部分对吧，就是这四个部分，12344个部分，然后的话在对我们的这四个部分，四个字节做一个整数。

是否是一个整数的一个判断对吧，然后他在判断的时候的话，发现前面三个都是正常的对吧，它是一个整数，但是我们后面我们的一个拼接了，我们的一个2e的一个字符啊，就是二页的一些命令对吧。

所以说他在进行最后的一个字节的，一个判断的时候，可以看到它明显的是包含有这种字符的。

![](img/27ecec39c1c1422d0612814eb1b56ab4_185.png)

就说它不是一个整数类型，所以说的话他在这里去进行一个判断的时候，他就不会啊，就是，就在这里判断的时候，它就会啊，能够判断出我们这里传递的这样的一个啊字符。



![](img/27ecec39c1c1422d0612814eb1b56ab4_187.png)

它不是一个ip地址。

![](img/27ecec39c1c1422d0612814eb1b56ab4_189.png)

然后的话他就不会去带入到下面的一个啊命令，执行的一个步骤。

![](img/27ecec39c1c1422d0612814eb1b56ab4_191.png)

好的话，我们前面的其他的就其实这里的一个例子的话。

![](img/27ecec39c1c1422d0612814eb1b56ab4_193.png)

就是几乎啊比较呃合理的，比较完美的，就是把我们的这里的一个命令执行的一个漏洞，进行了一个防御。

![](img/27ecec39c1c1422d0612814eb1b56ab4_195.png)

这样的话大家能理解吗，就说这一些这里的一个代码，啊有问题的扣一，没问题的扣二。

![](img/27ecec39c1c1422d0612814eb1b56ab4_197.png)

这里的话不是一个白名单，他是通过代码对吧，我们首先的话，因为，诶我们首先的话我们先看一下，这里的这样的一个页面对吧，这里的一个页面，我们假设它就是一个呃，就是呃就是通过这样子的一个功能点。

来去检测指定的一个ip它是否存活，去去调用一个片面对吧，这样子的一个功能点，然后这里的一个功能点的话，我们在这里的话，正常的一个方式是输入我们的一个ip地址对吧，就是说正常的方式。

输入一个我们的一个ip地址来去进行一个ping，好的话。

![](img/27ecec39c1c1422d0612814eb1b56ab4_199.png)

如果说攻击者通过我们之前的一些方法，来去进行一个命令的一个拼接，然后在这里拼接的时候的话，它就会在代码里面可以看到，他通过这样子的一个方法把我们的一个ip地址，因为ip地址是一个顶分十进制的一个形式。

大家都知道对吧，就说一个正常的ip地址，它都是啊这样子的一个形式对吧，好的话，如果说你这里，这里这个ip地址包含有其他的一些字符的话，那说明你的这这里的话它是不是一个ip地址。

如果你不是一个ip地址的话，你就不会让你去执行这样子的一个命令，因为你的这个功能，就是为了去拼这样的一个ip地址，而不是说啊其他的能够去传递其他的一些字符，然后通过这样子的一个方法来去啊。

过滤掉或者说来去防御啊，攻击者通过这种啊，通过我们的一些命令拼接的一些字符来啊，传递我们其他的一些命令，这样的话呃能明白吗，因为我们这里要去调用，就是说要去执行这样子的一个拼命令的话，就说要去啊。

带带入到我们的这里的，一个需要杠x一去执行我们的一个片命令的话，我们首先就需要好经过前面的这些警察嘛，如果这样的话，这里的一个代码的话，就是把我们的就是首先去判断，我们的传入在这里的一个字符。

它是否是一个正常的一个ip地址，如果是正常的话，就带入到这里去执行，不正常的话，那说明他是恶意的一个字符。



![](img/27ecec39c1c1422d0612814eb1b56ab4_201.png)

就不允许你去进行一个命令的一个执行。

![](img/27ecec39c1c1422d0612814eb1b56ab4_203.png)

然后有问题的扣一，没问题的扣二，好都没有问题了，那么我们继续，呃前面的话呃我通过这样子的四个例子，就是说来给大家就是呃介绍了演示了啊，通过这样子的一些字符命令，拼接的一些字符来去执行我们想要的一些命令。

对吧，然后的话我们来看一下我们通过啊，就是说通过这样子的一个命令执行的一个漏洞，我们能够去，做一些什么样的一个操作，首先第一个的话，我们可以通过这样的一个命令执行，来访谈一个shell。

反弹shell的话，第一个问题就是啊我们常见的一个nc来反弹，需要它的一个命令的话，就是像这样子。

![](img/27ecec39c1c1422d0612814eb1b56ab4_205.png)

![](img/27ecec39c1c1422d0612814eb1b56ab4_206.png)

这句话是利用了一个这个nc，而关于这个nc的话，大家呃有去使用过吗，或者说了解这个工具吗，这是一个呃我们常用的一个命令，常用的一个工具就是nec cat，如果大家不了解的话，大家百度1下吧。

因为这种工具的话就是一些常见的一些命令，它的一个使用啊，有没有什么太多的一个好讲的，就是啊我们这个nc的话，它它这个功能的话很强啊，还是比较强大的，能看到他这句话可以进行一些端口扫描啊。

就是通过nc啊来去呃，就是探测指定的一个端口，它是否去是否是存活的，还有的话我们可以进行一个一些，文件的一个传输，还有呃传输一些目录哦，还有的话就是我们常用的通过nc来去进行静力，这样子的一个连接。

就是好得到一个shell，我们具体的话以这个例子来进行一个查看，首先的话你要反弹这样子的一个shell的话，呃，这里执行的一个命令的话是nc杠n l p44 ，在这里的意思的话就是它通过nc这个命令。

然后的话在本地监听了一个444的一个端口，诶，然后的话我们以这一个例子来去进行一个执行，就以这个例子来去定一个执行对吧，我们在这里的话，我们通过这一个分号，或者说其他的一些符号。

来去进行一个命令的一个拼接，我们可以在后面的话接这样子的一串，主要要更改的，主要要就是要去更改的一个地方，就是我们可以更改其他的一些端口，比如说我这里的话改个一个五五的一个端口，然后的话去进行一个执行。

执行之后的话，你会可以看到的话，他在这里的话是一直在转的，就说他是有他的一个命令的话。

![](img/27ecec39c1c1422d0612814eb1b56ab4_208.png)

是今天一个端口对吧，这个端口的话它其实是而在我们那个服务端，他一直有在倾听的，就说等待等待一个客户端，或者说等待一个呃，就是说等待一个客户端去连接它，好的话，我们可以呃。

因为我是在这个服务器上面执行了一个命令，我们可以通过啊。

![](img/27ecec39c1c1422d0612814eb1b56ab4_210.png)

let's start，这样子的一个命令来查看我们的一个端口，就说我们之前的话是啊。

![](img/27ecec39c1c1422d0612814eb1b56ab4_212.png)

之前的一个命令是在这个服务端对吧，就是说在这个服务端进行一个，444的一个端口，我们这里的话来查看一下这个好吧，我是4455的一个端口，来查看一下它这个端口，它是否有在处于一个listen的一个状态。

然后这里的话我们可以看到，我们通过这样子的一个net start查看，就查看端口的话，可以看到这里，它本地的话是有一个五五的一个端口，是处于一个listen，也就是处于一个今天的一个状态。

它使用到的一个工具的话，就是这个nc这样的一共一个工具，然后的话他在这里经听了，这样子的一个端口的话，我们怎么去得到一个shell呢，我们在另外的一个机器啊，这里的话是我们的一个靶机机器对吧。

然后这里的话是我们的一个，是我另外的一个过往的一个机器，在这里的话我可以通过nc，然后的话接我们的这里的一个靶机的一个i p，47。1007，5。10177，然后的话接好加我们的。

就说他这里今天的一个端口，也就是我们要去连接的这个服务端，它的一个端口，服务的一个端口，然后的话你可以看到我今天做的话，他这里的话有呃返回了这样的一些数据，然后这些数据的话。

我们其实可以看到这里的一个数据的话，就是我们嗯不对啊。

![](img/27ecec39c1c1422d0612814eb1b56ab4_214.png)

是这里啊，这里的一个呃目录。

![](img/27ecec39c1c1422d0612814eb1b56ab4_216.png)

这个目录的话是在ex 1 c啊，为什么是在这个目录呢，就说因为我们在这里他执行的话。

![](img/27ecec39c1c1422d0612814eb1b56ab4_218.png)

他执行之后的话，它的一个单前目录就是在这个目录对吧，切换到这个目录来查看一下它的一个文件，没看到他在你的这里nc连接之后的话，它返回到这样的一些数据的话，就是我们在这里这个靶机上面的一个目录对吧。

然后的话我们可以来执行其他的一些命令。

![](img/27ecec39c1c1422d0612814eb1b56ab4_220.png)

![](img/27ecec39c1c1422d0612814eb1b56ab4_221.png)

![](img/27ecec39c1c1422d0612814eb1b56ab4_222.png)

![](img/27ecec39c1c1422d0612814eb1b56ab4_223.png)

啊这里的话我这里就是我这边的话。

![](img/27ecec39c1c1422d0612814eb1b56ab4_225.png)

我把它断掉了，就这个零件一断掉的话，就这边的一个呃。

![](img/27ecec39c1c1422d0612814eb1b56ab4_227.png)

就是这边的一个监听状态的话，就会被啊也会被断掉，我们可以看到当前的话，它是没有这样的一个端口，今天的，然后可以看到这边的话是啊，刚刚的话是一直在转的对吧，是一把叉。

这边的话是已经就是啊程序已经执行完毕了，我们重新来一下。

![](img/27ecec39c1c1422d0612814eb1b56ab4_229.png)

mini，这样的话我换个四四的一个端口。

![](img/27ecec39c1c1422d0612814eb1b56ab4_231.png)

然后执行执行之后的话，它就在我们的一个在这边的一个服务。

![](img/27ecec39c1c1422d0612814eb1b56ab4_233.png)

这边的一个服务器上面，执行了一个监听端口的一个命令，44444的一个端口对吧，好的话，我们在这边的话去进行一个连接哦，云接受的话就是这样子的一个状态，应该能看可以，你可能觉得这样的话是卡了，其实不是。

他这里的话是返回了一个shell，我们可以执行命令，有问题啊，是不是你们在零吗。

![](img/27ecec39c1c1422d0612814eb1b56ab4_235.png)

![](img/27ecec39c1c1422d0612814eb1b56ab4_236.png)

我不使用这个了，我直接在服务端这边执行这样的一个命令，然后我这边进行一个邻居连接之后的话，可以看到它是可以返回这样子的一个shell的，就我们可以在这里去执行一个命令，p w m d当前的一个目录对吧。

id当前的一个用户的话是root，因为在这边的话，他执行的话是一个root用户去执行的，关麦对吧，这就是得到了这样子的一个呃，能够执行命令的一个shell，然后这个需要的话。

其实跟我们就是大家之前用的一个用菜刀对吧，用菜刀通过一句话吧，得到了这样得到了一个啊，就是啊连接成功之后的话，我们有一个虚拟终端对吧，那个虚拟终端的话其实也是类似的，通过我们的一个一句话嘛。

建立了一个零基，来得到他当前的一个用户的一个终端，就是得到了这样，像这样子的一个可以交互式的一个命令。



![](img/27ecec39c1c1422d0612814eb1b56ab4_238.png)

终端对吧，然后这里的话就是一个nc，然后第二个的话还有就是一个tnt，这里的话其实呃也是，这里的话就是用的这个tnt这个mini，然后这里的一个不同跟上面的一个区别的话，就是在于这边的话它是好用。

tnt主动去连接指定的一个i指定的一个ip。

![](img/27ecec39c1c1422d0612814eb1b56ab4_240.png)

说今天的一个端口，所以说在这边的话它是一个正向的一个连接，就是说我们首先需要在我们本地用mc来。

![](img/27ecec39c1c1422d0612814eb1b56ab4_242.png)

今天这样子的一个端口啊，今天这样子的一个端口。

![](img/27ecec39c1c1422d0612814eb1b56ab4_244.png)

然后的话呃我们在在这边，这里的话需要改一下tnt连接的一个ip是。

![](img/27ecec39c1c1422d0612814eb1b56ab4_246.png)

然后连接一个端口号是666，然后我在这边去进行一个执行。

![](img/27ecec39c1c1422d0612814eb1b56ab4_248.png)

我们执行正可以看的话。

![](img/27ecec39c1c1422d0612814eb1b56ab4_250.png)

他在在这边的话，同样的是一直在转的，就是说然后的话可以看到，在这里的话返回了这样子的一个连接，可以看到这里的话是哦，来自于这一个四期这个ip的一个零件，就是这里的这个啊这个服务器的一个连接。

它主动的连接到了我们的这一个端口，然后他返回了这样子的一个需要，我们可以通过执行命令，通过这个需要执行命令查看呃，可以看到这里的话，就是这个啊服务器上面的这样的一些文件。



![](img/27ecec39c1c1422d0612814eb1b56ab4_252.png)

我们可以就通过了这样子的一个啊。

![](img/27ecec39c1c1422d0612814eb1b56ab4_254.png)

tnt的一个方式反弹回来这样子的一个shell，然后其实大家呃也可以去进行一个连接的。

![](img/27ecec39c1c1422d0612814eb1b56ab4_256.png)

![](img/27ecec39c1c1422d0612814eb1b56ab4_257.png)

就是呃就说这一个tell啊，用这个nc的方式的话。

![](img/27ecec39c1c1422d0612814eb1b56ab4_259.png)

就是说你在这边执行之后对吧，执行之后的话它就会啊今天一个端口。

![](img/27ecec39c1c1422d0612814eb1b56ab4_261.png)

然后的话你在本地，或者说你用你在windows上面，你也可以通过nc区进行一个连接，然后这里的话第二个的话，这个tnt的话是主动的去连接一个ip地址，然后因为这里的一个服务端，它是在公网对吧。

他在公网的话，所以你需要一个公网的一个ip地址，也就是说能够在被这个公网服务器，能够访问到的一个ip，然后的话他才能够找到你，找到指定的这个端口，然后的话去进行一个连接来反弹一个shell给你。

哦哦还有的话就是我们可以通过命令执行来写，需要这样的话，我我就不演示了吧，其实呃就通过直接通过echo命令嘛，因为他能够它允许我们直接执行命令对吧，我们直接通过echo来写入。

我们的这样子的一个一句话就ok了，然后这里的话呃就是下面跟上面的话，就说这里的这个一句话的话是呃，稍微有一些不一样，它不一样的一个地方的话，就是我们可以看到上面的话，上面的这样的一个呃。

需要的话有这样子的一个分号对吧。

![](img/27ecec39c1c1422d0612814eb1b56ab4_263.png)

这样子的一些分号，还有这种单引号，然后的话，如果说我们比如说我们上面的那个黑名单对吧。

![](img/27ecec39c1c1422d0612814eb1b56ab4_265.png)

就是，比如说我们这里的第二个这个例子二，这里的一个黑名单对吧，他对我们这里所写的这样的一个，菲律宾的一个一句话对吧，因为我们的一个菲律宾代码的话，它是以分号做一个结尾的，所以说你在这里的一个黑名单。

他把我们的一个分号替换为空之后的话，我们的写入的一个一句话ph代码，它是啊解析不了的，就说他无法因为你存，因为它是要以一个分号结尾，就是说表示你的这样子的一个代码结束了。

这样子以分号结尾的这样子的一个代码，才是一个完整的，一个符合p p p，h p的一个语法结构的一个代码，然后pp解释器的话，才能够去正确的解析里面的一个啊一句话，所以说我们在这里的话。

我们需要就说不去使用到这样子的一个分号，来上传我们的一个一句话，然后这里的话就是呃可以通过这样子的一个，一句话的一个构造，因为里面的话是没有包含有这种封号的，然后的话来绕过那个黑名单的一个检测。

然后它的一个使用的话其实就类似的，其实它就是一个啊拼接l，也是就说一个通过这样子的一个方法去进行的，一个构造，首先的话我们可以看到就说在这里，在这里的话我们通过呃，通过在这里啊，把我们的一个get。

用get方式获取二这一个参数所传递的一个值，然后的话付给了这样子的一个啊符号，就说赋予了这样子的一个变量，是这个竖杠，大家要注意，就是这里的话是就这个多了，服饰表示在ph里面是表示冰量。

然后输给了这样子的一个下划线的一个变量，然后的话再把它拼接到了这里，拼接到了这里，然后的话在就在这边的话，就是跟我们前面的一个一句话是一样的了对吧，好的话，还有就是呃通过菲律宾来去写shell。

就是说我们前面的话是写我们的一个，一句话对吧，然后的话我们可以通过啊，一句话来写我们的一个小马，然后的话来上传我们那个大马，就说如果说你直接通过一个一句话去连接，可能服务端不稳定对吧，你要执行命令。

或者说有相应的一些啊检测的一些手段是吧，就可能你的一个连接的话会失败，所以的话我们可以通过这样子的一个命令执行，来去写一个啊小马，然后这里的话是通过一个ask的一个编码。

通过一个编码的一个形式来进行的一个呃写入，就是说我们通过这种编码方式的话，我们代码里面的这种特殊的一些字符对吧，他可能有做一些过滤什么的，就完全的进行了一个绕过，然后的话就是第二种呢。

就是通过这个base 64的一个编码，就其实前面的话也讲过，就也是类似的，然后这里的话我再强调一点，其实前面也有说过了，就是说在post的参数当中的话呢，是不能出现这种出现这样子的一些字符的。

你就说你在post参数当中，如果出现这样子的一些字符的话，你的这样子的一个请求是呃，就是说请求就发送不过去的，他是不会允许你出现有这样子的一些字符，所以说我们就通过这样子的一个base，64的一个兵马。

来去除里面特殊的这样的一些字符，因为你被16 14编码之后的话，它是像这样子的一些数字跟大，小写字母的一个组合对吧，然后的话呃，然后的话就是我们知道就是base 64的话呃，它有一个特性。

就是你比如说我随便输入一个字符对吧，他做一个编码编码之后的话，他后面的话会有两个等号，这两个等号的话，其实就相当于就是呃，就是你缺的这样的一个位数的话，它就用等号来去进行一个填充。

关于具体的一个还有一个编码的一个原理的话，大家可以自己去了解一下，好的话，我们想要去除这样子的一个等号的话，我们可以通过二次的一个base 64编码，就说把我们的个等号啊也可以去进行一个去除。

然后的话变成一个完完全由这种大小写字母，数字组成的一个字符串，这样的话我就不去呃，前面也操作过了，我就不去进行一个操作了，好好好，下面的话我们一起来了解一下，就是命令执行漏洞的一些，咳咳咳咳。

关于防护的话，主要的话就是呃三点，首先第一点的话就是禁用高位的这样的，一些系统函数，就是说我们前面啊大家回想一下，就是说我们前面讲命令执行，我特意就是好，给大家就是介绍了这样子的一些，能够导致代码执行。

或者说命令执行的这样的一些函数，就说这些函数的话，其实它是存在危险性的，然后的话这一些函数的话，我们可以通过呃禁用它，因为我们如果说代码里面存在，有这样子的一些系统函数的话对吧。

如果你没有对他做一个严格的过滤，或者说呃程序员在写代码的时候，有一些纰漏的话，就会导致这样子的一个命令执行的一个漏洞，导致命令执行漏洞的话，这样子的一个漏洞的话，它的一个威胁是相当大的对吧。

因为我们直接得到了服务器的一个权限，能够对它进行一些操作嘛对吧，然后的话这里的话就是一些比较危险的，一些系统的一个函数，像比如说ph info对吧，我们前面的话啊，一直使用这种ph info的一个函数。

来去测试，他是否能够去执行我们的这样子的一个，菲律宾代码是吧，然后还有的话像l5 啊，还有这种系统，调用系统命令的这样的一些函数等等的一些，前面的话我只是列举了一些在这边的话呃。

比较全的一些就是一些高位的一些系统函数啊，我这样的话就大概列了一些，然后的话，禁用这样子的一些高位系统函数的话，我们一个禁用的方法，就是在我们的一个配置文件里面，我们需要修改我的一个配置文件，好的话。

有一个第三波function时的这样子的一个选项，然后我们在这个选项下后面，添加我们禁用的一个函数名就ok了，就是说大家再去进行啊，一个安全的一个防护的时候对吧，或者说，配置啊。

做这种安全安全配置的时候，如果你不想要不用不到这样子的一些呃，高位的一些函数的话，我们就可以通过这样子的一个配置，来去进行一个禁用，就就是就是这样子的一个呃这一行，然后的话我们在默认的话。

它是没有添加任何的一个函数的，然后我们在后面啊添加我们这样子的一些，想让它禁用了一些函数，然后的话注意是要以分号做一个结尾，然后你进入之后的话，就我们就，在ph代码当中，它是无法去，就说我们。

比如说我们得到了这样子的一个shell对吧，我们通过web应用得到这样子的一个shell，得到这样子的一个shell之后的话，我们想要去执行我们的一个系统命令对吧，就是说啊通过一个虚拟终端。

执行我们的一个区好吧，系统命令，然后的话你在执行系统命令的时候，他其实同样的就是啊，要去调用我们的这样子的一些调用系统命令，这样的一些函数，然后的话如果我们把这样的一些函数，把它给禁用之后的话。

你就算得到了他的一个shell连接，但是的话你还是无法去执行一些系统命令，比如说查看你当前的一些用户啊，还有查看当前的一些目录啊，就是说通过命令去进行一个执行当的话，如果说你通过菜刀对吧，通过菜的话。

他不是啊，有返回给你一个那个就是文件管理的吗，那些文件什么的话，是你同样的是能够去进行一个查看的，但是的话你是无法去执行一个命令的，如果你无法去执行一些命令的话，那么你就是说你只能是啊。

能够查看这样子的一些文件，而无法去做一些其他的一些操作，比如说我们通过这样子的得到了这样的一个需，要去进行一个啊通过啊进行一个内网渗透对吧，如果说你得到了这样的一个服务器。

它正好是啊某个公司的一个外网的一个机器，然后的话这个机器的话它是放在放在公网上的，然后这一个服务机器的话，正好他又能够去跟内网去进行一个通信，能够去访问内网对吧，那么我们这个时候的话。

我们得到这样子的一个机器的一个需要，我们就能够通过，因为它里面的话是这个机械化，是能够访问到某个公司的一个内网的对吧，那么我们可以通过你这一个机器，作为一个跳板机来去访问到内网的一些机器，对吧。

当然的话这里的话呃好话就，第二个的话就是一个严格的一个过滤特殊字符，就特殊字符啊，我们前面的话再去进行一个呃，利用他的一个命令执行漏洞对吧，我们想要执行我们额外的一些命令的话。

我们就需要一些特殊的一些字符来拼接，我们的一个命令对吧，好，我们既然我们需要去使用到攻击者，需要使用到这样子的一些特殊字符，来执行我们额外的一些命令对吧，那么我们就可以把这样子的一些特殊字符。

做一个严格的一个过滤，比如说前面的这种黑名单，虽然它是有一个缺陷的对吧，好的话，我们也可以通过白名单的这样子的一些，白名单的这样子的子的一个策略，来去验证用户的一个输入，那白面的话相比于黑名单。

他那个呃安全性的话是要高的，但是的话可能你的这样子的一些，就是与你一个这个的话，要看你的一个业务的一个需求，给你一个白名单的话，你可能会你的一些需求，你需要到需要去使用到这样子的，一些字符的时候。

比如说那么的话你就会造成一个误伤对吧，然后呃其实最恰当的一个方法的话，其实就是根据你的这样子的一个功能点对吧，比如说我们前面说到的这样子的一个例子，这个粒子三粒子四对吧，我们这里的一个代码的话。

就是他根据你的这样子的一个功能点，它的一个实际的一个呃需求来进行一个防御啊，因为你这里提供的是这样子的一个，ping命令的一个功能对吧，那么你ping的话，你肯定是你肯定是要去就说你输入的话。

是你要输入一个正常的一个ip地址对吧，然后的话你才能够是啊，执行这样子的一个拼命令对吧，来去检测啊，目标ip的一个存活啊，那么如果你不是一个正常的一个ip地址的话，那么说明的话你的这样子的一个输入的话。

就是一个恶意的或者说是不正确的，不合法的这种输入，那么我们就不让你去进行一个执行，这个的话就是说好，针对这样子的一个ping命令的这种功能点，来进行一个代码的一个防御。

然后的话如果说你是通过这种白名单对吧，你通过白名单，难道你去指定的某些ip，这这样子的话可能会有一些局限性，就是说如果说你只是，你只是只希望这样子的一些ip，能够去进行一个啊拼命令的一个执行的话。

你就可以去使用这样子的一个，白名单的一个策略，然后第三个的话就是这个safe mode，safe mode的话就是一个菲律宾的一个安全模式，就就是通俗的说的话，就是以安全模式来运行一个p h p。

然后这个开启了这样子的一个safe mode的话，就是我们在同样是在配置文件里面设置，我们的一个safe mode为on，就可以开启它，然后开启之后的话，就是他我们前面有提到的这样子的。

一些访问文件系统啊，还有调用系统执行命令，执行的这样的一些函数的功能，它都会被限制，比如说像这种啊执行一些系统命令的这种命令，这样子的一些命令他都会被限制，然后的话，还有就是菲律宾扩展当中的一些函数。

也会受到影响，比如说呃前面的有说到的这种啊，就是那个防反引号，就是反引号，还有像这种需要杠e x e c这种函数，如果说你开启了这个safe model的一个呃模式的话，就说这种这种能够去执行系统。

面临这种函数的话，是啊不能够去进行一个使用的，啊就是在这里说的就是这种啊操作符标记，操作符就是这种反引号，前面也说到，就是说在这个房引号里面的这种变量的话，是能够啊执行里面的一个代码的。

然后就是在菲律宾安全模式打开的时候的话，诶你打开之后的话，这些函数你都不能去使用的话，那么你有些需求的话，你肯定是无法实现的，所以说的话他就你想要去使用到这样子的，一些函数的话，你你必须要在啊。

这个safe model e x e x e c d i r，这个选项指定你啊，就是指定你目录的这样的一个程序，就是说在这个目录下面的话，是能够去执行我们的这样子的一些命令的。

来去调用我们的这样的一些函数的，好的话呃，大家对啊，我上面我前面讲的这些内容的话，有没有什么疑问呢，讲着讲着又时间都忘了，呃就大家对我前面讲的这些内容的话，有没有什么疑问呢，有问题的话，扣个一没问题吗。

扣个，都没有问题吗，好多美元的话，那么呃我把最后的这样的一些东西，把它说一下吧，啊就是啊命令执行漏洞的一些实验，这样的话我就写了有四个实验，就这四个实验的话，呃今天不知道大家有没有去自己去尝试做。

就说这两个实验命令执行漏洞，还有的话就是这个struck two的这种框架，的一个漏洞导致的一个命令执行啊，然后的话呃课后作业的话就是这几个实验吧，啊还有这个single ph 5啊。

还有啊这个imagic mini执行漏洞这几个方面，这几个实验大家在课后的时候去做一下，然后的话呃，下节课就是周日，就这周日的话是啊要上班的，就说在周日的时候，大家要大家注意一下。

就是啊周日的晚上的话是啊正常上课的，然后的话在周日的时候啊，对这些就是对这些实验如果有必要的话，给大家做一个讲解，然后的话呃大家就是在做这些实验的时候，做一些笔，建议大家的话做一些笔记啊什么的。

好的话呃，我计划的话，其实我计划就是在下节课的时候呃，就是能有同学能够就是说，就不是由我来去讲这些时间，就希望有同学能够就是分别给对这几个实验，大家就是做完之后啊，有就是你所学到的一些东西啊。

还是说这些实验怎么去完成，好的话，你从这些实验里面就是啊学习到了哪些知识点，希望大家能够呃分别做一个分享吧好吧，然后的话如果有我还有的话，就是，大家在呃把这个靶机上面的这一些。

而昨天还有今天讲的这样子的一些啊题目，大家做一下吧，然后的话可以的话把你的一个过程给记录下来，然后呃，就希望大家能够去养成这样子的一个习惯，就是做笔记的一个习惯，就说呃因为你就其实就比如说我吧。

就比如说我我自己去就去研究一个东西的时候，你可能你刚开始你去啊，你研究的话你就明白了，然后的话你可能你过一会你不用的话，你就忘记了，所以说这个时候的话，你就通过做笔记的话记录这样子的一些东西。

就你方便你自己下次的一个查看对吧，好的话，你这种笔记你其实也可以，就是啊可以把就是把你学到的，所学到的一些东西记录下来，然后可以啊整理成文章什么的。



![](img/27ecec39c1c1422d0612814eb1b56ab4_267.png)

或者说你可以自己搞个博客对吧，然后发到博客上面做一个分享嘛对吧，然后本节课的一个内容的话就到这里结束了，应该没有什么其他的一个问题了，没有什么其他问题的话，那么我们下课吧，然后我，我要把这些东西啊。

我把b我把ppt发到群里。