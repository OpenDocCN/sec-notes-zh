# 【B站最系统的网络安全教程】北大大佬196小时讲完的网安教程，全程干货无废话！学完即可就业，别在盲目自学了！！！ - P34：第32天：XXE漏洞-XXE漏洞修复及思路 - 网络安全就业推荐 - BV1Zu411s79i

你有什么。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_1.png)

hello hello，hello hello，大家能听得到我说话吗，我一直忘记把这个给打开了，然后我以为你们能听得到，就是音乐，结果发现就我一个人在这里听，今天为什么就只有四个人内。

其中一个人还包括了我，然后今天的话就是我们叉叉一，课程的最后一节课，你们开不开心，兴不兴奋，哈哈我开玩笑的，你们打一是有延迟吗，不是后天，不是明天还有吗，对明天就就是那个课程嘛，对明天是课程考核。

嗯课程考核的话就是在那个靶场，同样是这个地方。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_3.png)

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_4.png)

这两个的话其实还挺简单的，我上课都有讲过，然后你只要能登录进去，他登录进去的话，会有一个什么什么locking success就可以了。



![](img/f554bb8e2203c4ebda47eb3ed5e96df6_6.png)

然后今天的话就是将继续将我们叉叉一的一个，利用一个java中上传excel，导致叉叉一漏洞，前几天有一个cctf比赛，大家不知道大家有没有就是去看一下，或者是去了解一下，其中一道题的话。

就是考的这个就是考的这个12中上传这个excel，导致差叉叉一漏洞，然后来进行一个读取文件，那我就开始从现在开始今天的一个讲课吧，这里是说如果我们的网站上面，它存在一个上传的功能。

而且是支持上传我们这个excel格式，就是这个必须是这个xl s x格式的，那么就可能存在叉叉一漏洞，它是怎么，它的过程是怎样呢，就是我们首先新建一个excel，就是这个表格，把它就是重命名。

它的后缀为zip，你就会看到，其实它就是由比较多个的xml文件组成的，那在这的话我们是通过更改这个，就是你变成ji p之后的这个xml就是这个content types。

点xml把这个里面的内容改成这种形式，这个的话大家应该都明白什么意思了吧，就是这就这就是一个d t t的一个声明，然后里面有一个test外部实体的一个声明，最终在我们这个文档内容里面进行了一个引用。

所以在这的话如果我们进行监听，监听这个9999端口的话，就是我这就是用这个python，写了一个简单的htp服务，然后它的端口是9999，所以在这的话它就会有一个请求发送过来，就是那边你上船之后啊。

这个当然你要把它改为这个xl s x格式，就是你更改之后，我们把它变成vip格式，就是变成这种压缩包的格式，是为了把他的这个xml文件读语出来嘛，然后把里面的内容给改了吗，改了之后保存之后。

你要把它改回去，改回去，然后回到我们一个上传的地方，把我们这个文件上传上去，上传上去之后，如果他后台进行了解析，就会来请求我们这边起的这个服务，9999起的这个服务，这里有说如果服务器成功解析后。

攻击机则会接收到服务器的请求，然后我们实验室的话有一个这样的实验，我就带着大家来看一下那个实验，这个大家有什么问题吗，我就只是给大家简单的走一遍这个流程，然后它里面的这些原理的话，我就不过多介绍了。

首先他这个任务一的话是出现在在这个阿帕奇，poi这个组件里面，然后任务二的话是出现在这个，这个包装，总而言之，言而总之就是因为他们，包里面进行了一些解析，然后没有过滤掉我们的实体，所以从而能够导致。

解析我们的微代码。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_8.png)

那我们来看一下，就是给大家演示一下。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_10.png)

嗯把一个lip是把它提起来，你没有去做这个实验吗，就是这个java中常见解析，excel in rule的查查一组件出现分析，这个实验应该没有去做。



![](img/f554bb8e2203c4ebda47eb3ed5e96df6_12.png)

那我就拿这个阿帕奇poi这个来演示，嗯这里的话它是他因为这没有一个上传，它只是在这个城市里面，所以他就写死了，cs传入的是我们这个c盘下的test 1，这个这个excel文件，我们来打开把它给看一下。

我们看一下这个，文件你可以看到它在这个里面，它默认的话，我在这先，我在我自己本地创建一个excel，然后再，你可以看一下它默认的是怎样的，它默认就是这个样子的，然后这是它的一个声明吗。

他没有文档的一个声明，它是就是实验中，我们这个实验中这一块是我们自己加进去的，加到这里，然后这个的话他就是直接去访问了，我们本地的880端口，然后带的才带的那个url路径是叉叉一杠test。

那我们本地来进行监听，这个就是一个监听的一个命令，我们现在把它提起来，哦他说我刚才没有把它改回来，把它改回来，然后再运行一下，你可以看到在这里的话，它就有我们这个星球的包都给我们了。

就是他带的参数是这个叉叉一杠test这样，所以说，如果我们就是如果碰到一个有上传的地方，然后他他又允许这种格式的话，我们就可以尝试把它改为一个压缩包文件。

把里面的那个content type content types，那个china文件里面改成刚才的那个内容，看一下他是不是能进行一个访问，那如果是要访问外网的话，就是我们也可以通过我上次给大家演示。

那个支付码，把他的那个url改为我们自己的一个域名就好了，我这就不登录了，然后大家这个有什么疑问吗，应该没有吧，如果有疑问的话，就扣个一，如果没有疑问的话，建成之后，然后带什么工具，比如说他都他都能。

他都能把他的一个都能来主动请求我们自己，我们自己这边的服务器了的话，那是不是把他的数据我带出来，就是像前面就其实和，前面那样，读取数据是不是就其实是一样的，对吧，就是这个样子，只是你把这一个部分，那个。

这种形式只是你把你把它放大，只是你把这一个部分，就是这个d d d t d声明，这一部分，放到了我们这那个excel文件的那个xml里面去了，然后你这个这个d d d文件的话。

就是你自己可能他那边就是服务器那边，能够访问到你的一个网址，的一个dt d文件的一个地方，就放到一个地方位置，就是这样子的，就是这个都和大家说过了，其实，所以这样的话也可以进行一个本地文件读取啊。

都是可以的，像就是说的那个那个cctf题目的话，它其实也是就是你上传这个文件之后，你要把它的那个它的flag，不是在一个文件里面吗，我们要把那个文件里面的数据带出来，然后你在这个对。

然后中就可以把它读出来，然后提交就可以了，自己创建了上传不了，好吧，哦对了，给大家分享一下，那个我们不是无回想的时候要把数据带出来吗，那如果是真实的环境的话，可能需要一个能够外网能访问到了一个域名。

但是如果我们只有一个内网，当然你们有服务器的话，就当我没说，然后有一个有一个叫做ng，就是这个东西的话。



![](img/f554bb8e2203c4ebda47eb3ed5e96df6_14.png)

它是有一个，现在没。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_16.png)

有一个免费的这里隧道管理，开通隧道，在这里立即购买，这个是个免费的吗，然后协议写到名称，虽然名称你可以嗯随便填，然后这个前置域名的话，就是到时候你生成的那个域名的最后一集，然后这个本地端口的话。

比如说我的就是这个嗯，然后你这个本地端口这里可能需要注意一下，就是你要把这个端口设置为，不合你其他的一些端口冲突的一个端口，比如说八零端口的话，可能就和你本来的一些服务的端口相冲突。

所以说你就把它改成一个你平常不会，就是你没有服务绑定到的一个端口，然后确认添加，然后确认开通就好了，开通之后他在这里的话，它会分配给我们一个这个域名，然后它是映射到哪了，映射到我们本地的那个。

我们刚才绑的那个本地端口，就是，这个本地端口，这然后这个时候的话可能要起一个tomcat服务，或者是起一个别的服务，你就去官网，其实我有写啊，我直接把那个打开给你们看就好了，嗯你们看得清吗。

我好像不能把他，可以，嗯首先就是注册页，这个我现在我现在说什么，大家知道吗，我现在说就是如果你没有买服务器，没有自己的一个服务器，然后你又想可能这种会显得差了一怎么办，就是能让外网能够访问到的一个地址。

然后又能存存自己的一个文件，就可以用这个这个的话，首先去注册一个账号，然后这里开通，开通之后你要选这个htp，然后它的域名，然后它的前置域名，它的本地端口，这个本地端口是跟你就是。

之后你如果是用tom cat的话，就是跟那个是进行一个绑定的，然后隧道管理这里有一个id，就是这个地方他会给你一个id，然后他有一个赠送的域名，就是这个地方，接下来你可以把这个客户端下载下来。

下载下来的话就是，里面你解压之后就是这两个文件啊，你就可以把它，就直接运行这个bat文件，在这输入你的那个这个客户端id的话。



![](img/f554bb8e2203c4ebda47eb3ed5e96df6_18.png)

就是你的隧道id，接下来的话可能就要下一个tom cat服务，那链接就是这个你下一个，然后zip的，然后把它解压，修改里面的这个，修改里面的configure server，点xml。

你就是把这个加上这个的话，主要是为了能够记录你的一个日志，就是你的那个访问别人访问过来，你不是要外带数据吗，所以你到时候它外带出来的一个数据，就是在这个logs目录下。

这个目录下的这个文件也可以去看一下，后面跟的是你具体的一个日期，第二个你要把你的一个htp端口，就是这个地方改为，你在那时候这里绑定的这个端口，就是比如说我这设置是8998的话。

你就要把这个端口就给pol pro protocol，我不知道读，就是这个htb，这的对应的这个端口改为8998，那我这就是选的8181，所以我就不用改了，然后再把它启动起来。

启动起来的话就是在闭目录下，对这个，这个文件把它提起来，骑起来之后，你看到这个就是这个start server starting，多少多少毫秒的时候，就说明你已经把它启动起来了。

然后你把你要先把它启动起来，然后再运行它的这个启动工具嗯，填入生成的一个隧道id，然后浏览器进行一个访问，这个访问这个域名的话，就是它分配给你的那个域名，然后我这里是404，是因为我把那个。

就是阿布吉汤pattern这个里面的文件都给删了，只剩下这一个，所以他找不到index，它不是默认去会去访问那个index吗，我把它都给删了，所以就他这里就是有一个找不到404，如果没删的话。

默认会出现tom cat的一个主页，接下来的话就在我这里是九点点二零，这个版本就是在这里这个地方，因为它运行的话是直接他去访问的一个url的，根目录，是是是在这就相当于我们的3w目录下，是这个地方。

所以把这个我们的那个d d d文件，放到这个地方，然后我们拍到了发，发送之后就可以去我们那个logs，这个里面去查看一下它的日志，这样的话就把它的一个数据给带出来了，嗯这样是如果大家没有熟悉的。

我家我今天是不是讲的太快了，然后，然后你们都不理，也不是，就我是不是讲的太快了，就是你们不知道我在说什么，这是什么，老橙子，你发的是什么，对就是将这个换成那个域名，对。

我刚才讲的那个主要就是为了外网能够访问吗，那大家还有什么问题吗，就关于刚才的那个这个这个周二中上传excel，以及我刚才说的这个这个文档，到时候明天会发给大家，因为我上面写的是嗯。

写的是那个靶场的那个什么，所以现在还不能发给你们，我其实也可以发，我到时候直接把它复制出来就好了，这有什么吗，哎大家还有什么问题吗，应该没有了吧，如果有问题的话就扣个一，如果没有问题的话，就打个二。

想知道下向上传为省格杀什么意思，看完内容肯定会审核，还有其他吗，没有啊，我们普通人把它上传上去，肯定不会像我们那样去把它改为一个gp，然后，然后然后再看里面是不是有个什么，它把它下载下来的话。

那就只是一个excel文档呀，就只是一个excel文档而已啊，感觉大家应该没有什么问题吧，讲的还蛮简单的，今天然后最后一个部分的话，就我们就继续往下推进了，最后一个部分就是开大一的修复。

以及我们的一个练习，叉叉一修复的话，方案一就是过滤我们用户输入的一个xml数据，比如说尖括号，然后那个连接符号，一些关键词，这种这个滴滴滴的一个生命的一个关键词，还有这个nt c声明的一个关键词。

或者是这种外部尸体，这个system和public这种形式，但是这种的话嗯不是很推荐他有防御二，能够很好的解决，在java里面的话，你只要加这三行代码，把他的这个diesel loy。

diesel loy dog type这个东西设置为true，然后外部普通实体设置为false，以及外部参数实体设置为false，java是这样的，然后在菲律宾里面的话，就是这个把它设置为true。

不允许加载实体吗，它怎么翻译过来的话对吧，把它设置为true，然后在python里面的话，就是这个样子的，就是把这个reserve entities等于force，我们可以来演示一下。



![](img/f554bb8e2203c4ebda47eb3ed5e96df6_20.png)

嗯这个代码的话就是已经修复好的。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_22.png)

然后我现在在这边加上我们前面，等那些披露的事实我就直接复制过来，然后再forward，这里的话它会有一个except。



![](img/f554bb8e2203c4ebda47eb3ed5e96df6_24.png)

我们看程序里面他会说文件提前结束，就他不会允许进到，这里他就已经结束了。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_26.png)

就不会进行解析嗯，可以看一下，这边也是没有的，你在p h p里面的话。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_28.png)

我们前面演示的是这个，然后是当他对force的时候，我是不是打错了。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_30.png)

也可以来看一下，哦我刚才好像都没有。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_32.png)

你重新看一下他的报错信息吗。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_34.png)

设置为真实才能有那个不好意思，因为在这的话我就直接把这个复制过来，勾一下，你们看一下我们的。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_36.png)

我这个单词，哦是这样子打的，是那样打的。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_38.png)

是这样的。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_40.png)

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_41.png)

那就是这样子打的吧。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_43.png)

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_44.png)

嗯我们现在去看一下，嗯这里就有了。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_46.png)

那现在我把它改为tru。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_48.png)

现在保存，先把它颗粒，再发送一次可以看到它其实报错也是不一样的，这里的话它报错是不能加载外部实体对吧，about to load the external entity。



![](img/f554bb8e2203c4ebda47eb3ed5e96df6_50.png)

在这里的话就直接是将这个设置为帧的时候，不允许使使用我们的d d d，就是他到就已经结束了，他后面的都没有判断，因为我们在这边使用了一个d d d嘛。



![](img/f554bb8e2203c4ebda47eb3ed5e96df6_52.png)

就是这两种内python的话，就因为没有一个环境，所以就不给大家演示了，都差不多，大家今天的内容还有什么疑问吗，网站会按什么来判定他是一个，像方案一的有绕过的办法，像方案一的话，如果你防御的好。

比如说它其实就是不允许加载外部，实体等等这种东西吗，如果他防范的好，就是这这种的话，是把它列为黑名单吗，如果他收集的齐全的话，那肯定也是要看的呀，如果他收集的不齐全的话，那肯定就会有效果的方法。

好吧我还想给大家看一下，就前几天那个cctf比赛，有一个大佬写的right up，但是嗯他现在删了，其实就和就是这这样的，就和这个是一样的差不多，只不过他在这里的话把数据带出来，把数据带出来的话。

其实就是我们这边这种无危险的这种形式嘛，照着写就好就行了，对了大家昨天的一个作业，昨天那个叉叉一li，这个大家有什么问题吗，到最后的话它是有一个就是要把它把这个地方，你不是要保存保存吗，保存文件嘛。

你要把它的格式保存为，而不是格式是u，那个编码设置为那个ut f钢板就好了，过滤用户输入的代码是怎么样的，就和你之前写那种xs s的那种防护，是一样的呀，就是把他们，如果是出现了这种。

它的输入里面出现了这些这些符号，这些尖括号这种东西的话，以及这种字符串的话。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_54.png)

你就直接一个提示说不能不能不允许使用嗯，这个或者是不允许使用啊，entity等等这种提示，然后直接退出就好了呀。



![](img/f554bb8e2203c4ebda47eb3ed5e96df6_56.png)

今天的课其实还蛮轻松的。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_58.png)

那大家剩下的时间的话就可以去做一下嗯，今天的一个作业，作业的话就是这个这个嘛。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_60.png)

这个47。105。7。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_62.png)

5。1g7 ，然后这两个都要做，就是有回旋和无回旋的都要做。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_64.png)

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_65.png)

然后最终判断的话，就只要是说你能登录成功，登录成功的话，他也不会跳到登录成功一个页面，它只是在这里有一个弹窗，说你登录成功了就好了，那两家剩下的时间就可以去做这个八场，或者是去做昨天没有。



![](img/f554bb8e2203c4ebda47eb3ed5e96df6_67.png)

可能没有来得及做完的这个靶场，然后我的话就没有什么问题了，就没有要这样的东西了，嗯大家可以去做，你没有卡，你就是你就是嗯今天的课程结束了，然后我也没有有想要说的东西了。



![](img/f554bb8e2203c4ebda47eb3ed5e96df6_69.png)

所以就说如果大家剩下的时间花。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_71.png)

大家就可以去做一下这个靶场。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_73.png)

或者是前天给大家布置的这个实验，如果没有做完的话。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_75.png)

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_76.png)

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_77.png)

你不去你不去你不去，做了，那你发作业了吗，我作业都没有看，班主任又给我发两个，你觉得为什么不骄傲，梦凡吗，还是这个就是我记得这个要听，我头上没，保安实验室，哦你把把铲子给做了是吧，那你很棒哟。

嗯那靶场的有什么问题吗，没有什么问题呀，你看我问你，你问谁啊，这声音哦哦哦哦，我也哦，我没有对上号，不好意思，那既然你你就已经成了身为信号，那既然你都过了，那明天分享的话就可以说嗯不是最后一天的话。

就大家一起来讲嘛，那明天就你来讲哟，嗯哼可以吗，a s s f是哪个老师，p c r a f好像是刘老师啊，不对他不交流，林老师，明天留一个你的位置给你讲，那个白嫖客考研，奶妈还近视了。

就是那种他马上就是嗯对我把我本来给改了。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_79.png)

就是这里查看网页源代码的时候，它里面有一个说管理员这个二货，把口令存在那个那个目录下吗。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_81.png)

我把他删了，我就直接其实都是一样的，所以就直接给大家嗯登录就好了。

![](img/f554bb8e2203c4ebda47eb3ed5e96df6_83.png)

登录成功就好了，为什么还有那些为什么还有五个人，你们都是从哪里知道，如果你在学校里面的话，可能学校老师会通知大家，或者是社团里面都会有通知大家嗯，要么就是去一些c bf的一些平台或者是怎样。

他会有一些公告显示给我们，三，现在火嗯，现在火车上，你们都是学生吗，啊不是班主任有做过，问题是社会人啊，没关系，你们也会就是你们也会变成社会人吗，变成我们这种社会的家，你们也会到这一步到哼哼。

我可以下课了，不和你们瞎聊了，诊断零基础，那你问我呀，反应太慢了，好久都要查资料才能证，那你问我呀，啊还是不要没关系，你就问我呗，就问各位，就是任课老师呗，当然是为了好多，现在还好，现在还好了，就是。

学不会，太可怕了，好吧嗯是是可真，行吧，田战义不会他说的原话吗，原话就是叉叉，一不会就是本家占一，好吧，确实了，确实如果我没有给你们讲讲会的话，你确实可以找我说，你这你怎么长成这个样子什么什么的。

然后我就会改进吗，那个跟我说了之后，我就会，接受你们的建议，然后改进，好啦今天就到这啦，我就不和你们瞎聊了，然后你们如果有什么问题的话，就qq找我呗，那今天就下线下课了。



![](img/f554bb8e2203c4ebda47eb3ed5e96df6_85.png)