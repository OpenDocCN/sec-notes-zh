# 网络安全就业推荐 P30：第28天 🛡️ 逻辑漏洞-越权漏洞及支付逻辑漏洞

![](img/43df2d41d74a656f767924cd7e60a796_0.png)

![](img/43df2d41d74a656f767924cd7e60a796_2.png)

![](img/43df2d41d74a656f767924cd7e60a796_4.png)

![](img/43df2d41d74a656f767924cd7e60a796_5.png)

在本节课中，我们将要学习逻辑漏洞的第三部分，重点介绍越权漏洞和支付逻辑漏洞。这两种漏洞在实际的网络安全测试中非常常见，理解其原理和挖掘方法对于初学者至关重要。

![](img/43df2d41d74a656f767924cd7e60a796_7.png)

![](img/43df2d41d74a656f767924cd7e60a796_8.png)

![](img/43df2d41d74a656f767924cd7e60a796_10.png)

## 概述

逻辑漏洞通常源于程序在处理业务逻辑时考虑不周。今天我们将探讨两类核心的逻辑漏洞：越权漏洞和支付逻辑漏洞。它们的共同点是，攻击者可以通过修改客户端发送的请求参数，来达到非授权的目的。

---

![](img/43df2d41d74a656f767924cd7e60a796_12.png)

![](img/43df2d41d74a656f767924cd7e60a796_14.png)

## 越权漏洞 🔓

![](img/43df2d41d74a656f767924cd7e60a796_16.png)

![](img/43df2d41d74a656f767924cd7e60a796_18.png)

上一节我们介绍了逻辑漏洞的基本概念，本节中我们来看看越权漏洞。越权漏洞分为横向越权和纵向越权。

![](img/43df2d41d74a656f767924cd7e60a796_20.png)

![](img/43df2d41d74a656f767924cd7e60a796_22.png)

![](img/43df2d41d74a656f767924cd7e60a796_24.png)

*   **横向越权**：指相同权限等级的用户A可以操作用户B的数据或功能。
*   **纵向越权**：指低权限用户（如普通用户）可以操作高权限用户（如管理员）才能执行的功能。

![](img/43df2d41d74a656f767924cd7e60a796_26.png)

其产生的根本原因是：**服务器过分信任客户端提交的数据，而遗漏了关键的权限校验逻辑**。

![](img/43df2d41d74a656f767924cd7e60a796_28.png)

### 漏洞原理与利用

![](img/43df2d41d74a656f767924cd7e60a796_30.png)

挖掘越权漏洞的核心思路是：**抓取数据包，分析并修改其中的参数**。

以下是挖掘越权漏洞的一般步骤：

1.  **识别功能点**：寻找涉及用户个人数据操作的功能，如查看/修改个人信息、订单、地址等。
2.  **抓包分析**：使用抓包工具（如Burp Suite）拦截请求。
3.  **定位参数**：在请求中寻找用于标识用户或资源的参数，常见的有 `userid`、`id`、`username` 等。
4.  **修改测试**：尝试修改这些参数的值（例如，将属于自己的 `id=9` 改为他人的 `id=1`），然后重放请求，观察是否能越权访问或操作他人数据。

![](img/43df2d41d74a656f767924cd7e60a796_32.png)

**核心操作**：修改请求中的标识参数。
```http
POST /update_address HTTP/1.1
Host: example.com
...
id=9&address=NewAddress  // 将 id=9 改为 id=1
```

![](img/43df2d41d74a656f767924cd7e60a796_34.png)

![](img/43df2d41d74a656f767924cd7e60a796_36.png)

![](img/43df2d41d74a656f767924cd7e60a796_37.png)

### 实例演示

![](img/43df2d41d74a656f767924cd7e60a796_39.png)

![](img/43df2d41d74a656f767924cd7e60a796_41.png)

![](img/43df2d41d74a656f767924cd7e60a796_43.png)

![](img/43df2d41d74a656f767924cd7e60a796_45.png)

在一个示例网站中，用户修改收货地址的请求包包含参数 `id=9`。将其修改为 `id=1` 并重放请求后，页面返回了用户ID为1的地址信息，这证实了横向越权漏洞的存在。

**重要提示**：涉及用户敏感信息（如地址、电话、订单）的越权漏洞，危害等级通常很高。

![](img/43df2d41d74a656f767924cd7e60a796_47.png)

![](img/43df2d41d74a656f767924cd7e60a796_49.png)

---

![](img/43df2d41d74a656f767924cd7e60a796_51.png)

![](img/43df2d41d74a656f767924cd7e60a796_52.png)

## 支付逻辑漏洞 💳

![](img/43df2d41d74a656f767924cd7e60a796_54.png)

![](img/43df2d41d74a656f767924cd7e60a796_56.png)

了解了如何越权访问数据后，我们来看看在支付环节可能出现的逻辑漏洞。支付逻辑漏洞同样源于服务器未对客户端提交的支付相关参数进行充分校验。

攻击者可以通过修改支付请求中的关键参数，实现“低价购买”甚至“零元购”。

### 常见的攻击点

![](img/43df2d41d74a656f767924cd7e60a796_58.png)

![](img/43df2d41d74a656f767924cd7e60a796_60.png)

以下是支付流程中可能被篡改的参数点：

![](img/43df2d41d74a656f767924cd7e60a796_62.png)

*   **修改商品数量**：将正数改为负数或极大值。例如，将 `quantity=1` 改为 `quantity=-1`，可能导致系统向用户账户加钱。
    *   `quantity=1` -> `quantity=-1`
*   **修改商品单价**：直接修改价格参数。例如，将 `price=100.00` 改为 `price=0.01`。
    *   `price=100.00` -> `price=0.01`
*   **修改商品ID**：用低价商品的ID替换高价商品的ID。
*   **修改订单状态**：拦截并修改服务器返回的支付结果，将“支付失败”改为“支付成功”。
*   **滥用优惠券/积分**：
    *   修改优惠券金额或折扣率。
    *   重复使用本应一次性的优惠券码。
    *   篡改积分数量。
*   **测试数据包未删除**：开发者遗留的测试商品或订单，其价格极低甚至为零。攻击者可以通过遍历ID等方式发现并购买这些测试商品。

![](img/43df2d41d74a656f767924cd7e60a796_64.png)

### 实例演示

在一个靶场系统中，购买商品时抓取请求包，其中包含参数 `price=6000` 和 `quantity=1`。将数量修改为 `quantity=-1` 并提交后，用户账户余额反而增加了6000，而非扣款。

![](img/43df2d41d74a656f767924cd7e60a796_66.png)

![](img/43df2d41d74a656f767924cd7e60a796_68.png)

**核心思路**：支付逻辑漏洞的挖掘同样遵循 **“抓包-改包-重放”** 的流程，关键在于熟悉业务，知道哪些参数会影响最终的支付结果。

---

## 条件竞争漏洞 ⏱️

![](img/43df2d41d74a656f767924cd7e60a796_70.png)

![](img/43df2d41d74a656f767924cd7e60a796_72.png)

最后，我们简要了解一种特殊的逻辑漏洞——条件竞争漏洞。它发生在多个线程同时访问和操作同一共享资源（如变量、文件、账户余额），而程序没有进行合理的“锁”控制时。

### 漏洞原理

![](img/43df2d41d74a656f767924cd7e60a796_74.png)

![](img/43df2d41d74a656f767924cd7e60a796_76.png)

简单理解：**在极短时间内，同时向服务器发送大量相同的请求**，可能导致业务逻辑出现意外结果。

![](img/43df2d41d74a656f767924cd7e60a796_78.png)

### 常见场景

![](img/43df2d41d74a656f767924cd7e60a796_80.png)

*   **领取优惠券/奖励**：限制每人领取一次，但同时并发多个领取请求，可能成功领取多次。
*   **抽奖活动**：限制每人一次抽奖机会，并发请求可能获得多次机会。
*   **文件上传**：一种罕见但经典的场景。服务器流程可能是：1. 将文件保存到临时目录；2. 检查文件后缀是否合法；3. 不合法则删除。攻击者在文件被删除前，并发大量访问该临时文件的请求，有可能在删除前执行成功。

**利用方法**：使用抓包工具的爆破（Intruder）模块，以多线程方式大量重放某个关键请求包。

---

![](img/43df2d41d74a656f767924cd7e60a796_82.png)

![](img/43df2d41d74a656f767924cd7e60a796_84.png)

![](img/43df2d41d74a656f767924cd7e60a796_85.png)

## 总结

![](img/43df2d41d74a656f767924cd7e60a796_87.png)

![](img/43df2d41d74a656f767924cd7e60a796_89.png)

本节课中我们一起学习了三种常见的逻辑漏洞：

![](img/43df2d41d74a656f767924cd7e60a796_91.png)

![](img/43df2d41d74a656f767924cd7e60a796_93.png)

1.  **越权漏洞**：通过修改请求中的用户标识参数（如`id`），非法访问或操作其他用户的数据。关键在于**抓包并理解每个参数的作用**。
2.  **支付逻辑漏洞**：通过修改支付请求中的数量、价格、状态等参数，实现不当得利。核心是**熟悉支付业务环节，对每个参数进行篡改测试**。
3.  **条件竞争漏洞**：通过高并发请求，利用程序处理请求的时序问题，绕过次数限制。重点是**使用工具并发重放请求**。

![](img/43df2d41d74a656f767924cd7e60a796_95.png)

逻辑漏洞的挖掘高度依赖对业务的理解和手动测试，难以被自动化扫描器发现。对于初学者而言，掌握 **“抓包-改包-重放”** 这一基本方法，并培养敏锐的业务逻辑洞察力，是挖掘这类漏洞的关键。