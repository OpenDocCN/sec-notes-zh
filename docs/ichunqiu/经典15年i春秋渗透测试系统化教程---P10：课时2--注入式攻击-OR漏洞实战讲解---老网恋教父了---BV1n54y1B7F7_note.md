# 经典15年i春秋渗透测试系统化教程 - P10：课时2 注入式攻击-OR漏洞实战讲解 🔓

![](img/809355b9463015c6987aae6669643f68_1.png)

在本节课中，我们将要学习SQL注入攻击中的一种经典类型——OR漏洞，也就是常说的“万能密码”登录漏洞。我们将通过分析源代码、演示攻击过程以及讲解其背后的原理，来理解这种漏洞是如何产生并被利用的。

---

## 漏洞原理分析 💡

上一节我们介绍了SQL注入的基本概念，本节中我们来看看OR漏洞的具体实现。其核心在于，当网站登录验证的SQL查询语句没有对用户输入进行有效过滤时，攻击者可以构造特殊的输入来改变查询逻辑。

![](img/809355b9463015c6987aae6669643f68_3.png)

![](img/809355b9463015c6987aae6669643f68_4.png)

以下是登录验证代码的典型问题：

![](img/809355b9463015c6987aae6669643f68_6.png)

![](img/809355b9463015c6987aae6669643f68_8.png)

```sql
SELECT * FROM admin WHERE username='$username' AND password='$password'
```

在这条查询语句中，`$username`和`$password`是用户输入的内容。如果程序没有过滤单引号（`'`）和SQL关键字（如`OR`），攻击者就可以注入自己的逻辑。

![](img/809355b9463015c6987aae6669643f68_10.png)

## 实战演示 🎬

![](img/809355b9463015c6987aae6669643f68_12.png)

现在，我们通过一个实际的例子来演示OR漏洞的攻击过程。

![](img/809355b9463015c6987aae6669643f68_14.png)

![](img/809355b9463015c6987aae6669643f68_15.png)

![](img/809355b9463015c6987aae6669643f68_17.png)

### 正常登录流程

![](img/809355b9463015c6987aae6669643f68_19.png)

![](img/809355b9463015c6987aae6669643f68_21.png)

首先，我们查看数据库中的合法账户。假设存在一个用户名为`admin`，密码为`123`的账户。

![](img/809355b9463015c6987aae6669643f68_23.png)

![](img/809355b9463015c6987aae6669643f68_25.png)

![](img/809355b9463015c6987aae6669643f68_27.png)

当我们输入正确的用户名和密码时，后台执行的SQL语句是：

```sql
SELECT * FROM admin WHERE username='admin' AND password='123'
```

![](img/809355b9463015c6987aae6669643f68_29.png)

![](img/809355b9463015c6987aae6669643f68_31.png)

这条语句能够成功查询到记录，因此登录成功。

### 利用OR漏洞登录

接下来，我们尝试使用“万能密码”进行登录。在用户名输入框中输入：

![](img/809355b9463015c6987aae6669643f68_33.png)

![](img/809355b9463015c6987aae6669643f68_35.png)

```
' OR '1'='1' --
```

![](img/809355b9463015c6987aae6669643f68_37.png)

![](img/809355b9463015c6987aae6669643f68_39.png)

![](img/809355b9463015c6987aae6669643f68_41.png)

在密码框中可以输入任意内容，例如`test`。

![](img/809355b9463015c6987aae6669643f68_43.png)

此时，带入到数据库的查询语句就变成了：

![](img/809355b9463015c6987aae6669643f68_45.png)

```sql
SELECT * FROM admin WHERE username='' OR '1'='1' -- ' AND password='test'
```

![](img/809355b9463015c6987aae6669643f68_47.png)

让我们来分析一下这条语句：
1.  `username=''`：这是一个空用户名，条件为假。
2.  `OR '1'='1'`：`'1'='1'`是一个恒真的条件。
3.  `--`：这是SQL中的单行注释符，它会使后面的`AND password='test'`被注释掉，不再生效。

![](img/809355b9463015c6987aae6669643f68_49.png)

因此，整个查询的条件变成了“假 OR 真”，最终结果为真。这意味着数据库会返回数据（通常是第一条记录），从而使登录验证通过。

## 漏洞成因与防御 🛡️

通过上面的分析，我们可以总结OR漏洞产生的原因：**程序直接将用户输入拼接到了SQL语句中，且未对特殊字符进行转义或过滤**。

![](img/809355b9463015c6987aae6669643f68_51.png)

![](img/809355b9463015c6987aae6669643f68_53.png)

以下是开发中需要注意的防御要点：
*   **使用参数化查询（预编译语句）**：这是防止SQL注入最有效的方法。
*   **对输入进行严格的过滤和转义**：例如，过滤掉单引号、分号等特殊字符，或使用转义函数（如PHP的`mysqli_real_escape_string`）。
*   **最小权限原则**：数据库连接账户不应拥有过高的权限。

## 渗透测试技巧延伸 🧰

![](img/809355b9463015c6987aae6669643f68_55.png)

在实战渗透测试中，如何快速发现此类漏洞呢？

![](img/809355b9463015c6987aae6669643f68_57.png)

![](img/809355b9463015c6987aae6669643f68_59.png)

1.  **单引号测试**：在登录框的用户名或密码处输入一个单引号（`'`），如果页面返回数据库错误信息，则很可能存在SQL注入漏洞。
2.  **使用万能密码字典**：不同的编程语言和框架，其常见的“万能密码”Payload可能不同。测试时可以准备或搜索相应的字典进行尝试。
3.  **工具辅助**：对于POST请求的登录框，可以使用如SQLMap、穿山甲等工具进行自动化注入检测。方法是将登录请求的数据包保存下来，或者将登录页面的URL和表单参数提供给工具进行测试。

## 总结 📝

本节课中我们一起学习了SQL注入中的OR漏洞。我们从一个存在漏洞的登录程序出发，分析了其源代码，演示了如何利用`' OR '1'='1' --`这样的Payload实现“万能密码”登录，并深入讲解了其背后的数据库查询逻辑。最后，我们探讨了漏洞的成因、防御方法以及在实际渗透测试中的一些发现技巧。

![](img/809355b9463015c6987aae6669643f68_61.png)

![](img/809355b9463015c6987aae6669643f68_63.png)

理解原理是有效攻击和防御的基础。下一节课，我们将讲解Access数据库的注入技巧。