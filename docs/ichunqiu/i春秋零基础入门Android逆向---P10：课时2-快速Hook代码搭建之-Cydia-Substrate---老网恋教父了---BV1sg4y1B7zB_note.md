![](img/65643bdba9fec7a5ae2f51db64b60baa_1.png)

# iæ˜¥ç§‹é›¶åŸºç¡€å…¥é—¨Androidé€†å‘ - P10ï¼šè¯¾æ—¶2 å¿«é€ŸHookä»£ç æ­å»ºä¹‹ Cydia Substrate ğŸ› ï¸

åœ¨æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†è¦å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Cydia Substrate æ¡†æ¶æ¥å¿«é€Ÿæ­å»º Android åº”ç”¨çš„ Hook ä»£ç ã€‚æˆ‘ä»¬å°†äº†è§£å‡½æ•°é’©å­çš„æ¦‚å¿µï¼Œå¹¶åŠ¨æ‰‹ç¼–å†™ä¸€ä¸ªç®€å•çš„æ’ä»¶æ¥ä¿®æ”¹ç³»ç»Ÿè¡Œä¸ºã€‚

![](img/65643bdba9fec7a5ae2f51db64b60baa_3.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_5.png)

## æ¦‚è¿°ï¼šä»€ä¹ˆæ˜¯å‡½æ•°é’©å­ï¼Ÿ

![](img/65643bdba9fec7a5ae2f51db64b60baa_7.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_9.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_11.png)

å‡½æ•°é’©å­æ˜¯ä¸€ç§å¼ºå¤§çš„æŠ€æœ¯ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨ä¸ä¿®æ”¹åŸå§‹ç¨‹åºçš„æƒ…å†µä¸‹ï¼Œå½±å“ç‰¹å®šå‡½æ•°çš„æ‰§è¡Œã€‚é€šè¿‡é’©å­ï¼Œæˆ‘ä»¬å¯ä»¥æ¥ç®¡æ•´ä¸ªå‡½æ•°ï¼Œä¿®æ”¹å…¶å‚æ•°ã€è¿”å›å€¼ï¼Œç”šè‡³æ”¹å˜æ•´ä¸ªç±»çš„è¡Œä¸ºã€‚Cydia Substrate å°±æ˜¯ä¸€ä¸ªåœ¨ Android å¹³å°ä¸Šå®ç°è¿™ç§æŠ€æœ¯çš„æ¡†æ¶ã€‚

![](img/65643bdba9fec7a5ae2f51db64b60baa_13.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_14.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_16.png)

ä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†é€†å‘å·¥ç¨‹çš„åŸºæœ¬æ¦‚å¿µï¼Œæœ¬èŠ‚ä¸­æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•åˆ©ç”¨ Cydia Substrate è¿›è¡Œå®é™…çš„ä»£ç æŒ‚é’©æ“ä½œã€‚

![](img/65643bdba9fec7a5ae2f51db64b60baa_18.png)

## Cydia Substrate ç®€ä»‹ä¸å®‰è£…

![](img/65643bdba9fec7a5ae2f51db64b60baa_20.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_21.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_23.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_24.png)

Cydia Substrate æ˜¯ä¸€ä¸ªç”¨äºä¿®æ”¹ç³»ç»Ÿæˆ–åº”ç”¨ç¨‹åºè¡Œä¸ºçš„æ¡†æ¶ã€‚å®ƒæœ€åˆåœ¨è¶Šç‹±çš„ iOS è®¾å¤‡ä¸Šè¾ƒä¸ºå¸¸è§ï¼Œåœ¨ Android ä¸Šï¼Œå®ƒåŒæ ·å¯ä»¥å®‰è£…æ’ä»¶æ¥ä¿®æ”¹ç³»ç»Ÿå‡½æ•°æˆ–å¯¹ç‰¹å®šç¨‹åºè¿›è¡Œç ´è§£ã€‚

![](img/65643bdba9fec7a5ae2f51db64b60baa_25.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_27.png)

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Android è®¾å¤‡ä¸Šå®‰è£… Cydia Substrate çš„ä¸»ç¨‹åºï¼ˆä¸€ä¸ª APK æ–‡ä»¶ï¼‰ã€‚å®‰è£…åï¼Œç¨‹åºä¼šè¯·æ±‚ root æƒé™å¹¶å¯¹ç³»ç»Ÿè¿›è¡Œä¸€äº›ä¿®æ”¹ï¼Œä¿®æ”¹å®Œæˆåéœ€è¦é‡å¯è®¾å¤‡æ‰èƒ½ä½¿æ’ä»¶ç”Ÿæ•ˆã€‚

![](img/65643bdba9fec7a5ae2f51db64b60baa_29.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_30.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_32.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_33.png)

**æ³¨æ„**ï¼šç”±äºå…¼å®¹æ€§é—®é¢˜ï¼ŒCydia Substrate åœ¨æŸäº›è®¾å¤‡ä¸Šå¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œï¼Œå› æ­¤åœ¨å®é™…åº”ç”¨ä¸­å¯èƒ½ä½¿ç”¨è¾ƒå°‘ï¼Œä½†ä½œä¸ºå­¦ä¹  Hook æŠ€æœ¯çš„å…¥é—¨å·¥å…·ï¼Œå®ƒéå¸¸åˆé€‚ã€‚

![](img/65643bdba9fec7a5ae2f51db64b60baa_35.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_37.png)

## ç¼–å†™ç¬¬ä¸€ä¸ª Hook æ’ä»¶

![](img/65643bdba9fec7a5ae2f51db64b60baa_38.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_39.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_40.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_42.png)

Cydia Substrate çš„åŠŸèƒ½åŸºäºæ’ä»¶å®ç°ã€‚æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ APK ä½œä¸ºæ’ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­ç¼–å†™æˆ‘ä»¬çš„ Hook é€»è¾‘ã€‚

![](img/65643bdba9fec7a5ae2f51db64b60baa_44.png)

ä»¥ä¸‹æ˜¯åˆ›å»ºä¸€ä¸ªç®€å•æ’ä»¶çš„ä¸»è¦æ­¥éª¤ï¼š

![](img/65643bdba9fec7a5ae2f51db64b60baa_45.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_47.png)

### 1. åˆ›å»º Android é¡¹ç›®å¹¶å¯¼å…¥ SDK

é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ Android é¡¹ç›®ã€‚ç”±äºæ’ä»¶å¯èƒ½ä¸éœ€è¦ç”¨æˆ·ç•Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥ä¸åˆ›å»ºåˆå§‹çš„ Activityã€‚

![](img/65643bdba9fec7a5ae2f51db64b60baa_49.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_50.png)

æ¥ç€ï¼Œéœ€è¦å¯¼å…¥ Cydia Substrate æä¾›çš„ SDK åº“ï¼ˆä¸€ä¸ª JAR æ–‡ä»¶ï¼‰ã€‚å°†è¯¥ JAR æ–‡ä»¶æ‹·è´åˆ°é¡¹ç›®çš„ `app/libs` ç›®å½•ä¸‹ï¼Œç„¶ååœ¨é¡¹ç›®çš„ `build.gradle` æ–‡ä»¶ä¸­æ·»åŠ ä¾èµ–ã€‚

![](img/65643bdba9fec7a5ae2f51db64b60baa_52.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_54.png)

```gradle
dependencies {
    implementation files('libs/substrate-api.jar')
}
```

![](img/65643bdba9fec7a5ae2f51db64b60baa_56.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_57.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_59.png)

SDK ä¸­ä¸»è¦çš„ç±»æ˜¯ `MS`ï¼Œå®ƒæä¾›äº† `hookClassLoad` å’Œ `hookMethod` ç­‰æ–¹æ³•ç”¨äºæŒ‚é’©ç±»å’Œæ–¹æ³•ã€‚

![](img/65643bdba9fec7a5ae2f51db64b60baa_61.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_62.png)

### 2. ä¿®æ”¹ AndroidManifest.xml

![](img/65643bdba9fec7a5ae2f51db64b60baa_64.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_66.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_68.png)

ä¸ºäº†è®© Cydia Substrate è¯†åˆ«æˆ‘ä»¬çš„ APK æ˜¯ä¸€ä¸ªæ’ä»¶ï¼Œéœ€è¦åœ¨ `AndroidManifest.xml` æ–‡ä»¶ä¸­æ·»åŠ ç‰¹å®šçš„å…ƒæ•°æ®ï¼ˆmeta-dataï¼‰å’Œæƒé™ã€‚

![](img/65643bdba9fec7a5ae2f51db64b60baa_70.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_71.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_73.png)

é¦–å…ˆï¼Œåœ¨ `<application>` æ ‡ç­¾å†…æ·»åŠ ä»¥ä¸‹ `meta-data`ï¼š

![](img/65643bdba9fec7a5ae2f51db64b60baa_75.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_76.png)

```xml
<meta-data
    android:name="com.saurik.substrate.main"
    android:value=".Main"/>
```

![](img/65643bdba9fec7a5ae2f51db64b60baa_78.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_79.png)

è¿™é‡Œçš„ `android:value` æŒ‡å‘æˆ‘ä»¬æ’ä»¶çš„å…¥å£ç±»ï¼ˆä¾‹å¦‚ `.Main`ï¼‰ã€‚

![](img/65643bdba9fec7a5ae2f51db64b60baa_81.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_82.png)

ç„¶åï¼Œåœ¨ `<application>` æ ‡ç­¾å¤–ã€`<manifest>` æ ‡ç­¾å†…æ·»åŠ å¿…è¦çš„æƒé™ï¼š

![](img/65643bdba9fec7a5ae2f51db64b60baa_84.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_85.png)

```xml
<uses-permission android:name="cydia.permission.SUBSTRATE"/>
```

![](img/65643bdba9fec7a5ae2f51db64b60baa_87.png)

### 3. ç¼–å†™ Hook å…¥å£ç±»

![](img/65643bdba9fec7a5ae2f51db64b60baa_88.png)

æ ¹æ® `AndroidManifest.xml` ä¸­çš„é…ç½®ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º `Main` çš„ Java ç±»ä½œä¸ºæ’ä»¶çš„å…¥å£ã€‚è¯¥ç±»éœ€è¦åŒ…å«ä¸€ä¸ªç‰¹æ®Šçš„åˆå§‹åŒ–æ–¹æ³•ã€‚

![](img/65643bdba9fec7a5ae2f51db64b60baa_90.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_92.png)

```java
public class Main {
    public static void initialize() {
        // åœ¨è¿™é‡Œç¼–å†™æˆ‘ä»¬çš„ Hook é€»è¾‘
    }
}
```

![](img/65643bdba9fec7a5ae2f51db64b60baa_94.png)

Cydia Substrate ä¼šåœ¨æ’ä»¶åŠ è½½æ—¶è‡ªåŠ¨è°ƒç”¨ `initialize` æ–¹æ³•ã€‚

![](img/65643bdba9fec7a5ae2f51db64b60baa_96.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_97.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_99.png)

### 4. å®ç° Hook é€»è¾‘

![](img/65643bdba9fec7a5ae2f51db64b60baa_101.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_102.png)

Hook çš„åŸºæœ¬æµç¨‹æ˜¯ï¼šå…ˆæ‰¾åˆ°ç›®æ ‡ç±»ï¼Œç„¶ååœ¨ç›®æ ‡ç±»ä¸­æ‰¾åˆ°è¦æŒ‚é’©çš„æ–¹æ³•ï¼Œæœ€åç”¨æˆ‘ä»¬è‡ªå·±çš„æ–¹æ³•æ›¿æ¢å®ƒã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œæˆ‘ä»¬æŒ‚é’© `android.content.res.Resources` ç±»çš„ `getColor` æ–¹æ³•ï¼Œå¹¶ä¿®æ”¹å…¶è¿”å›å€¼ï¼š

![](img/65643bdba9fec7a5ae2f51db64b60baa_104.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_106.png)

```java
public class Main {
    public static void initialize() {
        MS.hookClassLoad("android.content.res.Resources",
            new MS.ClassLoadHook() {
                public void classLoaded(Class<?> resources) {
                    // ç±»åŠ è½½å®Œæˆåæ‰§è¡Œ
                    Method getColorMethod = null;
                    try {
                        // è·å– getColor æ–¹æ³•
                        getColorMethod = resources.getMethod("getColor",
                            Integer.TYPE); // int ç±»å‹çš„å‚æ•°
                    } catch (NoSuchMethodException e) {
                        // æ–¹æ³•æ²¡æ‰¾åˆ°ï¼Œå¤„ç†å¼‚å¸¸
                        getColorMethod = null;
                    }

                    if (getColorMethod != null) {
                        // æŒ‚é’©æ‰¾åˆ°çš„æ–¹æ³•
                        MS.hookMethod(resources, getColorMethod,
                            new MS.MethodHook() {
                                public Object invoked(Object obj,
                                                      Object... args)
                                                      throws Throwable {
                                    // è°ƒç”¨åŸå§‹æ–¹æ³•è·å–åŸè¿”å›å€¼
                                    int originalColor = (Integer) MS.invokeOriginalMethod(
                                        getColorMethod, obj, args);
                                    // ä¿®æ”¹è¿”å›å€¼ï¼Œä¾‹å¦‚ä¸ 0xFF0000FF è¿›è¡ŒæŒ‰ä½ä¸æ“ä½œ
                                    int newColor = originalColor & 0xFF0000FF;
                                    return newColor;
                                }
                            }, null);
                    }
                }
            });
    }
}
```

![](img/65643bdba9fec7a5ae2f51db64b60baa_108.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_110.png)

**ä»£ç è§£é‡Š**ï¼š
*   `MS.hookClassLoad`: ç”¨äºåœ¨ç›®æ ‡ç±»ï¼ˆ`android.content.res.Resources`ï¼‰è¢«åŠ è½½æ—¶å¾—åˆ°é€šçŸ¥ã€‚
*   `classLoaded`: å½“ç›®æ ‡ç±»åŠ è½½å®Œæˆåï¼Œä¼šæ‰§è¡Œæ­¤å›è°ƒå‡½æ•°ï¼Œå‚æ•° `resources` å°±æ˜¯åŠ è½½å¥½çš„ Class å¯¹è±¡ã€‚
*   `getMethod`: é€šè¿‡åå°„è·å–ç±»ä¸­æŒ‡å®šçš„æ–¹æ³•ï¼ˆ`getColor`ï¼‰ï¼Œéœ€è¦æŒ‡å®šæ–¹æ³•åå’Œå‚æ•°ç±»å‹ã€‚
*   `MS.hookMethod`: å¯¹æ‰¾åˆ°çš„æ–¹æ³•è¿›è¡ŒæŒ‚é’©ã€‚
*   `invoked`: å½“è¢«æŒ‚é’©çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¼šæ‰§è¡Œæ­¤å›è°ƒã€‚æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œè°ƒç”¨åŸå§‹æ–¹æ³•ï¼ˆ`MS.invokeOriginalMethod`ï¼‰å¹¶ä¿®æ”¹å…¶è¿”å›å€¼ã€‚

![](img/65643bdba9fec7a5ae2f51db64b60baa_112.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_114.png)

### 5. ç¼–è¯‘ã€å®‰è£…ä¸æµ‹è¯•

![](img/65643bdba9fec7a5ae2f51db64b60baa_115.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_117.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_118.png)

å°†æ’ä»¶ APK å®‰è£…åˆ°å·²éƒ¨ç½² Cydia Substrate çš„è®¾å¤‡ä¸Šã€‚å®‰è£…åï¼ŒCydia Substrate ä¼šæ£€æµ‹åˆ°æ–°æ’ä»¶å¹¶æç¤ºéœ€è¦é‡å¯ã€‚é‡å¯è®¾å¤‡åï¼ŒHook å³å¯ç”Ÿæ•ˆã€‚

![](img/65643bdba9fec7a5ae2f51db64b60baa_120.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_121.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_122.png)

åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œç³»ç»Ÿå†…æ‰€æœ‰è°ƒç”¨ `Resources.getColor()` çš„åœ°æ–¹ï¼Œå…¶è¿”å›çš„é¢œè‰²å€¼éƒ½ä¼šè¢«æˆ‘ä»¬ä¿®æ”¹ï¼Œè¿™å¯èƒ½å¯¼è‡´åº”ç”¨ç¨‹åºç•Œé¢çš„é¢œè‰²æ˜¾ç¤ºå¼‚å¸¸ï¼ˆä¾‹å¦‚å‡ºç°å¤§ç‰‡çº¢è‰²ï¼‰ï¼Œä»è€ŒéªŒè¯äº† Hook çš„æˆåŠŸã€‚

## Java åå°„åœ¨ Hook ä¸­çš„åº”ç”¨

![](img/65643bdba9fec7a5ae2f51db64b60baa_124.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_125.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_126.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_127.png)

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥é€šè¿‡æ–¹æ³•åå’Œå‚æ•°ç±»å‹æ¥è·å–æ–¹æ³•ã€‚ä½†åœ¨å®é™…é€†å‘ä¸­ï¼Œç›®æ ‡æ–¹æ³•å¯èƒ½å±äºéå…¬å¼€çš„ç±»ï¼Œæˆ–è€…å‚æ•°ç±»å‹æ˜¯è‡ªå®šä¹‰çš„å¤æ‚ç±»ï¼Œæ— æ³•ç›´æ¥å¼•ç”¨ã€‚

è¿™æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ° **Java åå°„** æŠ€æœ¯ã€‚åå°„å…è®¸æˆ‘ä»¬åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°è·å–ç±»çš„ä¿¡æ¯å¹¶æ“ä½œç±»çš„æˆå‘˜ã€‚

![](img/65643bdba9fec7a5ae2f51db64b60baa_129.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_130.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_131.png)

ä»¥ä¸‹æ˜¯ Hook ä¸­å¸¸ç”¨çš„åå°„æ“ä½œï¼š

### è·å– Class å¯¹è±¡

![](img/65643bdba9fec7a5ae2f51db64b60baa_133.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_135.png)

```java
Class<?> targetClass = TargetObject.getClass();
// æˆ–è€…é€šè¿‡ç±»åå­—ç¬¦ä¸²è·å–
Class<?> targetClass = Class.forName("com.example.TargetClass");
```

![](img/65643bdba9fec7a5ae2f51db64b60baa_137.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_138.png)

### è·å–ç±»ä¸­çš„æ–¹æ³•

![](img/65643bdba9fec7a5ae2f51db64b60baa_140.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_142.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_143.png)

```java
// è·å–æ‰€æœ‰ public æ–¹æ³•ï¼ˆåŒ…æ‹¬çˆ¶ç±»çš„ï¼‰
Method[] publicMethods = targetClass.getMethods();
// è·å–æœ¬ç±»å£°æ˜çš„æ‰€æœ‰æ–¹æ³•ï¼ˆåŒ…æ‹¬ private çš„ï¼Œä¸åŒ…æ‹¬çˆ¶ç±»çš„ï¼‰
Method[] declaredMethods = targetClass.getDeclaredMethods();
// è·å–æŒ‡å®šçš„ public æ–¹æ³•
Method specificMethod = targetClass.getMethod("methodName", ParameterType1.class, ParameterType2.class);
// è·å–æŒ‡å®šçš„æ–¹æ³•ï¼ˆå¯ä»¥æ˜¯ private çš„ï¼‰
Method specificDeclaredMethod = targetClass.getDeclaredMethod("methodName", ParameterType1.class);
```

### è°ƒç”¨æ–¹æ³•

![](img/65643bdba9fec7a5ae2f51db64b60baa_145.png)

```java
// è°ƒç”¨å®ä¾‹æ–¹æ³•
Object result = specificMethod.invoke(targetObjectInstance, arg1, arg2);
// è°ƒç”¨é™æ€æ–¹æ³•
Object result = staticMethod.invoke(null, arg1, arg2);
```

### è·å–å’Œä¿®æ”¹å­—æ®µï¼ˆFieldï¼‰

![](img/65643bdba9fec7a5ae2f51db64b60baa_147.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_148.png)

```java
// è·å–å­—æ®µ
Field field = targetClass.getDeclaredField("fieldName");
// è®¾ç½®å¯è®¿é—®æ€§ï¼ˆå¯¹äº private å­—æ®µæ˜¯å¿…é¡»çš„ï¼‰
field.setAccessible(true);
// è·å–å­—æ®µå€¼
Object value = field.get(targetObjectInstance);
// è®¾ç½®å­—æ®µå€¼
field.set(targetObjectInstance, newValue);
```

![](img/65643bdba9fec7a5ae2f51db64b60baa_150.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_151.png)

### è®¾ç½®è®¿é—®æƒé™

![](img/65643bdba9fec7a5ae2f51db64b60baa_153.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_154.png)

å¯¹äºé public çš„æˆå‘˜ï¼Œéœ€è¦å…ˆè®¾ç½®å…¶å¯è®¿é—®æ€§ï¼š

```java
methodOrField.setAccessible(true);
```

![](img/65643bdba9fec7a5ae2f51db64b60baa_156.png)

ç†Ÿç»ƒæŒæ¡ Java åå°„æ˜¯ç¼–å†™é«˜çº§ Hook ä»£ç çš„åŸºæœ¬åŠŸï¼Œå®ƒè®©æˆ‘ä»¬èƒ½å¤Ÿçµæ´»åœ°åˆ†æå’Œæ“ä½œæœªçŸ¥çš„ç±»ç»“æ„ã€‚

![](img/65643bdba9fec7a5ae2f51db64b60baa_158.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_160.png)

## æ³¨æ„äº‹é¡¹ä¸å±€é™æ€§

![](img/65643bdba9fec7a5ae2f51db64b60baa_162.png)

åœ¨ä½¿ç”¨ Cydia Substrate æ—¶ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

![](img/65643bdba9fec7a5ae2f51db64b60baa_164.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_165.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_167.png)

1.  **å…¼å®¹æ€§**ï¼šå¦‚å‰æ‰€è¿°ï¼Œå¹¶éæ‰€æœ‰ Android è®¾å¤‡å’Œç³»ç»Ÿç‰ˆæœ¬éƒ½å…¼å®¹ Cydia Substrateã€‚
2.  **ClassLoader**ï¼šCydia Substrate çš„ `MS.findClass` æ–¹æ³•ä¾èµ–äºæ­£ç¡®çš„ `ClassLoader`ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¦‚æœæ’ä»¶ä¸ç›®æ ‡åº”ç”¨ä¸åœ¨åŒä¸€ä¸ª `ClassLoader` ä¸­ï¼Œå¯èƒ½æ— æ³•ç›´æ¥æ‰¾åˆ°ç±»ï¼Œè¿™æ—¶éœ€è¦ç»“åˆåå°„æˆ–å…¶ä»–æŠ€å·§ã€‚
3.  **ç³»ç»Ÿç¨³å®šæ€§**ï¼šé”™è¯¯çš„ Hook ä»£ç å¯èƒ½å¯¼è‡´ç³»ç»Ÿæˆ–åº”ç”¨ç¨‹åºå´©æºƒï¼Œè¯·åœ¨æµ‹è¯•è®¾å¤‡ä¸Šè¿›è¡Œå®éªŒã€‚

![](img/65643bdba9fec7a5ae2f51db64b60baa_169.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_171.png)

å°½ç®¡æœ‰è¿™äº›å±€é™æ€§ï¼ŒCydia Substrate å› å…¶ API ç®€æ´æ˜äº†ï¼Œä¾ç„¶æ˜¯åˆå­¦è€…ç†è§£ Android Hook åŸç†çš„ä¼˜ç§€å·¥å…·ã€‚

![](img/65643bdba9fec7a5ae2f51db64b60baa_173.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_174.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_175.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_176.png)

## æ€»ç»“

![](img/65643bdba9fec7a5ae2f51db64b60baa_177.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_178.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_180.png)

æœ¬èŠ‚è¯¾ä¸­æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†å¦‚ä½•åˆ©ç”¨ Cydia Substrate æ¡†æ¶å¿«é€Ÿæ­å»º Android Hook ä»£ç ã€‚

![](img/65643bdba9fec7a5ae2f51db64b60baa_182.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_183.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_184.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_186.png)

æˆ‘ä»¬é¦–å…ˆäº†è§£äº†å‡½æ•°é’©å­çš„æ¦‚å¿µåŠå…¶å¼ºå¤§ä¹‹å¤„ã€‚ç„¶åï¼Œæˆ‘ä»¬ä¸€æ­¥æ­¥å®Œæˆäº†æ’ä»¶çš„åˆ›å»ºã€SDK å¯¼å…¥ã€æ¸…å•æ–‡ä»¶é…ç½®ä»¥åŠæ ¸å¿ƒ Hook ä»£ç çš„ç¼–å†™ï¼Œå¹¶æˆåŠŸå®ç°äº†ä¸€ä¸ªä¿®æ”¹ç³»ç»Ÿé¢œè‰²æ–¹æ³•çš„ç¤ºä¾‹ã€‚æœ€åï¼Œæˆ‘ä»¬æ¢è®¨äº† Java åå°„æŠ€æœ¯åœ¨åŠ¨æ€æŒ‚é’©ä¸­çš„å…³é”®ä½œç”¨ï¼Œè¿™æ˜¯åº”å¯¹å¤æ‚é€†å‘åœºæ™¯çš„å¿…å¤‡æŠ€èƒ½ã€‚

![](img/65643bdba9fec7a5ae2f51db64b60baa_188.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_190.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_191.png)

![](img/65643bdba9fec7a5ae2f51db64b60baa_193.png)

é€šè¿‡æœ¬è¯¾çš„å­¦ä¹ ï¼Œä½ åº”è¯¥å¯¹ Android å¹³å°ä¸Šçš„è¿è¡Œæ—¶å‡½æ•°æŒ‚é’©æœ‰äº†ä¸€ä¸ªåˆæ­¥ä¸”ç›´è§‚çš„è®¤è¯†ã€‚è¯·åŠ¡å¿…äº²è‡ªåŠ¨æ‰‹å®è·µç¤ºä¾‹ä»£ç ï¼Œå¹¶å°è¯•ä½¿ç”¨åå°„æœºåˆ¶å»æŒ‚é’©æ›´å¤šä¸åŒçš„æ–¹æ³•ï¼Œä»¥å·©å›ºæ‰€å­¦çŸ¥è¯†ã€‚æ‰å®çš„ Java ç¼–ç¨‹å’Œåå°„åŸºç¡€ï¼Œæ˜¯åç»­æ·±å…¥å­¦ä¹  Android é€†å‘çš„åŸºçŸ³ã€‚