# i春秋零基础入门Android逆向 - P19：课时3 arm 汇编代码讲解3 - 老网恋教父了 - BV1sg4y1B7zB

🎼。

![](img/9449045488383bb7539bbc5f64744cb1_1.png)

好的，嗯，大家好，我是讲8。那么今天就来讲一个M配代码的第三课。那么这节课的话打算一个呃实际的一款APP软件来讲解一下IDA的1个F5一个功能。

那么这一款软件的话就是这个啊是前几天腾讯那个安全竞赛中所出来的一个入门级的一个APK那么它的难度上也是呃较为一般啊，还还是可以的啊。所以这一些刻话它来进行一个讲解。那么现在说一下的话，ID它这么有名。

但实际上有一款插件是比ID本身更加有名的。那么这个的话就是一个它的1个F5插件，它的功能非常强大，可以把一个配备代码给法编译成一个比较精确的一个加件的一个伪代码。那当然这是一个伪代码。

那个真实呃功能上能上并不一定完全是真实的一个什么了。但是在效果来说哎可以大大去帮助我们去理解整一个程序的一个流程。那么这。我们就来看一下哎它的一个中程序是怎么弄的。现在把我们的一个腾讯的一个呃这款工具。

我们给进行一个把面来看一下它是怎么去进行一个验证的。

![](img/9449045488383bb7539bbc5f64744cb1_3.png)

![](img/9449045488383bb7539bbc5f64744cb1_4.png)

我们使用1个JDB去对它进行个打开。好，那么这里的话就让他进行一个分析，然后完成一切的一个分析了。好好，这里开始了。嗯，首先我们来看一下，呃，这里是它的一个内函数，也就是它的一个窗口。

然后这里这个这个软件就这里运行以后的话，它按它的界面比常简单，这一个输入，还有一个输入一个呃pass的一个地方。然后下面就是一个检查的一个注册是否成功的一个按钮，是一个非常典型的一个c密。

那么这里唉这以这里就是一个它创建事件，然后里面的话就会有一个呃一个有两个按钮。那么这下面的话就是就是它的一个按钮的一个响应事件了。我们双击嗯登进去看一下的话，那么会发现它这里有一个对名字的判断。

然后是一个密码的一个判断，上面的框就是取一个两个框的一个数据。下面话就是名字。那么下面的话就是一个密码。好，那么接着把名字密码给输入以后给校验一下，一个名字的长度宽要在6到20以内。

然后就对就如果过了的话，就可以这样一个函数来进行对名字和密码进行一个校验。如果它反馈结果是一的话，如果它反馈结果是一的话，那么那么就成功了。好，这个函数这个样子的。那么这是一个let的函数。

它它的所有功能的话都放在一个SO里面。好，所以这节课我们就来对这个函数进行一个立项来看一下它的一个。呃，他是怎样运行的？好，记下一些数据啊，这个的话是一个名字名称。另么第二个的话是一个密码。

把110的快能成功。好，我们以这个为基础来进行一个分析。那么既然这是一个呃lettic上的函数，那么我们自然自然而然的都要跑到1个SO层去进行一个分析，我们就打开这个APK来找到找到它的1个SO文件。

好，这里只有1个阿里BI啊，里面有1个SO那 be check register检测我们注册效果的。好，还是要用用1个IDA去进行一个打开进行一个分析。唉，好的啊，那么这里它已经完成最基本的分析了啊。

是一个比较简短的1个SO软件。呃，1个SO软件里面就有一个函数，看一下它的前缀ja完，然后先程程序要什么一个m，然后是个 check这就是对应的我们的这里的这个函数的一个地方了。

那么这里就直接是这个函数，我们就对它进行一个呃查看，那么可以看一下，可以现在大致的看一下，就这里代码还是挺长的好，那么这里啊。这里那么这里的话我们就来开始去使用它一个F5的F5的一个功能了。

我们选中这个函数的，就是这个函数的中间任变成一个地方随便选中然后按键盘上的一个F5或者说按一个t键也以就能够对它进行一个快速的一个返回F5唉可以看到。

然后这里就自动的把这些AIM代码给反编译出来一个C加加形式的一个伪代码，可以看到这是一个标准的一个C加加的一个语言好，那么这里就是一个F5的功能啊，这一段的一个这段的AIM还是挺简单的。

所以编译出来的一个C加加代码的话也是真实可信的。那么可以看到哎这里有一个返回结果，这里就是对一个V9就一个一个局部变量V9进行一个返回。

那么这里就是我们返回结果我们可以按键盘上的N和前节课所介绍的是类似键盘。N可以进行一个重命名。我咪喂喂诶哎呀。好，那么这里就是我们的返回结果，如果返回一就等于成功。

那么这个返回值呢又又是由中间的一个函数所返回的。好，那么所以我们实际上要分析的是这个函数，前面的话都是对这些函数的话进行一个啊铺垫的进行一个初始化进行运行的。好。

进一步的我们再来对这些函数呢进行某一些的一个修改。首先啊这是一个JNI调用的一个函数。它的第一个参数呢是一个JNIV的一个指针。然后第二个参数的话，看一下这里不是一个静态框。那么第二个参数是一个J2。

我们来进行一个配置进行一个变量的一个重新修改，重新定义。首先我们给一个导入1个JNI的一个图文件。那么JNI呢就是我们开发安卓的一个JN层的程序的时候，所用到的一个图文件。

但实际上这里我们也可以用一个IDA去导入这个这些C加这样的一个图文件来快速的导入某一些结构体变量的一个值。那么当我们把这些呃结构体给导入以后的话，就能够直接的去一个IDA中进行一个识别了。好。

我们来进行一个导入，这是JNI点H就是呃一个开发中庸的图文件了。所有的一个JNI程序开发的时候肯定会有一个图文件的。好我们在一个fi，然后就一个然后一个pre head面。

我来选择一个加载一个C的一个文件。Okay。好，选择相应的地方，双击打开。好，这里如果它提示我们的一个加强成功的话，就证明了我们哎已经成功了加载进去了。

这样的好处就是在于我们可以切到一个structures窗口里面啊，这个也可以从这里打开will open up real，然后可以打到这里有这么这么多一个窗口。

我们可以切到一个structures的一个窗口。哦嗯，在在在在在。好，把这反这的大家附见了啊。好，就在那里，我们可以打开这个窗口，然后进行一个结构体来插入，看一下这里的说明。如果我们有个用一个inet。

还有一个叠叠一的快捷键的框，可以快速的创建，还有删除那个结构体。然后第一还有 here框，就是它的一个数据类型了啊，创建一个data或者 area，然后一个重命名。

一个是usual and define。把我们这里按inect键来快速的插入我们的一个结构体。那inet那么这里就提示我们要创建一个新的结构体或者是联合结构体。那么我们点击下面的ad。

也就是说我们这里从外部文件去导入我们原始的一个结构体。好，这里就显示出来了IDA所识别出来的这么多结构体。这是IDA中已经原本有定义的。那么找到最下面的话，还会有我们刚才导入进来一个EMV的一个结构体。

我们就双击我们就加载这个结构体。好，这个时候这个MV的话已经给加载到ID之中去了。那么这个哎这个就是我们的定义第一个参数的一个类型，我们进行一个修改。它第一个参数是一个MV的一个指针。我们改进去好。

我们这里右键按一个Y，我们可以用呃快捷键Y来进行一个结构的一个类型的重定义。也可以右键这基上Y好，这己弹出个框，要求我们输入它一个类型。我们就输入一个V也就是刚才导入的一个地方。比如然后这里。

也可以按N来进行一个重命名。这对第一个参数。第一个参数CMV。好，我们可以看到的话好，那么下面它已经动了把一些类型给转换过来了。哎，接着可以看到这里甚至也把某一些间R函数也给识别出来了。

这是这就是那个IF5的一个强大的地方，本来啊这里的它是调哪一个函数的话，是需在配备代码上是需要我们手动的去计算一个偏移，才能够成功的定位得到了。哎，但这里它通过一个静态分析一个功能。

这已经把这些函数给识别出来了，就能够大大的去减少我们的一个一个一个反变义的一个时间了。好，我们可以可以按回车，那么也可以看空格切回到一个反变义的视角来看一下这些函数怎样调用的。

我们按空格的话可以切换到一个呃框框度一个视图。我们来我们现在框图上来看一下它的一个整一个程序一的调用了。啊，首先首先它的一个20的值，我们已经说过了，20是第一个参数。也就是一个中央新温。

首先他取出来了一个最佳烟V的一个。那，这里就是取出。JNIENV的一个值。那看一下这个这是F21。这321。嗯。我们我先把一个它的F5的反面一的伟大码注释给放上来。好，现在看一下。

这里先来取出一个JNIENV的一个值，我们再往下看，然后给服务复务员一个偏移。也就是拼E为2A4的一个地方，从这里把GNI的1个ANV的值的一个拼E为这么多的地方的内容给取出来放的R3中。

那么这个I3呢实际上就是这样一个函数的一个地址。不幸的话也可以打开一个JI点H来计算哎，手动的来看一下它的一个配地址。哎，是不是真的就是这个样子。Okay。谢谢。我好虑。好，我们来打开一个圈压来看一下。

这里的这样的一个函数，也就是说它短边一刷的函数，或者说是它在偏移为2A4的一个地址的一个函数，是不是就是这样一个这样一个函数啊？



![](img/9449045488383bb7539bbc5f64744cb1_6.png)

![](img/9449045488383bb7539bbc5f64744cb1_7.png)

嗯。好，就到这里可以看到它它上面有这么多函数。其实际上大概算下来的话，哎，真的它可因为地址为这么多的一个地方的话，真的就是这一个函数。所以如果在下面需要我们呃有一些时候F5不能够反映出来的时候。

需要我们自己去手算它的一个地址的时候呢，也是可以的。通过这样那个计算一个偏移的地址，可以把这个P移地址给计算出来，这个时候就能够定位到相应的一个函数中去了。好SCI加的一个函数。

我们这里直接就用F5的功能，把我们的一个函数给绑定出来。那么下面的一些变量话，也可以按照自己的需求来进行一个重命名吧。那么第二个参数的话是一个J也是一下按按按Y来进行一个重命名。好，LOBG好。

第三个参数的话，从第三个开参数开始，就以后就是我们完这就过去的一个参数的一个列啊。第一个第三个X这个列还有一个pas的一个东西，完们成命名。银行是一个pass。啊。

注意一下这样的 stream传过去的话，都是在其中都是一个J俊的一个类型。那我们进行一个呃同定义的一个结构啊，那么这里这一个函数进行还原出来啊啊，是这样是一个量子啊。

那么下面的变量根据需求也可以进行一个命名。那，这个没关系啊，这个没关系啊。接着哎看到这里有这么多的呃前缀，证明它还不识别一类的哈，我们就寻着搞一搞好，这样也行，这样也行。我们可以按右键按右键。

这里的话就是一个参数类型的一个啊比我们可以进行一个强制转换在选中相应的函数右键要就可以强制的把它的一个参数的一个数值，还有一个内容给给转换进来。比如说这个rease换话是1233叉啊，我们都这样吧。

都这样吧。那这样反边D出来的一个代码放去比较准确了。啊，是这个样子，它的整一步哎看一下这里呢这一步都都是非常简单。

它进过来以后第一件是所做的东西就是把一个J的一个内容给转换成一个差的一个一一字这里就是把我分别的去把我们的一个还有一个pas两个的一个值给转换成一个差类型的，分别放到这里。那么这就是V一个L。

那下面的话就是我们传过去的一个密码。好，那么下面的话就是把上面所获得的一个名次还有密码进行一个释放。那么中间唉这两个议对对出现一个ges还有release的对出现的这一个结构体中间的话。

就是一个校验函数一个调了非常标准的一个这样的一个声明到一个函数中去校验我们的一个名字，还有密码。那么如果对这几个函数不准确的话，可以去查一下这的一个刚方的一个SK嗯，这几个函数比较简单。

那么这也不说实际上它也就这里就是把我们的这名转换成一个串类型。然后传传递到下一个函数中进行一个校验。那么这里就是我们正式的一个这验函数按N来进行一个成名名啊明明为一个。好，接着好，这已经明了。好。

这个函数调是这个样子了，它反合一就是答案代表一个成功。好，把这些东西给记录下来，我们再进行一个下一步的一个分析。选中我们需要分析一个函数，按回车可以跳进去，双击也可以跳进去啊，我们跳进去。

那么这个时候就是一个呃又是另外一个反面运的一个代码。那么可以看到的话它大大致的长度是这个样子啊，听短的一个函数，对不对？好，我们接下来它的第一个参数的话是一个L，然后第二个参数是一个pass。那。

那么它们都是一个串类型的。这里就是分别进行一个修改NN进行个什命名。好，这也是一样的。然后两个跨度是一个圈类型的按Y去进行一个变量的一个重复位。好，那么这里就是首先先把它一个定量的值给弄出来了。

然后这个时候我们再来看一下它下面是怎么的去进行个校验的。我们一步一步来看啊，这里可能比较比较长，对吧？对刚开始学的人来说会比较长。那么我们一步一步的来看。首先这个函数的话，它返回一就等于成功。

所以返回零的结果也就是这种地方哎返回零的地方，把比少二变成零的地方都是代表失败的意思了。我们只需要它返回一就够了。我们可以看到，这里对比少也就是返回值呢进行辅助的地方，有这么几个啊，第一个这里是失败了。

那么第二个这里也是失败。那么第三个的话就是这里哎这里有可能就返回为成功，也可能返回为一个失败。如果这一个值等小于等于零的话，那么比少等于一哎，当就是返回一个成功的值了。所以那么这里我们要记住这一个地方。

就是对成功的判断。Yeah。的地方，那么上面的两个地方的话都是一个失败的一个否则。那么这也都是失败了啊，那么上面是肯定是一个失败的。我们对一个level按一个N就是一个重命名。好，前面命名为一个啊。

那么这里就是败，直接返开了。那么下面的话就是先那个result。哎，第二个的话是那个res进行一个初始化。然后下面的话才对他说哎复资成功进行一个啊查看。

好完全可以选中这个零的话去按一个M按快捷线的一个M可以进行一个对已子的一个结构体，也就进行一个定义。不然但是这里比较简单的话，不这样做也可以啊。好，我们这里按M去选择一个呃命名，然后选择一个for。好。

就可以变成这种结果啊，也是挺挺敢看的，对不对？好，我们再来都弄一下好，是这一个一样子吧。好，把一个反黑的地方啊，把的逻辑给搞清楚以后，我们就知道我们的一个目标。

我们我们的目标就是这样整一个程序慢慢的跑下来。然后跑跑到上面都不能反黑，然后要它跑跑到这一句才行。我们要整一个程序给跑到这一句，对整一个re进行一个复制。哎，那么如果它复制为一，那么我们的一个注册。

就是就是成功了。好，记住我们的一个目要求啊，就是让整个程序给跑到这个地方。好，那么接着我们就来分析整一个程序要怎么样才能够跑到这个地方。好。

那么开始我们就来从头分析我们刚才第一步事线就从它的尾部分析来从我们需要的地方进行一个分析。那么这里我们再来从图的分析。好啊，首先下面是对一个pass还有一个lan呢进行一个对存放到一个局部变象之中。

我进行一个成命名。你这是个名称。那么下面的话哎，这里有一个呃textract guy，就是一个对账校验。那么对应着一个R代码框，就是我上一节课所讲的一个呃L7的一个对账。如果这里的一个对战这失败的话。

就可以弹到这个失败的函数里面说我们的一个函数，它导致对战失败。那么这个程序就可以异常退出。呃，这种呃结构的话对一个L程序或者说说是叉86程序的话，都是非常非常的呃都是经常见得到的啊。

所以的话看到这些代码。唉，可以看到这个对我们函数是没有什么用的这也可以直接忽略。就这其实上就是一个对对战交用的一个代码。是为了保证在一个函数进入的时候，它退出的时候，它对称的内容。

它对称的大小不会发生一个改变，不会被破坏。所以这也可以不用管。好，那么这也就不要大惊小怪了，这是非常常常见的哈。我们就来下一步继续看下去。首先它下一步它第一步就是取出我们名字的长度。

第样一个加ITIIN的一个方法，也就是取一个长度的一个方法。可以看到这是是一个导入的一个函数，求字符串长度，这是CR加中标准的一个取长度函数。改名为一个。只是名字长度，然后进行了判断。

然果名字长度减6大大大一的时候就会跳转到一个范围的地方，双击也可以呃跟到跟上去，就是这里啊组成一个for的一个内容啊，这里它的意思就是说名字的长度按照按到6，还有6加1的范围之内啊，6加1是多少。

我们来算一下哈呃66加1。14好，转时进这就是20，回到一个java代码中看一下。哎，和这也是一样的，它的名字小于6和大于20的时候。

都是总开一个失代和这那么这一段代码还这段加代码合起1个CI代码也就一一推应了。说明一个名字的话应该在6到20以内。Yeah。好，那么这句代码它意思是这个样子。好，我们继续往下跑。那么这实际上并不重要。

接着哎它对一个S一个一个叉的一个类型，这个叉差长度是20，进行1个MN3，也就是对一个局部的一个差的一个速度进行一个初始化了。初始化的时候就是把它的每一个啊每每个空间都填成0。好。

我们来看一下它为什么要这样做，它为什么这这样做，我们再往下跑。首先给V5赋予了0，然后这里是一个DY循环。那么这里显然的话，这里的V5是作为一个计算器，一个计数器所使用的，就是这行一个次数的累加。

这里就是循环16次的一个意思。那么在C加加中，我们经常用I来代表这种类型的一个定量，也就是一个计数器。好，我们这里再进行下一个循环。好，我们继续来进行一个静态上的一个分析啊。实际上这款软件这个程序的话。

我在调的时候，我在做的时候根本就没有进行一个动态调试。其实静态分析就出结果了，是是一个非常简单的一个S软件。好，我们继续来进一步下步跑。先在一个创的一个速度进行一个初始化，然后做出了一个计算器，计数器。

然后就在一个计数器中哎进行一个进行某一些运算。先来取出我们的一个S的一个地址。嗯。好，这就是这个取出SI的一个地址。这里先是取到SI的一个内容，然后进行一个取值。那么这里就是取出SID一个地址了。好。

取求SI的地址。没见。那么这一个话就是框拽起来了。嗯。那把这些面面料和命名来点清晰一点的话，那么下面就好看很多了。那么在下一步就是对我们的一个名字长度，还有一个是111的话，是对我们的名字的一个指针。

好，进行同命名。这是一个P pass然后是6V pass。好，那么下一步的话。嗯。那么下一步的话就是对我们的名字对我们名字进行某一种运算，可以看到它这里是指向我们的一个名称的。

对我们名称的首机在存在一个数组进行一个运算。前面的话就是这意思就是说取出我们名字的第I个内容，取出我们名字中的第I个值，哎，然后进行一个运算乘以一个数乘以一个I加这么这么多的数，然后可以名字的长度。

把它最终的运算结果给放到VT中去，接着把VT这里的值给放到一个PSI中，也就是这里的SI的一个内容了。那么所以所以哎这里实际上就是对我们我们的名称进行某种运算，这个运算方式就是这样的运算。

那后我还运算的结果给转换成到这里的地方。好，然后把它转换的一个接果给放到这个呃串的一个数组中。那么哎这然知道这一个串数组是一个名称，经过经过一个转换，然后给转给变成这个样子。

我们就可以对一个这样一个串数组的一个名称进行一个重定名啊按N进行一个重命名，名字快随机。不过的话一定要让自己哎能够方便自己看懂。那么这样才行。好，我们这另外一个呃。好，们天那 in空吧。

啊示一个名单的一个加密。这是对名称加密的一个加密以后存放的一个地址。好，把它放到这里。下一步又是对下一个那个创世主要的初始化。嗯。好，那么初始范为到这里之以后呢，后面就会有两个函数。好。

这两个函数是这一个样子了。它的具体的内容我们暂时不清楚呃，别的业的时候也可以双击过去来看一下它的一个呃实现啊，我们暂时还不清楚它要是要做什么的但是可以大概参试得到的。

那这里的下两个函数这样不是对一个pass进行一个操作。所以可以想象出来啊，这是对个目我们输的一个密码进行某一种转换。然后把它转换一个结果给放到一个串数组中去的。这是非常理所当然的一个思考。好。

那么这里我们就先不跟到这两个函数中去啊，注意一下，先不跟到这个两个函函数中去，我们先来把这个函数进行一个大致的一个分析好。我们先在猜测一下，方者是把一个密码给经过一定的转换，给放到V15。

也就是刚初始化这个串输组中去。好，运几个重庆名啊，那么根据上面的命密方法，就命为pass code。好，这两个函数先不需要知道它是什么意思。好，看看继续下一步是怎样跑的。好。

如果我们第一个函数哎对pass进行加面一个函数，它传试到102024的。然后第二个对pass转换的函数，它反而结果不等于20的话，哎，就会摆成一个失败。如果它是满足这样子的样子的话。

我们就跳到下一步进行一个操作。好。这是pass。Okay。一个然后是一个第要函数。先做一个简单记录，然么后期的分析分析的话，就了留待后期再做。接着再来初始换两个数组，再来初始换两个串数组。好。

这已经非常熟悉了。我相信大家已经非常熟悉了。我们再来初始换两个数组。那么这两个画作是一个int形的一个数组。好，继续出始吧。Yeah。长度的话就是一个都是0314。然后再接下去又是一个循环。

有个一个一个doY循环。好，正如刚才所说的话，这种循环的话，哎这个viser都是一个计数器，就是一个重命名，它还使用它自己使用J。啊。

这里这个循环的话就是对我们刚才转换出来的一个pass对pass加密或者说解密转换出来的一个东西进行一个转换。那么下面的话就是对一个名称加密的一个地方进行一个转换。

把它转转换得到的一个结果来放到这里之中放到这里之中。好，我们就来看了O是V12，也是这一个数字的话，是对名字进行是对名字转换的结果除以4来得到的。我们进行一个计算了。好，呃，我们随便命名用来依赖。好。

这是最终的一个那是最终名字最终转换成为一个中心，命名为发吧。那么上面的话就是对密码呃进行转换后的最终的结果了啊，还它这里的话实际上就是一个职接复制V是一个临时变量给临时取出来。

然后把它值最终存放到V3中去，看到了吧？这里最终的话放到V3中去了好，是这个样子的。那么V3好对就命为一个 pass吧毕竟这是一个对密码进行一个转换，对不对？

我们看一下这里的ID的自动识别的时候有一点不对哈。的的话显然是一个in一个指针的一个函数，这里它识别了一个ch的一个类型了，可以看到它识别为char类型。我们就来把它改一下。

把它改成一个in的一个数轴好，我们改过去 pass的话应该和一样是一个。就是1个DCD55的一个数组才行了，我们来进行一个转换。按Y来进行一个类型的变换。每天那么这是520的。Yeah。现在再找上5。

好，那么这么一来的话，哎，下面整一个函数都变得清晰可见了。这里上面就是对我们的名字，对吧？对我们转换过后的名字还有密码进行下一步的一个加密或者是解密。得到了一个fin和有final pass。

那么下面就是对我们的转换结果进行一个进一步的一个校验了。首先是一个fin pass什么什么什么然后好，那么这里就是它这样校验判断的地方。好好好，那么这几个就是它校验判断的一个函数。Yeah。

可以看一下的话。可以看一下的话，哎，就这个样子，他要求就是这5点这5个语句，我们把它拷出来看一下嗯。这是他的几个要求。好，我们来考出来看一下啊的分析。这样结果就是这一个restore的话。

就是等于那里哎这个计算的结果要小于等于0。这是它最终最终的结果。那么上面我们进行一定的一个移位或者所谓变化，我们来看一下。首先第一个就先不管。那么第二段的话是前面的这一段等于2乘以一个pas4。

那怕4在前后都出现了，可以进行一个一位一位的一个消除。把这个pas4前面点一个，然后后面的话也点一个好，转成这一样的类型。好，同样对这一句，这也怕三在右边出现一次，在左边也出现了一次，右边是二层。

那么右边的话就消两边各消一个。好好好好，那么这已经差不多转换出来了。那么下面最后看是这个样子。什么。那么他要求这段少值小于等于0。那么这里就是它这样的一个地方了。好，这就是综合家验。可以看到的话。

在它建样的时候是把我们最终转换出来的名字和最终转换出来的一个密码就进行一个这样的。那么我们要写kigan的话。要写一个注册借框，就是要根据。名称啊，一个类。算出pass。所以哎在这里写的时候。

我们应该假设名称已致的情况之下，我们怎么去算出一个密码。好，那我看一下的话，这里实际上是可以很简单的去算出密码的。我们对这几个公式进行一个转换。我们假设这里名称这个音量啊啊，这个音量。

我们已经全部知道了我们的一 pass该是指什么而值，才能让它得到一个正确的一个结果了。我们进行一个假设。首先我们来对步步进行一个转换。呃，先来看第一第一个函数。第一个话我们这里一呃怕4。

还有怕4都不知道不知道，不能够进行校验。我们来看第二个函数，第二个函数就是pas4等于一个L一，还有L相加。哎，可以发现这里我们就可以直接的去求到我们的一个pas4了。我们来把这一句给拷下来。好。

这个第四个密码等于这个样子了，这是已是已知了。对就可以算出一个pas斯了。好，这帕s斯给算出来以后。设置一个第四个密钥以后呢，我们再来往上看了。那么这里可以回要第一个函数，这里第pas已经知道了。好。

那么亮云也知道，那pass也一样能记出来了。我们把第一个函数再考一下。这个时候的pa斯能记出来已经。那么这个就上去怕照了。我们再来往下看，我们再往下一步。嗯，这一不一样，呃。

一个帕3和帕0的话等于FL2加帕3和帕0。好，那么对加暂时不能算，我们再跳到下一步的话，会发现一个帕3的话会等于一个leer加量量3。那么这里也一样，可以算出一个帕3。う。我们再往下跑。

既然pas三能算出来夸，那么自里的pas0也一样能算出来。然后可以看到的话，这里唉前几端的话也是非常简单的。Yeah。好，哎，这就就把最后的一个pass给送出来了。那么最后就是下面的最后一句，哎。

最后最后一句的话就是一个L4加上一个pas1，减去3乘以pasL2的话要小于等于0。好，那么最后一句话就可以把最后的一个pas0给算出来进行一个移位。下面是减等于这样一个东西，一个话不号发生一个改变。

好，这里是量字的话，感觉转化来就是减去练字了。好，那么算出帕的范围。好，那么这里就是它这样的地方，根据这么一来的话，我们就能够把pas密码给全部给算出来了。那么我们要写t的话，也就是把这里给算出来了。

好，既然知道这样了以后的话，我们就要一步步往回推了。我们我们要知道这样最后最终的结果，我们得先知道一个F lamp是怎么算出来的。那那问题就还有这个ip pass是怎么给转换。

是怎么根据pas给转换回来的？我们要做这两步。那我们接下来这步分分为两步啊，第一步呃知道。怎么从一个app一个一个名字给转成。We got at length。啊亮，因后他第二步工作的话。

就是一个知道怎么从一个pas。转换为ipad。或者说哎这也要立过来，是怎么从。一个ipad。转换为判。它有一个密码。那么我们最终要的结果就是是要生成。即使从land。1人乘20。啊，这是一套流程啊。好。

我们来看一下，我们怎样去从lan生成pa，就要先从lan给生成一个F la。接着从S la大右上面一个公式给生成一个app pass。

把一个最用的一个fin pass给那就用final pass给转换成pas。哎，那么这一套就能够给转换出来了。好。给整理一下，就是从个app。然后把F两整成一个ippo，然后再最终再转换成一个poss。

文具一步步回来，我们要知道自里怎么生成了。好，首先是一个名称，转换成一个fin。然后那么这这一步算法实际上是非常明显的，就是这一个名称就是一个乘以这么一个中中中心的一个方法。好，然后就放到这一个地方。

接下把一个呃一个inco的一个名称的话，这里就进行一个除以10，那么这样就转换成一个分量了。然后从方分量在fo pass这一步的块可以从上面这里算出来。那么问题就来了。我们这里只需要关心最后一步。

怎么从一个fo pass给还原为pas中。好，我们再来往上看一下啊，首先这是一个foal pass框，它实际上就等于一个pass in code，也就是这里的两个函数好。

那那么问题又回又回到这里两个函数之中了，这两个函数它的作用是怎么？它们怎么去把我们的一个pas给转换成一个方pa的。好，问题就来到这两个函数之中了。我们这一个时候哎就发现这两个函数实际上是非常有用。

非常重要的。我们就来开始的去对这两个函数进行一个分析。好，那么这次我们需要解决的最后一个问题啊。对这两个函数进行一个分析。好，我们慢慢来从第一个函数开始，我们双击哎，双击总的存进去来看一下它怎么运行呢。

首先它第一个参数是一个ch型的一个参数。然后这里是一个A什么之类的，好，不用管。This是 pass。然后下面的话就是一个对帕s的指针。那么可以看到哈，这是一个循环啊，这一个pas不断相加。

然后从里面从一个表中，哎也可以看到这是一个数组，这是一个内存数组，从一个数组中取出一个值。那我这里的值的几个指向，小于等于3U的时候，这个这个它就退出这一个循环，循环退出以后就可以算出一个长度。

把这个长度除以4，然后乘以3，这样我还可以加一哎，这一段数字是怎么回事。我们先来大致来看一下它是这样一个循环。嗯，再大致看一下。然后是第二个函数，第二第二个函数的话有两个参数。第一个第二个是一个叉指针。

那么第一个的话是一个in型的一个指针，或成一个叉指针，也可以。我们两个都转成换成一个chart的一个指针。Yeah。好，第二个的话是我们输入了一个密码。然后第一个参数是我们解码以后密码只要放存放的地方。

啊。这样一来，早上完以后的话，哎这以还是清晰的多了。我们就来慢慢的看。首先还是还是一个类似的循环，从一个表中，哎小于等于3FU这个它和上面的这个函数是非常相似的。好，这个相似的。可以看一下啊。

慢慢的看啊，然后是一个V pass写pa可能算出某一个长度的值，然后三乘以什么加2除以4，哎，和这最后一步这是一样的。然后下面就是一一个真正的转换了，这成我们的一个pas中取出一个值，然后把它取出的值。

哎，可以转换成一个到一个pas以后的地方，慢慢跑下去慢慢跑下去慢慢跑下去怕的话它会有呃有几个循环，然后这这个循环都是很类似的好，这里都是一样取值，然后这是一个移位，是这样移位的。

然后抑惑或者说一个取什么求非有一个pas值形是一个求非，好，这是一个取表的一个运算。这这个取表运算，根据我们密码的一个内容，进行一个取表。取表以后呢，我们再进行某一些一位组合。

最后就算出一个partin扣。这段代码大致近是是这个样子的哈，是这个样子的。好，这里我们再继续来看一下。自然老师这个样子啊，我们是不是就可以呃开始睡曹操呢？好，接着我们就来看一下这个表是怎么回事。

既然这里涉及到一个取表的一个运算，我们就来要来看一下这个表的一个内容，哎，是什么样的一个东西。我们双击这个表给进去给看一下啊。我们双击这一个表来看一下，首先先来确认一下它的一个长度。

因为一个pass的取热的话可能是从一个0到FF，所以我们可以肯定这个表的长度的话，肯定是从0到FF之间的，也就是1个256的。我们双击进去好，挑到这一个内容。接着然后这个表的地址在这里在这里。

这个就是这一个表的一个开始地址，这是一个inco的一个加密表。我们这里切到一个has view，也就是一个呃16进制代码查看的一个地方。

这里切换到S has view has wheel就是查看哎差的一个16进制的值。如果这里没有的话，也可以从view open server里面可以找到相关的一个内容。

ha view的话也是在这一个附近的。好，下面下面唉在这里找一下这里就这里在这里好，我们切换到一个ha的一个容。367F好，那么这里就是我们整个表的开始地址啊，看一下它，看一下它和我们原码对比着看。

如果小于等于3F的时候就能够继续进行一个循环。如果大于3F的时候就会退出这一个循环。我们来看一下啊，有一段是40的，然后有一段的话是一个3级3级的。那么这里就是不会退出循环的一个地方。

那么40同时会退出循环的啊。这个表比较复杂，比较很麻烦我们暂时呃不怎么看懂，对不对？我们写一个程序，小小的程序来进行一个简单的一个转换。先把这一份表给拷贝出来，然后放到一个加下程序中进行一个查看码。呃。

记一下拼移的话，是一个367F进行一个跳转。

![](img/9449045488383bb7539bbc5f64744cb1_9.png)

嗯。好，那么这里就是这一个表的一个起始地址。从这里开始，37F选块其实，然后好后面的话它长度大概在FF之间。好，再随便选一个，随便选一个。那其实上他产购多少根本不重要。好，选到这里为止吧。好。

那么这一份代码我们就把它进行一份拷贝。然后有一个吸尘器吧。嗯，创一个项目。呃，这是呃随便写一个整序来进行一个转换也可以啊。几块的话也可以用一个java来学。好，我们对这个表进行一个转换吧。



![](img/9449045488383bb7539bbc5f64744cb1_11.png)

![](img/9449045488383bb7539bbc5f64744cb1_12.png)

要。现在创建一个项。对应着它DIR代码进行一个编写，把它的一个表格数据给拷贝过来，这是一个char的一个内内容。然后这是一个table。看长合话大概这么多，我们来进行一个解密。嗯。

然后II小于一个零菜谱。呃，对于一个对于一个差的一个table的话，它取值范围就是一个0到FF，因为它是一个一个字节的。我们单字节的它的一个最大值的话就是把这里全部取域的时候，就是一个FF。

这是单字节的，所能取道最大范围。我们把这个表所能取道最大范围给全部打印出来。好，我们根据这一个表达逻辑啊。好，接下来是一个逻辑的，来看一下它的。如果它小于等于3F的时候，就可以进继续进行一个循环。

如果大于40的时候进行都会进行一个退出，我们就来看一下它小于等于3F值哎都是哪一些数据。How。我们来进行一个查看了，A等于一个取求表的DI的一个值。一个简单的一个数据的一个取表，就取它的内容。

如果哎A的话，它是小于等于3NF的时候。我们就对他进行一个打印。好，呃，这个时候话呃。Pa门。反正代表tableable是这么多啊。打打打把I的一个数字给打印出来吧。

把I进C进这个值table PDR也就是说哎我们在table它一个这个表拼这么多数的地方，画值是一个I。然后他实现数据。这么多。把一个A给打印出来，然后一个画下图。好，那里就对整一个表进行了一个打印了。

是て。好并行来看一下它的一个运行结果。好好一下。Good道。

![](img/9449045488383bb7539bbc5f64744cb1_14.png)

我们来好下看一下结果啊，哎，他已经把所有数据给打印出来。如果是2B1是这个样子了。啊，那现在看来是这一个样子，是这一个样子了。好，可以看到这个表呃实际呃有效的数据的话，也就是说不会使其他推错数据的话。

有这么多个它对的值，也是这么一一些啊，还有像看头有点不明显，我们再来进行一个转换吧。

![](img/9449045488383bb7539bbc5f64744cb1_16.png)

![](img/9449045488383bb7539bbc5f64744cb1_17.png)

啊，嗯，这样说可能还不明显，我们再来进行进一步的一个损害。我们可以看一下，当它偏移为这么多的时候，嗯，它的一个值，也就是说假设我们输入了我们的密码哎，输入的密码是这么多的时候，那么对应着它的值是多少？

我们来进行。来看一下啊。好是一个样子的。假设我们说到一个pass这么多。我们说的怕了这么多，那么对应的它取出来的值在内存中取出来的值是这么多。我们来看一下是怎么一个样子运行。Okay。好。

再把它转换成一个串，这是我们说的一个密码。

![](img/9449045488383bb7539bbc5f64744cb1_19.png)

![](img/9449045488383bb7539bbc5f64744cb1_20.png)

来，可以看到把这里这已经把啊所有东西给打印出来了。比如说加然后一个什么什么这应个词这么多这么多零的话就对应着这个样子。然后从A哎从我们的一个从大A开始到我们的的一个大J，然后又是这一个排污可以看一下。

实际上啊这里就是把我们的一个ha的一个做串进行一个重排。它重开的结果是这样的，我们大写A就对应着一个0哎，大写A，我们输入的密码A就对应着0。那么输入的B就对应在一了。那从A到Z。从大写A到大写D的话。

就对应着1个0到19。啊，这之类的所候要求都都是1个16进制的啊，这都是默认16进制的，下面不提了。接着从19的下1个1A的话，就是从小A开始了，呃，到小Z又是一个呃到33的一个位置。好。

从33的下个34哎，就转到数字上去了。好，0这个零就排到34了。然后到写就3D。好，3D。那么它还有最后还有几个，从3A开始是3一和3F，那么对应的就是一个加，还有一个一个什么了，是一个斜杠可以看一下。

这样的对一个数字，或者说对一个这种算进行一个重排。那么再来看一下这一份表，从大A到小大J小A到小A和0到9这加还有斜杠，可以看一下，这是一个非常特色非常明显的一个加密算法，或者说是一个转转换算法。

如果对一个算法比较熟悉的话，可以看到话，这是一个非常典型的一个被列的4的一个表，这是一个被这个式中非常典型的一个转换表。



![](img/9449045488383bb7539bbc5f64744cb1_22.png)

那是非常典型了。好，我们来接来就来猜测这个算法实际上是不是就是一种被的一个算法呢？我们就大家这样的猜测来回到原代码中进行一个查看。哎，那么其实上这个实际上就是一个被是的一个密的一个算法。啊。

它解便上来最大一个特征就是它的表是这个样子的，然后转换的时候就会把这一个表给展示到内存中去了。然后就是对一个东一个一个加密或的东西进行转换，或者就是每四个长度给转换成三个长度，这里也可以看到了。啊。

这里每次循环中，这里pass也就是转换出来结果只加三，但是我们原决时的速度就是加4的。姐面子啊。后征就是一个4变3。然后加面的时候。课程的是三面四，就是贝边4中呃，课征最为明显的地方啊。

就是它长度就是这样变了。然后对应的一个转换的一个表的话，就是从A到C，就是这一个地方。然后后面这不足式的话是一个等块来进行一个填充啊，如果对就是这一个内容啊，我们来看一下，类似于是加密的话，呃。

就是类似于这种结果，三面44。3的一个形式。就是这种其这种类似的一个东西了啊，后面的话会以等号来表示我们填充了一个数据量。哦好，那么这里就是一个贝644的加密，具体的一个算法的话，我这里肯定解释不明显。

然后靠大家在下面的话，可以去了解一下贝64的一个运算。可以发现的话这里整一套就是一个贝64的一个解密程序。啊，这当然需要对我们一个算法有一定的熟悉才行。做简密的时候。

一定要对算法进行有有一个大概的一个了解，对某些特征的一个特征码给了解一下。那么这样立起来才是啊，这是一个对接对分责的解密。然后它解密的话是它一个长度了，打开结果就是它的一个长度。

那么上面对应的就是算出它贝64就有串所解验出来的一个长度了。好，把这两个密码给算出来以后啊，把这两个函数给列出来以后的话，就能那么这个算法，哎，这个注册算法也就给蹦出来了。



![](img/9449045488383bb7539bbc5f64744cb1_24.png)

这里从一个呃ipad。就等于一个。啊，他死一个被64取命。所以哎转出来的话就是一个pass的话，等于被率是加密的一个。奶泡。那么可以上去看一下的话啊，那么就把一个把这一步给弄透了，把这一步给弄完以后。

哎，就会发现我们的自用的测试结果已经得一套注册设法，整套注册流程已经出来了。那么注册机就是像这个样子的。好，我们来看一下最近的一个项目的方案。



![](img/9449045488383bb7539bbc5f64744cb1_26.png)

嗯，同事我看一下啊。好，我记得要嗯嗯。啊，手动找一下啊。嗯。🎼Yeah。好，在这里在这里，那真正正它真正的一个算法，等套加密简密的算法话就是类似这个样子的。



![](img/9449045488383bb7539bbc5f64744cb1_28.png)

![](img/9449045488383bb7539bbc5f64744cb1_29.png)

好，下面是用过名，然后所意的一个结果。然后大家要用过名生成一个结果，我跑下来。但是我直接把IDA的一个内容给拷进去了。那个好下来，所以的名称要当于2次小A5，然后进行一个表初始化。

这是对名称的一个表进行一个转换的。好，这是和这一步话，就是和这里进行一个对应。那么我转换过来以后，我们就可以对密码进行一个计算，从一链继续修Epo。然后最后来进行一个face6设的一个加密。

加密结果呢是做一个反这是return。调后成这里整一个就是一个计算的一个流程。我们随便来输一下，来确认一下我们的一个密码是不是正确的。



![](img/9449045488383bb7539bbc5f64744cb1_31.png)

![](img/9449045488383bb7539bbc5f64744cb1_32.png)

其实没有什么好家养脑，就是这一个嗯必药了，整套注册说法就是这个样子了。

![](img/9449045488383bb7539bbc5f64744cb1_34.png)

那么对于这一节课的话讲的就是这样1个IDA所进行一个静态分析的一个。

![](img/9449045488383bb7539bbc5f64744cb1_36.png)

![](img/9449045488383bb7539bbc5f64744cb1_37.png)

使用IDA去进行一个静态分析的这样一个结果了。那么可以看到的话，整一个分期流程的话是非常强大的。呃，当然的话如果大家呃比较喜欢调试，或者说实心调试的话，你可以去手动的去进行去调一下。



![](img/9449045488383bb7539bbc5f64744cb1_39.png)

这个也是挺挺好的。也就当时新一下吧。不过这里的话呃一定要注意一下的话，不一定说。

![](img/9449045488383bb7539bbc5f64744cb1_41.png)

好。呃，这里要注意一下，注意一点的话，就是嗯ID的F5的话，对于一些可的混淆是没有用的。也就是说一旦遇到一个混淆的一个代码的话，哎，那么我们这里ID的F5就会思效。

这个时候还是得去还是得需要我们去继续去分析，就日它的1个AI的配面代码，所以这也就是也是我前几节课不讲一个F5的一个原因。这这IM的话还是基本功还是需要我们去进行一个熟悉的啊。

我们进行一个这也会发现它反馈一个成功的一个结果。然后那么这里就是我们整一套的一个注册流程注册算法了。

![](img/9449045488383bb7539bbc5f64744cb1_43.png)

![](img/9449045488383bb7539bbc5f64744cb1_44.png)

![](img/9449045488383bb7539bbc5f64744cb1_45.png)

![](img/9449045488383bb7539bbc5f64744cb1_46.png)

好，那么这一个就是这一节课的内容。那么这节课的话我也给大家留了一个作业啊，9A的一个作业了。呃，就是逆向一个这一款APBK的一个注册码。呃。

这款APK的话也是呃前几节前几个月的1个CTF比赛中的某1个APK软件，挺简单的一个程序啊，大家不要害怕。那么也是一样。通过正态分析的话，就能够很容易的得到一个结果。



![](img/9449045488383bb7539bbc5f64744cb1_48.png)

好，那么我下面我也希望大家在下面去进行一个尝试，进行一个分析。那么F5的话，它对一般的使用也是匹配的。我一些对于市面上普通的一些SO文件，使用F5去分析就已经足够了啊。如果不需要对抗可能很淆。哎。

使用F5就大已经足过。🎼所以F5本身要学好，那么这里还这就是我们这节课内容了。那么这一天就谢谢大家，这节课到此为止了，谢谢大家。



![](img/9449045488383bb7539bbc5f64744cb1_50.png)