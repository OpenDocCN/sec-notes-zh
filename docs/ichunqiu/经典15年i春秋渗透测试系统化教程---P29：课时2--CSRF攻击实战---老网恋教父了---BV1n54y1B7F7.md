# 经典15年i春秋渗透测试系统化教程 - P29：课时2  CSRF攻击实战 - 老网恋教父了 - BV1n54y1B7F7

🎼Yeah。🎼Yeah。我们来讲解一下CSRF1列。啊，第一个案例，我们就给大家讲解一下CSRF快速脱库案例。那么这个是目前用的比较广泛的啊。那么我就用在这个呃呀利用CSRF给大家演示一下。

那么大家都非常清楚。呃，目前一些税工库啊，被它的这个库量是比较大的一个各大网站的这个数据库。那么你可以把你的QQ号啊、邮箱啊等等姓名放在这个呃。他的税工呃，网上的社工库里面一查就可以查出你的密码。

包括开房记录啊，都可以查的查得到。那么他这个呃。危害性是相当大的哈相当大的。那么我就用这个实例给大家拖一下这个DJ这个论坛的这个库啊，这个库那演示之前，我们首先用这个管理员用户给大家先登录一下。

大家看一下看一下这个演示哈这个过程。我在本地搭建了1个DJ蛋挞。啊，首先我用AM这个用户登录一下。登录进去之后，我们在这个管理中心。嗯，这个地方我们首先有一个数据备份啊。

这个就是针对这个DJ论坛的数据进行备份的啊，数据论坛进行备份。那么我来看一下，我点击提交备份。那，我先看一下这里。这是被饭到了。如果你通过这种哎啊你要注意一下啊。在这里备份的情况下。

你它是pos数据包提交的，它可以构成嗯get形式，明见没有？get形式。那你用BIP在这里代理一下，把这个包包拦截下来啊，拦截下来之后。

把这个pos改成get形式你那么像我这里是改成了get这种形式哈啊，我是这么改的大家自己改一下吧。我这里不拦截了，我已经改好了啊，点击提交。啊，开始备份数据的。好，那么这个数据备份到哪里了？

我们来看一下。嗯，在这里，你看。这就是我们备份的数据库。看到没有？这就是备份的数据。那么这个就是DCnet存的数据库。那么有了这个数据库，那里面的你的账号密码，整个内存的账号密码。

其他的一些信息啊都在里面。是啊一个网站最重要的也就是这个玩意。数数据数据最重要没得重要数据，我们把它删掉。啊，这是我们正常模拟一个正常的方法去管理员来备份网站数据啊，下面我们退出。一管理也提出。

那么这次我用了一个普通用户账号。test一t一登录。好，我们来看一下。这个是新手上路，你看是吧，最低的最低级别一级啊最低级别。账号。那么我来。让大家看看效果。那么在这里我来发一个贴。管理长。有事找你。

请看一下。好，那么内容你自己骗吧啊，这个东西谁骗你自己看你怎么样去欺骗管理员。那么我发一个贴。然，采用这样这个插图片的地地方，那么我们就插一到这个。DJ论坛备份这个数据库的代码。

就所以D车没做好一个为什么存在这个内洞？就是它这个。呃，这个请请请求方向pos的给触啊，国家是他都能接受，所以造成了这个。直接各上get方式的这个恶意代码也是可以执行的啊，插入到这个图片恶意地方。啊。

这个宽高我们不碎为0，这样的话对方看不到啊，看不到，不知道我这里有一行恶意大码，这是非常危险的吧，对不对？对方管理也不知道。啊，这个路径就是我这个。你看一下吧，就是这样。给我们隐藏一下那。你看。哎。

这样的话只看到内容，但是没有后面的图片等等这些方式是吧，对不对？没有吧。好，我们来这里。退出。用管理员。Yeah。用广电之前，我们管理员注意哈，在这个地方要管理员的话情况下。

管理管理员他在这个登录后台过程中，他进己登录了是吧，他用账号登录论坛。同时他他一般的情况下会来到这个管理页面嘛。他说管理员账号经常要在后台进行改一些东西，当他在这种情况下，他去看这个帖子的时候啊。

他在看这个浏览这个帖子的时候。啊，一般的人他都会这样去看吧。那么我们看一下他他有什么变化没有完了。

![](img/b5e1a9f785280a41bb464c4a925a1f7a_1.png)

看到没有？他的数据库完了备份了。看到没有？这就是网站的数据库SK了，这样的话就我们就把它备份下来了。我们再看一下啊，我把它删掉。



![](img/b5e1a9f785280a41bb464c4a925a1f7a_3.png)

我删掉。当管理员再浏览一下，你看。예？

![](img/b5e1a9f785280a41bb464c4a925a1f7a_5.png)

你看。这个CSCS2F这种表整值。

![](img/b5e1a9f785280a41bb464c4a925a1f7a_7.png)

比较神啊，比较厉害还是比较厉害的。你看下，这样的话，他管理员都不知道。他莫名其妙的数据库就被别人备份了。啊，那备范到对方的数据库，你怎么去搞它呢？有了这个数据库好说啊，对不对？

那么我们把这数据库下载下来不就行了吗？那么DJnet它的默认路径是在哪个地方，在这个路径下面吧。对不对？因为我在巡家还拷贝不出来。



![](img/b5e1a9f785280a41bb464c4a925a1f7a_9.png)

那么我们UC杠C5。Data。Back up。叉叉叉叉。杠AAAA杠1点SKL。嗯你看。嗯。我看一下这个路径没写错吧。几个下。4的。恭起来一个啊，你看。



![](img/b5e1a9f785280a41bb464c4a925a1f7a_11.png)

我们就可以丢人了，这个是不是数据库啊，你看。爱点米的。MD5兹。那么这个你就把它导入到，你自己在本地搭建1个mySK的，把这个数据库导入进去。那么这个数据库怎么下载啊，用渲雷下载。

你直接用迅雷下载下来就行。应该详细的知道，全部有这个就是数据库。包括账号密码全部在里面了。Okay。好，那么关于这里，我们就这个案例就给大家讲解到这里。比如说大家自己下载下来，这个就是说CSRF的啊。

怎么在这个论坛或者。嗯，其他的一些网站上去实现，就是这么一回事的。就我们插一个恶意代码丢过去。啊，骗管理员去浏览我想想要的页面，再用再就是我就盗用了这个管理员的身份。

我更记嘴就是他利用一个普通用户插一个OE代码，OE代码插入进去之后，管管理员是不知道的，他是不知道，不知为什么不知道，你看好，我们就用这个管理员账号登录进来，你看他这个觉得这个帖子有有不对劲。

有不对劲的地方吗？没有不信你管理员有权限可以编辑，你在这里看不到效果。不知道。不知道。不知道不知道的情况下，但是我们攻击者已经达到了自己想要的一些目的。所以说他在这攻间危害性还是相当大的还是相当大的。

嗯，其实用管理员自己的自己钓鱼一样，钓到管理员进来，管理员用的是自己的身份，就等于相当于去被害了一下。数据库这样的话，根记者他直接下载数据库。啊，他的这个还是还还是很厉害的。好。

我们这个就不再做太多的讲解哈，我们就把这个例子给大家演示一遍。接着我们来看一下CRSCSRF的这个。第二个案例。修改密码啊你。这个也是我就用DVWA给大再演示一下。那不能。Yeah。

第J段呢我就把它解束了。Yeah。Okay。嗯。呃，IP写错了。Yeah。Okay。It。调一下安全级别。为D看一下CSRF。他的这个。这个模块。那么他这里你看啊他这有原干码，我先给大家读一下。

还是先掩示吧，先掩示。呃，我改个密码，改成密码为多少嘞？best BEST啊，b。啊，就是我QQ的这个bes操亮哥的这个前面4个字母basedstBSTBST那么大家注意哈。

看观看哈CSRF就是有很多网站，它的后台是没有这个要不要求就是改密码的时候要求。原始密码。啊，原始明，那直接可以输入姓名了。这种方式，那么你点击一改二维码就改掉了。啊，这危害性比较大，你看你改。

就改掉了的密码就你看password串子就已经改变密码。好，这样的话，当你重新登录的时候，你必须要输入新的密码吧，就是b based本来密码是password。好，那么现在我已经把这个地址复制出来了。

放到这里，我们来看一下。你看密码改变bs based好，那么我们尽量是讲CSRF攻击。那么如果我对这套程序，攻击者对这套程序比较熟悉，像DJ论坛一样，原代码都是公开的，根任何人都可以下载。

任何人都可以用，不收你的钱等等。那么我。就来这么个着，我把这个地址。我知道了这个地址之后，或者用BIP拦截就改密码拦截得出这个地址。那么我需要改密码的情情况下，那不还简很简单吗？我打这个代码。

嵌入到叉SS里面的夸张攻机啊。如果你的网站有叉SS，或者你的网站有留言的地方，我留一个骗你去执行我这行代码，或者再或者就是我。Good。不认识你，但是我知道你的邮箱，或者知道你的这个QQ。呃。

或者还有其他的方式，我知道你专门去哪些网站去下载电影，下载软件。那么我把这行代码插入到相应的软件里里面，电影里面等等多种情况都可以。钓鱼嘛，那么反正我最终的目的就是要你执行我这行代码。这个地址。

那么我现在要改变你的密码，很简单，我把这个密码改成贝一贝一。当他受到攻击的时候，我爹穿着哎女儿一改就改变了，就这么简单。这样就改了。啊，为能验证我这个对面我改了没有，你看啊我单独聚消一下。好，我现在是。

A见面。こ。你再用ID名登录一下，登录不上去，点你看是吧，那么你要背思一了。哎，你就可以登录上去了，对不对？那么这种就是CSRF它的这个改密码怎么样去改，就这么简单嗯，就这么简单。好。

我们来看一下它的中级别啊，CSRS是中级别。但这个中还调不了。又变回去了那变回去了我们就不用管了好，我们就嗯我也不用代理了，就给大家直接来看代码这种。我还是给大家在这题嗯演示一下。你能看的。

它的低级别CSRF的低级别，它是什么一个级别呢？你看啊他没有做任任何碰挡他这种代码。没做任何胖的呃，就是说。呃，我只要你输入这个新新密码就行了。新密码就行了。就可以改变密码，不需要你输入原有密码。

也不要碰到你的来源来源于哪里。这都无所谓啊都无所谓。啊，都无所谓。那么它的第二部分的军机代码，你看啊它在这里碰到了一个来源，比如说只有我的本地地址才能改变，才能改密码，才能改密码。

但是他也没有要求输入原有密码。啊，原有密码，他只要求你你的这个地址必须127。0。0。1，也就是说我的本地地址。他的本他的本地地址。啊，他这他这是怎么防御的啊，他的这个CSRF。那么它的高级功能。

你看啊它这个是碰到泥负哈，离负。它的高级功能是什么呢？你看啊它的高级功能就很厉害了。😡，他要求是。原有密码。啊，蛮有名的。你没有。源密码你就不能设置新的密码。你看它它设置的是3个，你看它这里只有两个。

那么这里增加了一个新密码。新密码碰到。那么这种方式它就它可以杜绝这个CSRS攻击。好，嗯，那么我们这里就先。进来我们看一下。嗯，还是给大家打开一下BOIP因为这这一点很重要的。Yeah。

C23三日F的这个。减测方法就是通过这个离里面来来实现。Yeah。把改一个密码，给他改成改回去吧，给pos word。嗯。那么下面我们就给大家。Okay。Yeah。来一个钟。Okay。Yeah。Oh。

帮没带理我说嘞。Yeah。Okay。Okay。Yeah。把作业级别改一下。Oh。不。啊，强行他。你个强形它改成这个。没。密码改成。呃，b吧 BST BST。然，我点击改密码修改。

他这个时候他是碰到嗯他的衣服。Yeah。你看。它是改变不了，没有改成功了哈，它没有变。你看它这里没有改成功，为什么？你看我这个钢点。为什么？我刚才在。软代码里面给大家解释过。你要想成功很简单。呃。

他必须要把这个地址李这个地址改成什么？改成这个127。0。0。1。Oh。修改。嗯。怎么不拦京打数据报啊？啊，在这个地方。注意了哈。这个地方你改把它改成。把这个地方改一下。你看这个li服呃。他改成127。

0。0。1。他这个pos的数据宝是怎么在礼佛里面？那么你就改这里哎，不对。他是要本地地址，127。0。0。1。上面转发一下。啊，这个级别我也没改。Yeah。啊，CSIRF的判的方法就是这么判断的。

就是说如果它这个地方不是本地的地址，就是说我在源代码固定的这个地址，那么。你就不能改密码，如果是就是是是本地，就是117这个地址，那么我就允许你。改这个。改密码。

那么我只需要在这个地方把这个地址改一下就行了，改一下就行了。我不允许你来自外部的地址啊，外面的地址来修改密码它是这么回事的，它碰到离户啊，所以说它这个CSR空间那么如果你碰到这个网站有没有CSR空间。

你把这个地址去掉啊，去掉跟不去掉的区别，你看一下有没有区别。如果我去掉这个地址也正常可以访问这个网站，不去掉也可以正常访问，那说明有问题存在这个CSRF空间扫描机它就是这么碰到的啊，就是这么碰到的。

就通过这个离货啊，离谱来碰到。因为这个lea four它就是从外面到这个里面的。比就是说呃如果li for这个地方可以随意改动，或者随意添加任意地址。

那说明了这个我们就是说允许插入这个恶意的代码来进行执行的。哎，怎么这么多连接？他干了半天啊。还没改完。あ。那批量替换啊，你用这个B2B的批量替换给来吧。你这样搞了。这地址怎么这么多？复制。Yeah。

Yeah。好像在还没改成呢。Yeah。哦，这个才是正确的。哎呀，刚才刚才改了这么多，是封法，他这个抓的包有问题。这种才是正确的。你看地图的地址是这个地址。啊，这个才是真正的礼付。

刚才这个地址是到了这个礼付里面来的哈，他们这个也。Okay。嗯，看下啊。把这个地址会做到这里。安全级别。Oh。中中。嗯。Yeah。你咋子你没饭呀？Oh。呃，这个本地的提教育方式有问题。Yes。

肯定提交有问题。Okay。应该是这种。嗯，把它强行改了。应该是这种。Yeah。Bト。Okay。他这个地址是没问题的，在离货他就是这样。哦，就是我们正常在这里改，他这个离缝是没问题的，注意哈。认真记住啊。

他这个是绝对是没问题的。刚才讲错了啊，刚才不好意思，刚才刚才我把它改成127。0。0。10。0。1的话是不行的哈。因为它这个是本地的，也就是说它本地访问，那在这个里面信息里面去访问。

所以说它这里嗯是改成这个应该就是他这个网站的这个地址，它的域名地址。如果里面是域名访问，那就域名访问。如果我是就外面是IP地址访问的话，那么我就是19116811。55啊，这个地址，这个地址才是正确的。

那正确的修改是这种修改啊，正确的修改是这种修改。嗯，这样你看改位嘛，你看绝对是没问题的。这样的改命软就方法就正确了。这个是这个是毫无疑问的，这个才没问题。你看密码已经修改好，那么这里有一个小问题。嗯。

关我这个地方。在这里建过连接地址，我再用BRP来拦截。Yeah。ここ。你看。这个时候。他这里是没有离货的哈，它没有离货。就是说我构造更记代码。如果是外面的地址，就是说我不是在这个里面。

在这里面就是中介里面去直接在这里改的。我想我想把这个链接地址复制出来，复制到另外一个页面啊，这更记者他都是要做这样构造嘛，就是把这个会议代码插入到嗯其他的任何更记方式里面。

就是嗯叉SS啊或者留言板里面啊，留言板里面插入到里面让管理员去调用这个地址嘛，结果一调用发现。是有问题的。啊，他没有离货，所以说没有离货怎么办？裤子啊。按，这个就把这个。把这个的货端过来嘛。嗯。

这样就可以了啊，把这个地把刚才我们抓到的这个包。就在这里正常修改这个密码的时候。正常修改密码的时候，他这个离for把它复制出来，你再到外面去访问的时候，他发现你抓到的包呃，它是没有离for。

没有离货的话，就是没有这个离。因为它根据离货来碰到那，来碰的吗？这个离附记住了没有，那么这个你改密码是百分之百是改不了的，改不了。那么你如果有了这个方式加了这几个，那你再去你看它就可以改密码的。

它这个是绝对是可以改的哈。这就是我们这个嗯嗯我这天还没变啊。应该是可以变的呀。他就来到了这里。对。Yeah。Oh。你看他这个离服哎。科酒信息和喝酒信息也是一样的。那改一下啊。

我这个地方设安全级别设设了这老变，所以我强一些。Yeah。这种方式是可应该是改变的啊，应该是没问题的要改变的。所以说他这个终结的方法是碰到这个本地地址啊，他是这么碰到的。啊，大家回去之后自己练习吧。

按照我的这个方法啊，根据这个。嗯。Oh。我们先就讲到这里吧，等一下再接着讲解。

![](img/b5e1a9f785280a41bb464c4a925a1f7a_13.png)

![](img/b5e1a9f785280a41bb464c4a925a1f7a_14.png)