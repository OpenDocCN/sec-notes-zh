# 经典15年i春秋渗透测试系统化教程 - P46：课时4 逻辑、越权漏洞挖掘（中）🔍

在本节课中，我们将学习如何挖掘逻辑漏洞和越权漏洞，重点介绍具体的方法和技巧。我们将通过实例演示，展示在注册、登录、密码修改等关键功能点中寻找逻辑缺陷的思路。

## 概述

逻辑漏洞和越权漏洞通常源于程序在业务逻辑判断上的缺陷。本节课程将演示如何通过修改请求参数、分析验证机制等方式，发现并利用这类漏洞。

## 漏洞挖掘方法演示

上一节我们介绍了逻辑漏洞的基本概念，本节中我们来看看具体的挖掘方法。通常，在用户注册、登录、密码找回等功能点，是寻找逻辑漏洞和越权操作的高发区域。

### 批量注册漏洞

以下是利用验证码机制缺陷进行批量注册的步骤。

1.  **观察注册流程**：首先观察目标网站的注册流程，重点关注验证码的生成、校验和销毁机制。
2.  **分析验证码缺陷**：如果服务端在建立连接后没有及时销毁验证码，可能导致同一验证码被重复使用。
3.  **拦截并修改请求**：使用代理工具（如Burp Suite）拦截注册请求。
4.  **设置变量与字典**：在拦截到的请求中，对用户名、邮箱等字段设置变量，并为其配置字典，以生成大量测试数据。
5.  **重放攻击**：将修改后的请求发送到Intruder模块，进行批量重放，尝试注册大量账号。

**核心操作代码示意（Burp Suite Intruder）**：
在Intruder模块中，对`username`、`email`等参数设置`Payload`，选择`Sniper`或`Cluster bomb`攻击模式，使用字典进行遍历。

### 越权修改密码漏洞

在用户登录后的密码修改功能中，可能存在越权漏洞。以下是测试方法。

![](img/f9496ad37a47dd9a44f42cb543a2dfd5_1.png)

![](img/f9496ad37a47dd9a44f42cb543a2dfd5_3.png)

![](img/f9496ad37a47dd9a44f42cb543a2dfd5_4.png)

1.  **登录测试账号**：首先使用一个普通用户账号（如`123456`）登录系统。
2.  **尝试修改密码**：进入密码修改页面，尝试修改密码，并拦截该请求。
3.  **分析请求参数**：仔细检查拦截到的数据包，寻找标识用户身份的参数，如`userid`、`username`等。
4.  **篡改身份参数**：尝试修改`userid`等参数为其他用户的ID，然后提交请求。
5.  **验证结果**：观察是否成功修改了其他用户的密码，从而确认越权漏洞的存在。

![](img/f9496ad37a47dd9a44f42cb543a2dfd5_6.png)

**核心概念公式**：
`请求权限` ≠ `实际操作权限` => **越权漏洞**

### 密码找回逻辑漏洞

密码找回功能也是逻辑漏洞的常见场景。测试思路如下。

1.  **触发密码找回流程**：在密码找回页面输入目标用户名或邮箱。
2.  **分析每一步响应**：关注每一步服务器返回的信息，查看网页源代码、数据包内容。
3.  **寻找敏感信息泄露**：检查返回的页面源码、JSON数据或错误信息中，是否直接包含了密码提示问题的答案、用户凭证等。
4.  **尝试绕过验证步骤**：通过修改请求参数（如步骤ID`stepid`）、尝试注入或利用服务器异常，看是否能跳过某些验证步骤直接进入下一环节或获取密码。

## 其他场景思路拓展

除了上述核心功能，其他交互点也可能存在逻辑问题。

![](img/f9496ad37a47dd9a44f42cb543a2dfd5_8.png)

*   **投票系统刷票**：拦截投票请求，删除用于识别用户身份的`Cookie`字段或`Token`，然后重放请求即可实现刷票。如果服务端使用IP限制，则需要使用代理IP池进行绕过。
*   **交易金额篡改**：在支付环节，尝试将订单金额参数（如`amount`）修改为负数或极小的值（如0.01），提交请求，观察是否能够以异常金额完成交易。

## 漏洞挖掘核心思路总结

无论针对何种功能，挖掘逻辑漏洞的核心思路是一致的。

1.  **参数枚举**：对HTTP请求中的**每一个参数**都进行篡改测试，特别是那些控制状态、身份、数量、金额的参数。
2.  **流程跳转**：尝试绕过正常的业务流程步骤，直接访问后续步骤的接口。
3.  **状态保持**：观察登录状态、会话标识（如Cookie）在关键操作中是否被充分校验。
4.  **客户端校验**：识别仅在前端（JavaScript）进行的校验，通过拦截修改请求包的方式进行绕过。

![](img/f9496ad37a47dd9a44f42cb543a2dfd5_10.png)

## 总结

![](img/f9496ad37a47dd9a44f42cb543a2dfd5_12.png)

![](img/f9496ad37a47dd9a44f42cb543a2dfd5_13.png)

本节课中我们一起学习了逻辑漏洞与越权漏洞的实战挖掘方法。关键点在于：**仔细分析应用程序的业务流程，对每个用户可控的输入点进行测试，并通过修改请求参数来验证服务器的逻辑判断是否严密**。记住，思路比工具更重要，保持怀疑和测试的心态是发现这类漏洞的关键。在接下来的课程中，我们将分享一些真实的项目案例，进一步深化理解。