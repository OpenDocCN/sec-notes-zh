# i春秋零基础入门Android逆向 - P29：课时4  elf文件变形与保护 - 老网恋教父了 - BV1sg4y1B7zB

🎼홍。

![](img/a952810344cf13d815d5ad23ee3be8d4_1.png)

![](img/a952810344cf13d815d5ad23ee3be8d4_2.png)

嗯，好的呃，大家好，我是贾爱邦。那么今天的话我们来讲1个ERF文件的一个变形保护。那么上一节课的话我们已经讲了详细的讲过1个ERF文件，它在存储结的结构上，还有在一个执行上放两种不一样的一个状态。

并且也已经有说到过了。整一个这选hel的一个数据段的话，它是并没有被link来用于加载的。那么这里我们。故故词呢我们可以对一个筛选段来写用一个无用的数据来阻碍一些静态软件的一个分析。

那么今天的话我们就来看一下吧，像这种我们加固软件啊之类的，他们是如何对一个sion来进行一个对1个EIF文件来进行一个混淆，来达到阻碍分析的一个效果的。好，那么这里我们就以1个这样一个软件。

1个AP文件来进行一个测试了。

![](img/a952810344cf13d815d5ad23ee3be8d4_4.png)

![](img/a952810344cf13d815d5ad23ee3be8d4_5.png)

嗯，还是一样，这次目标靠还是这个APK打开。那么。我们等它这几一个分析完成以后，对1个SO文件来进行一个操作。啊，那么这里这一个是一个原始的1个SO文件，我们用IDA来打开分析一下。

看一下它原始的一个数据应该怎么样子的。不好打开。

![](img/a952810344cf13d815d5ad23ee3be8d4_7.png)

好，那么它呃原始的话应该是这种样子的，识为到这么很多函数，然后右边的反问器列表里面哎都能够看到这么多正常的一个数据的。



![](img/a952810344cf13d815d5ad23ee3be8d4_9.png)

好，那么是这个正常手尾的一个样子，我们来尝试着对它进行一个呃改变。

![](img/a952810344cf13d815d5ad23ee3be8d4_11.png)

好，找到他对应的S文件。

![](img/a952810344cf13d815d5ad23ee3be8d4_13.png)

这里是按ADR的一个库，然后打开。那么这里我们就尝试对它修改。那么作为第一次修改的话，我们先来把它的一个设选 help给清空，来看一下是不是能够正常的腾定是是能够正常执行。那么这里先跑一个脚本。



![](img/a952810344cf13d815d5ad23ee3be8d4_15.png)

![](img/a952810344cf13d815d5ad23ee3be8d4_16.png)

然后把它一个筛选head中的一个数据给清空。清空最好办广话就是在它的一个Eipad中。

![](img/a952810344cf13d815d5ad23ee3be8d4_18.png)

对，这里有一个intro size在下载它的几个相关数据，s川还有NS给志玲。然后在前面把它的一个生off4X和偏移地址给志玲。好，把这些都置理以后，我们来把声音来来运行一下。

看一下是不是能够正常的一个执行。好，我们来边辑运行来看一下效果。

![](img/a952810344cf13d815d5ad23ee3be8d4_20.png)

很多。我们可以看到可以看到整一个程序的话还是依旧能够正常执行的。那么这里我们已经对由于我们已经对原始的一个确损进行了一个修改。我们这用ID来打开看一下我们修改以后，ID是行为一个什么样的样子的。



![](img/a952810344cf13d815d5ad23ee3be8d4_22.png)

![](img/a952810344cf13d815d5ad23ee3be8d4_23.png)

好，那么这里啊是。呃，这函数的话可能还算是勉强，但是右边的话可以看到它对一个代码识别已经变成这个样子了。本来应该是反面一以后代码改变成这种呃这种呃没有办法识别出正常格式的一个样子，还有一些函数的话，哎。

都是非不怎么正常的哈，但是可以正常识别的也不少。嘿，那么这里就是一个简单的一个修改。当然这样的修改，对于混淆来说，强度还并不大。我们来尝试一下。

看下有没有其他的一个修改办法来或或许更比较强的一个混淆一个的一个效果。

![](img/a952810344cf13d815d5ad23ee3be8d4_25.png)

![](img/a952810344cf13d815d5ad23ee3be8d4_26.png)

![](img/a952810344cf13d815d5ad23ee3be8d4_27.png)

那么我们就可以看一下360的一个。呃。你的处理吧。我们打开上节课看到了一个test的一个信息。

![](img/a952810344cf13d815d5ad23ee3be8d4_29.png)

好，我们可以看到的话，里面这选段它是并没有去除看一下它的名字，被很被很消生这个样子。那后它的一个P地址，还有它off全都是字为0，然后size的话都是没变。

那么这里剩零就是单纯的把这几些数据给制零为清零了。然后它的一个访问的tab也进行了某一些修改啊，变成一个非法的一个t属性。我们可以尝试就是按它的一个操作哎来进行一个混淆网。啊。

另外注意一下c原始的一个S缩文件ca理论上是不会有这么多的一个筛筛取来个数据的。那么这里他可能往里面添加了几段无用的一个数学。



![](img/a952810344cf13d815d5ad23ee3be8d4_31.png)

这都是有可能的。我们就来尝试直这里我们就来尝试这一个筛选的一个信息来直接进行一个操作。

![](img/a952810344cf13d815d5ad23ee3be8d4_33.png)

![](img/a952810344cf13d815d5ad23ee3be8d4_34.png)

好，我们首先来进行啊地铺的操作。假如我们这里我们这里呃我们假如我们只是修改一个自场的off，我们来改一下。我来看一下，这样修改的话是并不会影响正常执行的。但是这样的话，对1个IDA的分析会有什么样影响？

我们来看一下啊。

![](img/a952810344cf13d815d5ad23ee3be8d4_36.png)

好，过去的话，他就可以把现在报出报出这样一个错误。youour structure，然后就会找啊导致这样一个问题。



![](img/a952810344cf13d815d5ad23ee3be8d4_38.png)

那么这里可和刚才直接放出一个筛选信息的一个作用是一样的。那么这里它就可以直接读取一个bro head格来进行一个信息的一个获取。那么这种情况话，它都是直接把一个筛选数据给去掉。

没有进行一个分析的一个样子。

![](img/a952810344cf13d815d5ad23ee3be8d4_40.png)

好，我们来再看一下另外一种写法。呃，上一刚才那们操作靠是把它筛选数据做一个无效的一个处理。那么接着我们就来进行其他的一个操作。那么这次我们直接对1个SO信息进行一个修改。



![](img/a952810344cf13d815d5ad23ee3be8d4_42.png)

![](img/a952810344cf13d815d5ad23ee3be8d4_43.png)

我们直接对筛选的信息进行一个修改，把一把一些有用的，还有没有用的都混杂在里面来看一下它的一个效果。

![](img/a952810344cf13d815d5ad23ee3be8d4_45.png)

好，那么在我们找到一个shead table。那么看一下话他文现在目前来说哎有这么多一的一个table。然后它它的value对应着这几个东西，我们来随便的进行一个改动吧。



![](img/a952810344cf13d815d5ad23ee3be8d4_47.png)

把回刚才360的那个东西。我们来看一下。我们来看一下。原始的一个摄彩态的框，它应该是这些类型的话都是有且仅有一个的。但可以看到这里有这么多什么什么什么的，那么证明它的一个太属性都会改动了，然后它的偏离。

还有它op都被改动过了。我们来看一下，我们也尝试去改一下，来看一下什么属性吧。

![](img/a952810344cf13d815d5ad23ee3be8d4_49.png)

首先这里的话是把所有的这个地址，还有给志玲，下次的话是不变的。好，我们这里就来看一下，来尝试着去进行一个制玲吧。好。哦塞算这里就这里这两个了。おて入个さ。我们来清空它。

这些 set size啊上行的这玲是奥德还有一个 set的这灵。然后把这些不想要的都给清空掉，以后有有兴趣的话，可以顺便把一个名字也混淆掉。



![](img/a952810344cf13d815d5ad23ee3be8d4_51.png)

把几个段给清空一下。好，我们先搞前面几个看一下效果。

![](img/a952810344cf13d815d5ad23ee3be8d4_53.png)

我进去看一下啊。好，那么只改这前面几个话，它造成的话是这个样子，他该分析还是能够正常分析的。但是看一下左边这一个函数的实验的话，就会发现它已经少了很多函数了。

对吧看一下左边这里已经少了非常多的一个函数了。

![](img/a952810344cf13d815d5ad23ee3be8d4_55.png)

给大快应该把一些导入的一些函数啊，什么都应该给剩下识别出来的。比如我们刚才改动了，导致它哎左边这里识别一堆函数都少了不少。我们接着再再把其他几个区段的一个偏音，我们现在也改一下。



![](img/a952810344cf13d815d5ad23ee3be8d4_57.png)

我们来看一下，把这些都改一下效果是怎么样子的。好，暂停一下。好，那么这里的话已经改完了，我们带来这些一个反面来看一下一个效果。把这个关掉，我们再来看一下效果。改完以后，我们再来用IDA来打开来看一下。



![](img/a952810344cf13d815d5ad23ee3be8d4_59.png)

好，继续读取。那么这样一来的话，就达到1个360的一个效果了。可以看一下左边的一个分射window全是空的。然后它右面的它对于一些函数的识别，哎，这里一个函数都没有识别出来，对吧？

然后这里全都识别了一个数据段了。哎，那么这里就是1个360加固，它什么对它进行混淆一个效果。它就是它就是单纯的对一个偶 set，还有它的偏移地址进行了一个修改，哎，变成这这样一种鬼样子。

这里就变成一个4个文件1234了。

![](img/a952810344cf13d815d5ad23ee3be8d4_61.png)

那么这里的函数全都给挂掉了。这是360呢它的一个修改，单纯的把一个os还便宜给清除掉。那当然这里的块也可以把自里的话块也是把这样一个type给全部给。



![](img/a952810344cf13d815d5ad23ee3be8d4_63.png)

给改了一遍的。被改全要被改一遍了。这里的太索性的话，这本来本来应该有一个啊training table，还有一个s symbolim table之类的一些访问的一个太索性的，它都改掉。

当然这里的话要修复的话也不是不可以的，把这一些拼音地址，还有它的太of，全都给重新计算，然后给填上去的话就完事了。好，那么这里是1个360的一个加密。当然360的话。

它仅仅是对了这样一个s选来进行一个加密的，所以西复回来的话也是比较简单的。还有另外一些比较强的一个加固的话它也会同时对一个program head来进行一个混淆的。



![](img/a952810344cf13d815d5ad23ee3be8d4_65.png)

那这里的话它可以对organ pad中的一个数据进行一个混淆，进行一个处理。

![](img/a952810344cf13d815d5ad23ee3be8d4_67.png)

哎，你说比如说啊虽然它link可它加载中需要用到for中的数据，特别是这两个段的数据，它都是用到它来进行一个map到中中的一个中的一个加载一个修改的。但是呢它里面的其就是说从一个b中里面的一些数据的话。

倒是是可以进行一个修改的。比如说像这样一个动态截区。上一节课已经说到这动态截区，它取出来的时候话是。

![](img/a952810344cf13d815d5ad23ee3be8d4_69.png)

![](img/a952810344cf13d815d5ad23ee3be8d4_70.png)

那么来呃定位到这样一个动态集节去取出来的一个地方吧。嗯，在在这。🎼好，那么这里取出动态地区的时候，是通过一个switch来进行一个病例的一个操作修改的。那么这里可以看到，哎这里每一个tag的话。

它下最后的一个tag覆会覆盖上一个tag的一个数据。那么所以这里呃在这里的话有一些。

![](img/a952810344cf13d815d5ad23ee3be8d4_72.png)

加密的话就会把这些t给多搞几个，对吧？像这种多搞几个，然后前面数据都是非法的。比如说这也是其他一些非法的一个甚是能够导致一个溢出的一些数据。哎那么最后啊最后这样一个tag才是一个正常的数据。

这样来写的话，也是能够来阻IID的一个分析的。因为对于link来说的话，每一个后面的t的话都会覆盖前面相关t的一个数据的。



![](img/a952810344cf13d815d5ad23ee3be8d4_74.png)

是有所以现在某一些粉丝的话，哎是会对对对这样一个动态截区的一个tag进行一个操作的。

![](img/a952810344cf13d815d5ad23ee3be8d4_76.png)

好，当然这是一个回淆。嗯，那如果遇到这种情况呢的话，就只需要记得。只有最后一个tag的一个数据才是有效的。前面的t的话哎都是可以被覆盖掉的一个样子的。那么这里是一个横香。还有说对动态节区的一个加密。

那么下面要分析的话路是针对于一个呃。通过他那个筛小段来进行个分析的。那那当然其他的一个风享圈者可以用来加密的其实。



![](img/a952810344cf13d815d5ad23ee3be8d4_78.png)

那江面的地方也没有很多。那么大致来说的话啊，就是这几个样子的一个样子。

![](img/a952810344cf13d815d5ad23ee3be8d4_80.png)

好，那么这里我们把这样一个hello来进行完一个修改了，我们再来进行一个编译，来看一下它是不是能够正常的一个运行。那么大家有兴趣的话，可以尝试着去行一些呃软分析软件，哎，来达达到一个混淆的一个效果。

对于像这种简单的混淆的话，哎，这样直接操作就可以了。那么那么可以看一下，在尝试里哎，即使我们把一个筛选的数据给修改完以后啊，它还是一样，能够正常的进行一个加载的。



![](img/a952810344cf13d815d5ad23ee3be8d4_82.png)

，那么这里就是一个自省段的一个混淆的一个效果，也是这样一个360的1个混淆的一个方法，挺简单的一个处理的。



![](img/a952810344cf13d815d5ad23ee3be8d4_84.png)

这是较简单的一个处理。那么要还要跨，哎，也是很简单的一个样子。🎼好，那么我们来看一下360这样一1个SO文件要怎么样要怎么样来进行一个还原吧。好，找到360。找到300的这个东西好。

我们来看一下怎么还原。那么刚才就已经演示过了，呃，它对于360来说，它的一个是选段的数据全都是被清空掉了。然后它里面都是不可信了。那么这里我们可以怎么办呢？对。

最简单的办法就是把它没有下的那个筛筛选的信息给全部给清空掉。

![](img/a952810344cf13d815d5ad23ee3be8d4_86.png)

那在本呢定阅到这里，把设选的配音地址。这里由于它系统段都被清了，清成零。第一种方法是手动的去把它的一个star地址给附回来回来啊，这其实是完全可行了。因为已经知道它的一个s大小了。

那么根据一些特征码也可以计算出来的。那么当然这些简单的方法的话，就是单纯的把它断信息给清空为0，然后它一个大小，这里S都为0，那么这里这简单的一个进已经完成了。那么这种先方法的话。

对于大部分的一个SO本项的话都是可行的。那都是可行的。我们来看一下这样搞完以后么一个样子，对吧？看到了吧？那么这里这搞完以后一些函数啊识别的话基本上是正常。

这里我只能说是基本上因为可以看一下右边看下右边的话先断了一个数据处理的话是非法的对吧？本来是一个函数地方，它就加为认为是一个数据了，但是一些函数这些函数的话也是正常的一个识别。



![](img/a952810344cf13d815d5ad23ee3be8d4_88.png)

![](img/a952810344cf13d815d5ad23ee3be8d4_89.png)

然后是一个J的一个函数。哎，这里也是一样，能够正常的给分析出来。那么这里就是大概是差不多一个呃这这这也就是一个最简单的一个修复办办法。对于一些混淆过SO文件的话。

可以尝试着就把它的s选head和这三个s给全部修成零。

![](img/a952810344cf13d815d5ad23ee3be8d4_91.png)

可以全部推上泥，这都是有可行的，这都是可行的，可以尝自己去试一下。🎼啊，那么这节课内容的话时间比较短一点，也到此为止，谢谢大家。



![](img/a952810344cf13d815d5ad23ee3be8d4_93.png)