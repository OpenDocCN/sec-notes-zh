# 经典15年i春秋渗透测试系统化教程 - P31：课时1 文件包含漏洞分类及上传技巧 - 老网恋教父了 - BV1n54y1B7F7

Yeah。啊，大家好，我们这节课给大家讲解一下文件包含内容。呃，文件包来的在以前也是影响比较大的一个大漏洞。那么这个漏洞嗯现在。很少的啊，比较少的。呃，以前在PHP168这呃这样的程序里面很多。

它基本上在PSHP里面出现的比较多啊，其他的程序出现来讲比较少。那么我们来看一下本章的一个结构。文件包含类的。那么包含类动的，首先我们来看知道要讲什么是文件包含类的啊，这个大家要清楚，写完这节课之后。

其次就是它的一个分类啊，分为本地包含远程包含。接着包含类动如何结合上传技巧。因为一般的网站包括论坛，它都有这个上传的功能啊，我们上传一个图片上去。那么我们在图片里面插入一句话木陌。

陌么通过包含漏的来直接包含我们这个图片。这样的话我们直接可以拉到微部睡了。其次我们要知道这个呃PHB这个包含的这个文件的一切读，怎么样去读系统文件写写文件，怎么包含日志文件。

包括它的这个PHB包含的一个载档内置协议啊。这个你要通过这节课我们把这些知识，大家全部要掌握。好，首先我们来看一下。包含内的一个简介，那么什么是包含内容呢？嗯，在这个大多数外部语言中啊。

它都提供了这个功能啊，就是包含功能。比如有一些嗯仿夸张啊仿注入啊，那么要调用这个仿注入程序啊，很多人都喜欢在这个呃代码里面加入一个包含啊，inlude直接包含这个。

每一个页面直接包放这个防注入程序啊一些呃。保护这个网站，保护自己的网站啊，防止这个黑客攻击。但是你要注意一下。在PSP等于这个文件这个。手提的这个功能太强大了，太灵活啊呃其他的语言啊在这个包含。

它这它没有这么灵活啊。为什么这个包含的一种在这个PSP语言里面出现的几率比较大呢？就是很大部分这个包含的人都在这个PSP语言里面，为什么其他的程序比较少呢？因为这个PSP它在这个呃。

提供了这个inc啊啊inc once啊等等，其他的一些函数里面，它这个功能是比其他的程序提供的要强大要灵活。所以说它基本上就是PSP包含的一种，基本上都都在PSHP语言里面。也就说念在了一句老话哈。

就是我们的这个程序语言。就是功能越强大，那么它的漏洞就越多啊，就像微微远的这个操作系统一样，它的功能强大，它的漏洞就多了。就是你的能力有多大，那么你的毛病就有多大，它是这么就是这个意思啊，就是这个意思。

啊，现在我们来看一下呃PSP包含的这这个分类，它主要是分为这个本地包含啊，远程包含，注意远程包航它需要是吧？在这个引。搭建这个PHP环境的时候，它有个PHP点INI这个配置文件。那么在原程包含里面。

这个PSHP点INI里面这个配置文件里面你需要这个嗯。把，这个这个al这个include这个呃开启为on，就是说必须要on状态下嗯，才okK的参与。才进行才能原才包含啊，不然的话啊默认是off分的。

就是关闭状态啊，只有为安状态下，你才能进行这个。远程包含，一般我们都是本地包含。本地包含的话，我们直接把一句话密码插入到这个图片里面，再进行包含这个图片。嗯。如果能开对方开启的远程播放的话来更好了。

那么我们把密马上传到任何地方，那么只要。通过他的网络地址一定要用一包含，那么微博效就拿到手了，这就是本地包含远程包含的一个。呃，区别好，现在我们接着看一下这个PSP这个语言中，它采用这个。

这个包含包含这个四个函数有哪几个函哪几个函数要漏洞就出现在这几个函数上面。好，我们来看一下，它有四这几个函数，include跟include这个on啊lili这个 once这四个函数。

这四个函数大家要记住，大家在源码审计的时候啊，你在这个代码里面看查一下有这有没有这四个函数，这四个函数就是。啊，PHB源里面的这个包含啊包含的这个文件函数。那么这个如果如果使用了这个。

那么你看一下它的过滤证严不严格啊，会不会造成漏洞漏洞。这个等一下我们在哪里开启，因为我这个讯机里面搭建的环境在网上下载软件啊，直接一键安装的。所以。嗯，它不是在这个PSHPDII里面啊。

等下我会给大家讲解哈，我的我的信拟机是在哪个改哪个配置文件。一般你们如果是服务器的话，一般是PSHPDINI啊，做手工安装的话。好，我们来看一下这个PHP本地包含的一个实例。这个环境我已经搭建好了嗯。

准备好了。

![](img/fd3195c5a680da197fea75c4aacf05ad_1.png)

好，下面我们就在这里给大家。演示一下。

![](img/fd3195c5a680da197fea75c4aacf05ad_3.png)

Yeah。あこ。Oh。Okay。好，我这里准备了嗯看一下我们首页，我们即时把打开这两个调用就是一个慢点PSP。嗯，这个文件PP文件。嗯，我这个inDXHTI的文件就打开的时候，我现在打开的是哪一个文件。

是这个inDX。点HTMI这个文件是吧？这个文件里面有一个man点撇点撇P问号配置等1点。那个天霾了。下面的样，下面是2。HTL。慢慢弄学这个文件。嗯。吃个橘的。我们也把它打开啊，编辑。

那么现在我们来看一下来看一下。当我点击一的时候。也就说1点TM，就是说这个参数。就传递给大家的，我们来看一下。你看也蛮意，对不对？是不是我也就是说我把这个。一点还是天埋了。你看一面一。

也就说在这个慢点PSP这个文件inc用到的函数，就是我们这个前面给大家讲到的就是包含的就直接包含了我们这个什么，当我们就是说是。配置这个。就是我们这里不是单体的给他发了一个什么？你们在这里看一下。

1点HTML，那么它直接包含进去了是吧？把1点HTM给这个。配置这个变量。那么这个嗯给这个参数啊给这个参数。那么慢点PSP这个文件，这个文件里面我们是试么？包含了这个配置。是我们任何东西文件还是文件。

还是我们给的，就是我们任何文件给这个参储的时候。提交给这个配置这个参数的时候，那么在这个慢点PSP里面include这个函数里面直接包含。直接包含，也就是说我们如果这个是一个木马文件的一点HTML的。

对不对？如果是个木马文件呢，我说假这啊，那么它是不是就。就执行了我们的木马，如果是一句话，那么执行一句话木马了，对不对？嗯，他是这个意思。下在我们大家一定要清楚哈一定要清楚。

那么下面我们就给大家嗯在这里给大家演示一下。好。这里我这里有一个准备了一个。图片这个图片里面是什么内容呢嗯。是一个木马。哎，不是老吧。应该这得20出吧。22点PGPG是。就是显示PSP的这个环境啊。好。

我们如果我们现在来给大家演示一下。Yes。如果我这个地方。这个配置是吧，等于1点，就就说我现在传个什么2点GPG过去。就是说我们看一下这条。现在是我把2。GP7这个图片。这个图片里面是。

也是PSP代码在这个图片，我们只改了个扩展名为2。GPG，那么传直接传递给这这个参数啊参数。那传过去之后，那么它这个地方比如说我们这个英弯点撇HP那么直接包含了是吧，看没？直接包含了这个参数。

这个我们把文件传给了这个参数，那么这里这个man给这个局文件直接包含，那么直接包含的话，我们要看一下效果。



![](img/fd3195c5a680da197fea75c4aacf05ad_5.png)

那你看一下效果。哎，看到没有？它直接执行，你看直接执行啊2点GPG是可以执行的。是不是比较危险，对不对？如果我选一个木马。



![](img/fd3195c5a680da197fea75c4aacf05ad_7.png)

因为我们我们现在网上都基本可以上传着来，我把一句话木码插入到一个图片里面。嗯，在命个名字命的后缀名是GPG的，这个是原始上传的。不得减F注意哈这个任何文件扩张名。

任何文件扩张名它都会当做PHP语言来执行啊。你不相信我们这个命个名。鸡歪歪。你看。1歪弯。你看也是可以的，对不对？对我PSP包含了一种，它就是这么回事。比如说。我们这个。不管你是什么裤子，你是什么东西。

那么只要你。上传上去了，那么。我就把它当作PHP语言，只要采用了include或者刚才讲到的是个任何任何一个函数，只要你上下的文件，它都会用到这个函数，它都会采用这个PHP语言来进行包含执行啊包含执行。

好，我们接着我们讲解。然后。Yeah。

![](img/fd3195c5a680da197fea75c4aacf05ad_9.png)

![](img/fd3195c5a680da197fea75c4aacf05ad_10.png)

Yeah。嗯，这是一个胖的。这个没什么太多讲，我们不先不用管它，后面再讲。好，现在我们这个实例啊给大家就演示到这里。下面我们来看一下这个。Yeah。嗯，这个。包含类证本地包含类灯与如何与图片接合？嗯。

这个是约在我们实际生的测试中用的，我个人来讲用的最多的。用的最多的是怎么回事的？Okay。呃，前面我一再强调的就是网上。包含那种一般也是要上传一个图片上去啊，就是把一句换吧，我举个例子。



![](img/fd3195c5a680da197fea75c4aacf05ad_12.png)

。就是把你的木马程序。加载到一个图片里面去。Oh。这是一个正常的图片，你看没有？哎，搞错了。嗯。你随便找一个嘛。



![](img/fd3195c5a680da197fea75c4aacf05ad_14.png)

这样的话，你这个图片一样照样可以打开的，没任何问题，对不对？你看到没有？

![](img/fd3195c5a680da197fea75c4aacf05ad_16.png)

没任何问题吧，有图片。好。那么这样的话，你如果网站提供了上传功能，你把它圈上去，那个是一般都不会拦截的。那么我们嗯通过我们模拟模拟网站去通过DVWA来直接先上传一下。你 can路人在这里。好。

再来到文件包含的的。折叠。

![](img/fd3195c5a680da197fea75c4aacf05ad_18.png)

对。看一下。路警。对不对？说这里没问题吧。好，那么这里我们来看一下啊，它这个地方是存在远程包含的，等一下会给大家解释一下。那么这个前面两点反斜杠两点反斜杠，这个是什么意思呢？这个是代表着这个文件。よし。

相对不景。呃，现在我们后面接到了这个路径是吧，我们的图片是上上传了pa点击笔记。这个图片是插入了我们这个木马。偏什么木马啊有个小的，就没你之前一个木马。呃，我上想到了。这个目录下面是吧？

那么这个路径就是黑Kbell，这个路径有对不对？黑bell。啊，pro啊load有pa这个都。那么这后面一节我们先不用管。那么这个是什么？两点反击杠两点反斜杠所是我们的。

他以网站的干目为为为为为目标入为。就是我们两两点1个反斜杠，这个我们往上一级。那就是DVW对不对？DVW。DVW在两点1个方斜杠前面。也个发现了，那么他就来到了这个路线。这个路。

那么我们接在我们你看一下这里DV大杯是不是？再往上一句是网站的跟路径吧，那么它就它就是这么一这么这么去调用的啊，你这个过程要知道哈，非常清楚啊。这你。因为在后面用的这个这个用的是特别多的啊，用的特别多。

好，这样的话你看哎在这里执行了吧，你在这里输入命点long原形就行了，这就是。买，一个。与图片结合啊，就是上传啊，在目就是有请建议大家使用一句话木嘛，这样比较好。还直接执行句换密码。嗯。Yeah。

这个例子就不用看了啊，没什么太多讲。跟我们前面一样。好，我看一下远程包含给大家讲解一下。刚才讲辑的是本地包含，远程包含你必须要。我说过一定要为把offer改到2默认状态消失。

off的那那个怎么怎么怎么做的？所以这个前面涉及到的一些函数哈嗯我的这个PSP点安安。对应的文件是。这个文件我们来看一下路径，我这个路径是在。这个下面。我的关件是这个。



![](img/fd3195c5a680da197fea75c4aacf05ad_20.png)

这个明白没有？你们的是PSPDII啊，一般的情势，你们是PSHPDN因为我这个是在网上下载的一个小程序，直接双击下嗯安装一下就行了。各方面的环境就帮你搭建好了，然后省了很多时间。

那么找到这个文件include你找。Yeah。Yeah。嗯，这个。嗯，默认状态下是off就是关闭状态，然他把你开直接为on状态下才okK的才行好。



![](img/fd3195c5a680da197fea75c4aacf05ad_22.png)

那么这里我已经开启了。那是这里我嗯教大家去调用一下。

![](img/fd3195c5a680da197fea75c4aacf05ad_24.png)

那举个例子吧。我这里就以这个路径。Yes。看。看到没有？直接运行来吧，对不对？没问题吧。如果我这个是一用瓦雷。好的假设这个EDX点AP是个SP木码或者PSP木码，那它是不是执行了？

那你输入面码一登录就上去了吧，这个是没任何问题的。这个是没OK的，就是说啊这里我就不用了耽误时间了哈，这就是远程包含，就是可以直接接远程地址啊，接远程地址。一般你如果对方开起来。远程包含的话。

我话基本上微不试也是。拿拿下来，因为你把木板上传到任何地方，在后面介上你的地址，你的这个木板地址。啊，就可以了啊，就可以了就可以执行了。那这里我就我直接去拉了一个网页包含一下。好。两层不。好。

现在我们接着看一下这个。呃，包含类动的这个上传技巧，大家不是这个读文件啊，读文件。嗯，也是这个例子之前。你们现在把DRG打开。开下代理哈，等一下啊。



![](img/fd3195c5a680da197fea75c4aacf05ad_26.png)

先把教程暂停一下。

![](img/fd3195c5a680da197fea75c4aacf05ad_28.png)