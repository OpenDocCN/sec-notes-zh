# 经典15年i春秋渗透测试系统化教程 - P16：课时8 注入式攻击-Cookie手工注入（上） - 老网恋教父了 - BV1n54y1B7F7

Yeah。好，这节课我们给大家讲解一下这个课教思之录。那们科技是注路，大家以前都。都使用过，我相信大家用过穿山甲或者SKm都。怎么样去SK这个扩制式注路，大家应该非常清楚。但是关于BOIP的时候。

这个扩制式注路大家不一定明白啊，很多人在问怎么样去操作啊，一步一步。那么今天我就单独做一节课给大家讲解。呃，有关这个科技呃。裤就是猪路。呃，在什么样的情况下呃会用到嘞？在万夫安全狗的情况下啊。

用的比较多。因为onefi安装口，它默认情况下只在那盖头来进行防御poss头，但是co者斯一般很少防御啊，需要人工去配置这个是否对co脚斯进行防御。嗯，这里我。给大家举了一些呃，做了一下说明。

这是在注路的时候，当一个站点getpo的防御之后啊。那么很多人朋友就会放弃，其实大家可以试一试co架式注入。那么下面我们这个事列就是嗯粘ge和po做了防住入之后，但是忘了。或者是反租。来进行一个演示。

在演示之前，我们给大家讲解一下AP跟PSHP两种方式的一个接受。呃，对数据的一个接收方式。那么这两个方式在前面我们课程里面也讲的非常详细，讲解了。呃，你course就是全部接收，那么这种模式是get。

那么这个phone模式这个是指接收poss。这种模式直接是扣着。那个PSP的它也发这这些模式。大家嗯大概记下来就知道了。好，下面我们来看一下呃，我们这个坐点。



![](img/86318d3ae7a5990e1d901087e6970b8f_1.png)

当我们在这里输入单摇的时候，你看仿注落程序爆出来了。啊，他告诉你不允许说入安德嗯这个。

![](img/86318d3ae7a5990e1d901087e6970b8f_3.png)

啊不d等等这些。你你输入这些什么on等呀，一一等于一啊那绝对是不行的。你看是吧做完防住了，如果你把它改成po来，举个例子。我们在这里你举个例子哈，pos。你那答也好看一下啊。



![](img/86318d3ae7a5990e1d901087e6970b8f_5.png)

你看说错了，ID什么非法支付。是吧也是不行的也是不行的那说明我们这个什么。

![](img/86318d3ae7a5990e1d901087e6970b8f_7.png)

想办法。绕过这个放修路，那么嗯。

![](img/86318d3ae7a5990e1d901087e6970b8f_9.png)

你们首先来看一下对方的这个网站程序的一原代码。这样的话我们好进行操作吧。

![](img/86318d3ae7a5990e1d901087e6970b8f_11.png)

首先我们来看一下这个注入的参数，这个文件里面的ID。

![](img/86318d3ae7a5990e1d901087e6970b8f_13.png)

嗯，这个P开出来吧，PPPPP。

![](img/86318d3ae7a5990e1d901087e6970b8f_15.png)

这个文件吧。好，他是采用的是，你看到这里是吧？

![](img/86318d3ae7a5990e1d901087e6970b8f_17.png)

全部接受。嗯，我这里讲到了吧。全部接受，那么全部接受代表什么？那叫get po或这三种这三种数据提交方式它都全部接受。但是我们前面测试了两种get跟pos都已经被过滤掉了，都已经被干掉了。



![](img/86318d3ae7a5990e1d901087e6970b8f_19.png)

那么我们就。还有课就是一种方法没有没有去。式。那么我们接着看一下它的包含文件，它这个包含是在INC里面。诶唔视。A是这个AY克的。SY SY。嗯，这个文件。嗯。

这个文件里面再包含了当前目录的这个检测S do，也就是说这个文件。一个包含一个是吧，那么我们可以嗯通过读它的这个仿撞的代码，看有没有漏斗。嗯，他这里定义的DIM定义的这几个文件。这几这几个函数。你看。

盖子呃盖子做了一个防筑落，你看没有？这个就是我们刚才看到的吧，弹出来的电话坑板。嗯，我们再看一下pos。pos也做了放助，对吧？出错了，表达什么什么这个我们刚才也看到了吧，对不对？

这句话我刚才我们也看到了。嗯。在盖头也做了，抛子也做了。但是我们这个什么。可就是没做啊。对不对？😔，这个没有啊，没有做仿筑入，如果你在这里再加一份代码，加到这里，再在这里定义一下，把扣角式也定义一下。

仿筑物那完蛋了，那这个真正的把这个注入防御掉了，对不对？那但是他这个代码里面没有扣角是没有扣学式，而且我们这个接受参运输的时候。



![](img/86318d3ae7a5990e1d901087e6970b8f_21.png)

接受参数的时候是什么？全部接受。quis是可以接锁的，但是这个防助的代码里面没有针对这个quis进行防御。那么我们下面就。按颜顺首工区可就是猪路。手工演色的话，模拟的话，建议大家使用BURP好，启动2。

嗯。启动按的话。嗯，我们在这里。

![](img/86318d3ae7a5990e1d901087e6970b8f_23.png)

嗯。哦，这个地方。开机代理。

![](img/86318d3ae7a5990e1d901087e6970b8f_25.png)

再刷新一下。长发长发长发。刷新。没有。怎么回事啊？

![](img/86318d3ae7a5990e1d901087e6970b8f_27.png)

好。抓到Q6斯之后，我们在这里。发送到离派。来调试。好，你看我们加单引号。报错了，你看没有？防助的程序出来了，都马上防御了。现在我们把这个地方去掉，我把这个参数。这个注入的这个ID等于58这个参数啊。

我把它放在酒室里面。用分号给看下。好。你看看帮我再加个单一号。哎哎，OK了，你看。ok企 啦。你看没有仿租的程序爆出来的那说明我们就绕过去了，对不对？是okK的，没问题。

但是道陆这里查询是不是也是没问题的？唔家。5办这个程序根本没问题吧，对不对？当我加个单引号，它就报错了。正常的是它的长度哈，你看没加单引号之前，它的长度是16196，加个单引号之后。

它这个长度会发生变化。当长度发生变化的时候，也就是报错。报错的话就是说明了一个问题。我这个地方是一个注点。看这个长度就看出来了哈。当然也可以这样嗯，也没问题。你你这样也可以。好，那么接着我们操作。

现在我们已经。

![](img/86318d3ae7a5990e1d901087e6970b8f_29.png)

嗯，那接着我们就用ode的 by语句测释一下。我的伴宇就怎么扯扯了？在这里，首先你要把这个。空格转换才16进制，就是20%。诶欧多。我迪1。欧do欧do半0%空格，也就是空格的意思。呃，但。嗯。

这个地方你必须要这样写。嗯，我首先核试一下25，不是不是。当前这个数据库有25个字段。报错，15241般是错误，1看到这个是11524，你看到没有？正常的数据包不是这1524吧，这16什么什么。

这个是报错的。那么我们。23。又1524报错了。21。又包错了。20。哎，正确，1611数据包这个长度大小长度变化了。16196，那说明我们这个。当前库里面有20个字段。20。2020之后。

我们在U灵用联合查询。un u n i o n。嗯，这个这个地方bag ands。联合查询的意思。联合查询这个20的话，我们。嗯，20个字弹。



![](img/86318d3ae7a5990e1d901087e6970b8f_31.png)

用火狐浏蛋器吧。嗯，在这个地方。2是。

![](img/86318d3ae7a5990e1d901087e6970b8f_33.png)

![](img/86318d3ae7a5990e1d901087e6970b8f_34.png)

嗯。再是20%。Flo。Flow模式。但是百分之0。表明表明f来自哪个表明at米。我要啲唔掉。admission代表的是。就是说嗯当前这个。查找这个表，看有没有这个表。这个表里面通过这里。

我们联合查询也会报出一串数字。好。没问题，哎，说明我这个。这个表是没问题的，AD面表。比就说存在一定表，当我这个地方，你看不存在这个表的时候，它就会报错1584。就是说这个长度是不一样。

是错误的一个长度。大家注意好，这个地方就是说你输入一个正确的数据，这个就是说你输入正确的看一下它的长度大小。绝对上就是说你在这里输入ID等于58，应该种方式，它的长度大小也是161117呀。

应该没没没任何问题的。但是报错的时候，如果你不存在这个A定表的时候，它就会其他的长度，那说明一般是报错。通过这个长度来分析。好，现在我们就说通过这里，我们就知道了嗯表。还有我们这个。Okay。

在20个字段里面，哪些是可写的呢？因为我们通过这个数返回的数据包可以看到。哪些是可写的？其实我们在这里你看。这样吧，你这样难找你是吧？难找你这样啊，一般的菜喜欢菜鸟朋友，一般跟初学者来讲喜欢看图。

喜欢因为。啊，有些人他就喜欢看这看这个看这个代码形式的。

![](img/86318d3ae7a5990e1d901087e6970b8f_36.png)

每个人爱好不一样啊，我这种方式也给大家说一下。你这样也行，没问题。

![](img/86318d3ae7a5990e1d901087e6970b8f_38.png)

，这个无所谓啊，根你各有各的爱好。你通过图形化界面这个看也是可以。你就把这个BIP这个。

![](img/86318d3ae7a5990e1d901087e6970b8f_40.png)

只。6136这几个数字记下来。

![](img/86318d3ae7a5990e1d901087e6970b8f_42.png)

其实在这里你也可以看到哈，你这里也有。你看6136一样的。

![](img/86318d3ae7a5990e1d901087e6970b8f_44.png)

那么我们接着把自动。自动带入到这个嗯6跟11A36吧，36里面去吧。嗯，在这里来白你吧。

![](img/86318d3ae7a5990e1d901087e6970b8f_46.png)

3。6是吧。用户名us name。pas word对不对？好，点击购。好。那么你在这里可以找到用户名啊，一般的。嗯，对于初学者来讲，他懒得搞了，我还是看这个图形画吧。



![](img/86318d3ae7a5990e1d901087e6970b8f_48.png)

读线块比较方便是吧？一目了了，这个用户名密码吗？

![](img/86318d3ae7a5990e1d901087e6970b8f_50.png)

好。

![](img/86318d3ae7a5990e1d901087e6970b8f_52.png)

嗯。嗯，用户名跟密码出来了，那，这是用户管理员的用户名A的名。这个是密码，你可以拉着拉着这个密码去解密就是。



![](img/86318d3ae7a5990e1d901087e6970b8f_54.png)

咩。在哪里解密啊，到CMD5CMD5吧，CMD5。

![](img/86318d3ae7a5990e1d901087e6970b8f_56.png)

![](img/86318d3ae7a5990e1d901087e6970b8f_57.png)

![](img/86318d3ae7a5990e1d901087e6970b8f_58.png)

![](img/86318d3ae7a5990e1d901087e6970b8f_59.png)

你电网速也这么慢吗？好，密码为A点名。好，接着你就拿这个用户名也是AA点名，密码也是A点名。姐你拿着这个账号密码就登录后台呗。



![](img/86318d3ae7a5990e1d901087e6970b8f_61.png)

![](img/86318d3ae7a5990e1d901087e6970b8f_62.png)

对不对？你看一下这个网站程序的后台在哪里。对不对？😔，你在这里。这个地方这个两张麻哈。

![](img/86318d3ae7a5990e1d901087e6970b8f_64.png)

![](img/86318d3ae7a5990e1d901087e6970b8f_65.png)

人家的马还还还有问题。嗯，不管他吧。方法就是这么回事的，图片有问题。在在验证码这个地方。

![](img/86318d3ae7a5990e1d901087e6970b8f_67.png)

我们不用管哈，我们主要是给大家演示在这个这个记录程序。

![](img/86318d3ae7a5990e1d901087e6970b8f_69.png)

![](img/86318d3ae7a5990e1d901087e6970b8f_70.png)

看有什么其他的没有讲到的。关注。关于这个嗯。防御的方法就大家就是自己把这个扣掉是这个防御弹码把它写一下。啊，就当做一个作业吧，你去放你也可以在网上去下载啊，玩站型的。嗯，他这个代码是有缺陷的。

就是针对这个。嗯。对，这个裤脚是没有去做防御。所以你下载一个一键看这个代码，是不是对这个。怕是改错可就是全部做防御了，一般的呀。用这样的灯。其他的这节课内容还是比较简单的。



![](img/86318d3ae7a5990e1d901087e6970b8f_72.png)

嗯，简单的一个分析。好，这节课就讲到这里吧。

![](img/86318d3ae7a5990e1d901087e6970b8f_74.png)