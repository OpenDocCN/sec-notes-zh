# 经典15年i春秋渗透测试系统化教程 - P40：课时4 MS15-034HTTP远程代码执行漏洞分析利用 - 老网恋教父了 - BV1n54y1B7F7

🎼Yeah。呃，我给大家呃说一下这个最新的这个呃微员爆出的一个漏洞，叫这个远程代码执行这种。那这个内洞影响很大的啊，刚出来。很多人在网上360也发出来这个来的，但是很多人不知道怎么样去使用啊。

怎么样去打波丁啊，包括他的危害啊啊，也有很多人在调试过程中。说这个内种没法利用，就是说呃蓝屏也没有调试成功，到底是怎么回事？那么今天我已经把这个。通告微软的这个官方站点的一个说法，就是受影响的操作系统。



![](img/5a64ccdc7aad5f9b419436ebc06da8d3_1.png)

就是II6。0以上的呃操作系统啊，我都装了一下，就是有winN期哎，20082012啊3个我都装了一下。那么在这里就给大家演示一遍，演示之前我给大家说一下哈呃这个内洞啊，首先点介一下。

不过这个修复方案啊，都给大家嗯整个过程给大家分析一遍。那么这次会讲出现的那种啊是MS15034啊，就是15年初的呃一个新那种。那么这个漏动表E区呃是哪一个文件是HHTTB点SYS这个文件。

就以说这个文件只有IS微软的34。0，呃IS6。0开始才有这个文件。那这个文件它是做什么用的啊，等一下我给大家讲解。那么现在我在这里给大家查找一下呃在C框底下，就是说呃这个文件。嗯，我们追索一下。

测作之前我们先别看这个，先给大家把这个漏洞还是玩一下。就是为这个windows平台优化了1个IIS服务器啊，引入的一个内核级的一个驱动程序。

那么这个驱动程序它的作用主要是提提供这个HDDP一个请求D收和响应那个缓存提高性能，二制功能的一个服务。莫代NS6。0它是没有这个文件的啊，是没有这个文件，也没有这个功能。😡。

那么下面我们来看一下他这个岁手已经黑了没有。嗯，有文件呢。在哪里设？我我在这里啊，就在这个啊，大家可以看到哈呃这个是一个备份的一个驱动SPTB点SIS文件。那么真正的路径是在这个路径下面。

大家可以在这里啊打开。😊，文件位置啊，在这里啊，这就是这个文件。那么大家可以按按照这个360的一个呃分析。嗯，这里我给大家一篇文档啊，这是4月6号16号公开的。呃，我刚拉的这个看到这个之后。

我就直接呃做了一点，看到这个文章做做了一遍。那么他是嗯。出现在这个文件里面。呃，大家可以直接来看这一道啊，这一档代码有点卡，开了两台虚拟机。那这个文件直接呃啊补丁之前，你在操作系统啊补丁之前。

再打补丁之后啊，把ATDP点SYS这个文件，分别载入这个OD1个动台反馈边啊，动态反馈片里面，就是说反馈编直接找到这一张代码啊，大家自去找一下我，这里我就不演示的push啊压路对账EBX啊，这个是解啊。

呃，他这里也给大家解释了，就是一一个呃的一个例子。看哪一页。嗯，我给里举的举个例子，就是模仿汇编口子，那就是一个加一啊，这里啊ADD啊就是加加的意思啊，13器加1EEIX1啊加1。

那两队之间的一个长度的一个距离。就之间存在31个字节，就是啊他这里就啊按照这个例子的这个写法，就是大概一个这样的一个形式。凹线E区啊，就是这这个64位无符豪整数E区为0。后面他写的很长。

大家可以自己看一下啊，他这个利用代码也给大家呃列出来了。这篇文章里面会很好。很简很短的一个利方代码，就是嗯不会对系统产生一句，造成各个系统蓝屏。目前还没有出这个就直接组织系统权限啊，利用这个这账代码啊。

还没有出来。这里呃我也没定衡啊，就是按照微险官方站的三点的说法是。他是远程。执行代码，就是说意思是可以直接啊，应该是得到系统权限的啊，你得像MS08。你46楼这有，直接发生一区走系统条件。

但是我这里是没有调试成功啊，可以直接。呃，调制这个郎屏啊，三个三个版本都调制成功了。那么这里给大家演奏啊。Yeah。呃，他是营销的版本从运期开始。呃，一个是SP啊SP啊，一个32果64位都受影响。

还有1个22008对22啊啊，注意哈，200822就是22008这个这52008SP这样的版本SP，它是存在这个，因为它没有这个文件SDPSSSYS这个文件这个文只有这个文件开行可能。

受到这个一系类中的影响。那微软在官方上面提供的这个。那操作系统自己去下载自己进行配试。Awinwindow8801啊2012。在这里啊，你也给大家提供了，大家自己去下载，等一下我给大家讲解一下。

Yeah。呃，这个修补不定啊，对对对对，路径这方面我都提供给大家了，大家自己参照我这个呃整体的这个文档啊，大家自己去下载啊对应的不定。不然你用360，应该360也现在也出了。这这呃文章。

360这个官方站点嗯把这个漏洞这个大家分析解了一下啊，这是这影响的版本啊也解了一下。那么大家就是按照这个应该360这个安全卫士。个人觉得应该是助补定的吧。这个我没有，因为我这电脑没有去装这个。嗯。

放到的安全位置。提这个问题啊。或者自己去威养官方商店直接下单文弄一点。哦，这里我提供了这个版本啊，这里我也写了一下。那么这个配动它是由呃美国的这个四界公司虚拟化啊，可的这个虚拟化软件。

也有公司研究出来的。就是呃做物量做补丁够12个小时之内啊，就嗯又有人在这。呃，一些溺味者就在网络上去分开了啊，公开了这种这个攻击代码。那么这个文件的这个工作原理也给他举出了一下。

下面我直接给大家呃演示一遍啊，就是说这呃利用过程。嗯，那么首先我这里就。呃，从2018打起吧，我这个打打完之后，我就把这个关了，等下要开2012。我上台机器从时开启的话，这个没法把这个视频录一下。

Of the eyes。大家看我这里是2008操作系统。呃，winowC5200822数据中心版本。7。哦，我那我们浏览一下看是不是这个1010480。呃，等一下我会给大家讲解一下，这个网上很多人说。

呃，不成功的原因啊是在哪个方面就是干码蚁提供了。但是就是很多人没有调试成功。呃，最主要的一个呃问题是因为网上给出的代码，很多是只是一个检测作用，检测你的服务器是否存在漏种呃。

但是这个没有提供这个没有起到一个攻击的作用啊，就是达到系统蓝屏，没有达到系统蓝屏。所以说在这里我就用直接用我这里那我这里也也有360，好像这个应该是。内蒙的是360的，提供的一个检测代码。啊。

这种检测代码我也给大家。等一下打包一下吧这个。嗯是。你看你的服务器是否存在这种啊是不存在这种。呃，大家注意点，这张代码只需要改1个IP地址就行了哈。那这里的话我就。那也是一样吧，等家打包。

等一下大家不会用这个呃配偶这个标本。那么这个脚本首先大家自己在自己的电脑装一下配偶，装完之后啊，那么就可以使用了啊，等一下我会直接打包给大家。把这个IP地址改一下，改成这个哪1个IP地址。呃。

有了用的主机的IP好A呃我这里就先从2018开始。192。1681。104。整个。2。2。162。1。104。好，那么在这里我就保存一下。你。我让我本地的配置。Yes。直接运行就行嗯。

告诉你这个地方存在流动，看到没有？如果出现这个路口外流，这个就是存在流动的意思。说明我这个主机2008是存在这个IS这个。疫区内中的。呃，下面我在这里嗯。这张代码而我也给大家。

那么什么情况下不存在这个这个？如果你这个系统打了最新的这个。补丁啊，为原告发上点的补丁，那么都不存在。对一个碰断条件意思啊意思。放造条件。看到没有。首先这种情况是没有打补丁的，存在漏洞的。

那个只是一个点头哈，没有发起攻击，那发起就是奥看蓝屏的。呃，这个是如果出现这种情况。那么是达到补丁。如果第三种情况是什么情况呢？这无法识别啊无法识别。呃不知道你这台题国际打了补定还是没有打补停。

这种情况是在什么情况下会出现的这种情况呢？如果你拒决2003去打，绝对是第三种情况，或者对决这个2008的SD这个版本去打，也会出现这种情况啊。嗯。咁我咁样。关掉。嗯，这里打开BURP啊。

这的神器比较厉害的一个软件一款软件，大家一定要非常熟练的去找握。呃，代码就利用这张代码。对呀，现在干吗？嗯，这里按毛我贴给大。嗯，在这里总结一下，接绍这条。



![](img/5a64ccdc7aad5f9b419436ebc06da8d3_3.png)

嗯，或者你改一下IP地址。利用。我，当前这个网站是是是是是是IPIP是多少？Okay。嗯，这个。104号104。192点162。1。168。1。10字。3980。Okay。嗯，这个其实。要改一下。

就是改不改都无所谓。这个地址因为我这里看过里面已经写好了。有1。10字。Yes。好，那么成功与不成功的原因是呃在这里进行一点，最重要的一点。这个ge的时候，就是说我这个地方是吧，啊。

开这个A应的网站啊这个地址。Yeah。我看能不能个看红外。

![](img/5a64ccdc7aad5f9b419436ebc06da8d3_5.png)

嗯，来访问。那很好，这是直接放回虚拟机里面的这个断点啊，这个断点啊这个断点。你不人念是什么怎么打的呀？😡，我就是这么测示的，它这个地方它是没有ge出一个文件啊，去写一个文件和直接。

是一个爱或者一个域米啊，是这样的话是。我启试的时候好像是不蓝屏的，不蓝屏，有的没没没有反应啊，没有攻击效果。那么大家直接接一个什么图片。每天一个图片，这个图片是什么？就对方网站。

对方网站的一个邮辑的一个随便打一个图片啊，不可以，应该不可以没问题。那么这里的话我用I默认的一个图片啊，这个应该是这个默认图片是在哪个地方？都I。嗯。没有嗯，要这件是。这个啊这个这个这个这个这个名字。

不能你如果你互联网的机器，你你就你就直接在这个地方啊，我在浏览器里面可以找得到呃，这个这个图片，这这也也也有名字，没有名字啊，如果是其他的图片，你也找个你也找到找个名字，你一下，在这里请求。

呃也呃是可以啊，没问题的。啊，那么这个就是一个呃一的一个疫区的一个通啊一个代码。我们来进行过一下啊，来看效果啊，那么要看效果，其实有的时候啊注意哈，有的时候他不难平，但是。



![](img/5a64ccdc7aad5f9b419436ebc06da8d3_7.png)

放是技术。我当前这个机器是可以操作的吧，对不对？没问题吧啊。我在这里嗯看效果很简单。2。题函数嗯，IBD址是192。168。1。104。确等一下要0字OK。啊，闻一下啊，一直听。先看能不能通。哎。

你就方十啊怎吗？Yeah。防后墙。应该是很会的。お。然后。然我想把这个。忘了他。不然的话，你没法看效果是吧，对不对？呃，1块钱，我们需要验证效果okK嗯能哈。😊，嗯啊，我们来打一下，因为就是以防万一啊。

呃等一下打的时候他说不难停，有的人说哎，不难停啊，但是这个服务器确实死了，死了死了他是活不过来的，你必须守动来重启才能活，明白没有？呃，这么回事的。好，我来哦打一下。效果啊，我看他这里有反应没有？嗯嘢。

等一下看吧，要果数据包刚刚发送。好像吃了。好像死了，还没死还没死还没死。我再勾一下。好，看到没有？服务器看到没有？挂掉了，看到没有，直接直接挂了，看到没有停车超市。😊。



![](img/5a64ccdc7aad5f9b419436ebc06da8d3_9.png)

直个机直接关掉了。

![](img/5a64ccdc7aad5f9b419436ebc06da8d3_11.png)

阿6哎，注意哈，一一下没死啊，一下没死。看一下。一下没死一下没死之后，你两下两项没死般你三三下发三次数据报，哎，一般上百分之百就。



![](img/5a64ccdc7aad5f9b419436ebc06da8d3_13.png)

服务器就挂掉了啊，服务器就挂掉了啊，这个没蓝屏，那无所谓啊。等下再起来的时候，它这个蓝屏啊这个。

![](img/5a64ccdc7aad5f9b419436ebc06da8d3_15.png)

嗯，有有的时候他他的狼，有的时候他重启了。这这这个你不用管它啊，但是这个服务器死了啊，是的，那就起来你再次可以打一下，再打一下，打一下，他应该这子应该等一下就拦平了，直接拦了。完平的就崩崩溃在哪里？

崩溃在哪里？先把服务器重启了是吧？这个也上了啊，关机了嗯，没事。现在我们把这个关掉。下一下一个。定7来垂置一下。



![](img/5a64ccdc7aad5f9b419436ebc06da8d3_17.png)

运期的IP地址是。诶可以地住诶可地住。102吧，我看一下102能不能。OK我0了。啊，这里暂庭。你102。Yes。这可一通。嗯，IP地址。啊，那是这个。嗯，102。嗯，还有找一个地方？嗯。

这个图片的访问是。嗯要点。这个哦要这个图片是。稍新一下。你 bug。还是Pwecom GENGOK还是这个图片。嗯好，我们再摆一下，呃卫生间的这个效果，大家看一下。



![](img/5a64ccdc7aad5f9b419436ebc06da8d3_19.png)

那给到时在去拟机里。这个你你想换一下。好。没防疫没反疫。没反应没事，我们看一下，那数据包没发送完呢。啊，几个超时。马上死了啊，你看啊20了已经断机了，已经断机了。然后你些我需不要别点进去了，点进去。

我等一下出了半天出不来。因为他已经死了。按一下还不拉不平。Yeah。嗯，他这里已经呃确实已经已经挂掉了服务器。呃，我这里指标一放进去啊，这里百分之百是出误。哎我。那指标指标指标我的指标。准备要出不来了。

我看一下已经死了嗯，我徐标在虚拟机里面是没。没事的。那他这里一下动得掉，那他这里面已经确实。Good。我则道一点他这里去。超值了啊超值。我这里还没有去南坪。是我们这里他一下到哪看，我不攻击，我不点歌。

他不难底呃，他他他他他数据包还那个。没有空了。但是他告诉你的是，无法访问到目标主机。但是他这里哦大家可以看到这个窗口是没有盲屏的，但他这里他就是已经死了这个里面是。已经是已已经是彻彻底挂掉了。

这个服务器。因为我鼠标点进去啊，你看我我我鼠标点进去一下，刷新刷新点不管点奈何通的都是没用的。那个服务器已经彻底彻底彻底完了。哎呀，我去个真的出不来了，这置真的出不来。嗯，可以啊，这里就不演是了。

那这个就放开给你啊，挂掉。已经死了。可以看到这里就行了，无法访问目标主机。和你样。

![](img/5a64ccdc7aad5f9b419436ebc06da8d3_21.png)

是的。一打2008是打了他，怕他停起了，国际动机了，让他打了他。万风万的要阻意，就是说死了，非得挂在了半停了。Oh。暂这要暂停哈，这家最好不不像DDDD的这个这个服务攻击这个暂停。

那这个暂停是特别暂停的。就是说也就是说怎么说呢？DDOS攻击的时候，你点击不攻击，它的CPU内存慢慢恢复了。它问里是不是跟CPU内存有关系，就直接服器直接看了。又崩溃了，虽然你没看到他蓝皮凶西。

但他是崩溃的。呃，这个熏机在还原过程中呃，在这里我就。把，后面再讲解一下。把这个图片粘图哦，我还没加图，等一下我再摘一张。还一个郎屏，而我今天测试的时候，专家机器都可以郎屏啊。

今天做教程的时候都没有郎屏。就不封了。幸付方案是一个是。在这个地方来进行大捕地。还有一种方法。这两个地址我都提供给大家了，提供大家，那家直接粘接一下。嗯。😊，Yeah。把这个缓弹。啊，这个谎存的功能。

呃，去掉。这样。在这里这个这个我们也给大家演示一下。

![](img/5a64ccdc7aad5f9b419436ebc06da8d3_23.png)

嗯，这里在还原过程中。我告诉大家吧，在哪个地方，我本地也是win机系统。那这 win7车系统这块，我给大家直接也操作一遍。先打开S一下。有一个功能啊，这个叫输出方谈。马看龙啊啊，不对。Eny。

把这两个规格先去掉，去掉之后，那么。别的别的别人。电你是没肯定作用的，不产生疫区啊，蓝屏和服务器撞机。这没有这个啊。那么呃这是一个。临时方案吧临时方案呃，我不建议大家这么做。这种方案是在于什么内网。

应用服务器有的人是。不想打补丁啊。你不要联网的情况下，可以使用这种方法。还有一种就是说呃5天不是要重启服务器吗？那有的服务器它呃业务比较重要，嗯，它根本上呃不想让它放关机。也就是说这种情况下。

但可以采用这些方法，但是不能点。不能建议。听啲。他用微员来提供的这个主力。来解决这个。Yeah。要解决这个问题。在这里他为原告提供了这个相应的补贴。大家点击进去直接去下载。你进去下载。那这里有一个。

有差意词啊看意思。免的版本自己下载吧。这个我就不再在这里不再讲解。哦，这个起来了吧，应该。嗯。Yes。



![](img/5a64ccdc7aad5f9b419436ebc06da8d3_25.png)

这个是。2012。

![](img/5a64ccdc7aad5f9b419436ebc06da8d3_27.png)

那是20亚。等一下。

![](img/5a64ccdc7aad5f9b419436ebc06da8d3_29.png)

IB地址103。那个20123的这个内存还挺大的，这种虚拟机相当的慢。有连想。我这里是公开获取IP地址。



![](img/5a64ccdc7aad5f9b419436ebc06da8d3_31.png)

第二个CP哦，202012。

![](img/5a64ccdc7aad5f9b419436ebc06da8d3_33.png)

那个这个图片2012的图片。哦，是这个图片。嗯，这个片。随便找一个吧，这个无所谓。嗯。ERP。Yes。



![](img/5a64ccdc7aad5f9b419436ebc06da8d3_35.png)

按效果。啊，后哋就。

![](img/5a64ccdc7aad5f9b419436ebc06da8d3_37.png)

嗯，估计一下。你少年。IP地址合同。

![](img/5a64ccdc7aad5f9b419436ebc06da8d3_39.png)

103。

![](img/5a64ccdc7aad5f9b419436ebc06da8d3_41.png)

嗯。

![](img/5a64ccdc7aad5f9b419436ebc06da8d3_43.png)

啊。

![](img/5a64ccdc7aad5f9b419436ebc06da8d3_45.png)

看到没有？你的电脑遇到问题需要重启，我们只能搜到某些错误。我后为重进启动，完成比直接挂掉了。没管理。因为我的指标不出不来的，没的。那是把我把我把我自己。好，来了。hel，你好，这个。1211H标。

他就变成这样。哎，他断机了，耳子我挂在这里。😊，出现问题了，你电脑，然后你下就挂掉了。呃，这里我就。

![](img/5a64ccdc7aad5f9b419436ebc06da8d3_47.png)

等个图吧。

![](img/5a64ccdc7aad5f9b419436ebc06da8d3_49.png)

这你插一张图片，好像。嗯。嗯不个。这样的蝴就完整的O对。

![](img/5a64ccdc7aad5f9b419436ebc06da8d3_51.png)

嗯。Yeah。死了死了忘记了。

![](img/5a64ccdc7aad5f9b419436ebc06da8d3_53.png)

挂掉了。我跟你拼也没给那些也，自己搞过吧，那么这里不该就这么严制的。把这个把这个文档充一下啊。Yeah。呃，对终效果图。系啊满啦。Yes。Yes。也也O了。



![](img/5a64ccdc7aad5f9b419436ebc06da8d3_55.png)

好，把BIP关闭关掉。就可。

![](img/5a64ccdc7aad5f9b419436ebc06da8d3_57.png)