# 经典15年i春秋渗透测试系统化教程 - P26：课时5  上传漏洞-服务端检测绕过（文件内容检测） - 老网恋教父了 - BV1n54y1B7F7

🎼Yeah。好，现在我们这节课给大家讲解一下这个服务当这个。

![](img/40ce28f2f8175b588fe7033432512795_1.png)

检测老过的这个。文件内容检测是这个我们在前面也。

![](img/40ce28f2f8175b588fe7033432512795_3.png)

都大概都讲解过了哈，都提过了。

![](img/40ce28f2f8175b588fe7033432512795_5.png)

但是我们这个文档里面分到这么都快的话，我们给大家详细讲解一下。那么这一块它属于这个代码这一层代码层。就是说如果这个文件内容检测设置的这一层如果设置的比较严格的话。

那么攻击是非常困难的啊几几乎如果没有解析内证的话，几乎是。没戏啊，几乎没戏。那么一般的如果这一层都杜绝掉了啊，白名单黑名单如果都没戏啊，如果对方采用这个呃内润检测的。啊，但是伏务器也打了不定啊。

打了最新的不定，就是解析内容西也没了。那么这个。就很困难了啊，针对这个服务当的这个检测啊嗯。也就是其实方法使用起来很简单，大家可以我把这个方法教给大家，大家试啊，可以去试一下啊，但是有些是不行。

有些可以可以的啊，关键是看对方嗯。做了这些安全防范没有啊安全防范没有。但是在物远上面也有很多成功的案例。啊，我也在实际这个渗透过程中也发现了也不少这方面的这个。啊，文件论容的这个检测啊。

检测不也绕过去的。那么首先我们来看一下这个。最常见的这个图像类型里的这个耐用检测这个镊子给大家讲。详解一下。那么第一个是文件换术检测。那么这个是什么意思啊？也就是说主要是检测这个文件内容啊。

开头去开头的地方，这个文件换数，比如图片类型的，它文件换数是这些啊，也就是说我们绕过这个GPG文件换数啊检测啊，那么我们必须要在这个呃PSP啊SP啊GSP啊前面加上这一点加上这个。如果是GIF的。

那么在开头的地方加上这个。如果是偏机的，那么在开头的地方加上这个来这个那么这个是什么呢？举个例子哈。

![](img/40ce28f2f8175b588fe7033432512795_7.png)

嗯，我们在这里举个例子，让我找了个小的图片。

![](img/40ce28f2f8175b588fe7033432512795_9.png)

这里有一个test点GPT啊，就是inux的一个图标啊，一个这m的一个图片。那这个图片呢我们打开一下啊啊，它就是个这种啊这种。



![](img/40ce28f2f8175b588fe7033432512795_11.png)

![](img/40ce28f2f8175b588fe7033432512795_12.png)

也就说对应的是个什么这个GFIF，你看哈。嗯，是是不是跟那个一样呢？

![](img/40ce28f2f8175b588fe7033432512795_14.png)

对不对？一样的呀，然后在前面加上这个，就是你打开这个图片，右角用记术本一打开，把这个东西复制下来，复制就行了，就粘贴到你的这个。脚本木马的最前面粘在粘贴在前面就行了。那么在这里我建议大家哈使用一款工具。

这个工具是这样啊，我个人用的是比较多的啊，这个工具啊很好用啊，实际过程中也使实用比你这个手工加要好一些，因为它这个工具夹它加入到这个空的地方。啊，有的是。嗯，你手工加的是不成功的。

用这个工具加完成功上传一下，哎，绕过去了。

![](img/40ce28f2f8175b588fe7033432512795_16.png)

![](img/40ce28f2f8175b588fe7033432512795_17.png)

嗯，这个就是第一种方法，就文件换术，就是很简单的。你打开这个。呃，图片右键打开，在前面把前面一截对应的这个GPG点是复制这这一部分，那GIF的复制这一部分PNG的复制这一部分复制过去之后啊。

直接保存一下，保存一下，直接再再把你这个呃对应的脚板木板上传上去啊，这是这个文件换术。那么第二种方法就文件相关信息检头，那么这个是。什么意思呢？因因为我们在这里看一下解释。

图像文件相关的信息检测常用的就是通过这个。啊，getto image这个sZ啊这个函数啊，这个函数只需要把这个文件头部分伪造一下就OK了。那么这个除了加了这个东西之后啊啊。嗯，这个这个是一看就加F的哈。

这个大头打开用技是看打开这个头复制过来的。我们再加一些乱七八糟的一些信息啊，就迷惑一下啊，迷惑一下就伪造用这个检测的时候，检测这个文件信息啊，一看唉没问题，确实是图片啊，就是图片。

在在我们在空空头处再插入这个一句话木板啊，插入这个木。嗯，就把这个PSHP改成这个啊一化码，这样的话就可以了。那么第三个第三个综合位置文件加载检测啊，这种是最变态的这个检测了。

一般是通过调用API函数啊或者函数来进行加载测试。那么常见的是图像上的测试再变态的再变态的一点就是。二次渲的。为什么第三前面那种为什么我在这里不演示？我们用来第三种来演。

第三种方法就文件加载检测的时候在图像渲染的时候哦，我们为什么推荐这款工具呢，用这款工具来完成啊，这个工具嗯，等一下你会看到优点哈啊，它的优点。如果一次算的，一般那是还是可以绕过去的哈。如果二次算的。

基本上没写啊，基本上呢建议大家放弃啊，反正我是没有去啊采论过啊承论过。大家可以看一下啊，先说一下这个渲呢跟这个加载检测测试工具啊，这个代码注入了绕过，可以用这个图像软件来加载一个图片来进行注入啊。

这是我刚才推荐给大家啊，这件图法。用这个win可以看到数据，可以分析出这类工具的原理啊。这就根据原理。这个工这些工具啊，就是说我们我刚才推荐的这款工具啊。

它其实它就是说它的原理是在不破坏这个文件本身就是图片本身的情况下啊插入这个一句化木码啊，不破坏本身的这个算来的情况下找到一个空白的话，就是它这个工用工具去插一句话木马，插到图片里面的时候。

它是找这个一个空白的区域来进行填充来进行填充，就是插入一句化大码。一般会这个图片的注释区啊，在注释的地方呢进行。啊，填充这一句话木马，对于旋转垂式的基本上闹多能 logogo啊，旋烂的方式啊。

基本上那go。因为这个根据实现的时候，它这个它在这个注释的区域来进行加这个一句话木马的。所以说它不会破坏这个图片的本身啊，浏览本身。所以这个最后它是保证了这个文件结构的一个完整性啊，完整性。



![](img/40ce28f2f8175b588fe7033432512795_19.png)

啊，这个记术本打开一样啊，用windix X也可以啊，用VRP这些东西做。反正这些工具都是可以的啊都是可以啊。关键你看你自己喜欢用哪种啊，你自己去用就是了。关于这个二次向传的绕go啊。

这这里也有相关的解释哈，但是反正是没有成功过，在网上找资料也基本上没戏啊没有。

![](img/40ce28f2f8175b588fe7033432512795_21.png)

调试也没采用过啊，这里写的也这么多啊，也推荐了一些思路方法，大家自己看一下。那么在这里呢我们就给大家。



![](img/40ce28f2f8175b588fe7033432512795_23.png)

![](img/40ce28f2f8175b588fe7033432512795_24.png)

把这个。一就是说没有经过二次渲呢来进行绕过的方法给他打。啊，演示一下，就是说有这种工具，那图片呢我也给大家准备好了。图片也给大家准择好了，那么在这里呢怎么做这个工具怎么使用呢？不是商机就可以用啊。

还是把这个图片一拖拖到这里啊，这样啊这种方式。那么接着我们来找个一句话木马。

![](img/40ce28f2f8175b588fe7033432512795_26.png)

![](img/40ce28f2f8175b588fe7033432512795_27.png)

Yeah。

![](img/40ce28f2f8175b588fe7033432512795_29.png)

撇就撇啊。嗯。我觉得我们点击这个okK。好，OK那就OK了。

![](img/40ce28f2f8175b588fe7033432512795_31.png)

Yeah。

![](img/40ce28f2f8175b588fe7033432512795_33.png)

你再用机这边打开一下，你们可以。用黑ggs都可以。那么这个时候你可以看到它在注释处，它会加插了这个一化木门。你看。你看没有？这个井号这个地方后面那一个是一个注释的地方，它这个地方就是加入了的。

你看插入了我们的一句块母，要这么插进去的呀，是这么插进去的。

![](img/40ce28f2f8175b588fe7033432512795_35.png)

![](img/40ce28f2f8175b588fe7033432512795_36.png)

所是他是这个比你手工去擦要好一些，你手工擦的不好，你到就是说你在这个图片这乱七八糟，你看不懂什么意思啊，一堆一堆上吧，你说你把你这个一句话木把。



![](img/40ce28f2f8175b588fe7033432512795_38.png)

丢到哪个地方去，尤其图片比较大的行了，你放到前面是最不安全的。然后的放后面，有的时候它这个破坏了，把这个图片本身破坏掉。所以你看你往哪边插的是吧？能更就插也比较好一点，它不会破坏这个图片的本身。

你看一下插了一句话，你的这个图片照样就可以丢了是吧？还是一样的啊，还是可以。那么这个地方啊，你改成这个，如果是改你这个本身这个图片好，你改个过产品PSP你说你你说这个行吗？



![](img/40ce28f2f8175b588fe7033432512795_40.png)

我们看一下，它是绝对是可以通过这个一句话可以连接的啊。首信我们来看一下。打开这个工具。

![](img/40ce28f2f8175b588fe7033432512795_42.png)

好，我们这个工具哈来看一下，你看啊我们在这里。

![](img/40ce28f2f8175b588fe7033432512795_44.png)

编辑嗯，taste点PSP你看等身在它是个图片的啊，这图片里面只是插了一公一换木嘛，我们是改了个扩张名，那天我们再去连接，你看一样是可以连接的吧，没任何问题吧，对不对？是可以，没问题啊，是吧？

我们再看哈。嗯。分后点GPG。你说这种行吗？

![](img/40ce28f2f8175b588fe7033432512795_46.png)

这个行不行？你们看一下。这个是如果成功了的不上的这个不能上这个嗯佛当 logogo了，检测logo了啊。那么这种我给他搞到给他顺便讲到这里，我们给大说一下这个IS这个解析类的啊，你看几P几。

你说这个地方能采功吗？也是可以，你看。哎。怎么连接才连接上来？

![](img/40ce28f2f8175b588fe7033432512795_48.png)

它就是连接上去的，你看也是可以的。嗯，没问题没问题。没问题。嗯，还有就是说。嗯，解析类的这个是IS的。嗯。阿巴奇阿巴等一下呃，这个我们先不讲解吧。先不讲解。这一个人。



![](img/40ce28f2f8175b588fe7033432512795_50.png)

。嗯在这里不再做太多的讲解啊。

![](img/40ce28f2f8175b588fe7033432512795_52.png)

呃，讲到这等一下，后面还还很多。你拿这个呃都是可以的。

![](img/40ce28f2f8175b588fe7033432512795_54.png)

这个是涉及到这个。呼呼吸那一节课了，就是我们这个。是个解析的弄整起了。嗯，关于这个服务端这个。检测牢布的话，我们就给大家讲到这里啊，怎么去。嗯，爸一句话你没嗯，差就说。

插入到这个图片里面去啊插入图片里面去。比如说把这个图片命个名字也是可以连接的啊，也是可以连接的。这关键是这个检测的时候，就是说我们这个。Yeah。他他是检测里面的内容的情况下，我们如何去。



![](img/40ce28f2f8175b588fe7033432512795_56.png)

伪造啊如何去伪造啊，不会伪造。那么也就是通过这种方法来进行伪造。

![](img/40ce28f2f8175b588fe7033432512795_58.png)

好了吧，我们这节课就讲到这里啊，下一节课我们就是把这个解析了的啊。应用才啊应用就是在到了这个服务器档啊。来给大家。讲解一下啊讲解一下，就是到了应用层啊，应用层就涉及到这个解析的的。

那么在前面我们讲到的多是一些代码层的一些东西，包括这个默认配置啊。

![](img/40ce28f2f8175b588fe7033432512795_60.png)

阿巴系的他们卡到的I么种配置没一些一些老个方法。