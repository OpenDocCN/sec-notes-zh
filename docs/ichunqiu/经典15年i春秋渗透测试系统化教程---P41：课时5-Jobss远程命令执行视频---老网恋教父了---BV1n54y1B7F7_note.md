# 经典15年i春秋渗透测试系统化教程 - P41：课时5 JBoss远程命令执行漏洞利用与防护 🎯

在本节课中，我们将学习JBoss应用服务器的远程命令执行漏洞。我们将从环境搭建开始，逐步讲解漏洞的发现、利用方法，以及如何通过工具自动化执行攻击，最后会探讨漏洞的修复方案。

## 环境搭建与准备 🛠️

![](img/32176a7bf739c330a0ba635c901f1a1b_1.png)

![](img/32176a7bf739c330a0ba635c901f1a1b_3.png)

上一节我们介绍了课程概述，本节中我们来看看如何搭建一个用于学习和测试的JBoss环境。

![](img/32176a7bf739c330a0ba635c901f1a1b_4.png)

![](img/32176a7bf739c330a0ba635c901f1a1b_5.png)

![](img/32176a7bf739c330a0ba635c901f1a1b_7.png)

以下是搭建JBoss测试环境的核心步骤：
1.  在Linux系统中安装Java运行环境。
2.  使用 `wget` 命令下载JBoss安装包。
3.  解压下载的安装包。
4.  将解压后的目录重命名为 `jboss`。
5.  创建一个新用户并赋予其相应权限。
6.  切换到该用户，进入 `jboss/bin` 目录。
7.  执行 `./run.sh -b 0.0.0.0` 命令启动JBoss服务。

![](img/32176a7bf739c330a0ba635c901f1a1b_8.png)

![](img/32176a7bf739c330a0ba635c901f1a1b_10.png)

启动成功后，JBoss默认会监听8080端口。由于安装过程耗时较长，这里不再演示，请大家自行完成环境搭建。

![](img/32176a7bf739c330a0ba635c901f1a1b_12.png)

## 漏洞原理与手工利用分析 🔍

![](img/32176a7bf739c330a0ba635c901f1a1b_14.png)

![](img/32176a7bf739c330a0ba635c901f1a1b_16.png)

搭建好环境后，我们来理解漏洞的核心原理。JBoss的 `/jmx-console/HtmlAdaptor` 路径存在未授权访问漏洞，攻击者可以借此部署恶意的WAR包，从而在服务器上执行任意命令。

![](img/32176a7bf739c330a0ba635c901f1a1b_18.png)

![](img/32176a7bf739c330a0ba635c901f1a1b_19.png)

![](img/32176a7bf739c330a0ba635c901f1a1b_20.png)

其核心利用链可以概括为：**访问特定路径 -> 部署远程WAR木马 -> 获取WebShell -> 执行系统命令**。

![](img/32176a7bf739c330a0ba635c901f1a1b_22.png)

网上已有公开文章详细分析了此漏洞。简单来说，攻击者需要先准备一个包含JSP木马的WAR包，并将其放置在可远程访问的Web服务器上。然后通过JBoss的漏洞接口，让目标服务器去下载并部署这个WAR包。

![](img/32176a7bf739c330a0ba635c901f1a1b_24.png)

以下是手工部署WAR木马的关键步骤：
1.  准备一个包含JSP WebShell的WAR文件（例如 `cmd.war`）。
2.  将该WAR文件放在一个可通过URL访问的远程服务器上。
3.  访问目标JBoss的 `HtmlAdaptor` 页面。
4.  在部署功能处，填写远程WAR包的URL地址。
5.  提交后，JBoss会自动下载并部署该WAR包，攻击者即可通过访问对应的JSP路径来执行命令。

![](img/32176a7bf739c330a0ba635c901f1a1b_26.png)

## 自动化工具利用演示 ⚙️

理解了手工利用的原理后，我们使用工具来更高效地完成攻击。本节课演示的工具是来自 `prgprg.cn` 的 “JBoss HtmlAdaptor漏洞利用工具”。

![](img/32176a7bf739c330a0ba635c901f1a1b_28.png)

![](img/32176a7bf739c330a0ba635c901f1a1b_30.png)

该工具的原理与手工部署类似，但实现了自动化。它通常会调用一个预先部署在公网上的WAR木马（包含 `index.jsp` 和 `cmd.jsp`），直接向目标发送精心构造的请求。

以下是使用该工具进行攻击的步骤：
1.  在工具中输入目标JBoss的地址和端口（例如 `http://192.168.1.200:8080`）。
2.  点击执行，工具会尝试利用漏洞部署木马。
3.  部署成功后，即可在工具界面直接执行系统命令，如 `ls`、`ifconfig` 等。

![](img/32176a7bf739c330a0ba635c901f1a1b_32.png)

![](img/32176a7bf739c330a0ba635c901f1a1b_34.png)

![](img/32176a7bf739c330a0ba635c901f1a1b_36.png)

利用成功后，可以在目标服务器的JBoss临时部署目录（如 `jboss/server/default/deploy/`）下找到被上传的JSP木马文件。此时，攻击者已经获得了目标服务器的命令执行权限。

![](img/32176a7bf739c330a0ba635c901f1a1b_38.png)

![](img/32176a7bf739c330a0ba635c901f1a1b_39.png)

## 连接WebShell与进一步控制 🕸️

![](img/32176a7bf739c330a0ba635c901f1a1b_41.png)

![](img/32176a7bf739c330a0ba635c901f1a1b_42.png)

![](img/32176a7bf739c330a0ba635c901f1a1b_44.png)

成功执行命令后，我们来看看如何建立更稳定的控制通道，例如连接中国菜刀这类Web管理工具。

通过漏洞利用，我们实际上在服务器上部署了一个WebShell。其连接地址有特定格式，通常在访问错误页面时可以看到提示，例如：`http://目标IP:端口/部署的路径/木马文件名.jsp`。

![](img/32176a7bf739c330a0ba635c901f1a1b_46.png)

以下是连接WebShell的步骤：
1.  在漏洞利用工具中，将木马类型切换为包含一句话木马的WAR包（密码通常为 `023`）。
2.  重新对目标进行攻击部署。
3.  打开中国菜刀，添加一个新的Shell。
4.  URL地址填写上述格式的WebShell地址，密码填写 `023`。
5.  连接成功后，即可通过菜刀进行文件管理、数据库连接等操作。

## 其他相关漏洞与修复建议 🛡️

除了本节课演示的 `HtmlAdaptor` 漏洞，JBoss还存在其他高危漏洞，例如反序列化漏洞（CVE-2017-12149）。目前已有集成化的工具（如 `Jexboss`）可以自动化检测和利用多种JBoss漏洞。

对于系统管理员和安全人员来说，及时修复漏洞至关重要。

以下是针对JBoss远程命令执行漏洞的修复建议：
1.  **设置访问控制**：为 `jmx-console` 和 `web-console` 等管理页面配置强密码认证。
2.  **删除或重名危险文件**：在不影响业务的前提下，删除 `HtmlAdaptor` 等存在漏洞的组件文件。
3.  **升级与打补丁**：及时关注官方安全公告，将JBoss升级到最新版本或安装安全补丁。
4.  **网络隔离**：将JBoss管理后台置于内网，禁止外网直接访问。

## 总结 📝

![](img/32176a7bf739c330a0ba635c901f1a1b_48.png)

本节课中我们一起学习了JBoss应用服务器的远程命令执行漏洞。我们从环境搭建开始，分析了 `/jmx-console/HtmlAdaptor` 未授权访问漏洞的原理，并演示了如何通过手工和自动化工具（如 `prgprg.cn` 的工具）来利用该漏洞获取WebShell和执行系统命令。最后，我们探讨了连接中国菜刀进行持久化控制的方法，并给出了修复漏洞的实用建议。希望大家通过实践加深理解，并始终将安全防护放在首位。