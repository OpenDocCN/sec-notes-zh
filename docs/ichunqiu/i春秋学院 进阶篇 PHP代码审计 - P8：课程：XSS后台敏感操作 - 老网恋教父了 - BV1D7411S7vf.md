# i春秋学院 进阶篇 PHP代码审计 - P8：课程：XSS后台敏感操作 - 老网恋教父了 - BV1D7411S7vf

。大家好，我是viring。啊，这节课给大家带来的是叉SS后台敏感操作。啊，本节课有一个内容就是叉SS后台敏感操作。我们先来看一下啊这个XSS的后台敏感操作的问题的漏呃审计。啊，首先是XSS是什么？

XSS表示ca sight scraping。啊，跨站脚本攻击啊，为什么啊他用叉SS表示，而不是CSS呢？啊，主要是它已经存在了1个CSS。啊，那个CSS是啊界面的。就前端的一个什么东西来着？好吧。

不管那我们这里是主要所以他就是把C改成了叉叉SS。啊，叉SF它与circle啊注入攻击是类似的啊，circle注入啊是以circle语句为用户输入。啊，从而达到查询修改删除数据的目的。

而叉SS攻击呢啊就是通过插入恶意的脚本，实现对用户浏览器的控制。那么XSS攻击分为两种，一种是非持久型攻击，另一种就是持久型攻击。那么我们这里主要讲的是持久型攻击，也就是。啊，把攻击代码啊存到服务端。

然后因为存在服务端，所以说他就基本上是一直存在的。然后。啊，通过别人载入了这一段攻击代码从而执行。那么我们主要就是插入叉SS的攻击代码啊，让管理员啊点开某个页面啊，执行我们的叉SS代码啊，达到某些啊。

然后让我们达到以管理员身份执行某些敏感操作。

![](img/03a39f710295ab5d2a223cb4a52f6108_1.png)

那么我们还是主要来看代码。啊，前面我们把握大笔的时候也分析到了getIP这里可能会存在注入。但是XSS输入。那么我们可以看到他获取的IP是从嗯HTTP头呃信息去获取的，就是先是获取sonIP。呃。

没有的话就去查 forward for这个I这个信息再没有，它就是remote address。啊，他的。呃，顺序是这样的，那么。同时我们唉。这个。啊，我们需要考虑到。他这个可以伪造的啊。

只有这个dientIP和叉SF这两个头，这两个头是我们能够自行控制的。呃，能够控制这两个也就能达到啊伪绕任意IP或者或者插入任意的一些。疲load。让我们去注入。那么我们首先需要知道他这个函数用在哪里。

我们在哪一个页面。嗯，可以达到注入的目的。我们前局搜索。去找这个。在哪里用的？啊，我们搜索出来两个结果。一个是它的定义的文件，一个是他使用的文件，我们点开。啊。他主要是在我们登录的时候。啊。

就记录我们的IP它获取到我们IP之后经过过滤。然后再复制到IP这个变量。然后他就直接就载入了。呃，cicle的语句。啊，因为有单引号存在，我们就不能够进行注入攻击。嗯，但是我们。看到。啊，这个。哦。

还没生成C太。嗯，虽然我们知道他在Lb。嗯，直接跳转到它定义的地方。啊，他这里基本上只有是嗯scle注入的过滤，而没有我们叉SS的过滤。也就是说我们可以插入任意叉SS的攻击代码。好好。

他主要插入的是这个字段。我们要继续搜索这个字段在哪里。被找出来。同时我们要看数据库结构啊，这个字段它允许我们插入多少个字符。搜索。Yeah。好。

我们可以看到他在addmin目录下的manage user，这里他用到了。咁咧。输出这个字段。然后在个这个管理页面，用户管理页面。他就存在输出。然后管理员访问这个页面。

就会得到我们的IP或者是我们插入的叉SS代码。好，我们再看。它的字段长度限制了255个字符。再往下看。我们登录啊，就是前面我们登录的地方记录了。所以说我们在登录的时候。啊，构造一个payload注入。

然后在管理员打开这个页面的时候，就执行我们的代码。那么。我们要插入什么呢？因为他没有限制，可以任意插入。那么我们一般是采取啊远程GS文件。让他载入远程JS文件。这样能够执行。更多的支付啊更多的语句。

不然我们的语句太长啊，255个字符并不够我们放。那么。我们准备好了一个。呃J。也就攻击的配。啊，利用CLHTPT这个。啊，去。构造一些信息。我们可以看到。我们还得需要知道我们管理员在后台能做到什么。



![](img/03a39f710295ab5d2a223cb4a52f6108_3.png)

好，我们打开这个登录了管理员这个页面。啊，他存在这几这几个。呃功能。用户的就是我们刚才管理用户的评论啊，大概是删除啊，增加评论。啊，P就是执行和命令。我们前面说过。啊，我们前面是第一节课的时候，就说。

啊，可以进行注入。啊，我们这里是直接用后台的话，也就可以达到啊XSH与管理员用户啊去执行就可以达到我们的一些注入。好，这节课呢我们就来看这个它管理员功能，它管理员功能呢一般是有删除管理员或者增加管理员。

修改密码等可能有这些操作。你具体看一下它有哪些。Yeah。好，他这里显示了两个。这是。你他显示两个用户。一个是呃他还有两个功能，一个是删除，一个是添加。那么我们就可以考虑构造一个payload啊。

让管理员执行之后增加用户的。那么他主要就是我们再看他的。表单代码。

![](img/03a39f710295ab5d2a223cb4a52f6108_5.png)

啊，这里看的不够详细，然后我们就是manage a me。我们看他表单代码。啊，没有什么其他的验证。你就可以看到它直接是post。啊有算ね。他是word。嗯。然，把这些po过去的话。

还判断是不是管理员啊，我们用的叉SS攻击，也就是以管理员身份去执行。啊，验证是否存在？这两个输入信息。好。查找数据库是否存在以相同的。没有的话，他就是插入。就添加一个管理员。那么我们来构造。呃。

他主要是男女姐。那是at的命。这个页面。然后，这里是。You start。来。等于。啊XSF。嗯，嗯。啊，他说的。等于123456。啊，这个。



![](img/03a39f710295ab5d2a223cb4a52f6108_7.png)

你可以放在自己的网站。嗯，自己的服务器。然后我这里是放在本地。没有。嗯。

![](img/03a39f710295ab5d2a223cb4a52f6108_9.png)

![](img/03a39f710295ab5d2a223cb4a52f6108_10.png)

嗯。

![](img/03a39f710295ab5d2a223cb4a52f6108_12.png)

![](img/03a39f710295ab5d2a223cb4a52f6108_13.png)

![](img/03a39f710295ab5d2a223cb4a52f6108_14.png)

好，我们现在是可以成功。通过。哦，打开这个网页，那么后面我们就继续构造。

![](img/03a39f710295ab5d2a223cb4a52f6108_16.png)

同系。呃，怎么样的注入代码去让他加载这样的一个文件。我们可以用。Yes。Yeah。嗯。加载飞剧。Yeah。好，我们这一句。我们加插入到我们的IP伪造IP信息。的地方就可以达到我们的目的。

那么这一句很明显这幅串不会超过255。

![](img/03a39f710295ab5d2a223cb4a52f6108_18.png)

那我们再。

![](img/03a39f710295ab5d2a223cb4a52f6108_20.png)

我们退出管理员。在登录。我们用户登录。那么我们怎么伪造呢？这里介绍一个插件。这什么的饭 harder。那我们编辑。啊，前面可以是真正的IP什么的。嗯，后面我们就插入我们的代码。就像这样也可以使用啊。

f straight啊，去抓包改包。我现在是把它打开啊。登录test。123456。对。我们登录了。咁但。嗯，以管理员身份登录看看。我们啊也可以是看数据库，看我们插入的信息是否成功插入。



![](img/03a39f710295ab5d2a223cb4a52f6108_22.png)

![](img/03a39f710295ab5d2a223cb4a52f6108_23.png)

你看到用户这个表。老几IP。他已经成成功把这一句。很显肉了。数据库然后他这里是。啊，前面双引号也被转译了。我们先看看能不能执行。有一些览气是可以忽略的。我们登录addmin。啊，进入用户管理页面啊。

当管理员进入的时候。他就可能会执行这一句。我们来看代码。很明显，他这里出现了错误。啊，不能够打开啊么还有另外一个黑科技。



![](img/03a39f710295ab5d2a223cb4a52f6108_25.png)

啊，就是我们不用输入双引号，直接这样去执行。

![](img/03a39f710295ab5d2a223cb4a52f6108_27.png)

嗯。Yeah。我们还是要先修改一下。把有双引号的那句修改掉。保存。好，登乐。嗯。Yeah。再回到用户管理的页面刷新。我们同时也可以看数据。啊，刷新一下。没有双引号的。我们来看管理员页面。

他这里有一个pos信息。啊，就是执行了我们的操作。看代码。他这里是自动修复了。修复了我没有双引号的问题。啊，这是一个浏览器的特性。我们输入的这样一句，它就会自动加上了。啊，双引号。啊，我们现在再去看。

看我们的管理员。页面。成功添加了一个叉SS这个用户。我们重新登录，我们来试试看这个。新增的用户是否能够登录？123456。成功登录进来了。所以说啊这个就是XSS漏洞。后台敏感操作添加了我们的用户。

接下来你就可以为所欲为了。啊，至于怎么修复呢？其实我对叉SS了解不多。啊，但是我们trcle袜。嗯，这里我们添加。嗯，FCRIPT。添加这些类似的一些啊关键字就可以过滤一部分。啊。

更多的过滤网上也有比较多的过滤代码。这里就不多说。那么我们来总结一下。我们的思路。我们在。嗯，把握大局的时候，找到了这个ge单IP这个函数。们也找到了他的一些啊输入的方法。啊，白帕子。

掉了这个sorcle这个函数。啊，把我们的信息传入到了数据库。啊，管理员在后台啊。查看用户的时候，管理用户的时候啊就会输出我们的代码啊，并且执行。然后进行我们的敏感操作。啊，本节课就到这里结束了啊。

感谢大家的观看。😊。

![](img/03a39f710295ab5d2a223cb4a52f6108_29.png)