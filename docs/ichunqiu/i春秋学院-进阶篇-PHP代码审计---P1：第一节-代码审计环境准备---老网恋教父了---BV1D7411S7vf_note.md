# i春秋学院 进阶篇 PHP代码审计 - P1：第一节 代码审计环境准备 🛠️

在本节课中，我们将学习如何搭建一个高效、便捷的PHP代码审计环境。一个良好的环境是进行安全审计的基础，它能帮助我们更快速、更准确地定位和分析代码中的安全问题。

我们将从集成环境、代码编辑器、浏览器插件到辅助工具，系统地介绍整个环境的搭建与配置过程。

---

## 1. PHP集成环境：PHPStudy 🖥️

上一节我们介绍了课程目标，本节中我们来看看第一个核心工具——PHPStudy。这是一款在Windows系统下非常优秀的PHP集成环境。

它具有以下特点：
*   它集成了多个PHP版本，方便我们根据审计目标进行切换。
*   它包含了MySQL数据库的服务端以及图形化的客户端管理工具。
*   它提供了一个专门的控制面板，方便我们进行网站、数据库等各项服务的配置和管理。

---

## 2. 代码编辑器：Sublime Text 2 📝

一个强大的代码编辑器是审计工作的核心。Sublime Text 2拥有丰富的插件生态，可以极大地提升我们的审计效率。

以下是需要安装的几个核心插件及其作用：

![](img/c821ae87cd5f5355551c8215ae4e8256_1.png)

*   **Package Control**：这是管理其他插件的“插件管理器”，是安装后续所有插件的基础。
*   **CTags**：此插件能为项目中的函数建立索引。安装后，我们可以快速跳转到任意函数的定义位置，极大地方便了代码阅读和跟踪。
*   **PHP-Tidy**：此插件可以对PHP代码进行格式化整理。它能把结构混乱的代码变得整齐规范，让我们阅读起来更加方便。
*   **ConvertToUTF8**：此插件可以将非UTF-8编码的文件转换为UTF-8编码，解决代码文件乱码问题。

除了插件，我们还需要配置Sublime Text的**Build System**。这个配置允许我们直接在编辑器内执行PHP脚本并查看输出结果。

---

![](img/c821ae87cd5f5355551c8215ae4e8256_3.png)

## 3. 浏览器与辅助工具 🔧

审计工作不仅限于代码编辑器，浏览器和相关辅助工具同样至关重要。

![](img/c821ae87cd5f5355551c8215ae4e8256_5.png)

以下是需要准备的浏览器插件和外部工具：

*   **浏览器（Firefox）插件**：我们需要安装一些安全测试必备的插件，例如代理插件（用于拦截和修改HTTP请求）以及HackBar（用于快速构造和发送测试Payload）。
*   **Burp Suite**：这是一款功能强大的Web安全测试平台，常用于抓包、改包、漏洞扫描等。在后续的审计中，我们会用它来拦截和分析HTTP请求与响应。
*   **MySQL语句监控工具**：这款小工具可以实时显示访问一个页面时，后端执行了哪些SQL语句。这对于调试和验证SQL注入漏洞非常直观和方便。
*   **Web编码转换工具**：这款工具集成了多种编码（如Base64、URL编码）的转换与加解密功能，也包含一些常见的绕过技巧配置，是处理各种编码问题的好帮手。
*   **Notepad++**：这是一款轻量且功能强大的文本编辑器，可以作为Sublime Text的补充，在某些场景下配合使用。

![](img/c821ae87cd5f5355551c8215ae4e8256_7.png)

---

![](img/c821ae87cd5f5355551c8215ae4e8256_8.png)

## 4. 环境搭建演示 🎬

现在，我将为大家演示如何一步步部署上述环境。

![](img/c821ae87cd5f5355551c8215ae4e8256_10.png)

### 4.1 安装与配置PHPStudy

![](img/c821ae87cd5f5355551c8215ae4e8256_12.png)

首先安装PHPStudy。安装过程简单，一直点击“确定”即可。因为是首次安装，程序会进行初始化。

![](img/c821ae87cd5f5355551c8215ae4e8256_1.png)

![](img/c821ae87cd5f5355551c8215ae4e8256_14.png)

初始化完成后，PHP环境启动成功。接下来，我们需要添加一个虚拟站点用于测试。
1.  打开PHPStudy的“站点管理”。
2.  添加一个新网站，设置域名（如 `test.com`）和网站目录路径。
3.  保存配置并重启服务。

![](img/c821ae87cd5f5355551c8215ae4e8256_16.png)

![](img/c821ae87cd5f5355551c8215ae4e8256_3.png)

为了使域名生效，我们还需要修改本地的 `hosts` 文件，将 `test.com` 绑定到本地IP（`127.0.0.1`）。保存后，即可在浏览器中访问 `http://test.com`。

![](img/c821ae87cd5f5355551c8215ae4e8256_18.png)

![](img/c821ae87cd5f5355551c8215ae4e8256_5.png)

在PHPStudy的“数据库”面板中，我们可以方便地创建和管理MySQL数据库。例如，新建一个名为 `test` 的数据库。

![](img/c821ae87cd5f5355551c8215ae4e8256_7.png)
![](img/c821ae87cd5f5355551c8215ae4e8256_8.png)

### 4.2 配置浏览器插件

在Firefox浏览器的插件商店中，搜索并安装常用的安全测试插件，如代理插件和HackBar。

![](img/c821ae87cd5f5355551c8215ae4e8256_20.png)

![](img/c821ae87cd5f5355551c8215ae4e8256_10.png)

![](img/c821ae87cd5f5355551c8215ae4e8256_22.png)

### 4.3 配置Sublime Text 2

![](img/c821ae87cd5f5355551c8215ae4e8256_24.png)

**第一步：安装Package Control。**
使用快捷键 `Ctrl + `` 调出Sublime Text的命令行，粘贴安装Package Control的代码并执行。安装完成后需要重启编辑器。

![](img/c821ae87cd5f5355551c8215ae4e8256_26.png)

![](img/c821ae87cd5f5355551c8215ae4e821.png)
![](img/c821ae87cd5f5355551c8215ae4e8256_16.png)

![](img/c821ae87cd5f5355551c8215ae4e8256_28.png)

**第二步：通过Package Control安装其他插件。**
重启后，使用快捷键 `Ctrl + Shift + P` 调出命令面板，输入 `Package Control: Install Package`，然后依次搜索并安装 `CTags`、`PHP-Tidy`、`ConvertToUTF8` 这三个插件。

![](img/c821ae87cd5f5355551c8215ae4e8256_18.png)
![](img/c821ae87cd5f5355551c8215ae4e8256_20.png)

**第三步：配置CTags。**
CTags插件依赖于外部的 `ctags.exe` 程序。我们需要将 `ctags.exe` 文件放置到系统的环境变量路径下，例如 `C:\Windows` 目录。

![](img/c821ae87cd5f5355551c8215ae4e8256_22.png)

配置完成后，在Sublime Text中打开项目源码根目录，右键选择 `CTags: Rebuild Tags` 为整个项目建立函数索引。

![](img/c821ae87cd5f5355551c8215ae4e8256_30.png)

![](img/c821ae87cd5f5355551c8215ae4e8256_32.png)

![](img/c821ae87cd5f5355551c8215ae4e8256_24.png)
![](img/c821ae87cd5f5355551c8215ae4e8256_26.png)
![](img/c821ae87cd5f5355551c8215ae4e8256_28.png)

![](img/c821ae87cd5f5355551c8215ae4e8256_33.png)

建立索引后，在代码中选中任意函数名，右键选择 `Navigate to Definition` 即可快速跳转到该函数的定义文件。

![](img/c821ae87cd5f5355551c8215ae4e8256_35.png)

**第四步：配置PHP Build System。**
默认的Build System没有PHP选项，我们需要手动创建。打开 `Tools -> Build System -> New Build System...`，输入以下配置并保存为 `PHP.sublime-build`。

![](img/c821ae87cd5f5355551c8215ae4e8256_37.png)

```json
{
    “cmd”: [“php”, “$file”],
    “file_regex”: “php$”,
    “selector”: “source.php”
}
```

![](img/c821ae87cd5f5355551c8215ae4e8256_39.png)

![](img/c821ae87cd5f5355551c8215ae4e8256_30.png)
![](img/c821ae87cd5f5355551c8215ae4e8256_32.png)
![](img/c821ae87cd5f5355551c8215ae4e8256_33.png)
![](img/c821ae87cd5f5355551c8215ae4e8256_35.png)

![](img/c821ae87cd5f5355551c8215ae4e8256_41.png)

为了让系统识别 `php` 命令，还需要将PHP解释器的路径（例如 `D:\phpstudy\PHPTutorial\php\php-5.5.38`）添加到系统的环境变量 `Path` 中。

![](img/c821ae87cd5f5355551c8215ae4e8256_43.png)

![](img/c821ae87cd5f5355551c8215ae4e8256_37.png)
![](img/c821ae87cd5f5355551c8215ae4e8256_39.png)
![](img/c821ae87cd5f5355551c8215ae4e8256_41.png)
![](img/c821ae87cd5f5355551c8215ae4e8256_43.png)
![](img/c821ae87cd5f5355551c8215ae4e8256_45.png)

![](img/c821ae87cd5f5355551c8215ae4e8256_45.png)

添加后可能需要重启Sublime Text。配置完成后，新建一个PHP测试文件，输入 `<?php echo “test”; ?>`，然后按 `Ctrl + B` 运行，即可在编辑器底部看到脚本的输出结果。

![](img/c821ae87cd5f5355551c8215ae4e8256_47.png)

![](img/c821ae87cd5f5355551c8215ae4e8256_47.png)
![](img/c821ae87cd5f5355551c8215ae4e8256_49.png)
![](img/c821ae87cd5f5355551c8215ae4e8256_51.png)
![](img/c821ae87cd5f5355551c8215ae4e8256_53.png)

![](img/c821ae87cd5f5355551c8215ae4e8256_49.png)

### 4.4 使用Burp Suite与MySQL监控

![](img/c821ae87cd5f5355551c8215ae4e8256_51.png)

**MySQL语句监控：**
打开监控工具，配置好数据库连接信息（用户名、密码）。当我们在网站上进行操作时（例如搜索“ABC”），该工具会实时显示后端执行的所有SQL语句，这对于分析SQL注入漏洞非常有帮助。

![](img/c821ae87cd5f5355551c8215ae4e8256_53.png)

![](img/c821ae87cd5f5355551c8215ae4e8256_55.png)

![](img/c821ae87cd5f5355551c8215ae4e8256_55.png)

**Burp Suite抓包与改包：**
首先，配置Burp Suite监听本地的8080端口作为代理。

![](img/c821ae87cd5f5355551c8215ae4e8256_57.png)

![](img/c821ae87cd5f5355551c8215ae4e8256_57.png)

然后，在浏览器中设置代理为 `127.0.0.1:8080`。设置完成后，在网站上进行操作（例如搜索“ABC”），Burp Suite的Proxy模块会捕获到该HTTP请求。我们可以拦截这个请求，并将参数修改为“XYZ”，然后放行。观察网站返回结果，会发现搜索关键词已变成了我们修改后的“XYZ”。这个过程演示了基本的抓包和改包操作。

![](img/c821ae87cd5f5355551c8215ae4e8256_59.png)
![](img/c821ae87cd5f5355551c8215ae4e8256_61.png)

### 4.5 Web编码转换工具

最后，我们来看一下Web编码转换工具。它界面简洁，功能集中。例如，输入字符串“ABC”，可以快速进行Base64编码或解码，也可以尝试其他多种编码和加密方式，是审计过程中处理数据的一个实用工具。

![](img/c821ae87cd5f5355551c8215ae4e8256_63.png)
![](img/c821ae87cd5f5355551c8215ae4e8256_65.png)

![](img/c821ae87cd5f5355551c8215ae4e8256_59.png)

---

![](img/c821ae87cd5f5355551c8215ae4e8256_61.png)

## 总结 📚

![](img/c821ae87cd5f5355551c8215ae4e8256_63.png)

本节课中，我们一起学习了如何搭建一个完整的PHP代码审计环境。

![](img/c821ae87cd5f5355551c8215ae4e8256_65.png)

我们首先介绍了**PHPStudy**这个集成的Web服务器环境，用于快速部署和切换PHP项目。然后，重点配置了**Sublime Text 2**编辑器，通过安装CTags、PHP-Tidy等插件和配置Build System，使其成为强大的代码审计利器。接着，我们准备了**浏览器安全插件**和**Burp Suite**，用于进行HTTP层面的测试与分析。此外，还介绍了**MySQL语句监控工具**和**Web编码转换工具**等辅助利器。

![](img/c821ae87cd5f5355551c8215ae4e8256_67.png)

一个配置得当的环境能让我们在后续的代码审计工作中事半功倍。现在，你的审计环境已经准备就绪，可以开始真正的代码审计之旅了。

![](img/c821ae87cd5f5355551c8215ae4e8256_69.png)

![](img/c821ae87cd5f5355551c8215ae4e8256_67.png)
![](img/c821ae87cd5f5355551c8215ae4e8256_69.png)