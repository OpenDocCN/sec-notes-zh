![](img/c77083c8c782f076e558e6418568b472_1.png)

![](img/c77083c8c782f076e558e6418568b472_2.png)

![](img/c77083c8c782f076e558e6418568b472_4.png)

![](img/c77083c8c782f076e558e6418568b472_5.png)

# 经典15年i春秋渗透测试系统化教程 - P47：课时5 逻辑、越权漏洞挖掘（下） 🔍

![](img/c77083c8c782f076e558e6418568b472_7.png)

![](img/c77083c8c782f076e558e6418568b472_8.png)

![](img/c77083c8c782f076e558e6418568b472_10.png)

在本节课中，我们将继续学习逻辑漏洞与越权漏洞的挖掘方法。我们将通过分析多个真实项目案例，深入理解这些漏洞的成因、利用方式以及修复建议。课程内容将涵盖后台访问绕过、参数越权、信息泄露、邮件轰炸、服务费绕过等多种典型漏洞场景。

![](img/c77083c8c782f076e558e6418568b472_12.png)

![](img/c77083c8c782f076e558e6418568b472_14.png)

![](img/c77083c8c782f076e558e6418568b472_16.png)

---

![](img/c77083c8c782f076e558e6418568b472_18.png)

![](img/c77083c8c782f076e558e6418568b472_20.png)

![](img/c77083c8c782f076e558e6418568b472_22.png)

![](img/c77083c8c782f076e558e6418568b472_24.png)

![](img/c77083c8c782f076e558e6418568b472_26.png)

## 绕过后台访问限制案例 🚫

![](img/c77083c8c782f076e558e6418568b472_28.png)

![](img/c77083c8c782f076e558e6418568b472_30.png)

![](img/c77083c8c782f076e558e6418568b472_32.png)

上一节我们介绍了逻辑漏洞的基本概念，本节中我们来看看一个具体的后台访问绕过案例。

![](img/c77083c8c782f076e558e6418568b472_34.png)

![](img/c77083c8c782f076e558e6418568b472_36.png)

![](img/c77083c8c782f076e558e6418568b472_38.png)

![](img/c77083c8c782f076e558e6418568b472_40.png)

![](img/c77083c8c782f076e558e6418568b472_42.png)

直接访问某个系统的后台管理页面时，页面提示“对不起，为了安全体验，不能直接访问本系统的后台管理页面”。

![](img/c77083c8c782f076e558e6418568b472_44.png)

通过查看页面源代码，发现其引用了 `admin.php` 文件进行权限判断。该文件的核心逻辑是检查 `Referer` 头，如果 `Referer` 不是来自本站后台的特定页面，则拒绝访问。

![](img/c77083c8c782f076e558e6418568b472_46.png)

![](img/c77083c8c782f076e558e6418568b472_47.png)

![](img/c77083c8c782f076e558e6418568b472_49.png)

![](img/c77083c8c782f076e558e6418568b472_51.png)

![](img/c77083c8c782f076e558e6418568b472_52.png)

**核心绕过思路**：伪造 `Referer` 请求头，使其看起来像是从已授权的后台页面跳转而来。

![](img/c77083c8c782f076e558e6418568b472_54.png)

以下是利用 Burp Suite 进行测试的步骤：

![](img/c77083c8c782f076e558e6418568b472_56.png)

![](img/c77083c8c782f076e558e6418568b472_57.png)

![](img/c77083c8c782f076e558e6418568b472_59.png)

1.  首先，正常登录后台，并拦截访问后台任意功能（如备份页面）的请求包。
2.  将该请求包发送到 Burp Suite 的 Repeater 模块。
3.  在 Repeater 中，退出登录状态，然后尝试直接访问该后台功能地址，此时应被拒绝。
4.  在请求包中，手动添加或修改 `Referer` 头，将其值设置为后台某个已知页面的地址（例如 `http://target.com/admin/index.php`）。
5.  重新发送请求，观察是否能够绕过限制，成功访问后台功能。

![](img/c77083c8c782f076e558e6418568b472_61.png)

![](img/c77083c8c782f076e558e6418568b472_63.png)

![](img/c77083c8c782f076e558e6418568b472_65.png)

![](img/c77083c8c782f076e558e6418568b472_67.png)

![](img/c77083c8c782f076e558e6418568b472_69.png)

此外，源代码中还可能包含 JavaScript 跳转代码进行二次验证。例如，通过 `window.location.href` 跳转到登录页。此时，可以通过浏览器设置禁用 JavaScript 来绕过此客户端校验。

![](img/c77083c8c782f076e558e6418568b472_71.png)

![](img/c77083c8c782f076e558e6418568b472_72.png)

![](img/c77083c8c782f076e558e6418568b472_74.png)

![](img/c77083c8c782f076e558e6418568b472_76.png)

![](img/c77083c8c782f076e558e6418568b472_77.png)

**关键点**：此漏洞的根源在于，开发者仅依赖客户端传递的 `Referer` 头和 JavaScript 进行访问控制，未在服务端对用户会话和权限进行严格校验。

![](img/c77083c8c782f076e558e6418568b472_79.png)

![](img/c77083c8c782f076e558e6418568b472_81.png)

![](img/c77083c8c782f076e558e6418568b472_82.png)

![](img/c77083c8c782f076e558e6418568b472_83.png)

---

![](img/c77083c8c782f076e558e6418568b472_84.png)

![](img/c77083c8c782f076e558e6418568b472_86.png)

![](img/c77083c8c782f076e558e6418568b472_87.png)

![](img/c77083c8c782f076e558e6418568b472_88.png)

## 参数越权导致信息泄露案例 📞

![](img/c77083c8c782f076e558e6418568b472_90.png)

![](img/c77083c8c782f076e558e6418568b472_92.png)

![](img/c77083c8c782f076e558e6418568b472_94.png)

绕过前端限制后，我们进入系统内部。本节我们来看一个因参数可控导致的越权漏洞，它会造成用户敏感信息泄露。

![](img/c77083c8c782f076e558e6418568b472_95.png)

![](img/c77083c8c782f076e558e6418568b472_97.png)

![](img/c77083c8c782f076e558e6418568b472_98.png)

![](img/c77083c8c782f076e558e6418568b472_99.png)

![](img/c77083c8c782f076e558e6418568b472_100.png)

在某电商网站测试时，发现“地址管理”模块存在漏洞。用户登录后，在修改或添加收货地址时，会发送一个包含地址ID（如 `id=111`）的请求。

![](img/c77083c8c782f076e558e6418568b472_101.png)

![](img/c77083c8c782f076e558e6418568b472_103.png)

![](img/c77083c8c782f076e558e6418568b472_105.png)

**漏洞利用过程**：
1.  使用 Burp Suite 拦截修改收货地址的请求包。
2.  观察请求参数，发现有一个代表地址唯一标识的参数，例如 `id=111`。
3.  将此 `id` 参数值修改为其他数字（如 `id=112`）。
4.  转发修改后的数据包。
5.  刷新页面或查看响应，发现页面显示的是其他用户的收货地址、电话、邮编等完整信息。

![](img/c77083c8c782f076e558e6418568b472_107.png)

![](img/c77083c8c782f076e558e6418568b472_109.png)

![](img/c77083c8c782f076e558e6418568b472_111.png)

![](img/c77083c8c782f076e558e6418568b472_112.png)

**漏洞原理**：服务端在处理修改/查看地址的请求时，仅根据前端提交的 `id` 参数来查询数据库，没有校验当前登录的用户是否有权限操作这个 `id` 对应的地址数据。这导致了**水平越权**，即用户可以访问同级别其他用户的资源。

![](img/c77083c8c782f076e558e6418568b472_114.png)

![](img/c77083c8c782f076e558e6418568b472_115.png)

![](img/c77083c8c782f076e558e6418568b472_117.png)

![](img/c77083c8c782f076e558e6418568b472_118.png)

**修复建议**：在服务端进行严格的权限校验。在执行查询或修改操作前，验证请求的地址 `id` 是否属于当前登录的会话用户。若非本人资源，应返回错误提示或强制登出。

![](img/c77083c8c782f076e558e6418568b472_120.png)

![](img/c77083c8c782f076e558e6418568b472_122.png)

![](img/c77083c8c782f076e558e6418568b472_123.png)

![](img/c77083c8c782f076e558e6418568b472_125.png)

---

![](img/c77083c8c782f076e558e6418568b472_127.png)

![](img/c77083c8c782f076e558e6418568b472_128.png)

![](img/c77083c8c782f076e558e6418568b472_130.png)

![](img/c77083c8c782f076e558e6418568b472_132.png)

## 邮件轰炸漏洞案例 💣

![](img/c77083c8c782f076e558e6418568b472_134.png)

![](img/c77083c8c782f076e558e6418568b472_135.png)

除了数据泄露，逻辑漏洞还可能被用于发起拒绝服务攻击。下面是一个邮件轰炸（Mail Bombing）的案例。

![](img/c77083c8c782f076e558e6418568b472_137.png)

![](img/c77083c8c782f076e558e6418568b472_139.png)

![](img/c77083c8c782f076e558e6418568b472_140.png)

在某网站注册流程中，用户需要通过邮箱接收激活码来激活账号。系统提供了“重新发送激活邮件”的功能。

![](img/c77083c8c782f076e558e6418568b472_142.png)

![](img/c77083c8c782f076e558e6418568b472_144.png)

![](img/c77083c8c782f076e558e6418568b472_145.png)

**漏洞利用过程**：
1.  拦截“重新发送激活邮件”的请求包。
2.  发现请求中包含一个代表用户的参数，如 `uid=1001`。
3.  在 Burp Suite 的 Intruder 模块中，将此 `uid` 参数设置为攻击载荷（Payload）。
4.  使用数字生成器，快速生成大量不同的 `uid` 值进行遍历攻击。
5.  攻击开始后，目标邮箱会在短时间内收到海量激活邮件，导致邮箱被“炸”，无法正常使用。

![](img/c77083c8c782f076e558e6418568b472_147.png)

![](img/c77083c8c782f076e558e6418568b472_149.png)

![](img/c77083c8c782f076e558e6418568b472_151.png)

**漏洞原理**：服务端未对“重发邮件”功能的调用频率和调用者身份进行限制。攻击者可以伪造大量不同的用户ID，触发系统向任意邮箱重复发送邮件。

![](img/c77083c8c782f076e558e6418568b472_153.png)

![](img/c77083c8c782f076e558e6418568b472_155.png)

**修复建议**：
*   对发送邮件的频率进行限制，例如同一邮箱每分钟/每小时只能接收一次激活邮件。
*   加强身份验证，确保“重发邮件”请求只能由该邮箱对应的已登录用户发起，或需通过图形验证码等手段进行人机验证。

![](img/c77083c8c782f076e558e6418568b472_157.png)

![](img/c77083c8c782f076e558e6418568b472_158.png)

---

![](img/c77083c8c782f076e558e6418568b472_160.png)

![](img/c77083c8c782f076e558e6418568b472_162.png)

## 服务费绕过与金额篡改案例 💰

![](img/c77083c8c782f076e558e6418568b472_164.png)

![](img/c77083c8c782f076e558e6418568b472_166.png)

![](img/c77083c8c782f076e558e6418568b472_168.png)

逻辑漏洞在金融相关业务中危害极大。本节分析一个信用卡还款服务费绕过的案例。

![](img/c77083c8c782f076e558e6418568b472_170.png)

![](img/c77083c8c782f076e558e6418568b472_172.png)

![](img/c77083c8c782f076e558e6418568b472_174.png)

在某金融类应用进行信用卡还款时，流程中涉及一笔服务费。测试发现，在提交还款申请的最终请求中，有一个参数（例如 `fee_flag=0`）用来标识是否已处理服务费。

![](img/c77083c8c782f076e558e6418568b472_176.png)

![](img/c77083c8c782f076e558e6418568b472_178.png)

![](img/c77083c8c782f076e558e6418568b472_180.png)

**漏洞利用过程**：
1.  拦截提交信用卡还款的最终请求数据包。
2.  在数据包中寻找与费用、状态相关的参数。
3.  将表示“未付费”或“待处理”的参数值（如 `fee_flag=0`）修改为表示“已付费”或“已完成”的值（如 `fee_flag=1`）。
4.  转发修改后的数据包。
5.  页面返回“还款成功”，但实际上并未扣除相应的服务费，实现了“0元还款”。

![](img/c77083c8c782f076e558e6418568b472_182.png)

![](img/c77083c8c782f076e558e6418568b472_184.png)

![](img/c77083c8c782f076e558e6418568b472_186.png)

**类似案例**：客户端积分/金额篡改。在某些应用中，用户积分或账户金额会在客户端进行显示和计算，并在后续请求中提交给服务器。攻击者可以通过抓包修改这些数值（例如将积分改为一个极大的正数或负数），服务器若未做二次校验，就可能接受这些异常数据，导致业务逻辑错误。

![](img/c77083c8c782f076e558e6418568b472_188.png)

![](img/c77083c8c782f076e558e6418568b472_190.png)

![](img/c77083c8c782f076e558e6418568b472_192.png)

![](img/c77083c8c782f076e558e6418568b472_193.png)

**漏洞原理**：核心业务逻辑（如支付状态、金额计算）过度依赖客户端提交的参数，服务端缺乏对关键业务数据真实性和一致性的复核机制。

![](img/c77083c8c782f076e558e6418568b472_195.png)

![](img/c77083c8c782f076e558e6418568b472_196.png)

![](img/c77083c8c782f076e558e6418568b472_198.png)

**修复建议**：
*   所有核心业务状态和金额计算必须在服务端完成。
*   客户端提交的涉及费用、状态、数量的参数，服务端必须与自身数据库记录或可信的支付网关回调信息进行比对校验，绝不信任客户端直接提交的结果。

![](img/c77083c8c782f076e558e6418568b472_200.png)

![](img/c77083c8c782f076e558e6418568b472_202.png)

![](img/c77083c8c782f076e558e6418568b472_204.png)

![](img/c77083c8c782f076e558e6418568b472_205.png)

---

![](img/c77083c8c782f076e558e6418568b472_207.png)

![](img/c77083c8c782f076e558e6418568b472_208.png)

![](img/c77083c8c782f076e558e6418568b472_210.png)

## 平行越权与信息泄露案例 👥

![](img/c77083c8c782f076e558e6418568b472_212.png)

![](img/c77083c8c782f076e558e6418568b472_214.png)

最后，我们看一个注册逻辑漏洞导致的平行越权和信息泄露案例。

![](img/c77083c8c782f076e558e6418568b472_216.png)

在某网站注册新用户时，如果输入一个已存在的用户名或邮箱，网站会提示“该用户已存在”。

![](img/c77083c8c782f076e558e6418568b472_218.png)

![](img/c77083c8c782f076e558e6418568b472_220.png)

![](img/c77083c8c782f076e558e6418568b472_221.png)

![](img/c77083c8c782f076e558e6418568b472_222.png)

**漏洞利用过程**：
1.  在注册页面，输入一个已知的、已注册的用户邮箱。
2.  提交注册表单，并拦截请求。
3.  观察服务器返回的响应信息。在某些存在漏洞的系统中，为了“友好”地提示用户，错误信息可能直接返回了该邮箱对应账户的详细信息，例如：`“注册失败，该邮箱已被用户[张三]，身份证号[110...]，手机号[138...]注册”`。
4.  攻击者仅凭一个邮箱地址，就获得了用户的真实姓名、身份证、手机号等敏感信息。

![](img/c77083c8c782f076e558e6418568b472_224.png)

![](img/c77083c8c782f076e558e6418568b472_225.png)

![](img/c77083c8c782f076e558e6418568b472_227.png)

![](img/c77083c8c782f076e558e6418568b472_229.png)

**漏洞原理**：系统在处理注册冲突时，错误地将完整的用户信息返回给了客户端，属于**不当的错误信息处理**。这本质上也是一种信息泄露漏洞。

![](img/c77083c8c782f076e558e6418568b472_231.png)

**修复建议**：返回给前端的错误信息应当简洁、通用，避免泄露任何敏感数据。例如，应统一返回“该邮箱已被注册”，而不是包含具体用户信息的提示。

![](img/c77083c8c782f076e558e6418568b472_233.png)

![](img/c77083c8c782f076e558e6418568b472_235.png)

![](img/c77083c8c782f076e558e6418568b472_237.png)

---

![](img/c77083c8c782f076e558e6418568b472_239.png)

![](img/c77083c8c782f076e558e6418568b472_241.png)

![](img/c77083c8c782f076e558e6418568b472_242.png)

![](img/c77083c8c782f076e558e6418568b472_244.png)

## 总结 📝

![](img/c77083c8c782f076e558e6418568b472_246.png)

![](img/c77083c8c782f076e558e6418568b472_248.png)

![](img/c77083c8c782f076e558e6418568b472_250.png)

本节课中我们一起学习了多种逻辑漏洞与越权漏洞的真实案例，包括：

![](img/c77083c8c782f076e558e6418568b472_252.png)

*   **后台访问绕过**：利用伪造 `Referer` 和禁用 JavaScript 绕过客户端校验。
*   **参数越权**：通过修改请求中的ID等参数，非法访问或操作他人数据。
*   **邮件轰炸**：利用未加限制的重发功能，向目标邮箱发送大量邮件。
*   **服务费/金额篡改**：篡改客户端提交的支付状态或金额参数，绕过计费逻辑。
*   **平行越权与信息泄露**：通过注册等功能的错误回显，获取其他用户的敏感信息。

![](img/c77083c8c782f076e558e6418568b472_254.png)

这些案例的共同点在于，**服务端过度信任客户端提交的数据，缺乏对用户身份、权限和业务逻辑状态的严格校验**。在渗透测试中，需要仔细梳理业务流程，尝试修改每一个可能影响逻辑判断的请求参数，并观察系统的响应变化。同时，安全开发人员应牢记：**所有来自客户端的输入都是不可信的，必须在服务端进行严格的验证和校验**。