# 经典15年i春秋渗透测试系统化教程 - P34：课时1 验证码分类及原理讲解 🔐

在本节课中，我们将要学习验证码的基础知识，包括其定义、作用、发展历史、主要分类以及工作原理。理解这些内容是后续学习如何识别和突破验证码安全机制的基础。

## 概述 📖

验证码，英文全称为“Completely Automated Public Turing test to tell Computers and Humans Apart”，缩写为CAPTCHA。它的核心作用是自动区分访问者是计算机程序还是真实人类。验证码被广泛应用于防止恶意行为，如密码暴力破解、刷票、论坛灌水等，是保障网站安全的重要机制之一。

## 验证码的定义与作用 🛡️

验证码是一种用于区分用户是计算机还是人类的公共全自动程序。它的主要作用包括：
*   防止恶意暴力破解密码。
*   防止刷票和论坛灌水。
*   有效阻止黑客针对特定注册用户使用自动化程序进行持续的登录尝试。

目前，大多数网站都采用了验证码机制。其原理是计算机生成一个问题，但这个问题必须由人类才能解答。由于计算机无法解答这些问题，因此能够正确回答的用户就被认为是人类。

最早的验证码概念由卡内基梅隆大学的路易斯·冯·安等人于2002年提出。最初，卡内基梅隆大学曾尝试将其注册为商标，但在2018年被拒绝。

![](img/915cabc4f7005441ad1e5ed596237dec_1.png)

![](img/915cabc4f7005441ad1e5ed596237dec_3.png)

![](img/915cabc4f7005441ad1e5ed596237dec_5.png)

## 验证码的分类 📂

![](img/915cabc4f7005441ad1e5ed596237dec_6.png)

![](img/915cabc4f7005441ad1e5ed596237dec_8.png)

验证码有多种实现形式，各有其特点和安全级别。以下是主要的几种类型：

### 1. GIF/动画验证码 🎞️

这是最常见的验证码形式，通常表现为静态图片。静态图片验证码相对容易被OCR（光学字符识别）软件识别。

![](img/915cabc4f7005441ad1e5ed596237dec_10.png)

为了提高安全性，出现了GIF动画形式的验证码。动态变化的验证码增加了识别难度，可以有效防止自动化软件的识别。据统计，动画验证码在防止垃圾广告注入方面效果显著。

![](img/915cabc4f7005441ad1e5ed596237dec_12.png)

![](img/915cabc4f7005441ad1e5ed596237dec_14.png)

![](img/915cabc4f7005441ad1e5ed596237dec_15.png)

### 2. 手机短信验证码 📱

![](img/915cabc4f7005441ad1e5ed596237dec_17.png)

这是目前应用最广泛的验证码形式，在微信、网上银行、淘宝等涉及交易或敏感操作的场景中大量使用。

以下是其工作流程和注意事项：
*   验证码通过短信发送到用户手机。
*   大型网站通常会限制验证码的有效时间（例如60秒），以防止黑客在有效期内进行暴力破解。
*   如果验证码有效期设置过长（如5-10分钟），则存在被暴力破解的风险。
*   有些网站会通过第三方服务商提供的接口来统一发送和验证短信验证码。

### 3. 手机语音验证码 📞

![](img/915cabc4f7005441ad1e5ed596237dec_19.png)

![](img/915cabc4f7005441ad1e5ed596237dec_21.png)

这种验证码在国外应用较多，例如Google和YouTube。在验证过程中，系统会自动拨打用户的电话，通过语音播报验证码。

![](img/915cabc4f7005441ad1e5ed596237dec_23.png)

![](img/915cabc4f7005441ad1e5ed596237dec_25.png)

![](img/915cabc4f7005441ad1e5ed596237dec_27.png)

![](img/915cabc4f7005441ad1e5ed596237dec_28.png)

以下是其特点：
*   用户只需能正常接听电话即可收到验证码，实现了自动语音播报。
*   有时会同时发送短信作为备用，确保万无一失。
*   这种方式安全性较高，难以被自动化工具突破。

![](img/915cabc4f7005441ad1e5ed596237dec_30.png)

### 4. 视频验证码 🎬

视频验证码是一种较新的形式，将数字、字母或汉字动态地嵌入到MP4或Flash格式的视频中。

![](img/915cabc4f7005441ad1e5ed596237dec_32.png)

以下是其安全优势：
*   验证码在视频中动态变化，随机呈现，能有效防范字典攻击和重放攻击。
*   字母数字的字体、大小、显示速度和运动轨迹都可以变化，极大增加了恶意截屏破解的难度。
*   其安全度远高于普通验证码，且用户体验更佳。
*   但由于需要较高的技术支持，目前在国内尚未普及。国际上已有服务商提供此类服务。

![](img/915cabc4f7005441ad1e5ed596237dec_34.png)

![](img/915cabc4f7005441ad1e5ed596237dec_36.png)

![](img/915cabc4f7005441ad1e5ed596237dec_38.png)

![](img/915cabc4f7005441ad1e5ed596237dec_40.png)

![](img/915cabc4f7005441ad1e5ed596237dec_42.png)

![](img/915cabc4f7005441ad1e5ed596237dec_44.png)

## 验证码的工作原理 ⚙️

![](img/915cabc4f7005441ad1e5ed596237dec_46.png)

理解验证码的工作原理对于后续的安全测试至关重要。其标准的交互流程涉及客户端（用户浏览器）和服务端（网站服务器）。

以下是验证码验证的标准流程：
1.  **客户端发起请求**：用户访问需要验证码的页面（如登录页）。
2.  **服务端生成会话和验证码**：服务器收到请求后，会创建一个唯一的会话（Session），并生成一个随机的验证码字符串。公式表示为：`服务器生成：Session_ID, CAPTCHA_Text`。
3.  **服务端返回响应**：服务器将生成的验证码图片（或触发短信发送）连同Session_ID一起返回给客户端。
4.  **客户端提交验证**：用户识别并输入验证码，然后将验证码和Session_ID一并提交给服务器。
5.  **服务端验证并销毁会话**：服务器收到提交后，会比对提交的验证码与Session_ID对应的原始验证码是否一致。如果正确，则执行登录等后续操作，并立即销毁当前的Session；如果错误，则返回错误信息。

## 验证码的安全问题与突破思路 💥

![](img/915cabc4f7005441ad1e5ed596237dec_48.png)

![](img/915cabc4f7005441ad1e5ed596237dec_50.png)

![](img/915cabc4f7005441ad1e5ed596237dec_52.png)

![](img/915cabc4f7005441ad1e5ed596237dec_54.png)

![](img/915cabc4f7005441ad1e5ed596237dec_56.png)

验证码的安全并非绝对，可以从四个层面进行分析和测试：

### 1. 客户端安全问题

![](img/915cabc4f7005441ad1e5ed596237dec_58.png)

这类问题源于验证码的生成或验证过程在用户浏览器端完成，而非在服务端。

![](img/915cabc4f7005441ad1e5ed596237dec_60.png)

![](img/915cabc4f7005441ad1e5ed596237dec_62.png)

![](img/915cabc4f7005441ad1e5ed596237dec_64.png)

![](img/915cabc4f7005441ad1e5ed596237dec_66.png)

![](img/915cabc4f7005441ad1e5ed596237dec_68.png)

以下是几种常见案例：
*   **本地JS生成与验证**：验证码由客户端JavaScript文件生成，并且仅在客户端用JS验证。攻击者可以禁用JS、删除验证码输入框或修改本地JS逻辑来绕过验证。例如，某些大学网站曾存在此类漏洞。
*   **验证码在客户端源码中泄露**：验证码直接或经过简单编码（如Base64、MD5）后，出现在返回给客户端的HTML源码、Cookie或HTTP响应包中。攻击者可以轻易提取并解码获得真实验证码。微信早期版本、索尼等都有过类似案例。
*   **验证码触发逻辑缺陷**：有些系统在用户首次登录时不显示验证码，仅在密码错误数次后才出现。其判断逻辑可能依赖于Cookie中的一个计数器（如 `error=1`）。如果攻击者提交请求时不更新这个Cookie，就可以一直以“首次登录”状态进行暴力破解，而无需输入验证码。例如，某些航空公司和电商网站曾存在此漏洞。

![](img/915cabc4f7005441ad1e5ed596237dec_70.png)

![](img/915cabc4f7005441ad1e5ed596237dec_71.png)

![](img/915cabc4f7005441ad1e5ed596237dec_73.png)

### 2. 服务端安全问题

![](img/915cabc4f7005441ad1e5ed596237dec_75.png)

![](img/915cabc4f7005441ad1e5ed596237dec_76.png)

![](img/915cabc4f7005441ad1e5ed596237dec_77.png)

这类问题源于服务器端对验证码和会话的处理存在逻辑缺陷。

![](img/915cabc4f7005441ad1e5ed596237dec_79.png)

以下是几种常见案例：
*   **验证码未过期或未销毁**：这是最常见的漏洞之一。服务器在验证验证码通过后，没有立即销毁对应的Session。导致同一个验证码和Session_ID可以被重复使用多次，使得验证码形同虚设。攻击者可以固定Session_ID和验证码进行暴力破解。
*   **未进行非空判断**：服务器在验证时，没有对提交的验证码参数做严格的“是否为空”判断。攻击者通过拦截请求（如使用Burp Suite），直接删除验证码参数，可能就能绕过验证。许多CMS系统曾存在此类问题。

![](img/915cabc4f7005441ad1e5ed596237dec_81.png)

![](img/915cabc4f7005441ad1e5ed596237dec_83.png)

### 3. 验证码本身问题

这类问题源于验证码设计得过于简单，容易被机器识别。

![](img/915cabc4f7005441ad1e5ed596237dec_85.png)

![](img/915cabc4f7005441ad1e5ed596237dec_87.png)

以下是几种常见案例：
*   **验证码库容量有限**：例如，某些图形验证码（如“点击图中所有的火车”）的图片库很小。攻击者可以预先收集所有可能的图片和答案，建立本地库。当遇到验证时，通过图片特征匹配本地库即可获得答案。12306早期的验证码就存在类似风险。
*   **验证码过于简单**：简单的数字、字母组合，无扭曲、无干扰线，很容易被OCR软件识别。例如，一些证券、银行网站的早期验证码。

![](img/915cabc4f7005441ad1e5ed596237dec_89.png)

![](img/915cabc4f7005441ad1e5ed596237dec_90.png)

![](img/915cabc4f7005441ad1e5ed596237dec_92.png)

![](img/915cabc4f7005441ad1e5ed596237dec_94.png)

![](img/915cabc4f7005441ad1e5ed596237dec_96.png)

### 4. 验证码逻辑设计问题

![](img/915cabc4f7005441ad1e5ed596237dec_98.png)

![](img/915cabc4f7005441ad1e5ed596237dec_100.png)

![](img/915cabc4f7005441ad1e5ed596237dec_101.png)

这类问题源于验证码系统的整体业务流程设计存在缺陷。

![](img/915cabc4f7005441ad1e5ed596237dec_103.png)

![](img/915cabc4f7005441ad1e5ed596237dec_105.png)

![](img/915cabc4f7005441ad1e5ed596237dec_106.png)

![](img/915cabc4f7005441ad1e5ed596237dec_108.png)

![](img/915cabc4f7005441ad1e5ed596237dec_110.png)

例如，某证券网站验证码，在用户密码连续输错数次后，验证码会从简单模式变为带有复杂干扰线的高级模式，从而有效阻止了自动化工具的持续攻击。这说明了良好的逻辑设计能弥补验证码本身强度的不足。

![](img/915cabc4f7005441ad1e5ed596237dec_112.png)

![](img/915cabc4f7005441ad1e5ed596237dec_114.png)

## 总结 🎯

![](img/915cabc4f7005441ad1e5ed596237dec_116.png)

![](img/915cabc4f7005441ad1e5ed596237dec_118.png)

![](img/915cabc4f7005441ad1e5ed596237dec_120.png)

本节课我们一起学习了验证码的完整知识体系。我们首先了解了验证码的定义、核心作用及其发展历程。接着，详细探讨了GIF动画、短信、语音和视频等主要验证码类型的特点。然后，深入剖析了验证码“客户端-服务端”交互的标准工作原理。最后，也是最重要的，我们从客户端、服务端、验证码本身和逻辑设计四个维度，系统性地分析了验证码可能存在的安全漏洞及攻击者的突破思路，并辅以多个真实案例进行说明。

![](img/915cabc4f7005441ad1e5ed596237dec_122.png)

![](img/915cabc4f7005441ad1e5ed596237dec_124.png)

![](img/915cabc4f7005441ad1e5ed596237dec_126.png)

理解这些原理和案例，是后续进行实际安全测试和制定有效防御策略的基础。在接下来的课程中，我们将通过实验来演示如何利用这些知识点对验证码机制进行安全性评估。