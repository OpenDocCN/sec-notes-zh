# i春秋零基础入门Android逆向 - P32：课时7 常用Android快速定位关键点方法介绍 - 老网恋教父了 - BV1sg4y1B7zB

大家好，我是讲师艾8。那么今天的话就来讲这样一个第七课。第七课的话就是讲一下一些安卓在一个定位关键大家代码时候的一些小技巧。它的小方法。呃，其实的话这些技巧或或者说是一个方法的话。

在前面几几节课中已经有出现过几次了。那么前面几节课的话，我们已经有用到其中的一些方法，或者是中式文二级之类的。那么这节课的话就来做一个系统的一个总结。首先是第一个第一个的话是属于在一个字符串。

或者说是一个课程字特征码的一个搜索。呃，在前面的第三课中也有有用得到。这也是第四课中也定有用得到了。

![](img/f433181dceac85855d5d116fea0b6567_1.png)

![](img/f433181dceac85855d5d116fea0b6567_2.png)

比如说针对于这样一个游戏，我们可以搜索它的一个自符串。比如说它的1个GKID之类的，就能够相当之快的定位到它的一个程序运行的运行的一个过程。



![](img/f433181dceac85855d5d116fea0b6567_4.png)

![](img/f433181dceac85855d5d116fea0b6567_5.png)

呃，通常这样一个自我创打是在程序在运行过程中和我我们用户的一些交互的一个信息，和我们用户的一个交互信息，可以看得到这里引进去。哎，那么在这里的话就可以出现一个购买的一个提示。



![](img/f433181dceac85855d5d116fea0b6567_7.png)

![](img/f433181dceac85855d5d116fea0b6567_8.png)

🎼Yeah。好，那么购买然在这里那么比如说这些字符串这些一一个信息就可以说这样一些文字来得到来达到一个呃快速定位的一个效果。啊，那当然了，其实这样一个搜索定位的话是非常非常难用的。

如果说对于现在的一些程序，对于现在的一些APK来说，是很难以通过这样一个字符串的搜索去定位到一个关键位置的。因为因为现在的一些程序的字符串都是经过一定的一个加密。正如我们上一节课所引示一样。

其实它的一个字符串。一些关键一些关键的信息呢，都是在程序运行的过程中动态的去进行一个释放的。去它可以去对一个加密的一个数度，进行一个解密来找出我们真正的真正的一个字符串。



![](img/f433181dceac85855d5d116fea0b6567_10.png)

就是程序比较厉害的一个地方。也是对于现在一些程序员可以通有的一个特征。对于支付串的一个加密。所以现在一般很少用得到。当那当然这样的话还是还还是挺好用的，还是挺好用的。好。

然后第二步的话就是一个对于系统的一个敏敏感的一些APIAPI的一个监控了。呃，这样的一个API的话，是实际上就是程序的一个呃函数。

我们可以挂过一些系统系统的一个比比较重要的重要的一个函数来达到对整一个程序的一个分析。嗯。嗯，这是一个。现现在目前来说也有很多的工具可以对它进行一个监控的。哎，比如说啊我们在这里我给大家来弄了一款工具。

叫做一个追弱。因该是一个Spo的一个插件。安装完以后的话，在这里的模块进行一个启用，进行一个启用。然后再重启一下，就能够启用整一个插件了。那么这样一个插件的话。

可以监控到它的一个呃系统在程序在运行中的用到的一些系统的一个信息。

![](img/f433181dceac85855d5d116fea0b6567_12.png)

并且把一个相关的一个函数的它一个函数的一个调用，还有还有它的一个结果给动出来。像比如说这里程序运行过程中，哎，它产生了这么多的一个数据。好，我们设置一个过滤，看一下它的一个前缀。

以这是转成后面是一个API monitor。The。Yeah。然后这后面的跟的是一个发明。设置一个过滤。好。不错，我们试试海要过滤，嗯，本来就这样。后面跟的是一个报名。

报名应该是弄出来什么D算机ASXYL啊。Yes。应该是得付了嗯。好，可以看到的话，这也就是程序中啊被它多索取出来的一个运行的一个情况。这这个工具的话可以有效的监控一些啊，比如说一些网络上的一个函数。

一个API调用或者说一个系统的一个广播的一个接收。好，这是这也是一个程序可以监控到的地方呃，当然的话还有其他的一些程序其其他的一些APP文件，也可以做到一个相应的一个监控的一个功能一个效果。

那么但是的话但是的话。那这样一个挂钩的话，那么大家在下面也可以自己去找一下一些其他的一个程序。有一些程序的话是对1个SD卡的一个写用，可以进行一个监控的这也是一个分析中经常会用到的一个东西。

大家前面几节课的话还暂时来说还没有出现得到。好，我们然后第三个的话就是一个呃关键函数的一个挂钩啊。那么这样一个技巧的话是比较呃对编程功底可能需要的比较多。

一般来说的话呢就是它就是需要我们去按装一个export或者一个是DIA。然后我们根据这样两个勾后的框架去手动的去编写一个勾的一个代码，然后勾选我们想要的一个函数。

就像上一节课中呃那个AAA个GEB它运行的过程中，它有一个字符算解密的函数，我们就可以选择勾勾那一个函数，然后在程序运行的过程中，哎自动的去把它一个解密以后的一个结果给释放出来。

这就是一个挂钩的一个作用。那那这个话现在暂时还没用得到啊，在后面几节课在写一个插件的时候，看能不能够给大家来找一个相应的一个程序来写一下这样一个简密的要挂钩的一个方法。好。

然后第四个话就是一个monitormonitor啊我前几节课中也有出现过。但那时候我们一般是用来查这样一个log的消息。但实际上话它它的一个monitor功能是远远不不止于此的，远远不止于此的。

如果你只会用monit来查看一个loggo的话，那就是一个太可以了。他空了几多的强大。非常强大，我们来看一下它它有哪一些的一个它有哪些功能。首先是一个呃现成的一个1个DDMS的功能，它是可以查看一个路。

前面几节课已经出现过了，然后第二个和话就是一个现成的监控功能。我们选中我们想要分析的一个函数，哎，这里有一个呃up也就是一个现程当踪，打开看一下的话，看到它可以看到它这里有这么多的一个现程。

这里可以跟踪到每一个现成的产生的一个方法，然后还有它的一个状态。也就说这个是一个面建仓，然后就不是一个机器资源，可以说有个线程，然后是一个log，也就是一个消息打应的一个线程。

这里可以进行一个现程的哪一个跟踪。除此之外呃，除了这样一个线程跟踪以外，它还可以进行一个呃当保为跟踪，也就是mes twice。好，那么看一下这样一个mess串它是一个怎么回事。

mess串的话就是一个程序，在运行过程中，它将到哪一些方法都可以进行一个跟踪。mes串的话在这里点进去进行一个呃跟踪。下面我们就来激乎我们相应相应的一个方法。好，激活完完完以后取消掉。

那么程序就会上成一个这一段时间内的一个呃调用，可以看到这里有这么多的一个线程啊，和这一个是对应的。这么多的一个线程，它运行了这么多的一个方法。像下面看找做的到。

这是呃刚才程述一下运行过程中会出现到每一个方法。呃，对于这样可以看到的话，它动出来了非常非常多的一个呃方法，还有它的一个数据。这个的话我们要一步一步的往下倒。好。

我们来一步步往下倒来看一下有什么方法是我们关心了。哎，看到一个一键 pay。好，那么这里就是我们所关系所关心的一个方法。我们有有理由去相信啊，它是和我们的一个呃支付是相关的。嗯。

那么这里的话需要一步一步的找看一下有没有佩戴了but，没这是我们点击支付的一个button呢。好，我们在这里去进行一个定位，尝试着从这些方法去进行一个入手。

比如说这里有一个pay button view，看一下怎样。好在这里在这一个域里面，我们来进行一个分析吧，看一下能不能够从这里进行一个入手来看一下。来找到我们的一个呃关键点。

也就是也就是查之后才能够找到找到的那个关键点。我们看一下看一下we要 pay game down的 bills。好，这里是设置它的一个点击处理事件的一个回调。

那你所在啊这样一个回调大概是它一个支付函数的地方。我们来看一下一个配 game的这样一个这这样一个东。好啊，在这里。嗯。He。到八六。Yeah。好，没找到没找到，我们手手动的进行一个定位ZN开始。

然后是E边 terminalHDKUI。哟还是没找到口。那么这个估计是在一个letttic上的一个方法是进行一个调用的。那么在java上的夸是找不到的。它可能是一个net上。

也就是一个SO层的那一边的一个调码。我看一下这个线索。然那这样的话，我们就不找这个了，能往上翻一下，找一下其他的。好。佢愿月被单我。好，我们往上找一下。呃。

前面的块也有个找后找到一个是呃嗯payactivity的。他再来就是在这个地方一见activity cr。啊，就这个这一个。可以看到这里就是我们呃点击一个制作按钮以后，就可以创建这一个个个KT了。

在里面的话就调用一个支付的一个函数进行个co怎么去看到它是一个层的一个调用。和我们下面是一对应的。那么这里如果想要跟踪下去的话。

就要跟踪到它的它的一个SO层啊跟踪这样一个libary就是这样一个SO库来跟踪下去才能找到一个接口那么这里我就暂时还不能跟踪在这附近找一下。

可以可以看到它的一个啊其他的一些支付的一个相关的一个类之类的东西这样有一个支付的一个接口，个是一个接口interface接口。那II可以就是我们的一个I可以看到它的一个扩展。

那么这里就是重写这样一个接口，这是一个支付相关的一个方法，按ctrol加X查找它的一个调用好这里是支付成功的一个调用。那么这里就是在它的一个附近的在它附近定位的一个方法了。呃，好。

那么这一个话就是一个函数跟踪的一个作用。那在你也可以手动的对自己呃。对自己感兴趣的一些函数，手动的去插入这样两两个函数来来设置一个开始跟踪，还有停止跟踪。这是在安卓提供了一个方法。

是安卓插呃SDC中提供了两个呃跟踪跟踪的一个方法。主要还是看一下它里面调用的哪一些函数的。然后第五个的话就是一个叉log信息。那么log的话在前面你也有用得到。

可以在可以打印出程序关键的一个信息的可以把自己想想要这些信息可打印在DDMS中这是一个log。然后另外一个是一个动态调试，动态调试的话，我相信大家应该用的不少，用的不少。

那这是一个比较好用的一个地球一个方法。但有一些程序真的不怎么好调的时候，就只能用前面的一些log的一些其他方法之类的。那么这面这么多就是我这节课打算要讲的一个内容。作业的话这节课并没有什么作业。

那么你们就可以用这下用上面的一些方法来对。那几节课所介绍到了一些APK文件来看一下有没有。其他方法可以去切用一个关键点。呃，这一节课主要还是来做一个总结。那当然呃总结并不是这一节课唯一一个呃目标。啊。

下面的话我就来讲一下上一节课的一个作业了，也就是完成对这1个GEB的一个分析。如果上一节课作业已经做出来了，或者说自己已经分析出来了话，那么下面的内容就可以不不用看了。啊，其实第六节课作业的话。

我个人认为是偏蓝的。如果你啊你做不出来是非常非常正常的一件事情啊，如果前面没有一个逆项经验的话，是基本上是做不出来的。毕竟那个思那个思考这个思维的一个方法是不一样，是很难弄出来的。不过也不要紧。

如果你是真的一点经验都没有，但是自己去把一个它的一个key一个注册的一个方式，一个流程给给弄出来的话。哎，那么我相信你肯定会收获很大。如果没有弄出来的话，也不要紧。

可以跟着我这样一步一步来来看一下我们怎么对于一个逆向来说，我们是怎么去分析一个函数的。特别是对于这样一个静态分析，我们是怎样去弄怎么去弄的。好，我们还是用上一节课将教到的一个方法去定位到它的一个关键点。

这里就到这样一个list的一个类，可以看到这里有一个就是设置时间戳，这是它的一个过期的时间戳按键盘上的X可以找到它的一个调用，哎，可以看到它是找一个过期时间。我们来看一下。

其实这样一个时间戳的话是的标准时间。也就是也是它过期时间到1970年1月1日所经过的一个秒述，这是它的一个时间戳，我们按键盘上的contrl加X来找到它的一个调用。

这里就是它的一个校验校验我们去的一个地方。首先在这个地方初始化的一个校验的一个类里面传递的一个呃我们的机器码模ID我们按进行一个重命名。Yeah。好。这里点进去，然后初始化的方法。

这是对这样一个浪值进行一个复制。这一个就是我们的一个模型ID了。所谓的机器码，接着我们在这里取出了我们的一个listS key，也就是我们的输入的一个注册码。嗯。

然后下面有一个函数来与我们的我们的注册法进行一个判断。如果他这是这个这个判断的话，它的返回类型是一个不文类型的，也就是成功还有失败，返回被处的话就证明一个注册成功了。好。

我们下面就来一步一步的跟踪它第一个参数是我们输入了一个助算盘。然后第二第二个参数的话是一个int的一个数组。而且注意一下啊，这一个int的话是还没有被初始化的。而且在这里我们往下滚下去的话。

可以看到这样一个int值会用来初始化这样一个过期时间的。哎，那么那就可以呃明显的出现出来啊，其实这样一个int数组是在这一个函数里面进行一个复值。那么这里的一个相关的内容就是一个过期时间。

也就是它这样了。Yeah。这是一个复值。好，我们把上面呃前面一个函数的一些参数给确认，确认好以后的话，就能够真正的开始我们这一个函数的一个逆向分析了。靠这个函数它里面是块初始化。

The teststand。我们点进去哦，继续来。第一个函数是我们的个key。然后第二个的话是需要它传递出来的一个态带。我们先在看一下它的一个返回地方，先来看一下它的一个返回地方。哎。

这里一0就是我们的返回，我们IN呢进行一个什命名，出新了一个reult，可以看到这里是返回为成功。那么前面的话都是返回为失败了。首先把它的一个返回结果初始化为一个forse。好。

前面的返回都是返回为一个foral，也就是失败了。好，然后这里就也就是这一个成功成功的地方会对我们的t day就是过期事故上过期时间进行一个复持。那么这里就是一个过期时间了。Yeah。好。

把这样一个基本的一个步骤给弄完以后呢，我们再来进行一个详尽的一个分析。好，我们一步一步的往下走，一步一步往下走，进行一个正向的一个分析。首先是对我们的一个就算某一个K来进行一个判断它是不是空的。

或者说它它的一个长度是等于零的。如果是这种情况的话，就直接反回为一个丝袜啊，就是我们输入的K，它是有一定的长度的，接着对我们的K进行一个呃去求空格。Yeah。啊。

这是去除前面还有后面的一个空格的一个方法，这是java里面的一个方法去去除空格，然后把去掉空格的一个值放到这样一个地方。接着我们这这一个K寻找1个9090的值。

我们按B可以看到是1个5A寻找这样一个东东西的一个位置。index of主要靠就是寻找这么一个字符，或者说是一个字符在一个字符串中出现的一个位置了。我们看一下5A5A是一个大小的一个Z。

那么这里就是寻找一个N的位置了。好，这里是寻找一个Z的位置，然后把Z的位置放到这样一个地方。哎，那可以确定我们的key里面是肯定有这一个这这样一个函数的，因为它找不到的时候就直接返回为一个失败了。好。

我们可以确定它呃它中间有一个Z，那前面有没有不知道，那后面有有没有也不知道它反正肯定有肯定有一个Z来组成的。肯。主是这样的，我们再往下走，第个取它的一个度算进行一个分割。

前面取出来的一个这个值给传递下来进行一个分割。也就是说在最前面的话，就是在最后面的一个路算。这里就是取出在Z后面的一个字符串，那这里就是把了后面的这样一个东西给弄出来。好，这样来写太难写，太难分别了。

我给它分割出来，然后3456789，然后Z后面是ABCB。好，我们假设是这样一个东西，它假设是这样的话，那么后面的这一个个函数就是把一个Z后面的一个字符串给取出来，就是把这一块给取出来了。

然后把放到这样一个区里面去。え。还是一要进行一个命名。然后它的长度如果是小于一个V4的话，也就是2。如果它的长度小于2的话，就返回为一个失败。那么也就是说后面的这一个正上。

我们命名为我要假设它是一个命名为A，那么A的长度的话就要大于等于2，不然的话就是一会返回一个失败了。Thank。好，长度呀大油。He。接着我们来看一下这右边的字符串进行怎么一样一个处理。好。

看到对于右边的字符串再一次进行一个分割，它的分割的话主要是把从零到它的倒数第二位，取做为一个字符串，放到V3中，然后呢记着把它最后的一个字符串给字符给取出来，放到这里。对这一个来说的话，就是把这里呃。

从呢它这个作为一个新字符串给放到这V商里面，把后面的一个G给放到这样一个地方，好我们再来进行一个分割吧。把这个。好，分割成2块。这个B块呃，我们命名为一个B，然后面的块命名为一个C，好，后色2块。

这里是一个逼了。接着把这样一个前面的这一块给转换成一个int值，放到V4里面。转换成一个int，然后后面把呃上面的右边的这么一个，也就是把这一块给转换成ink放到一个V7里面。这是个IC。好。

把它分别转换成一个int值，这2块转换成int值放到这两个地方。接着后面就是一个呃求和，可以看到先把这样一个值等于IB线，就是前面这一块左上角阴的这一块。好，我们进行一个求和。

每一次的话就是哎它的一个15位置的03F。在这里的话就是它的第一四位了，每次它求合都加上了第四位，然后用于一个4位，接着再加就再加上它的第四位，也就是说把它的每4位，每4位进行一个累加。

这是一个累加的一个结果，然后把它累加的结果，然后对十进行一个求模，它求模得到的值应该是等于一个IC了，也就是后面的这一块的一个值了。哎，如果他不懂的话，就反而失败了，证明这是一个教验。唉，可以看到啊。

我们后面的C这样这么一块的话，它实际上就是对前面的一个字符串来进行一个求哈求哈ush吧来求一个交验的值。那么C这一块就是保证它们的一个交验值了。这开始对身的是一个教样哒。然后我们往下继续跑。

会发现这里对IB进行了一个异货。然后结果放到一个t里面。那么这里看在下面就是我们的过去时间了，下面也没有再复值了。证明这里的话就是起出它的一个过去时间了。假如我们前面的校验都通过的话。

我们就给这样一个时间给复值。那么这样一个时间主要是通过一个IB抑货这么一个数据来得到了。哎，那么IB的话就这样一个B，它实际上就是我们一个过期时间啊。好，我们现在就弄出来，B是一个过期时间。Yeah。

的加密获续时间抑获一个东西，然后C的它就是一个低的一个呃校验。好，那么这一个就是大家推他对后面的这一块字助串的一个处理。然后在这里我慢慢跑下去，看到它是是取出一个前面一个零到这的位置。

就是取出前面这一块的一个字符串。我们取出来放到这样一个位置，我们看一下它做什么。假如说我们把这样一个字符串命名为呃。我们把这个给它假设为一个B。好，看一下哈它的第一个B怎么处理的。

首先把它转换成一个log值，放到这个4E里面去。接着啊我们在这里就取提出一个 ID呃，请大家记住一下这个 ID的话，它本来是一个ro值。那么这样一个强制转换以后的话，也也就是说强制的转换为以后的话。

它实际上就只剩下一个值了。比一个是有两个组成，也可以这样看，因为是有两个组成了。那么这里就是分开进行一个校验了，我们先来把一个机器码给设出来，首先是一个 ID一个是ro有两个in组成。它是一个lon字。

这两个都是一个lon字。我们分割起来，比如说把它的一个高位就是它的高位，把高位设置为一个呃一，然后它DV设置为一个F。然后对于我们的输入的一个D，把它对一个D给转换成一个字，一个lon的形式的时候。

然后这里它高位是一个G，然后对是一个H。好，那么这里就是取求它的一个呃定位啊，把它强制转向原因的时候，前面的高位的字符错的一些信息都会给给丢失。那么这里就是一个F的值了，这里就是取求F值。Yeah。好。

这里先先值取出来。接着好，我们这里对刚才转换出来的一个long的一个值给用于一个V9的这样一个位数。V9是什么东西啊，看一下V9是32，转一下就等于0320，也就是一个呃。恰好是一个ink值的一个程度。

这里就是取出它的一个高位了，就是把这里的ink全部取出来。好，我们这里就取取出来这样一个G的一个呃数值了。Yeah。Yeah。好，这一个就是一个IG。我们把这些东西给取出来是干什么的？后面再慢慢看。

好后这里慢慢跑了啊，跑，这是对一个模型器来取出它的一个高位还是一样，用于32位就等于取出它的一个高位的一个值了。好，这里就取出一个一的这一块的一个值，然后减去一个数。

加上一个数描后一或一个数进行一个处理。然后结果放到这里，就是对上面一个一进行一个运算的值了，这一进行一定的运算。Yeah。好，继续往下跑，可以看到一个上也就是上面一个F的值。

F值加上一个数应该等于我们的一个LD的一个低位，也就是它后面的这一块的一个值。好，我们再来看一下，这是一个开始进行一个校验了。我们看一下一个LD是它D面的H值，应该等于我们那个也就是这里的一个低V的值。

也就是F值，加上一个数。好，这是他的一个第一步校验，是两个地位的一个校验。如果这里没有通过就反失败。如果通过这里没有通过，就这里好失败回了。果通过了以就可以进行进行下一步判断。

一步是上一步这里进行一个算一进行算值应该等于这个IG等于这一块的好，这是第2块的一个校验应该等于我上面的算出来。一个位一个一进行一个理出一个数加上一个数后一个数好，等于这样一个理。嗯。

那这里哎这是另外第二个教点对高位的一个教点。然后这里如果是通过了以后的话，就可以进行一个这样一个转换。然这个转化是什么意思啊？已经不怎么重要了已经不怎么重要了。因为下面已经反还要被一个呃成功了。

下面已经下面已经反还成功，证明这里的一个所所有的校验已经通过了。他要处理的就是这么多的一个东西。哎，可以看到整一个函数整一个验证的流程走过来其实是不难的，其实是不难了啊，这也是一个相当之简单的一个函数。

啊，可以看到我们我们所谓的逆项分析其实也不过如此啊，就是这样对的一个呃函数或者说参数还有方法啊，对着它的一些呃中间会经过的一些函数一步一步的走过来来慢慢的对它进行了分析。

但是呢在这过程中会看到会用到非常非常多的一个java的一些函数，还有一些数据之类的。可以看到，如果是对一个java的语法，或者说一些函数不怎么熟悉的话，那么在这里肯定会遇到非常非常多的一些坑。

所以啊前面也也也有有人问过，如果我的开发不行，呃，可能不能够做逆向，然后也有人说，哎其实呃他其实这样一个立向和开发不行，开发有没有什么太差关系不想学之类的啊，我这里就统一的说一下嘛。

那你的逆向的话是非常依赖于你的一个开发一个功底的。如果你开发功底不好，那么这里在分析函数的时候就可以遇到很多坑了。呃，而且你也可以去看一下，现在在那些呃网络上能够称得上是大流的人的话。

他们哪一个呢他们哪一个开发功功给是不好的。他们随便找一个出来也能够变出一个非常屌一的程序了。所以如果你想成为一个大流啊，一定要把开发这一块给弄好，不然这些函数这些参数的作用你都不清楚。

那么这样一个分析就无无从谈起了，对不对？好，那么这一个就是一个逆向分析，一个简单的一个例子，也是上一节课作业其实是不难的。啊啊，那么这节课的话就大概讲这么多了一个内容。好啊，谢谢大家。



![](img/f433181dceac85855d5d116fea0b6567_14.png)

🎼。