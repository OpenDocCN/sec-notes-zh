# 经典15年i春秋渗透测试系统化教程 - P35：课时2 验证码各类方法突破分析 🔓

在本节课中，我们将学习验证码安全漏洞中的一种常见类型：**验证码会话未及时销毁导致的复用漏洞**。我们将通过一个实际案例，演示如何利用此漏洞对登录系统进行暴力破解。

![](img/78e1fc22263a00c38af3c3edc1284188_1.png)

## 概述：验证码会话复用漏洞

![](img/78e1fc22263a00c38af3c3edc1284188_3.png)

![](img/78e1fc22263a00c38af3c3edc1284188_5.png)

上一节我们介绍了验证码的多种绕过思路。本节中，我们来看看其中一种由服务器端逻辑缺陷导致的漏洞：**验证码过期但会话未销毁**。

![](img/78e1fc22263a00c38af3c3edc1284188_7.png)

当用户提交一次验证码后，如果服务器没有立即销毁或标记该验证码对应的会话（Session），攻击者就可以在同一个会话中，重复使用同一个验证码进行多次请求。这使得针对用户名或密码的暴力破解成为可能。

## 实战演示：利用验证码复用漏洞进行爆破

![](img/78e1fc22263a00c38af3c3edc1284188_9.png)

我们将以“戴其漏PP接待系统”的官方站点为例进行演示。该站点存在验证码会话未及时销毁的漏洞。

### 第一步：环境准备与抓包

![](img/78e1fc22263a00c38af3c3edc1284188_11.png)

首先，打开Burp Suite并配置浏览器代理。然后访问目标登录页面。

![](img/78e1fc22263a00c38af3c3edc1284188_13.png)

![](img/78e1fc22263a00c38af3c3edc1284188_14.png)

1.  在用户名处输入一个已知或猜测的用户名（例如：`test`）。
2.  在密码处随意输入。
3.  输入页面显示的验证码。
4.  点击登录，并使用Burp Suite拦截该HTTP请求包。

![](img/78e1fc22263a00c38af3c3edc1284188_16.png)

![](img/78e1fc22263a00c38af3c3edc1284188_18.png)

以下是拦截到的登录请求数据包示例结构：
```http
POST /login.php HTTP/1.1
Host: target.com
Content-Type: application/x-www-form-urlencoded

![](img/78e1fc22263a00c38af3c3edc1284188_20.png)

username=test&password=wrong123&verifycode=CGWC4I
```

### 第二步：将数据包发送至Intruder模块

![](img/78e1fc22263a00c38af3c3edc1284188_22.png)

将抓取到的请求包发送到Burp Suite的 **Intruder** 模块，用于进行暴力破解攻击。

在Intruder模块中：
1.  点击 **“Clear §”** 按钮，清除所有默认的变量标记。
2.  因为我们计划对`test`用户的密码进行爆破，所以仅在`password`参数值处添加变量标记。**验证码`verifycode`参数保持原值不变**，这正是利用漏洞的关键。
3.  攻击类型选择 **“Sniper”**（针对单个位置进行爆破）。

![](img/78e1fc22263a00c38af3c3edc1284188_24.png)

以下是设置变量的示例：
```http
username=test&password=§wrong123§&verifycode=CGWC4I
```

![](img/78e1fc22263a00c38af3c3edc1284188_26.png)

### 第三步：配置攻击载荷（Payload）

![](img/78e1fc22263a00c38af3c3edc1284188_28.png)

接下来，需要为密码字段配置一个字典作为攻击载荷。

![](img/78e1fc22263a00c38af3c3edc1284188_30.png)

![](img/78e1fc22263a00c38af3c3edc1284188_32.png)

![](img/78e1fc22263a00c38af3c3edc1284188_33.png)

1.  切换到 **“Payloads”** 选项卡。
2.  在 **“Payload Sets”** 中，选择我们刚才标记的密码参数。
3.  在 **“Payload Options”** 区域，加载或手动添加一个密码字典。为了演示，可以手动添加几个常用密码，并包含一个正确的密码用于验证漏洞。

![](img/78e1fc22263a00c38af3c3edc1284188_35.png)

以下是可用的密码列表示例：
```
123456
admin
password
12345678
qwerty
[此处填入已知的正确密码]
```

![](img/78e1fc22263a00c38af3c3edc1284188_37.png)

![](img/78e1fc22263a00c38af3c3edc1284188_39.png)

### 第四步：执行攻击并分析结果

![](img/78e1fc22263a00c38af3c3edc1284188_40.png)

![](img/78e1fc22263a00c38af3c3edc1284188_42.png)

点击 **“Start Attack”** 按钮开始攻击。Intruder会使用同一个验证码`CGWC4I`，遍历字典中的所有密码进行请求。

![](img/78e1fc22263a00c38af3c3edc1284188_44.png)

![](img/78e1fc22263a00c38af3c3edc1284188_46.png)

![](img/78e1fc22263a00c38af3c3edc1284188_48.png)

攻击完成后，我们需要分析结果以找出正确的密码：

![](img/78e1fc22263a00c38af3c3edc1284188_50.png)

![](img/78e1fc22263a00c38af3c3edc1284188_51.png)

1.  观察 **“Status”** 或 **“Length”** 列。通常，登录失败和成功的HTTP响应状态码或返回包长度会不同。
2.  点击 **“Length”** 列进行排序，找出长度与其他请求明显不同的那一条。
3.  检查该条请求对应的响应内容，通常会包含登录成功或跳转的提示。

![](img/78e1fc22263a00c38af3c3edc1284188_53.png)

**核心逻辑**：由于服务器没有在第一次验证后销毁该验证码会话，导致攻击者可以使用`同一个验证码 + 不同的密码`进行多次尝试，从而绕过验证码的防护机制。

## 其他相关漏洞场景

在实战测试中，还可能遇到其他与验证码相关的逻辑漏洞。

![](img/78e1fc22263a00c38af3c3edc1284188_55.png)

以下是几种常见情况：

![](img/78e1fc22263a00c38af3c3edc1284188_57.png)

*   **客户端验证码校验**：在提交的数据包中，如果发现验证码参数同时出现在请求的“前端”（如一个隐藏字段）和“后端”（正常输入字段），且两者值相同时才通过验证，这属于不安全的客户端校验。攻击者可以拦截请求，将两个值修改为一致即可绕过。
*   **验证码空值绕过**：直接提交空的验证码参数，有时会被服务器逻辑错误地接受。
*   **验证码回显**：验证码可能直接显示在HTML源码、Cookie或响应头中。

![](img/78e1fc22263a00c38af3c3edc1284188_59.png)

![](img/78e1fc22263a00c38af3c3edc1284188_61.png)

## 总结

![](img/78e1fc22263a00c38af3c3edc1284188_63.png)

本节课中我们一起学习了**验证码会话复用漏洞**的原理与利用方法。我们了解到，如果服务器在验证后未能及时销毁会话，攻击者就可以重复使用同一个验证码进行暴力破解。我们通过Burp Suite工具，完整演示了从抓包、标记变量、配置载荷到执行攻击和分析结果的全过程。在实际渗透测试中，需要灵活运用这些方法，并注意观察其他可能的验证码逻辑缺陷。下节课我们将继续讲解验证码突破的其他案例。