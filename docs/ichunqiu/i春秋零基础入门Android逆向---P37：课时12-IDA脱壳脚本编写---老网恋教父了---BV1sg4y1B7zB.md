# i春秋零基础入门Android逆向 - P37：课时12 IDA脱壳脚本编写 - 老网恋教父了 - BV1sg4y1B7zB

悟空。

![](img/4a477490ce41e63f66bd84d354bb5aed_1.png)

🎼。嗯，好的，呃，大家好，我是蒋。那么今天的话就来讲一个IDA的一个脚本脱壳。那么上一节课中已经初步的讲解了一个在一个安卓一个d模式下，整个系统是怎么样去加载1个DX文件的。

并且从当中呢我们也来看到了一个比较特殊的一个数据，就是这样一个GDM一个ususDXY的一个数据了。那么这这一个数据中哎所有在内存中加载过的一个de文件呢。

都需要给到这样一个数据中去给存放到这样一个块中来达到一个加载效果。否则就不能这样就不能够正常的使用这样一组数据的。所以无论是什么可，唉，只要他需需要加载一个ds文件，并且加载成功以后的话。

肯定是需要去操作这样一个结构体的。所以我们可以通过B变异这样一个结构体来获取到内存中所有被加载过的一个ds文件。哎，那么在今天我们就来看一下啊，怎么样去用脚本去把这样一个结构体的数据给弄出来。

怎么去把它的一个d词文件数据给搞出来。好，我们先回到下一节课中所收到一个代码的一个分析。好，那么上一节课我们就讲到了一个open dash的一个函数。然后里面就看到这个函数里面的夸掉呢这样一个函数。对。

这个函数就是往1个GDM中的在主数据中去添加我们的1个PS加加结构的一个文件。那么这个结构里面的话存放着我们的一个dash文件数据。哎，那么在这里我们就尝试着从在调试中找到这样一个位置。

然后然后从里面来找到我们加载过的一个dash文件数据。好，我们就来开始来进行一个尝试。那么今天的我们的一个目标课件的话是1个APK文件。我们现在进行一个安装调试，然后。来看一下它是加了一个什么壳。

然后怎么样去进行一个结合啊，那么在这里它检测到基一个I加密加固。至于事物的事程呢是艾加B的话，我没有去仔细看过。我么大家的话下面可以自己去尝试去研究研究。我这里。



![](img/4a477490ce41e63f66bd84d354bb5aed_3.png)

![](img/4a477490ce41e63f66bd84d354bb5aed_4.png)

现在进行一个安装。然后调色。

![](img/4a477490ce41e63f66bd84d354bb5aed_6.png)

那么由于在这里，我们的目标的话是找一个通用的一个脱壳机啊，所以在这里的话就不进行一步一步的一个调试了。那么在这里的话，我们将直接的进行一个挂接。

来尝试去看一下能不能够直接从内存中把它相应的一个数据给导出来。那我们进行一个安装。

![](img/4a477490ce41e63f66bd84d354bb5aed_8.png)

然后打开我们的IDA进行个调试。

![](img/4a477490ce41e63f66bd84d354bb5aed_10.png)

我打开下卓 server，然后有一个进行一个端口转发。接着把开我们的程序，然后ID进行一个挂接。

![](img/4a477490ce41e63f66bd84d354bb5aed_12.png)

嗯，那么这里请大家注意一下，有一些程序到我们IDA进行挂机的同时呢，它就会自动的去完成了也就自动的强行一个退出了。哎，那么在这这情况之下，我们可以先把我们的一个进程给暂停掉。

那么这样即使他接到一个退出的指令，也不一定可以推出掉啊，我们可以先把我们进程给强制给停掉，以后IDA再进行挂接，哎，把数据给动出来以后再再进行一个脱离。哎，这时候再继续进程。



![](img/4a477490ce41e63f66bd84d354bb5aed_14.png)

那么这样一来的话，可以对付大部分的可，大部分可的话都可以通过这样一个方式来获取到它里面的一个数据的。

![](img/4a477490ce41e63f66bd84d354bb5aed_16.png)

好，那么我们这里在1个IDA进行一个关机之前，先把整一个进程给停下来。当然这一幅画对这个程序来说不做也没有什么关系，但搞完话会比较好一点，特别是没有没有被改过系统，通常ID一挂机上去就被发现了。哎。

那样就非常糟糕了。好朋友么在这里我们来找我们来使用这样一个QF持久的一个命令。就是立马上的Q死令来进行一个正常暂进程的一个停止。



![](img/4a477490ce41e63f66bd84d354bb5aed_18.png)

![](img/4a477490ce41e63f66bd84d354bb5aed_19.png)

然后进行一个挂接盗数据。好我们来。由于在这里我们来看到Q，然后传递一个视点之后，后面的话要传一个正常的1个PID的值。那么首先我们得获取整一个正常的PID那么先用PS指令来获取当前正常的1个ID值。

看到这有这么多，我们可以进行一个筛选。

![](img/4a477490ce41e63f66bd84d354bb5aed_21.png)

![](img/4a477490ce41e63f66bd84d354bb5aed_22.png)

好，我在这里的一个程序名是这么一个东西。好，先要QQ绑上梯k里面。

![](img/4a477490ce41e63f66bd84d354bb5aed_24.png)

找到他。你也可以看到就可筛选出这三个进程了。那么这三个进程的话，也不是每一个有都有用的。下面两个的话是一个不serv，还有一个remoote，是一个啊单独脱脱离出来的两个服务进程。

那么最上面这个话才是主要的一个进程。所以在这里唉我们就把这这个进程给停下来就可以了。它的PID值是1个32416，我们把它Q掉。好，那么他这样一来就暂停下来了。



![](img/4a477490ce41e63f66bd84d354bb5aed_26.png)

那么这个时候就能过人用ID去进行一个逛街了。那么ID找到我们想要好的一个集程，可以关机上去。32416好在这里。那么关系完以后就开始去进行一个操作。那么我们要先来整理一下我们要操作的一个流程。

首先在这里我们的的第一步。就像打个道。1个GTVN，然后是userDXILES的一个哈表的位置。然后呢就便利这一个表。然后早到。加载过的一个。S文件数据。我们要做的事情唉，就这么两样。

那大家具体怎么做啊，我们能方外搞。首先就是这样1个GDM数据GTVM的话，我们跑到这里唉GTVM我们可以看到它是一个全局的变量，而且这个变量的名称是这样一个结构体DVM的一个交体。

那么点过去会发现里面有非常多的一个结构。然后一个GDVM中的一个userDex的话是其中的一个hush table的一个结构。好，把这些哎把这些细小的东西都记录下来。预测D发是一个hos有一个EC。

然后GDV的话是一个全局的一个DMgo结构体。我们就来开始进行一个定位。那么既然首先既然GDAN的话是一个全局的一个结构体。那么在IDA中，自然也可以直接的使用一个G来进行一个跳转。

因为这是一个导出的一个还导出的一个结构。大家可以看到在这里我们已经找到DAN的一个结构体了。

![](img/4a477490ce41e63f66bd84d354bb5aed_28.png)

它那么它里面有这么多内容，哎有这么多内容。这时候我们并不知道哎，我们所需要的一个user that里面，它到底在它偏移什么位置，或者说在哪一个结构中。哎，这一时我们又需要进行进一步的一个分析呢。

那么在这里既然要分析它的1个SO文件。那么这个SO的话是在一个在1个LIBDVM的1个SO文件的。那么既然要分析这样一个文件，我们就需要做到把这个文件给弄出来，然后进行一个分析。

来把它的一个位置进行一个确定。那么在一个手机中，我们就把我们的这样一个lave文件给动出来。首先哎。我们现在跑到系统的一个la目目录下。然后就在。好，那我可以看到我们的目标文件就是在1个LB的SO的话。

就在这样一个目录之下，我们就把这个目录下数据给弄，把这个文件给弄出来。那么这里就使用1个APP铺的一个指定。然后来表名这是。



![](img/4a477490ce41e63f66bd84d354bb5aed_30.png)

好，我们把它铺到我们的当前位位置之下。拖到这里以后的话，我们再来另开1个IDA来对我们倒出来这个SO文件进行一个分析。那么这么一来，可以获取到最好的一个分析效果，包括一些函数名字。

都是最为原始的一个情况。那在这里呃也是同样可以使用一个G，然后。基DVM来跳转到DVM的一个模式之下，可以看到DVN是一个导出的一个结构题。哎，虽然在这里找到。

但是我们还是哎不知道我们的这一个就是就说D一XY数学在哪。嗯，那么在此之前我们现在进行一个啊reb program，就是把它的一个位置和我们内存的位置进行一个对齐。好，我们看一下它DV是加载到这个地方。

41461000。那么在IDA中，我们也把它进行一个重定位。定位到这里。到这个地方好。那么这么定位完以后，哎，再重新加载完以后，这个静态分析ID那个D1个DVN地址已经到了这一个地方。哎。

和这里是对应的和这里是对应的。看一下这两个地址是不是一样的好，那么所以这样这么一来，我们在这样一个静态分析的S文件中所找到的一个UCDVM数据的话，和这里找到一个一个地址哎是一样的。那么这么一来。

需要寻址，需要编辑的时候就方便很多了。好，那么前面的话做前面这些都是一些准备操作。那么实际接下来的话，我们还是需要去想办法去找到这样一个地址。我们可以尝试进行一个搜索，能不能找到，或者说进行一个跳转。

哎，这都是不能够找到的。好，我们就这样哎，也是不行。所以在这里我们就要通过一些其他办法去找到这个地址到底是在哪一个地方。哎呀，我们来看一下这些函数，既然这些函数有调到的话。

那么实际上我们就只需要找到这几个函数，就能够找到它的一个这样的的一个地方了。首先我们分析道这个函数是一个openDX2的函数，我们可以尝试找这个函数。哎，结果找回到那既然如此。

我就跳到这个函数里面去找这个函数搜索它。因为这些函数的话不一定全部都有导出，所以当中的话只有某一些函数是有可能给留给我们企个参考的啊，我们这里送一个艾D table file也不行啊。

那么下面我们就来搜这个呃DVM table的话，那么里面哪个参数，第一个就是一个juusDF file了。好，我们搜索。那么这个时候找到了，找到以后，我们跳转过去。好，他原为是这样做的。

然后查找一个引用。我们来看一下哪一个地方呢是对我们的GDMtable来进行一个引用的那，引用的地方很多很多很多，对吧？我们就随便找一个呃，那么注意一下，由于前面这几个函数都找不到的话。

所以那么它的一个第二个有一个地方肯定不是导出的一个函数，也就是说肯定哎不是这些函数，肯定是这些函数，有可能是这个对吧？对吧哎我来看一下，对对一下错误信息，哎。

错误信息是一个point has already been added的。哎，不是这里，因为这里的信息的这个地方好，我们再来找一下。啊，这个地方对，也不是，对吧？我在找哎，这个也很像，但也不是。

那通过这样变理一下的话，我们就能够找到我们所需要的一个DVNtable。哎，知到这个地方名称已经对到关的 has already been added。

那么在这里我们就可以知道这个函数就对应着这个函数了。这个函是已对着这个函数，因为这里名称引对上好那么自然而然的来它里面的第一个参数。就对应的这里的第一个参数比个user d x文件的。

那么在这里可以看到，哎这个偏例址在这个地方，那么这个地址自然就是一个user de x的一个数据了。我们也进记一下记录。好，他有一个地址在这个地方哦呃，然后我们狙医院的一个地址又在这个地方。

然后两个进行一个相减。再得到330。那么在这里我们可以列出这样一条算式。当然这个试子的话，仅仅是对我这一台手机，或者说是在一个安卓4。4所编译出来的一个系统是生效的。在其他系统中的话。

他们的PE地址就可能不是这样一个数据了。那么这个时候的话就需要我们自己去重新进行一个寻找。那么在这里我们已经找到这个地址在这个地方了。那么就直接进行一个使用就可以了。好，我们再跳到这里我们的数据中，哎。

跳到这里这个这个地方。那么这里这个地址里面存放了就是我们一个user hasush table的一个数据了，就是一个user disP file数据里面的话是一个指针。

这个指针的话就指向一个hush table。pa又是是一个什么结构体呢？哎，我们可在过去进行一个分析好。然后里面再转一下。然后里面的话哎这是一个指针，前面的四个字节就表明了这个指针的值。

那么这个指针指向就是我们的这里的这样一个 table的一个结构。我们跳过去。这是是1DAEF20。那么跳过去以后哎，呈在一个结构体。起来了个数据。我们就可。于海涛一置在这一个地方。

我这里面就是我们的一个user has table的一个结构体。好，我们来看一下来看一下。首先第一个一个那个结构是那个inter型的一个table size结构。那么这里就说明了它总共有8。

就是table的一个大小是8。然后是一个number in，也就是也就是当前已经使用过的一个number数的一个大小唉。他说当前使用了4个number，然后下面如果是没有用到。

或者说是已经不用的要in呢是0个那么就在下面下面就是一个P的结构了，它指向它是一个的一个结构，它里面指向的这个地址。那么注意一下我们的1个PDXY文件的PTX和JR数据的话。

就是添加到这一个inice数据里面缩序了。好，那么下面的话就是其他的一些结构。好，那么在这里我们主要关注这一个结构，也就是哎这一个位置的一个历史的一个数据了。我们再把它给记录下来。

这是一个h in try P in twice的一个数据。然后它指向的一个地址的跨是1个711K3118。然后跳转到这里，就这个地址。那这个地址里面存放的数据的话。哎。

自然就是我们ha in项的数据里面就是第一个值是一个haush radio，第二个值是一个data数据而。啊这样的一个。里面的 value先不管。

那么它第一二个的一个data数据里面指向的就是1个PDX orJR格式的一个结构体了。不相信的话可以回头去看一下我们的一个DV heart table log的一个结构。

它里面就是把这样一个结构体给存到这个地方了。好，那么自然知道哎自然知道这些数据以后，我们就可以发现它里面总共有4个结构。然后然后你们的ing串中可以看到我们的data处于第二位，也就是说这是第一个结构。

然后第二个，然后第三个有第四个总共使用到4个。然后这里的这里哎这里的每一个都分别分别是1个DXOJR的结构体。那么在这里我们就以最后的一个结构体，也就是这样一个结构体，做一个示例来讲解一下如何去寻找。

注意一下，这是1个DXOJR的结构体，它的大小等于这里。这其中一个大小等于这样一个地方，71D10110，这是一个低端字节序的DEX加的结构体。我们跑到一个回去。好，DS加。好，转过去。

那么这样一个结构铁块就是对应着这一个结构体。那么它第一个呃第一个参数，或者说第一个结构的话是一个指向它加载的DX名称的一个数值。那么在这里就是这个地方，我们开过去看一下啊，这是名称748B6930。

哎开过去看一下哎data然APPCM9后APK点E那么很显然我们找个地方就己已经算找对了。因为这样一个结构体里面存放的就是我们的这个可的一个d文件数据。这是不明是我们已经找对了。哎，今天早队。

我们就开始对他进行一个进攻。来进行一个分析。符到这样一个结构，我们对它进行一个分析。那么第二个参数就是问它是不是d文件。哎，这里看一下哎，这里是ds文件，然后。然后下一个就是O to free。

就在这个位置，他说是不是可以释放，哎，不是能够暂时不能释望。好，那么既然现在它是1个DEX文件的话，我它的这一个参数是有效的。然后这一个参数是无效的。我们来找到这一个参数。

我用为由于一个内存对齐的关系的话，这个占四个字节，这个占两个字节，这个占两个字节，前面的话总共就占了8个字节。那么所以。所以这样一个第四个参数的话，它是一个指针在4个字节，它就占这几个数据。

然后下面的这样一个呃。PTFfi的话，它就占这个字节，里面数据是空的，哎，不能不能看，我就不用管。那么在这里我们就来看一下这一组数据，就是一个P proDXY一个数据，存放到这个位置去上的。哎。

它是到底指向什么样的内容，我们来找到他。这里也算一个记录。这个711F3B70。跳过去看一下。那么这里就是一个WDXY的一个数据，里面的话就有两个指针，一个是一个catch file量一个指针。哎。

这里是空的哎，空的话就证明它们我们的一文件名称。那么第二个指针的指向就是我们想要的1个DANDX的一个指针。对拆回他。那么在这里哎这里就是我们想要的1个DVMDX的一个数据了。哎，这个数据很重要。

为什么重要呢？我们来看一下它第一个就是我们的dify的一个数据。然后第二个就是这个des head的一个数据。当中的每一个哎都很有可能对我们的work有非常大的一个帮助。

我们先来看一下它的一个des的一个数据。des的话只像1个PDXYpe。好，我们来看一下des y。des file的话里面就是存放这些数据的那这些数据的话是经过一个处理过的哎。

里面可能还包含1个OPT head。假如我们想要获得OPT head的话，可以从desify来入手。假如不想的话，哎，直接取这一个head数据已就可以了。我这里我们就直接取这一个head数据。

就是这个地方。然后它这里是1个76290520。哎，是这样一个东西，是不是弄错了？前面。再来回头看一下。找到第一个数据来改一下先。575。163766。然后这里能找到一个这里。哦，好嗯。

这里这里来话他的几个dess头。只能说是他d头的话，在这已经被抹去了，已经变成一个无效的一个数据了。可以说。我这样子啊。既然这样一个但数据无效哈哎呦。你这被抹去以后的话。

我们就来尝试去其他地方来搞一下吧。只能说这个被他加密给干掉，我们来找到其他的一个ge in try。哎。太浪板了。那么既然如此，我们来找到它倒数的第二个呃这个DS隐串一串数据的话被可给抹去掉了。

或者说是非法。哎，我们找到这里。这你是第二遍演示的话，就做的快点。找到这里，然后再指向一个低锁接压的文件。把一个地址给记录下来。第一个参数是指向它的一个。起始地址，他加载了一个名称的起始地址。

就是也是一样一个7棒漆体的一个地址。然后第二个参数是1个DX orJR的一个参数。0表明它并不是1个DCX文件，所以这个参数无效。哎，这个参数是有效的，我们跳到这里。而且虽然这个参数是有效。

那么这个参数的话是指向一个JR的一个文件，我们跑到1个EDXJR那么在这里已经找到这个PGR文件啊，它第一个哎是一个一个的文件，接着是一个恰的一个，然后下面才是1个DAMDX的一个结构。

那么上面的这个结构长度的话是0324个字节，也就是说从这里到这里都是我们这个结构长度。那么下面这个哎下面这个就是我们那一个catch file了，我完了可以跳过去看一下它的名字。哎，是不是一个文件名称？

既然是文件名称，我们就来把它后面的1个DVNDX的数据给搞出来。嗯，这个是什么地方来着？我刚才跳转时候弄乱了啊，这一次什么。我们跳到这个地方为止。呃，应该是这里应该这里。

然后这里是这一个指针这是个DXJR结构体，前面的24个字节是加B串的结构，这个是指向一个名称的一个基础地址。那么它后面第第三个话就是一个指向DBNDX结构在这里。好，推过去。

那么这里就是1个DVMDEX的一个结构。在这个地方。好，那么这个结构题，它第一个参数是一个DXI参数，第二个参数是一个Phead的一个参数。我们找到一个Pbehead。在里面就存放着我们的一个干数据了。

可以看到TX035，对吧？然后前面还有它的1个OPT head头DY036。那么从这里我们就可以根据这样一个数据存在一个地方，把它内存把它内存中的数据给直接动出来了。

那么所以哎真知道在有有这样一个原理之后呢，我们就可以开始去尝试进行一个数据的一个动词，或者说把它的一个GR in里面的数据进行一个便利。然后根据我刚才的一个方法来把它的des文件数据给全部给输一遍。

哎把它的一个数据给动出来。那么在这里可以先跑到一个des数据中哎。然后 guess by。这是1个DX fine。第一个话是1个OPDheadather，也就是它OPT的header在这里。好。

那么下面的话就是一个其他头文件了。呃，这个壳的话就证明我刚证明我刚才所说过，它已经把真实的一个dess文件数据给磨掉了。就是它刚才我们第一次演示的样跳转过去的，可以看到它ds头的话是一个非法的。

那么这个时候话可能需要我们自己去进行一个重建。也就是把这一些数据啊这这个DX035啊，这个要重新自己给修上去，才能够进行一个修完了。我们再来回到这样1个DVMDX的中，这是我第一次搜索的时候。

就是第四个。选出来中所找到找到的DVN结构体。然后里面的第二个参数，理论上应该只能指向1个DS它的基始地址的。但是在这里哎已经被磨成这个鬼样子了。哎，已经变模成这样一个鬼样子了。

那么这个时候只能去通过一个脚本去进行一个修复，或者说是进行一个手动修复。

![](img/4a477490ce41e63f66bd84d354bb5aed_32.png)

哎，但是呢呃在这里的话，它也是有其他数据可以供我们去进行一个参考的。那么对于DVFDX中的话，比如说这个数据memory这个数据里面就很有可能就是存放着我们原始的一个呃DEX数据的地方。

有些可哎它下载完以后，它原始的一个没有被抹获的数据的话，很有可能就存放在这里。所以像这种找不到原始，或者说它再头被抹去情况的话，可以尝试去找一下这个结构体来把它的一个原始DX给动出来。

我们看一下这个结构体，在哪一个平移位置啊，这个但四个字节，这里也是四个，就是那么前面四个就在0叉10的字节。那么这里哎这是个也是在一个0叉110的个字节。所以mm map结构体。

它的一个起始地址在偏1为0320的这个地方。那么在这一个地就是我们的一个mm B map的里面数据，它第一个就是它的一个address，第二个就是一个长度。我们跟随这一个address跟过去看一下。哎。

就看到它原始的dess文件数据没有被修改过，没有被抹去过的一个数据呢。哎，就是在这个地方是像这种形式的。那么从这里开始这么快，就能够获得到它作为原始的一个ds文件数据了。对，这个壳是这样的。

对其他壳号有一些壳，这个只是空的就不能够通用了。好，我们在这里我们再看一下被它磨括S头的一个数据。大有兴趣的，可以和这个来对比一下是不是都是一样的。从这里开始是不是都一样的。对吧。

只是前面的这个DX035这一部分数据的框，都非他给干掉。哎，那么这里就是也这样一个口。或者说是这样一个建立DVMDEX进行一个脱壳的一个呃方法。那么在这里根据这样一条思路的话。

可以去写一个脱口脚本来自动的帮我们去完成上面的这一系列操作。然后包包括从一个内存中给动DAX文件，甚至是说把一个ds文件从内存中进行一个还原都可以。



![](img/4a477490ce41e63f66bd84d354bb5aed_34.png)

通过这样一个脚本来进行一个完成。我在这里这脚本我已经写好了。首先嗯注意一下，如果大家下面要用的话，要注意一下，把这个地址给改一下。

就是我前面所说的找这样1个GDNU的一个usD放的一个位置的一个地方改一下。那么在这里对于我来说，这个地址相对于GDV的偏移的话是330。那么下面大家自己的手机的话，可能不并不是这样一个地址。

那么这个时候希望大家能够自己去尝试去找一下，把这个地址给找下来，这个数据给改一下，哎，就能够给这脚本这中之常跑起来了。那么在这里我就尝一试跑一下脚本给动一下数据吧。



![](img/4a477490ce41e63f66bd84d354bb5aed_36.png)

![](img/4a477490ce41e63f66bd84d354bb5aed_37.png)

![](img/4a477490ce41e63f66bd84d354bb5aed_38.png)

![](img/4a477490ce41e63f66bd84d354bb5aed_39.png)

好，那么直接好小本选中等口。那么在这里的话，就里面就已经识别出里面总共有4个加载过的一个de数据了。前面两个话都是我自己去插入进去的。呃，就是一个expo的一个中的一个插入的数据。

那么后面两个的话就是可它本身大额数据。呃第一个的话是可原生的原本加载前的一个的一个可。那么这里的这个话就是它呃通过可以这里可就是第三个cook的话，就是它呃可解码以后的一个东西。

我们尝试着把这两个动出来看一下它的情况。哦，这里，我先当一个状子。来，看一下这有5个这有5个，这5个话对应着一个。我来打他。嗯嗯嗯，好像在这里。嘿，那么我们打个汤。进行一个打开。我们看一下呃。

编号为二的一个des文件数据的话，它是这个样子的。呃，无效蝶那它需要去提高新户才能进行一个加载。那我们就来。嗯，使用另外一个东西打开吧。好，打开看一下。那么看一下里面的一个classs数据文件。

大致的来浏览一下就可以了。那么里面只有一个class，就是它的一个application，其实就是它用来解渴用用到的的一个类文件。那么很多可它加载完以后，在内存中的结构的话也都是类似这个样子的。

第一个就是第一个第一个cookie。第一个可能的cook的话是可能入口点一个proces application。然后下面的话都是有效的一个有效的一个d文件数据。那么这里我们这一次的话。

我们都ge它为三的这个数据。ま。编号为3是6。

![](img/4a477490ce41e63f66bd84d354bb5aed_41.png)

好，我们在这里唉看一看一下，这里的话，它就识别出来5000多个classs文件了。那么这里的话这一个就是整一个壳的一个有效数据了。哎，我们已经看到这个脚本已经成功跑起来。那从它跑起来到脚本跑完的话。

还需要有一段时间。那么趁这一段时间的话，我就来讲一下我的脚本他是怎么工作的。嗯，首先还是一样，现在找到我我们的一个哈table的一个位置。



![](img/4a477490ce41e63f66bd84d354bb5aed_43.png)

就是这样一个user dXY的一个ush table的位置。找到完以后，嗯，我们来看一下ush table定义。这个定义的话和我们刚才在内存中哎在一个安卓源码中讲到的的一个结构的话是完全一样的。

因为是从这里操完的。第一个它作是一个table size numberumb还有什么之类的，把这个文件的结构给读出来，然后进行一个解析。

从里面的话就能够获取到根据我刚才演示的操作获取到所有DVM和JR的一个地址。

![](img/4a477490ce41e63f66bd84d354bb5aed_45.png)

![](img/4a477490ce41e63f66bd84d354bb5aed_46.png)

![](img/4a477490ce41e63f66bd84d354bb5aed_47.png)

获取完以后，那也就是获取到我们的1个DXY的地址啊。根据我们所选入的一个编号，获取DAMDES的一个地址，获取完以后呢，就对它存一个内存中来进行一个重构。我么这也重构的话，就包括。

一些呃可能贝可修过的一个plus的一个数据的一个重新修复一个定位之类的。然后我们这里就开始进行一个动。那么输出的目录话就保存在这个地方。也就是说接DXY数据的话就保存在这样1个UPK动的一个地方。

那么假如。

![](img/4a477490ce41e63f66bd84d354bb5aed_49.png)

![](img/4a477490ce41e63f66bd84d354bb5aed_50.png)

假如他有另外一个数据，也就是有呃有这样一个memory的一个数据。我们找到这个妈m里嗯。哎，假如他有这样一个memory met的一个数据的话，哎，那么这里他是说假如他找到这样一个数据的话。

就把这样一个memory脉的数据给动出来，给放到这个目录之下。

![](img/4a477490ce41e63f66bd84d354bb5aed_52.png)

嗯，对这一个。可来说的话，他这就能够找到，那么他就可以把多动处分析出来。

![](img/4a477490ce41e63f66bd84d354bb5aed_54.png)

那么通过这样一个从内存中对于我们的一个文件，1个DX文件的一个重构呢，来达到一个脱壳的一个效果。那么这里就是我这样一个脱壳脚本的一个呃作用了，那么总共才写了1000多行，挺少的一个代码，也挺简单的。

其实。那么上面的话这些就是涉及到一个呃内存中一个dess公fi的一个解析读取，然后进行一个定位。和这些操作哎都是在这里进行一个完成的。我这一个搞完以后的话，哎，就是一个成功。

就是弄出来一个完整的一个带数据了。哎，这就是这个脚本，如果有兴趣的话，可以自行去看一下，看一下这个脚本它是怎么编写的。我想看一下话还是能够学习到不少东西了。好。那么这里就是这样一个脚板操作。

那么下面的话我们就来等我们的1个IDA来完成它一个内存中动的一个效果。由于对于这个口来说，它动出来数度是比较大的，可以看到已经动出来60多了。



![](img/4a477490ce41e63f66bd84d354bb5aed_56.png)

![](img/4a477490ce41e63f66bd84d354bb5aed_57.png)

呃，整个可比较大，所以他画卡脚本的时候要卡比较多。哎，那么下面下面的话他就是说发现了额外的数据就是在ma mapping这里，他发现了额外数据，他问我是不是要动我们这里就选择是就把额外的数据给动出来。

那么这里个的一个后TS文件的话，就是我们哎刚才所分析出来的一个刚才所找出来的一个文件，也是我刚才手动找的第一个ds文件。那我们看到的话里面的ds图是非法的，是非法。我们在这里可以看一下。好，我以看一下。

那么在这里的话，我就尝试着自己去修了一下，然后一些呃相关的片移地址也尝试着去用脚本去修一下。大家看到吧？虽然他把一个des子头给抹去了，那么下面的话我也尝试着去改了一下了，其实。

那么在这里我们就来看一下我们打完以后能不能够进常的反命率，然后执行。我们看一下有不有胶来啊。好，那虽然整个。整1个D一S文件，整1个GAB套报出非常多错误，但还是说能够加载成功，然后进行一个解析啊。

可以看到，那么这里面的话哎报了很多错误，什么方法为，然后分析错误，分析错误什么之类的。那么这些都会影响到最终生成的。至于怎么修复的话，这个要等后面才能够讲得到。



![](img/4a477490ce41e63f66bd84d354bb5aed_59.png)

呃，在这里呃经过百个头文件进行一个修复以后的话，就把整一个S文件给弄出来了。哦，我们等一个JPJEB来分析完成。那么这样一个动出来的一个ds文件的话，就已经类似于原始的一个代码。呃。

也是可以去完成一个呃准确的一个分析的。好，我们等他来进行一个。等1个GEB还有做一个脚本来跑完。

![](img/4a477490ce41e63f66bd84d354bb5aed_61.png)

呃，那么现在ID的脚本已经跑完了，但是这硬B的话还是挂，只是挂了状态。因为我们就不打ITV直接关掉了。好，那么跑完以后，它就动出另外一个一柜组数据，这组数据就存放在这个地方。

那么这个的话就是这边原始没有被抹去投文件数据的一个ges文件。那么这个文件的话就是可以直接去进行一个使用的一个文件的。那么在这里我们就可以尝试着去利用这个文件来完成一个脱壳的一个操作。那么既然是脱壳。

哎我们那么我们就应该做一个脱壳相关的一个事情。里面话还有一些everer，就是没有办法打开之类。就是说这些类唉它没有办法加载。啊，这些可可能是它本身自带的，哎，或者说什么之类的都有可能。我们来看一下。

哦，1ML起宝项啊，但是它比可选了几个类。我说他自造了一个解一个别ation的地方。

![](img/4a477490ce41e63f66bd84d354bb5aed_63.png)

诶不等咗一边。好，我们来开始进行一个脱壳。在这里呃一个已经把一个正常但视文件给拖出来了。我这个调试也可以给关掉。那么这着接着我们就开始进行脱合吧。



![](img/4a477490ce41e63f66bd84d354bb5aed_65.png)

呃，托改的话就和上次讲到一样了。

![](img/4a477490ce41e63f66bd84d354bb5aed_67.png)

先还原动出原则DS。🎼好把它给还原为原始的一个smarile代码。那么这样这变的时候，如果是看到它没有报样错误的话，那就证明我们的一个动出来代码基本上是属于一个正确的。如果这里呃进行一个反变的时候。

它报出了任何错误的话，我们都说明我们的des文件是需要进一步的一个修复的。好，对下动察数据还有这么多都是原始的一个代码，我们给拷过来。然后就拷贝到这个smar代网上。然后进行一个覆盖。不开时候留意一下。

有些东西的话。有些地地方啊有些东西要注意一下的。那我们就等它一个。注册完成。ね。哎，大家注意一下这里。他完成一个application替换。啊，这个要记录下来，因为很重要这个提分。哎。

那么按照我们原始的一个操作的话，是需要去。买一个applicationation标签里面的这样一个东西，这是一个呃这个对方。里面的这样一个安卓链给删掉的话，我们就来把它删掉，来看一下发生什么事。好。

进行一个编译，然后重新安装执行。我们来等它一个安装执行完成。然后刷新安装。打上外壳。嗯。うん。然后打开mit好，哎，看到了吧？对他报了一个错误。哎，在这里实际上在我手机中下在显示的话。

就是成一个程序已经挂了，跑不起来。说没有办法去创建那个active in。这是为什么？就是按照我们以前这样直接替换ge方法也不行，还不能正常运行。那是为什么呢？

那是因为它里面的还有一个application没有修复。正因我们加可的时候，我们都可以看得到一些程序啊，可以把自己的的一个application的一个入口点给放到这个地方。那么假如原始这个程序。

就是这个AP文件，它本来就有一个application时候怎么办呢？它就可以通过一种方法给缓存起来，然后自己的可解完以后呢，再进行一个重构。那么在这里在这里这时候呢，我们这一个程序之所以跑步起来。

就是没有把把它原始的一个application给找出来了。那么要找出来的话，也是很简单的。我们只需要。



![](img/4a477490ce41e63f66bd84d354bb5aed_69.png)

去进行一个搜索。我们去搜嗯我们去搜这个地方。

![](img/4a477490ce41e63f66bd84d354bb5aed_71.png)

哎，每个自己写的一个applicationation的话，都需要。重写它的application标签，我们说一下。结果发现呢哎这一个baation就是他原来去写的一个dation数据。

而且从刚才复器上线的时候，我们已经看得到了。这里刚才上线的时候就完成了这样一个application的标签，并且替换前和替换后的一个application。它两个数据是不一样的，是不一样的。

所以在这种情况，我们就需要对一个原始的application进行一个修复。也就也就是说把当中按卓点亮的数据给替换成整一个程序原始application。由于哎这里替换后的一个一个入口点话是在这里。

我们就把这个东西给弄上去。然后再进行一个PE，然后安装。那么这样安装完以后，我们来看一下整个程序能不能够正常跑起来。啊，我们等它进行一个编译完成，然后安装。那么疫情下我可以在这里看得到。

那么这时候唉这时候。整一个程序就已经能够正常的加载来了。那么到此为止，哎，对于这个壳的脱壳算是一个完成了。使用在我们在这里的话使用到这么一个脚本来进行一个脱壳，然后把它图文件来进行一个相应的一个修复。

呃，这节课的话讲的地方可能有点多。那么大家的话到下面自己慢慢的去进行一个消化。好，那么我相下下面大家的话，可以尝试着去用我的这个脚本来看一下有没有能够拖一下其他壳。说有有些壳为有为什么能拖？

或者说有一些壳为什么不能拖？是不是我们拖的一个时机不对，或者说是不是需要改一下地方，那么我希望大家家在下面的话，紧去进行一个研究研究。



![](img/4a477490ce41e63f66bd84d354bb5aed_73.png)

那么这节课的话就到此为止了，谢谢大家。🎼悟空空。

![](img/4a477490ce41e63f66bd84d354bb5aed_75.png)