# i春秋学院 进阶篇 PHP代码审计 - P7：课程：SQL数字型注入 - 老网恋教父了 - BV1D7411S7vf

。大家好，我是virink。这节课给大家带来srcle数字型注入。嗯本节课主有一个内容。啊，s注入问题的审计。我们来看一下注入问题的审计。啊，首先是。折口注入。啊，他是一个。呃，查询数据库的。漏洞。啊。

注入的话就是让我们查到一些嗯不允许查到的信息。也就是嗯数据库的信息泄露。我们可以注入而查询到一些呃管理员信息。还有就是啊拿到数据库的权限啊，进而去渗透这个网站。一般注入有很多种。啊。

数字型字符型二次注入还有多种什么特殊的注入。Yeah。这边列出来的啊。是基本上的啊，但是。不完全吧。还可能存在其他的输入。然后我们这节课。嗯。我们还是选在代码上面给大家讲解。我们前面把握大局的时候。

我们就嗯看到了这个circle这个函数。

![](img/6fddf08b115564e08e477ad936ed1afe_1.png)

他就可能存在白帕。我们要怎么样去bypas呢？我们来仔细分析。啊，这个函数的功能就是将我们输入的这些。啊，制服。啊，进行。查找替换。把circle的一些。嗯，关键是。啊，把它将它替换掉。啊。

可以看到前面字符型的啊字符串啊都替换为sQ up。然后后面的符号还将。嗯，斜杠转化为双斜杠。然后是and号和。嗯，管道服这两个。啊，替换为空。呃，单引号也是替换为空。把分号和下划线都加一个。斜线斜杠。

Yeah。嗯。对里。嗯，就。哦，可以看出来这有一个绕过的地方了。啊。前面的这些替换。如果是。嗯，我们来写出来比较方便。比 the。如果是单纯的select，它就会被替换为色Q up。啊，如果。

我们用双竖线把它插入中间，组成这样的字符串。那么在搜索的时候，他就找不到这样的。好，就绕过了这一步。然后等他执行到这一步的时候，他就把双斜线啊替换掉了。然后他又会变回collect。也就是绕过了。啊。

slash以及这些支付串的限制。嗯，成功白pa一步。然后在单引号的时候。啊，因为我们输入的单引号都会经啊经过这个转移啊，经过stepack或者GBC去转移，添加一个斜杠。也就变成这样的形式。好。

这里我们再去替换，它就会变成单斜啊斜杠。啊，这里就存在两个绕过。那么我们既然找到了。他的。白pas了这个和Q up函数。那我们现在再来看哪里有注入点。啊，输入点的方式呢，我们可以便利这些文件。

也可以通过全局搜索它。啊，依然是。啊，使用全局搜索。啊，既然是端口语句。And this are from。啊，我们这里是用正则的方式搜索。好，中间随人一字符。From。后面是啊后面是well。

也可以是其他，他就搜索等于。于等于等于后面就是。我们的dora号do勒符号啊，基本上这样。我们去搜索。啊，就搜索到了第一句。我们点开它在message details这个页面。啊。

这里ID这个变量啊直接就进入了啊字符串。啊，没有单引号在旁边。啊，就pay这是一个。啊，数字型的注入，我们再往上看ID从哪里来。啊，ID是get来的。好，get来的ID经过了s up的过滤。

那么我们这里。啊，相信大家都可以。知道。这里存在了一个注入。而且是任意输入。啊，不需要白pas单引号。啊，这里我们就开始构造。ID等于等于什么？假如是一。然后。我们是用联合注入。You耐。

哎然后 she。横树县。后面是s。然后输入啊，这里是就开始是字段。1。2。单等。然后是pro。我们依然是双数险。呃，我们要搜索什么信息，查询什么信息。那等那。有。搜索管理员的信息，我们要找到他的密码。

啊，我们这里不知道它有多少个字段啊，我们需要测试啊，测试字段呢一般有两种。大概有两种就是。啊，用out by去测试它的字段还有多少个字段。啊，第二个种呢就是。呃，大概弄七八个字段，啊，慢慢删减。好。

我这里就使用三点的方法。45678，我们用8个去删点它。啊，一般这里是用错误的，也就是-一或者0。或者另一个比较大的数。那么你要找sssage。一天了。



![](img/6fddf08b115564e08e477ad936ed1afe_3.png)

好，我们在留言页面搜索。点开留言。然后他有这里这有一条留言信息，我们他的链接就是detail，这里显示。然后我们在这里就是。是ID这里注入。复制这一句。好的这里。也行。啊，这里。他就要返回错误。

说我们的字符啊，字段不匹配跟删减法。再见。再谢。好，现在我们就成功看有4个字段。好，我们就要在这里。找到他的信息。啱万五。要去怎么样去找呢？就比如二这里，我们要找passicpassword这个数据。

啊，他不存在，他说。啊，或者是他这里有规律。Yeah。嗯。他将什么转化呃OR。被他过滤了。好，我们这里用上双数线。



![](img/6fddf08b115564e08e477ad936ed1afe_5.png)

因为没有发错，我们再回到代码。嗯。管理员的密码它是什么字段呢？我们可以从它的安装目录的结构里面去看。好。它是addmin下划线pa。那么我们可以看到他这里有一个下划线，这就有点难办了。

因为我们前面看它的过滤，它将下划线转化为斜杠，加了一个斜杠斜杠下划线，我们就不可以直接去使用呃，它的。不算。那么这里要怎么办呢？啊，我们再数一数它有三个字段。



![](img/6fddf08b115564e08e477ad936ed1afe_7.png)

然后前面它有4个字段。啊，那我们可以可以测试用星号。加一个字段。星号表示我们搜索它的命它的字段啊，星号的多个字段就3个，然后再加上一个，还有刚好4个。好，我们来搜索。Yeah。好，成功的就输出了。啊。

他的命的信息。啊，用户名及密码。啊，当然这里是比较巧合的地方了。啊因为啊。他的命啊管理员的这个。表它的字段只有3个啊，如果他超出了4个，我们就不能用星号了，不匹配。所以说我们就只能。算是一个巧合。

这里就。成功注入拿到了管理员的这个密码，我们去解密，就可以破解他的密码进行后台登录。

![](img/6fddf08b115564e08e477ad936ed1afe_9.png)

好，我们要找到了。嗯。挺好。这样就是陪了。我们找到之后，我们要修复它怎么修复呢？有两种。啊，两种都要修复，我们这里加一个单引号。加一个单引后嗯就让他。没办法绕过。然后QQ也有漏洞，我们也要把它修复。



![](img/6fddf08b115564e08e477ad936ed1afe_11.png)

我们不能把它切换为空，一样，把它切换为字符串。那么这样我们就不能够。用了。不能够注入了。好。本节课的内容嗯基本上就是问题讲了一下。我们来总结一下。啊，前面我们根据啊把握大局的时候。

我们可以看到它有一个soQ的。呃，函数，然后我们在找它的注入点的时候，可以找到呃在message里跳它有1个ID。直接带入嗯搜索。啊，过滤的时候，我们就把它白pass掉了。嗯，本节课啊就到这里结束了啊。

谢谢大家的观看。😊。

![](img/6fddf08b115564e08e477ad936ed1afe_13.png)