# 经典15年i春秋渗透测试系统化教程 - P6：课时6 🔓 HTTP方法漏洞利用

在本节课中，我们将要学习HTTP方法漏洞的原理与利用方式。这是一种因Web服务器配置不当，开启了不安全的HTTP方法（如PUT、DELETE等）而导致的漏洞。掌握此漏洞的利用，有助于理解服务器配置安全的重要性。

![](img/9afe1cb3a8f7517d123a30f92bac6022_1.png)

## 概述

HTTP不安全方法漏洞，通常指Web服务器开启了如**PUT**（上传）、**DELETE**（删除）等具有写操作权限的HTTP方法。其危害在于，攻击者可能利用这些方法在服务器上上传、修改或删除网页、脚本及文件，从而破坏服务器内容，甚至控制服务器。

虽然部分企业可能因服务器未赋予实际写入权限而不将其视为漏洞，但这本质上仍是一种安全风险。

## 漏洞原理与利用条件

上一节我们介绍了漏洞的基本概念，本节中我们来看看成功利用此漏洞需要满足哪些具体条件。

利用HTTP方法漏洞（特别是PUT方法上传文件）需要同时满足两个核心条件：

![](img/9afe1cb3a8f7517d123a30f92bac6022_3.png)

1.  **服务器开启了不安全的HTTP方法**（如PUT）。
2.  **目标目录或网站具有写入权限**。

![](img/9afe1cb3a8f7517d123a30f92bac6022_5.png)

缺少任何一个条件，攻击都无法成功。

![](img/9afe1cb3a8f7517d123a30f92bac6022_7.png)

![](img/9afe1cb3a8f7517d123a30f92bac6022_9.png)

## 检测HTTP方法

![](img/9afe1cb3a8f7517d123a30f92bac6022_11.png)

在尝试利用之前，首先需要检测目标服务器是否开启了不安全的HTTP方法。

以下是检测HTTP方法的常用方式：

*   **使用扫描器**：许多Web漏洞扫描器（如AWVS、AppScan）会将其识别为“HTTP不安全方法”漏洞。
*   **使用专用工具**：例如使用`OPTIONS`方法探测。通过发送`OPTIONS`请求到网站根目录，可以查看服务器支持的HTTP方法列表。其中，**PUT**和**DELETE**属于危险方法。
    *   示例命令：`curl -X OPTIONS http://target-site/ -i`

## 漏洞利用实战演示

在确认漏洞存在后，我们将进入实战环节，演示如何利用PUT方法上传文件。

![](img/9afe1cb3a8f7517d123a30f92bac6022_13.png)

### 环境准备与检测

首先，确保测试环境（如IIS）的WebDAV扩展处于启用状态，这是支持PUT等方法的前提。通过扫描工具对目标地址（例如 `http://192.168.1.10:8090`）进行扫描，确认显示了**PUT**等方法，即表明漏洞存在。

### 尝试直接上传Webshell

![](img/9afe1cb3a8f7517d123a30f92bac6022_15.png)

直接尝试上传一个ASP后缀的Webshell文件。

1.  选择ASP文件并点击上传。
2.  结果发现，服务器不允许直接上传`.asp`、`.php`、`.jsp`等可执行脚本文件。即使尝试上传，文件也会被重命名为`.txt`等安全后缀。

![](img/9afe1cb3a8f7517d123a30f92bac6022_17.png)

这表明仅有PUT方法和写入权限还不够，需要绕过文件类型限制。

![](img/9afe1cb3a8f7517d123a30f92bac6022_19.png)

### 结合解析漏洞绕过限制

![](img/9afe1cb3a8f7517d123a30f92bac6022_20.png)

![](img/9afe1cb3a8f7517d123a30f92bac6022_21.png)

![](img/9afe1cb3a8f7517d123a30f92bac6022_22.png)

当直接上传脚本文件被阻止时，可以尝试结合服务器解析漏洞。例如，利用IIS的解析特性（对分号后的内容不解析）。

![](img/9afe1cb3a8f7517d123a30f92bac6022_23.png)

![](img/9afe1cb3a8f7517d123a30f92bac6022_24.png)

![](img/9afe1cb3a8f7517d123a30f92bac6022_25.png)

以下是利用步骤：

![](img/9afe1cb3a8f7517d123a30f92bac6022_26.png)

![](img/9afe1cb3a8f7517d123a30f92bac6022_27.png)

![](img/9afe1cb3a8f7517d123a30f92bac6022_28.png)

1.  **上传文本文件**：首先，使用PUT方法上传一个内容为Webshell代码，但后缀为`.txt`的文件（例如 `shell.asp;.txt`）。此步骤可以成功。
2.  **重命名文件**：然后，利用**MOVE**方法（对应HTTP的`MOVE`请求）将文件重命名。目标是利用IIS解析漏洞，将文件名改为可被解析的形式，例如从 `shell.asp;.txt` 改为 `shell.asp`。
    *   注意：此步骤成功的前提是服务器同时支持MOVE方法，并且存在相应的解析漏洞。
3.  **访问Webshell**：重命名成功后，访问 `http://target-site/shell.asp`，如果服务器以ASP脚本解析该文件，则Webshell执行成功，攻击者即可获得服务器控制权。

![](img/9afe1cb3a8f7517d123a30f92bac6022_29.png)

![](img/9afe1cb3a8f7517d123a30f92bac6022_30.png)

**核心要点**：整个利用链依赖于 **PUT方法**（上传）、**写入权限**、**MOVE方法**（重命名/移动）与**服务器解析漏洞**（如IIS分号解析）的共同作用。

![](img/9afe1cb3a8f7517d123a30f92bac6022_31.png)

![](img/9afe1cb3a8f7517d123a30f92bac6022_32.png)

![](img/9afe1cb3a8f7517d123a30f92bac6022_33.png)

## 总结

![](img/9afe1cb3a8f7517d123a30f92bac6022_34.png)

![](img/9afe1cb3a8f7517d123a30f92bac6022_35.png)

![](img/9afe1cb3a8f7517d123a30f92bac6022_36.png)

本节课中我们一起学习了HTTP方法漏洞的利用。

![](img/9afe1cb3a8f7517d123a30f92bac6022_37.png)

![](img/9afe1cb3a8f7517d123a30f92bac6022_38.png)

![](img/9afe1cb3a8f7517d123a30f92bac6022_39.png)

我们首先了解了漏洞的成因与危害，即服务器不当开启了PUT、DELETE等危险HTTP方法。接着，明确了利用该漏洞的两个必要条件：开启不安全方法和具备写入权限。然后，我们学习了如何使用OPTIONS方法或扫描器来检测漏洞。最后，通过详细的实战演示，剖析了如何利用PUT方法上传文件，并如何结合MOVE方法与IIS解析漏洞，绕过文件类型限制，最终成功上传并执行Webshell。

![](img/9afe1cb3a8f7517d123a30f92bac6022_40.png)

![](img/9afe1cb3a8f7517d123a30f92bac6022_41.png)

请牢记，安全的服务器配置应禁用不必要的HTTP方法，并对可写目录进行严格的权限控制与安全审计。