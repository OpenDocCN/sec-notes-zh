![](img/fe7c5eb11b15b90741c2c0e042420518_1.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_2.png)

# iæ˜¥ç§‹é›¶åŸºç¡€å…¥é—¨Androidé€†å‘ - P31ï¼šè¯¾æ—¶6 soåŠ å£³æ–‡ä»¶ä¿®å¤ ğŸ›¡ï¸

![](img/fe7c5eb11b15b90741c2c0e042420518_4.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_5.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_6.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_7.png)

åœ¨æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åˆ†æå’Œä¿®å¤ä¸€ä¸ªç»è¿‡åŠ å£³æ··æ·†çš„SOæ–‡ä»¶ã€‚æˆ‘ä»¬å°†ä»¥â€œå¸®å¸®â€åŠ å›ºåçš„APKæ–‡ä»¶ä¸ºä¾‹ï¼Œæ¼”ç¤ºä»è¯†åˆ«åŠ å£³ç‰¹å¾ã€åŠ¨æ€è°ƒè¯•åˆ°æœ€ç»ˆä¿®å¤SOæ–‡ä»¶çš„å®Œæ•´æµç¨‹ã€‚

![](img/fe7c5eb11b15b90741c2c0e042420518_9.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_11.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_12.png)

---

![](img/fe7c5eb11b15b90741c2c0e042420518_13.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_15.png)

## æ¦‚è¿°ï¼šåŠ å£³SOæ–‡ä»¶çš„åˆ†ææŒ‘æˆ˜

![](img/fe7c5eb11b15b90741c2c0e042420518_17.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_18.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_20.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_22.png)

ä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†å¯¹æ··æ·†ä¸ä¸¥é‡çš„SOæ–‡ä»¶è¿›è¡Œè¿˜åŸçš„æ–¹æ³•ã€‚æœ¬èŠ‚ä¸­æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•å¤„ç†æ··æ·†æ›´ä¸¥é‡çš„åŠ å£³SOæ–‡ä»¶ã€‚

![](img/fe7c5eb11b15b90741c2c0e042420518_24.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_25.png)

åŠ å£³çš„SOæ–‡ä»¶åœ¨åŠ è½½æ—¶ï¼Œå…¶åŸå§‹æ•°æ®æ˜¯åŠ å¯†æˆ–å‹ç¼©çš„ï¼Œåªæœ‰åœ¨è¿è¡Œæ—¶æ‰ä¼šåœ¨å†…å­˜ä¸­è§£å¯†å¹¶å¡«å……ã€‚è¿™ä½¿å¾—é™æ€åˆ†æå·¥å…·ï¼ˆå¦‚IDAï¼‰æ— æ³•ç›´æ¥æ‰“å¼€å’Œåˆ†æã€‚æœ¬èŠ‚è¯¾çš„æ ¸å¿ƒç›®æ ‡å°±æ˜¯å­¦ä¹ å¦‚ä½•å°†å†…å­˜ä¸­è§£å¯†åçš„SOæ•°æ®â€œè½¬å‚¨â€å‡ºæ¥ï¼Œå¹¶è¿›è¡Œä¿®å¤ï¼Œä½¿å…¶èƒ½å¤Ÿè¢«é™æ€åˆ†æå·¥å…·æ­£å¸¸è¯†åˆ«ã€‚

![](img/fe7c5eb11b15b90741c2c0e042420518_27.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_28.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_30.png)

---

![](img/fe7c5eb11b15b90741c2c0e042420518_32.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_34.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_36.png)

## è¯†åˆ«åŠ å£³SOæ–‡ä»¶çš„ç‰¹å¾ ğŸ•µï¸

![](img/fe7c5eb11b15b90741c2c0e042420518_38.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_39.png)

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­ä¸€ä¸ªSOæ–‡ä»¶æ˜¯å¦è¢«åŠ å£³ã€‚ä¸€ä¸ªæœ€æ˜æ˜¾çš„ç‰¹å¾æ˜¯**æ–‡ä»¶å¤§å°è¿œå°äºå…¶æ˜ å°„åˆ°å†…å­˜åçš„å¤§å°**ã€‚

![](img/fe7c5eb11b15b90741c2c0e042420518_40.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_41.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_43.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_45.png)

æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ†æSOæ–‡ä»¶çš„`Program Header`ï¼ˆç¨‹åºå¤´ï¼‰æ¥è§‚å¯Ÿã€‚ä»¥ä¸‹æ˜¯å…³é”®æ­¥éª¤ï¼š

1.  ä½¿ç”¨`010 Editor`ç­‰å·¥å…·æŸ¥çœ‹SOæ–‡ä»¶çš„`Program Header`ã€‚
2.  é‡ç‚¹å…³æ³¨`LOAD`ç±»å‹çš„æ®µï¼ˆSegmentï¼‰ï¼Œå®ƒä»¬è´Ÿè´£å°†æ–‡ä»¶å†…å®¹åŠ è½½åˆ°å†…å­˜ã€‚
3.  å¯¹æ¯”`FileSiz`ï¼ˆæ–‡ä»¶ä¸­çš„å¤§å°ï¼‰å’Œ`MemSiz`ï¼ˆå†…å­˜ä¸­çš„å¤§å°ï¼‰ã€‚

![](img/fe7c5eb11b15b90741c2c0e042420518_47.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_49.png)

å¦‚æœå‘ç°æŸä¸ª`LOAD`æ®µçš„`MemSiz`æ˜¾è‘—å¤§äº`FileSiz`ï¼Œä¾‹å¦‚ï¼š
*   `FileSiz = 0x52C`
*   `MemSiz = 0x1548`

![](img/fe7c5eb11b15b90741c2c0e042420518_51.png)

è¿™ä¸­é—´çš„å·®å€¼ï¼ˆ`0x1548 - 0x52C`ï¼‰å°±æ˜¯è¿è¡Œæ—¶è§£å¯†åå¡«å……çš„æ•°æ®ã€‚è¿™æ˜ç¡®è¡¨æ˜è¯¥SOæ–‡ä»¶æ˜¯åŠ å£³çš„ã€‚

![](img/fe7c5eb11b15b90741c2c0e042420518_53.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_55.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_56.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_57.png)

---

![](img/fe7c5eb11b15b90741c2c0e042420518_59.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_61.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_63.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_65.png)

## åŠ¨æ€è°ƒè¯•ä¸å†…å­˜è½¬å‚¨ ğŸ§ª

![](img/fe7c5eb11b15b90741c2c0e042420518_67.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_69.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_71.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_73.png)

æ—¢ç„¶æ•°æ®åœ¨è¿è¡Œæ—¶è§£å¯†ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå°†è§£å¯†åçš„SOæ¨¡å—ä»å†…å­˜ä¸­æå–å‡ºæ¥ã€‚è¿™éœ€è¦ä½¿ç”¨åŠ¨æ€è°ƒè¯•æŠ€æœ¯ã€‚

![](img/fe7c5eb11b15b90741c2c0e042420518_75.png)

ä»¥ä¸‹æ˜¯è¿›è¡ŒåŠ¨æ€è°ƒè¯•å’Œå†…å­˜è½¬å‚¨çš„ä¸»è¦æ­¥éª¤ï¼š

![](img/fe7c5eb11b15b90741c2c0e042420518_77.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_79.png)

### 1. ç¯å¢ƒå‡†å¤‡ä¸é™„åŠ è¿›ç¨‹

![](img/fe7c5eb11b15b90741c2c0e042420518_81.png)

é¦–å…ˆï¼Œå®‰è£…ç›®æ ‡APKï¼Œå¹¶é…ç½®IDAè¿›è¡Œè°ƒè¯•ã€‚

![](img/fe7c5eb11b15b90741c2c0e042420518_83.png)

*   åœ¨IDAçš„è°ƒè¯•å™¨è®¾ç½®ï¼ˆDebugger -> Process optionsï¼‰ä¸­ï¼Œå‹¾é€‰ **â€œSuspend on library load/unloadâ€**ã€‚è¿™èƒ½ä½¿ç¨‹åºåœ¨åŠ è½½SOæ–‡ä»¶æ—¶è‡ªåŠ¨æš‚åœï¼Œä¾¿äºæˆ‘ä»¬ä¸‹æ–­ç‚¹ã€‚
*   é™„åŠ åˆ°ç›®æ ‡è¿›ç¨‹ï¼Œå¹¶åœ¨`linker`ï¼ˆç³»ç»Ÿé“¾æ¥å™¨ï¼‰ä¸­å¯»æ‰¾åˆé€‚çš„æ–­ç‚¹ä½ç½®ã€‚

![](img/fe7c5eb11b15b90741c2c0e042420518_85.png)

### 2. å®šä½è§£å¯†æ—¶æœº

![](img/fe7c5eb11b15b90741c2c0e042420518_87.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_88.png)

SOæ–‡ä»¶åŠ è½½æ—¶ï¼Œ`linker`ä¼šè°ƒç”¨å…¶åˆå§‹åŒ–å‡½æ•°ï¼ˆå¦‚`init`æˆ–`init_array`ï¼‰ã€‚åŠ å£³SOçš„è§£å¯†æ“ä½œé€šå¸¸åœ¨è¿™äº›åˆå§‹åŒ–å‡½æ•°ä¸­å®Œæˆã€‚

![](img/fe7c5eb11b15b90741c2c0e042420518_90.png)

*   åœ¨`linker`ä¸­å®šä½è°ƒç”¨`init`/`init_array`å‡½æ•°çš„ä»£ç é™„è¿‘ã€‚
*   åœ¨è¯¥è°ƒç”¨**è¿”å›å**çš„åœ°å€è®¾ç½®æ–­ç‚¹ã€‚è¿™æ ·å¯ä»¥åœ¨SOæ–‡ä»¶å®Œæˆè§£å¯†åä¸­æ–­æ‰§è¡Œï¼Œæ­¤æ—¶å†…å­˜ä¸­çš„SOæ•°æ®å·²æ˜¯æ˜æ–‡ã€‚

![](img/fe7c5eb11b15b90741c2c0e042420518_91.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_92.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_94.png)

### 3. æ‰§è¡Œè½¬å‚¨

![](img/fe7c5eb11b15b90741c2c0e042420518_96.png)

å½“ç¨‹åºåœ¨è§£å¯†åçš„æ–­ç‚¹å¤„åœä¸‹æ—¶ï¼Œå°±å¯ä»¥è¿›è¡Œå†…å­˜è½¬å‚¨äº†ã€‚

![](img/fe7c5eb11b15b90741c2c0e042420518_98.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_100.png)

*   è·å–SOæ¨¡å—åœ¨å†…å­˜ä¸­çš„**åŸºå€**å’Œ**å¤§å°**ã€‚
*   ä½¿ç”¨IDAè„šæœ¬æˆ–æ’ä»¶ï¼ˆä¾‹å¦‚`dump_so.py`è„šæœ¬ï¼‰å°†æŒ‡å®šå†…å­˜åŒºåŸŸçš„æ•°æ®ä¿å­˜åˆ°æ–‡ä»¶ä¸­ã€‚
    ```python
    # ç¤ºä¾‹è„šæœ¬æ€è·¯
    start_address = 0x75520000  # SOå†…å­˜åŸºå€
    size = 0x32123             # SOæ¨¡å—å¤§å°
    dump_data = get_bytes(start_address, size) # è¯»å–å†…å­˜
    open(â€œdumped.soâ€, â€œwbâ€).write(dump_data)   # ä¿å­˜æ–‡ä»¶
    ```

![](img/fe7c5eb11b15b90741c2c0e042420518_102.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_104.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_106.png)

---

![](img/fe7c5eb11b15b90741c2c0e042420518_108.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_110.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_112.png)

## ä¿®å¤è½¬å‚¨çš„SOæ–‡ä»¶ ğŸ”§

![](img/fe7c5eb11b15b90741c2c0e042420518_114.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_116.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_117.png)

ç›´æ¥ä»å†…å­˜è½¬å‚¨çš„SOæ–‡ä»¶ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸º`dumped.so`ï¼‰è¿˜ä¸èƒ½è¢«IDAæ­£å¸¸åˆ†æï¼Œä¸»è¦å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š
1.  **å†…å­˜å¯¹é½é—®é¢˜**ï¼šæ–‡ä»¶ä¸­çš„åç§»ä¸å†…å­˜ä¸­çš„åç§»æ²¡æœ‰æ­£ç¡®å¯¹åº”ï¼Œä¸­é—´å­˜åœ¨â€œç©ºæ´â€ã€‚
2.  **èŠ‚åŒºå¤´ï¼ˆSection Headerï¼‰ç¼ºå¤±**ï¼š`linker`åŠ è½½æ—¶ä¸ä¾èµ–èŠ‚åŒºå¤´ï¼Œå› æ­¤è½¬å‚¨çš„æ•°æ®ä¸­ä¸åŒ…å«è¿™éƒ¨åˆ†ä¿¡æ¯ï¼Œä½†é™æ€åˆ†æå·¥å…·éœ€è¦å®ƒã€‚

![](img/fe7c5eb11b15b90741c2c0e042420518_119.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_121.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_123.png)

æˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸“é—¨çš„ä¿®å¤å·¥å…·æ¥è§£å†³è¿™äº›é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯ä¿®å¤æµç¨‹ï¼š

![](img/fe7c5eb11b15b90741c2c0e042420518_125.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_127.png)

1.  **å†…å­˜å¯¹é½ä¿®å¤**ï¼š
    *   ä½¿ç”¨å·¥å…·ï¼ˆå¦‚æœ¬èŠ‚è¯¾æ¼”ç¤ºçš„ä¿®å¤å·¥å…·ï¼‰çš„â€œä¿®å¤å†…å­˜å¯¹é½â€åŠŸèƒ½ã€‚
    *   è¯¥åŠŸèƒ½ä¼šæ ¹æ®`Program Header`ä¸­çš„ä¿¡æ¯ï¼Œé‡æ–°æ’åˆ—æ•°æ®ï¼Œå¡«å……å¯¹é½äº§ç”Ÿçš„â€œç©ºæ´â€ï¼Œç”Ÿæˆä¸€ä¸ªåˆæ­¥ä¿®å¤çš„æ–‡ä»¶ï¼ˆå¦‚`repaired_step1.so`ï¼‰ã€‚

![](img/fe7c5eb11b15b90741c2c0e042420518_128.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_130.png)

2.  **é‡å»ºèŠ‚åŒºå¤´**ï¼š
    *   ä½¿ç”¨åŒä¸€å·¥å…·çš„â€œé‡å»ºèŠ‚åŒºâ€åŠŸèƒ½ã€‚
    *   è¯¥åŠŸèƒ½ä¼šæ ¹æ®å·²ä¿®å¤çš„æ–‡ä»¶æ•°æ®ï¼Œé‡æ–°ç”Ÿæˆå®Œæ•´çš„`Section Header`ï¼Œå¹¶é™„åŠ åˆ°æ–‡ä»¶æœ«å°¾ï¼Œæœ€ç»ˆå¾—åˆ°å¯åˆ†æçš„SOæ–‡ä»¶ï¼ˆå¦‚`repaired_final.so`ï¼‰ã€‚

![](img/fe7c5eb11b15b90741c2c0e042420518_132.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_133.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_134.png)

ä¿®å¤å®Œæˆåï¼Œä½¿ç”¨IDAæ‰“å¼€æœ€ç»ˆçš„æ–‡ä»¶ï¼Œå³å¯çœ‹åˆ°æ‰€æœ‰å‡½æ•°å’Œä»£ç éƒ½å·²æ­£å¸¸æ˜¾ç¤ºï¼Œå¯ä»¥è¿›è¡Œé™æ€åˆ†æäº†ã€‚

![](img/fe7c5eb11b15b90741c2c0e042420518_136.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_137.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_139.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_141.png)

---

![](img/fe7c5eb11b15b90741c2c0e042420518_142.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_144.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_145.png)

## æ€»ç»“ ğŸ“

![](img/fe7c5eb11b15b90741c2c0e042420518_147.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_149.png)

æœ¬èŠ‚è¯¾ä¸­æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†åŠ å£³SOæ–‡ä»¶çš„ä¿®å¤æ–¹æ³•ã€‚æ ¸å¿ƒæµç¨‹å¯ä»¥æ¦‚æ‹¬ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š

![](img/fe7c5eb11b15b90741c2c0e042420518_151.png)

1.  **è¯†åˆ«ç‰¹å¾**ï¼šé€šè¿‡å¯¹æ¯”æ–‡ä»¶å¤§å°ä¸å†…å­˜å¤§å°ï¼Œåˆ¤æ–­SOæ˜¯å¦åŠ å£³ã€‚
2.  **åŠ¨æ€è½¬å‚¨**ï¼šé™„åŠ è°ƒè¯•è¿›ç¨‹ï¼Œåœ¨SOè§£å¯†å®Œæˆåï¼Œå°†å…¶ä»å†…å­˜ä¸­å®Œæ•´è½¬å‚¨å‡ºæ¥ã€‚
3.  **é™æ€ä¿®å¤**ï¼šä½¿ç”¨å·¥å…·ä¿®å¤è½¬å‚¨æ–‡ä»¶çš„å†…å­˜å¯¹é½å¹¶é‡å»ºèŠ‚åŒºå¤´ï¼Œä½¿å…¶èƒ½è¢«é™æ€åˆ†æå·¥å…·è¯†åˆ«ã€‚

![](img/fe7c5eb11b15b90741c2c0e042420518_153.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_155.png)

![](img/fe7c5eb11b15b90741c2c0e042420518_157.png)

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¿®å¤åçš„SOæ–‡ä»¶ä¸»è¦ç”¨äºé™æ€åˆ†æï¼Œé€šå¸¸ä¸èƒ½ç›´æ¥æ›¿æ¢åŸæ–‡ä»¶è¿è¡Œï¼Œå› ä¸ºå…¶æ–‡ä»¶å¸ƒå±€å¯èƒ½ä¸åŸå§‹åŠ å£³é€»è¾‘ä¸å…¼å®¹ã€‚æ­¤å¤–ï¼Œè®¸å¤šåŠ å›ºæ–¹æ¡ˆï¼ˆå¦‚â€œå¸®å¸®â€ï¼‰å«æœ‰å¼ºå¤§çš„åè°ƒè¯•æœºåˆ¶ï¼Œåœ¨å®é™…æ“ä½œä¸­å¯èƒ½éœ€è¦å…ˆç»•è¿‡è¿™äº›æ£€æµ‹ã€‚æŒæ¡æœ¬è¯¾çš„æ–¹æ³•æ˜¯æ·±å…¥åˆ†æå’Œå¯¹æŠ—SOåŠ å›ºçš„é‡è¦åŸºç¡€ã€‚