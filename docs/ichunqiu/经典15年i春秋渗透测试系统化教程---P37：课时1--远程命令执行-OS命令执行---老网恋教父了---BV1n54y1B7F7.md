# 经典15年i春秋渗透测试系统化教程 - P37：课时1  远程命令执行-OS命令执行 - 老网恋教父了 - BV1n54y1B7F7

好，我们这节课来讲解一下呃远程代码执行。那么远程代码执行的内容比较多哈，我们就。嗯，实验的话，我单独有些实验我单独就是做成来视频，单独放在这个教程里面，到时候大家自己看一下。啊。

首先我们来看一下呃呃这个远程那码执行啊，它是什么样的一个。呃过程啊一个原原理。原态代码执行它指的是啊代码在处理输入输出的时候没有进行严格控制，而导致了用户可以构造参数，包含这个执行代码在服务器上执行。

从而获取这个服务器权限。它是发生在这个应用应用程序的这个楼器层上面的一个安全类的。啊，让我们看一下命令执行，它这个里面远程担保这行，它是一个统参哈。那么它这下面又分很多啊，有命令执行啊。有偏置片命的啊。

有教务命令执行等等。有很多很多。那么我们就呃一个一个的讲解吧，命令什么是命令执行的？命令执行，它就是系统命令执行这个。是指执行是指这个应用程序啊，在穿录的这个命令一行的参数过滤不一。啊。顾虑不已。

导致这个恶意用户能够控制什么，最终执行这个。魅力进入系统。导致严重的破坏高危类的。那么sell是这个系统的这个用户界面，徐国进那个始也都知道啊，用户一般我们跟sll打交道，sll是跟徐打交道。

在跟跟系统的这个内核啊，我们执行一些脚本啊啊命令啊，都是由sell来完成。提供了用户与内核之间一个交汇的一个接口。他接受用户输入的命令，并把它传入到这个内核中去执行。

那么实际上需要它是只是一个命令解释器，由它来解释，有用户输入的命令，并且由他们来进行发生内核。不仅如此，需要有自己的编程语言，用于这个命令的编辑，它允许用户编写有需要命令组成的这个程序啊，需要编程语言。

它具有这个普通编程语言的很多特点。比如。它也有这个选款结构和这个分支结构啊，用这种语言编写的语言编写的是要与其他应用应用程序具有相同这个。相同同样的接这个效果啊相同的这个效果。啊。

这个就是命令呃命令执行。这个需要你相进那个是有有b啊BSH那么也同样有命令执行内的。后面到时候我会在网上，我会单独拉一个实例给大家讲解啊，操作系统另来个操作系统远程也有远程命令执行内的。啊。

也是相当影响的，相当于微软的0MS08。46啊微远。嗯，也影响很大啊，总结一句话哈啊，面临执行的总结一句话啊嗯一句话什么呢？你像嗯。是他就相当一个翻译官，就说例如我跟老外打交道，跟美国人打交道。

我说中文别的说eng该。啊，两个来说，你如果不能应该历是，他也不懂中文，那两个人说话听不懂啊，不知道说什么啊，有什么呢文采呢？那有这个需要，需要就消会中间的翻译来源啊，它是这样的一个过程。

我认为什么是命令执行啊，这个差不多。是自己可以看一下啊，参数。那么接下看一下命令调用啊，和带路命令进入这个管道交互操作系统在执行命令的过程中，通过调用其他的这个。

外部程序啊跟文件系统啊进行这个应用程序与基础命令层的这个操作系统交互执行程序。命令行提供一个执行交付的一个数据，数据的这个输输入输出啊，跟踪调试执行。那么他的有什么特点呢？这个命令执行有什么特点呢？

它的特点是实际上就虽要是一个命令的一个解释器，就是翻译官。它解释有用户输入输入的这个命令，并且有他们传输的内核。不仅如此，需要有自己的啊，这个这个跟前面差不多。

大家自看一下windows有没有windows的哈啊，虽然它这个是inux。那么windows下有什么的有CMD就是我们在这个地方啊这个命令提示符CMD还有windows这个b。

那么这个在嗯08以下的系统它是没有这个那么到了就是0308到了08系统之后，2012它多增加了这个pay啊啊也是一种嗯命令执行，将编程语言样它执行过来命令可以写程序啊，写。

PG的啊一些脚本啊嗯都是通过这个来完成，还有点那头，还有点那头。啊，它也就是一个命令航模式，那么inux也同样也有这个啊图形界面跟这个命令黄模式啊，那么图形界面简称就是GY啊。

就简称内选来看一下它这个它这个选构inux我都知道啊，贝啊，它主要是做什么用的倍数也出了高过度，远程命令执行的的。你可以看一下。那我们用的最多的还是这个吧。对不对？其他的这个几个在你那个上面很少用的。

没要用。但是我们主要目前主要用的这个什么？因为这个另那个是。嗯，他这个税啊它有很多这个不同的版本哈那主要的有有这些，就是被上啊，它有是这个GNU这个。可能X是碎了。

有这个来这个默认的就进那个操作线默认是碎了，默认是碎了。就我们用的就是这个，嗯其他的就几几乎很少用。我们看一下所有的，为什么说应该说这些默认是这个呢？它有一个重要的一个特性啊，重要的特性是什么？

它自身就是一个解释性的一个程序设计语言啊，需后程序这个设计语言，它支持绝大多数的高级语言中能见到的一个程序元素，例如函数变量数组啊，程序控制结构。这就是它的一个为什么要用sll，它是嗯它的一个特点。啊。

接让我们看一下这个嗯什么是微博命令执行啊，这个我们在渗头测试过程中用的多啊，什么是微微博这个命令执行呢？那么这个一般在我们这个拉到微博是要提倡的时候啊，就你就要用用到这方面的啊，微博命令执行。

帮看一下这里所写的。我们常建的ABPHBGSB等脚本解释性。语言以及近起兴起的语言像配偶啊这等等这些语言是由于我们代码写的不严顺，不严谨，没有进行过安全过滤。

就是安全的这个代码审计啊啊所造成的一个bug命令执行的种给我们网上带来一定的安全风险，给路天生有一个课程直接。那么许多微博这个脚本语言，它支持动态执行，在这个运行时候生成的一个代码配置。

那么这种特写是允许开发者创建，可根据各种数据和条件动态来修改其中的代代代码的应用。如果用户输入和并并没有经过。危险注入执行代码检查筛选过滤动态这个执行代码中。那么从写权限变成可执行权限的利用。

那么攻击者就可以提交专门设计设计的这个输入代码，并且破坏原有的数据。那么服务器在执行路侵者的者的命令。就我们可以各造自己的对攻击者来讲，可以各造自己的这个。呃，路侵的命令来进行执行啊。

非法命令来进行执行系统的一些。Me。那么嗯这个是嗯我们用的嗯在针对这个渗透过程中，在提重过程用的比较多哈。你有微不需的就是我命令执行。下面一个就是数据库命令执行。数据库命令执行。

我们在提转过程中也是用了很多的。在我们拉到微博设查时间之后，呃，找网站的这个数据库连接账号密码，连接上去之后啊，通过微博设连接上去之后，我们就可以通过嗯数据库连接数据库连接。

我们就可以执行一些非法的一些操作例如对数据库进行删删除。删除啊。呃，插路啊。咨行呀等等都可以操作啊。留后美啊都可以的这是数据库秘密执行。刚才还有第三方面软件明临事情啊。

那么现在这个第三方面软件这个不安全了，越来越多的这方被这个挖掘出来了。你像举个例子，像第三方远程一区的人有很多的。有色维啊什么嗯其他的一些精衣料啊等等。反正很多的应用软件都存在相应的那个印出来的啊。

我像本迪体车来了啊。读写操作啊。D来了这个内容啊等等，还有一些。输入法。远菜线像以前那个。うんん。只能ABC一些，包括我样的输入法，直接系统自带的。一些内种直接可以。那VN是2000的是。不需要这个。

直接可以绕过这个删这个登录的这个账号密码啊，直接跳到系统里面建一个账号，这是相当相当危险的。这些命临之行。在命令执行你你做过三套厕所，这个用绿膜的一些扫描器啊，一扫一搭片，好多系统都存在这个命令执行。

那，接着我们来看一下啊，像我们设G跟我们就是相关的，就是一般都是对这个脚本方面。那么接下来我们看一下PSHP命令执系。那么前端这个PSHP命令注入攻击。那么PCPSP命令注入这个攻击流段。

是我们目前这个PSP应用程序最常见的一个脚本内容之一。那么国内居名的这个外部应用程序像DJDDCMS啊，PSHPCMS等等。那这个是用在。用类相当多的哈，happy wind。那么这些曾经都出现过这个。

没吃的味种。后面那个字看一下吧，我就不念了。那么PSP这个命令注入啊，它的这个主要嗯存在的原因啊，这个漏洞原因是微博应用程序员在这个应用这个PSP语言中啊。一些具有这个命令执行功能的一些函数啊。

给用户提交的数据内容啊是没有经过严格的这个过滤带入这个带入这个函数中去执行这而造成的这个内容。嗯，举个例子，这举了一个例子，当黑客提交数据内容，我向网站目录写1个PSP文件的时候啊。

对我们写1个PSP文件的时候，就可以通过这个命令输入攻击内存啊，可以写入1个PSP后面啊，这样的话就可以拉到这个连接一下啊，直接可以拉到维不碎了。好，我们来看一下这个命令执行的这个函数。

就是在PSP中啊，就可以执行可以实现执行外部程序和函数的命令。执行的这些函数一般的包括5个函数啊，当然还有其他的一些啊最常见的5个最常见的5个。首际先我们来看一下sstem。那么这个函数。

它是可以这个用的用的最多了哈，相那多了，它是可以用来这个执行一个外部应用程序，并并将相应的这个执行结果输出啊。这个是它的一个格式。那么其中这个comment就是我们这执行的这个命令啊。这个狼。啊。

李通杠VR2它是主要是采功命令直行后的一个状状态的一个值。那么一般按照我们程序员的想法，那么命令执行函数它主要的作用是通过这个执行命令函数啊与微博应用程序进行一个交互性的一个作用啊，交互一个作用。

那我们在网站的地址之后啊，当我们去。执行嗯接一个参数的是，执行这个程序员想要的一个效一个一个结果。但是他忽略了这个什么。这个黑K这个攻击就是利用你这个方法，他可以。之前还个想要的一些系统没。

简要的一些形能。也就说通过外部应用程序来执行外部的应用程啊，应用程序啊啊，外部的这个程序和汇对系统命令。举例子，外部程序啊想要通过这个函数获取目录文件内容。那么可以通过什么？这趟大马去。来实现。

本来本来就是说他通过网站的这个页面啊来知道当前的这个。当前的这个路径啊，完中了一些路一些路径猎目录啊猎目录。但是他忽略了一些其他的一些情况。啊。他他他这里写的很清楚啊，LS跟为L就是列目。

结果结果嗯根具的来讲，它可以在这个后面加一个这个。加一个这个符啊，他可以在这里嗯例如。右手内幕把右手AD添加一个账号，或者再改一下密码，改入车密码，而paswd落车，而且是修改密码。啊。

在这在这后面执行命你，不对，我问一下。在这里啊执行这样的mate start光A端查看当前连接等的是吧，都是可以的这个。他忽略的一些嗯一些过滤啊，那么我们在这里给大家演示一下吧。呃，举个例子啊。

DV打不雷嗯，我在这里，你看看这里有吗？战马鞋了吗？你写在这里吧。Yeah。嗯。Oh。Yeah。Yeah。Yeah。是。退了点PSP吧。能拖到这个熏机的。然，我们看一下当前的这个虚拟机的IP地址。

101我们来打开。かた。う。お。あ。Yes。我去8080。Yeah。Yeah。Yes行。Yeah。你来看下第三行那一错嗯哎。搞错了。呃，这个地方要几个参所。

你看它这个获取我们DRR就是我们得写的一个内容给这个。这个这个变量。嗯，在这里点R，你看。DRR他现在没用啊，要是举个例子，我们现在例如输入一个东西给他DR或者1个DR。那么这个直直接是嗯给他一个什么。

LLS杠AL那么LS在这个杠L这个因为是我是。windows系统这个命令是在inux系统上面运行的，windows绝对是运行不了。那么我们在这里举个例子，DRR是吧？啊，这个可以是吧，大更S。What。

等我好，我们可以看一下它这个变形啊，主月的我就这个DRR吧。点二是吧。那这个时候我们再去看一下。Yeah。嗯。Yeah。Yes。好，我们看一下。Yeah。Okay。Okay。对呀。儿子也不错。Yeah。

那这样吧应该没问题。你们看一下这趟代码。Yeah。嗯，我们把它。放在这个里面。Okay。Okay。

![](img/ebbc13944f02d7c500212f4fcb18bf4a_1.png)

Yes。

![](img/ebbc13944f02d7c500212f4fcb18bf4a_3.png)