# iæ˜¥ç§‹é›¶åŸºç¡€å…¥é—¨Androidé€†å‘ - P2ï¼šè¯¾æ—¶2 è°ƒè¯•æ–¹æ³•åŠSmaliæ–‡ä»¶ç»“æ„ ğŸ“±

![](img/cf495bfa417e2038cf8bee4cba13d2a2_1.png)

åœ¨æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ Androidå¼€å‘çš„åŸºç¡€çŸ¥è¯†ï¼Œå¹¶é‡ç‚¹ä»‹ç»å¦‚ä½•è°ƒè¯•Androidåº”ç”¨ä»¥åŠç†è§£Smaliæ–‡ä»¶çš„ç»“æ„ã€‚æˆ‘ä»¬å°†ä»åˆ›å»ºä¸€ä¸ªç®€å•çš„â€œHello Worldâ€åº”ç”¨å¼€å§‹ï¼Œé€æ­¥æ·±å…¥åˆ°ä»£ç çš„åç¼–è¯‘ã€ä¿®æ”¹å’Œè°ƒè¯•è¿‡ç¨‹ã€‚

## æ¦‚è¿°

![](img/cf495bfa417e2038cf8bee4cba13d2a2_3.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_4.png)

æœ¬èŠ‚è¯¾å°†åˆ†ä¸ºå‡ ä¸ªéƒ¨åˆ†ï¼šé¦–å…ˆï¼Œæˆ‘ä»¬å°†è§£å†³ä¸ŠèŠ‚è¯¾é—ç•™çš„Android SDKå®‰è£…é—®é¢˜ï¼›æ¥ç€ï¼Œæˆ‘ä»¬å°†é€šè¿‡Android Studioåˆ›å»ºä¸€ä¸ªåŸºç¡€çš„åº”ç”¨ç¨‹åºï¼›ç„¶åï¼Œæˆ‘ä»¬ä¼šåˆ†æAPKæ–‡ä»¶çš„æ„æˆï¼Œå¹¶ä»‹ç»Smaliè¯­è¨€ï¼›æœ€åï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•å¯¹åº”ç”¨è¿›è¡Œåç¼–è¯‘ã€ä¿®æ”¹å’Œè°ƒè¯•ã€‚

![](img/cf495bfa417e2038cf8bee4cba13d2a2_6.png)

---

![](img/cf495bfa417e2038cf8bee4cba13d2a2_8.png)

## Android SDKå®‰è£…é—®é¢˜è§£å†³ ğŸ› ï¸

![](img/cf495bfa417e2038cf8bee4cba13d2a2_10.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_12.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_13.png)

ä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†è¯¾ç¨‹æ¦‚è¿°ï¼Œæœ¬èŠ‚ä¸­æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•è§£å†³Android SDKå®‰è£…è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„é—®é¢˜ã€‚

![](img/cf495bfa417e2038cf8bee4cba13d2a2_14.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_15.png)

å®‰è£…Android SDKæ—¶ï¼Œå¹¶éæ‰€æœ‰åŒ…éƒ½éœ€è¦å®‰è£…ã€‚é€šå¸¸ï¼Œåªéœ€å®‰è£…é»˜è®¤é€‰ä¸­çš„åŒ…å³å¯ã€‚ç­‰å¾…ç»¿è‰²è¿›åº¦æ¡å®Œæˆåï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹å¹¶å‹¾é€‰ç¼ºå¤±çš„ç»„ä»¶ï¼Œç‚¹å‡»å®‰è£…å³å¯ã€‚

![](img/cf495bfa417e2038cf8bee4cba13d2a2_17.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_19.png)

å¦‚æœå› ç½‘ç»œæˆ–ä»£ç†è®¾ç½®é—®é¢˜å¯¼è‡´ä¸‹è½½å¤±è´¥ï¼Œå¯ä»¥å°è¯•è®¾ç½®ä»£ç†ã€‚åœ¨Android Studioçš„ `Tools` -> `Options` ä¸­ï¼Œå¯ä»¥é…ç½®ä»£ç†åœ°å€å’Œç«¯å£ã€‚

---

![](img/cf495bfa417e2038cf8bee4cba13d2a2_21.png)

## åˆ›å»ºç¬¬ä¸€ä¸ªAndroidåº”ç”¨ï¼šHello World ğŸŒ

![](img/cf495bfa417e2038cf8bee4cba13d2a2_23.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_24.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_26.png)

ç°åœ¨ï¼Œæˆ‘ä»¬æ­£å¼å¼€å§‹æ•™ç¨‹ã€‚ç»å¤§å¤šæ•°ç¨‹åºå‘˜çš„ç¬¬ä¸€ä¸ªç¨‹åºéƒ½æ˜¯â€œHello Worldâ€ã€‚æœ¬èŠ‚æˆ‘ä»¬å°†ä½¿ç”¨Android Studioæ¥åˆ›å»ºå®ƒã€‚

![](img/cf495bfa417e2038cf8bee4cba13d2a2_28.png)

æˆ‘ä»¬ç»Ÿä¸€ä½¿ç”¨Android Studioè¿›è¡Œå¼€å‘ã€‚è¯·ç¡®ä¿ç½‘ç»œç¯å¢ƒè‰¯å¥½ï¼Œä»¥ä¾¿é¡ºåˆ©ä¸‹è½½ä¾èµ–åŒ…ã€‚

![](img/cf495bfa417e2038cf8bee4cba13d2a2_30.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_32.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_33.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_35.png)

ä»¥ä¸‹æ˜¯åˆ›å»ºæ–°é¡¹ç›®çš„æ­¥éª¤ï¼š

1.  æ‰“å¼€Android Studioï¼Œé€‰æ‹© `Start a new Android Studio project`ã€‚
2.  åœ¨å¼•å¯¼çª—å£ä¸­ï¼Œå¡«å†™åº”ç”¨åç§°ï¼ˆApplication Nameï¼‰ï¼Œä¾‹å¦‚â€œHelloWorldâ€ã€‚
3.  å¡«å†™åŒ…åï¼ˆPackage Nameï¼‰ï¼Œè¿™æ˜¯åº”ç”¨åœ¨ç³»ç»Ÿä¸­çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚
4.  é€‰æ‹©é¡¹ç›®å­˜æ”¾è·¯å¾„ã€‚
5.  é€‰æ‹©æœ€ä½æ”¯æŒçš„Androidç‰ˆæœ¬ï¼ˆMin SDKï¼‰ï¼Œä¾‹å¦‚API 15ï¼ˆAndroid 4.0.3ï¼‰ã€‚
6.  é€‰æ‹©ä¸€ä¸ªåˆå§‹çš„Activityæ¨¡æ¿ï¼Œç„¶åç‚¹å‡» `Finish`ã€‚

![](img/cf495bfa417e2038cf8bee4cba13d2a2_37.png)

é¡¹ç›®æ„å»ºå®Œæˆåï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªåŒ…å«â€œHello Worldâ€æ–‡æœ¬å’ŒæŒ‰é’®çš„ç•Œé¢ã€‚ç‚¹å‡»è¿è¡ŒæŒ‰é’®ï¼ˆç»¿è‰²ä¸‰è§’å½¢ï¼‰å³å¯åœ¨æ¨¡æ‹Ÿå™¨æˆ–çœŸæœºä¸Šè¿è¡Œåº”ç”¨ã€‚

![](img/cf495bfa417e2038cf8bee4cba13d2a2_39.png)

---

## Androidé¡¹ç›®ç»“æ„è§£æ ğŸ—‚ï¸

ä¸Šä¸€èŠ‚æˆ‘ä»¬åˆ›å»ºäº†ç¬¬ä¸€ä¸ªåº”ç”¨ï¼Œæœ¬èŠ‚ä¸­æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹Androidé¡¹ç›®çš„ç›®å½•ç»“æ„ã€‚

![](img/cf495bfa417e2038cf8bee4cba13d2a2_41.png)

ä¸€ä¸ªAndroidé¡¹ç›®ä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š

![](img/cf495bfa417e2038cf8bee4cba13d2a2_43.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_45.png)

*   **`java` ç›®å½•**ï¼šå­˜æ”¾é¡¹ç›®çš„Javaæºä»£ç ã€‚
*   **`res` ç›®å½•**ï¼šå­˜æ”¾èµ„æºæ–‡ä»¶ï¼Œå¦‚å¸ƒå±€ï¼ˆ`layout`ï¼‰ã€å­—ç¬¦ä¸²ï¼ˆ`values`ï¼‰ã€å›¾ç‰‡ï¼ˆ`drawable`ï¼‰ç­‰ã€‚
*   **`AndroidManifest.xml` æ–‡ä»¶**ï¼šæ¯ä¸ªAPKéƒ½å¿…é¡»æœ‰çš„æ ¸å¿ƒæ–‡ä»¶ï¼Œç”¨äºå£°æ˜åº”ç”¨çš„åŸºæœ¬å±æ€§ã€æƒé™å’Œç»„ä»¶ï¼ˆå¦‚Activityï¼‰ã€‚

ç¼–è¯‘ç”Ÿæˆçš„APKæ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªZIPå‹ç¼©åŒ…ã€‚æˆ‘ä»¬å¯ä»¥ç”¨å‹ç¼©å·¥å…·æˆ–åç¼–è¯‘å·¥å…·æŸ¥çœ‹å…¶å†…å®¹ã€‚

ç¼–è¯‘å‰åæ–‡ä»¶çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š
*   `java` ç›®å½•çš„ä»£ç è¢«ç¼–è¯‘æˆ `classes.dex` æ–‡ä»¶ã€‚
*   `res` ç›®å½•çš„èµ„æºè¢«ç¼–è¯‘åˆ° `resources.arsc` ç­‰æ–‡ä»¶ä¸­ã€‚
*   `AndroidManifest.xml` è¢«ç¼–è¯‘ä¸ºäºŒè¿›åˆ¶æ ¼å¼ã€‚

![](img/cf495bfa417e2038cf8bee4cba13d2a2_47.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_49.png)

ä½¿ç”¨åç¼–è¯‘å·¥å…·ï¼ˆå¦‚Android Killerï¼‰æ‰“å¼€APKï¼Œå¯ä»¥çœ‹åˆ° `classes.dex` è¢«åç¼–è¯‘æˆäº† **Smali** ä»£ç ã€‚Smaliæ˜¯Android Dalvikè™šæ‹Ÿæœºçš„å¯„å­˜å™¨è¯­è¨€ï¼Œæ˜¯Javaå­—èŠ‚ç çš„ä¸€ç§äººç±»å¯è¯»çš„è¡¨ç¤ºå½¢å¼ã€‚åœ¨Androidé€†å‘ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦åˆ†æå’Œä¿®æ”¹çš„å°±æ˜¯Smaliä»£ç ã€‚

![](img/cf495bfa417e2038cf8bee4cba13d2a2_51.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_53.png)

---

## Activityä¸å¸ƒå±€åŸºç¡€ ğŸ–¼ï¸

ç†è§£äº†é¡¹ç›®ç»“æ„åï¼Œæœ¬èŠ‚æˆ‘ä»¬æ¥çœ‹çœ‹æ„æˆç”¨æˆ·ç•Œé¢çš„æ ¸å¿ƒç»„ä»¶ï¼šActivityã€‚

![](img/cf495bfa417e2038cf8bee4cba13d2a2_55.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_57.png)

Activityä»£è¡¨ä¸€ä¸ªåº”ç”¨çª—å£ã€‚ä¸€ä¸ªActivityè¦è¿è¡Œï¼Œå¿…é¡»åœ¨ `AndroidManifest.xml` ä¸­æ³¨å†Œã€‚

![](img/cf495bfa417e2038cf8bee4cba13d2a2_59.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_61.png)

æ³¨å†ŒActivityçš„æ ¼å¼å¦‚ä¸‹ï¼š
```xml
<activity android:name=".MainActivity">
    <intent-filter>
        <action android:name="android.intent.action.MAIN" />
        <category android:name="android.intent.category.LAUNCHER" />
    </intent-filter>
</activity>
```
å…¶ä¸­ï¼Œ`android:name` æŒ‡å®šActivityçš„ç±»åã€‚`<intent-filter>` ä¸­çš„ `MAIN` å’Œ `LAUNCHER` è¡¨ç¤ºè¯¥Activityæ˜¯åº”ç”¨çš„å…¥å£ã€‚

![](img/cf495bfa417e2038cf8bee4cba13d2a2_63.png)

Activityçš„ç•Œé¢å¸ƒå±€ç”± `res/layout` ç›®å½•ä¸‹çš„XMLæ–‡ä»¶å®šä¹‰ã€‚åœ¨Activityçš„Javaä»£ç ä¸­ï¼Œé€šè¿‡ `setContentView(R.layout.activity_main)` æ–¹æ³•å°†å¸ƒå±€ä¸Activityå…³è”èµ·æ¥ã€‚

![](img/cf495bfa417e2038cf8bee4cba13d2a2_65.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_67.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_69.png)

---

![](img/cf495bfa417e2038cf8bee4cba13d2a2_71.png)

## åŠ¨æ‰‹å®è·µï¼šåˆ›å»ºä¸ä¿®æ”¹Activity âœ¨

![](img/cf495bfa417e2038cf8bee4cba13d2a2_73.png)

ç†è®ºéœ€è¦ç»“åˆå®è·µï¼Œæœ¬èŠ‚æˆ‘ä»¬å°†åŠ¨æ‰‹åˆ›å»ºä¸€ä¸ªæ–°çš„Activityå¹¶ä¿®æ”¹å…¶å†…å®¹ã€‚

![](img/cf495bfa417e2038cf8bee4cba13d2a2_75.png)

ä»¥ä¸‹æ˜¯åˆ›å»ºä¸€ä¸ªæ–°Activityçš„æ­¥éª¤ï¼š

![](img/cf495bfa417e2038cf8bee4cba13d2a2_77.png)

1.  åœ¨ `res/layout` ç›®å½•ä¸‹å³é”®ï¼Œåˆ›å»ºæ–°çš„å¸ƒå±€æ–‡ä»¶ï¼ˆå¦‚ `activity_hello.xml`ï¼‰ã€‚
2.  åœ¨ `java` ç›®å½•ä¸‹åˆ›å»ºå¯¹åº”çš„Javaç±»ï¼ˆå¦‚ `HelloActivity`ï¼‰ï¼Œå¹¶ç»§æ‰¿ `AppCompatActivity`ã€‚
3.  åœ¨æ–°Activityçš„ `onCreate` æ–¹æ³•ä¸­ï¼Œè°ƒç”¨ `setContentView(R.layout.activity_hello)` å…³è”å¸ƒå±€ã€‚
4.  åœ¨ `AndroidManifest.xml` ä¸­æ³¨å†Œè¿™ä¸ªæ–°çš„Activityã€‚

![](img/cf495bfa417e2038cf8bee4cba13d2a2_79.png)

è‹¥æƒ³åœ¨ä¸»Activityä¸­å¯åŠ¨æ–°çš„Activityï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼š
```java
Intent intent = new Intent(MainActivity.this, HelloActivity.class);
startActivity(intent);
```

![](img/cf495bfa417e2038cf8bee4cba13d2a2_81.png)

æˆ‘ä»¬è¿˜å¯ä»¥ä¿®æ”¹ç•Œé¢å…ƒç´ ï¼Œä¾‹å¦‚ä¸ºä¸€ä¸ªæŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶æ¥ä¿®æ”¹æ–‡æœ¬æ¡†çš„å†…å®¹ï¼š
```java
Button myButton = findViewById(R.id.my_button);
EditText myEditText = findViewById(R.id.my_edit_text);

![](img/cf495bfa417e2038cf8bee4cba13d2a2_83.png)

myButton.setOnClickListener(new View.OnClickListener() {
    @Override
    public void onClick(View v) {
        myEditText.setText("æ–°æ–‡æœ¬å†…å®¹");
    }
});
```

![](img/cf495bfa417e2038cf8bee4cba13d2a2_85.png)

---

## Smaliæ–‡ä»¶ç»“æ„è¯¦è§£ ğŸ“„

å¼€å‘åŸºç¡€å·²ç»ä»‹ç»å®Œæ¯•ï¼Œç°åœ¨æˆ‘ä»¬å°†é‡ç‚¹è½¬å‘é€†å‘åˆ†æçš„æ ¸å¿ƒâ€”â€”Smaliä»£ç ã€‚

![](img/cf495bfa417e2038cf8bee4cba13d2a2_87.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_88.png)

Smaliæ–‡ä»¶æœ‰å›ºå®šçš„æ ¼å¼ã€‚æˆ‘ä»¬ä»¥ä¹‹å‰åˆ›å»ºçš„ `HelloActivity` å¯¹åº”çš„Smaliæ–‡ä»¶ä¸ºä¾‹è¿›è¡Œåˆ†æã€‚

ä¸€ä¸ªå…¸å‹çš„Smaliæ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š

![](img/cf495bfa417e2038cf8bee4cba13d2a2_90.png)

```
.class <è®¿é—®æƒé™> <ç±»å>;
.super <çˆ¶ç±»>;
.source <æºæ–‡ä»¶å>

![](img/cf495bfa417e2038cf8bee4cba13d2a2_91.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_93.png)

# å­—æ®µå®šä¹‰
.field ...

![](img/cf495bfa417e2038cf8bee4cba13d2a2_95.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_97.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_99.png)

# æ–¹æ³•å®šä¹‰
.method <è®¿é—®æƒé™> <æ–¹æ³•å>(<å‚æ•°ç±»å‹>)<è¿”å›ç±»å‹>
    .registers <å¯„å­˜å™¨æ•°é‡> # å£°æ˜æœ¬æ–¹æ³•ä¸­ä½¿ç”¨çš„å¯„å­˜å™¨æ€»æ•°
    <æŒ‡ä»¤é›†> # æ–¹æ³•çš„å®é™…æ‰§è¡ŒæŒ‡ä»¤
.end method
```

![](img/cf495bfa417e2038cf8bee4cba13d2a2_101.png)

**å…³é”®å…ƒç´ è§£æï¼š**

![](img/cf495bfa417e2038cf8bee4cba13d2a2_103.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_105.png)

*   **`.class`**ï¼šå®šä¹‰ç±»ï¼Œä¾‹å¦‚ `.class public Lcom/example/HelloActivity;`ã€‚åœ¨Smaliä¸­ï¼Œç±»åä»¥ `L` å¼€å¤´ï¼ŒåŒ…åä¸­çš„ç‚¹ç”¨ `/` ä»£æ›¿ï¼Œæœ€åä»¥ `;` ç»“å°¾ã€‚
*   **`.super`**ï¼šæŒ‡å®šçˆ¶ç±»ã€‚
*   **`.source`**ï¼šå¯¹åº”çš„æºJavaæ–‡ä»¶åã€‚
*   **`.method` / `.end method`**ï¼šå®šä¹‰ä¸€ä¸ªæ–¹æ³•å—ã€‚
*   **å¯„å­˜å™¨**ï¼šSmaliä½¿ç”¨å¯„å­˜å™¨ï¼ˆv0, v1, p0ç­‰ï¼‰å­˜å‚¨æ•°æ®ã€‚p0é€šå¸¸ä»£è¡¨ `this` å¯¹è±¡ã€‚
*   **ç±»å‹æè¿°ç¬¦**ï¼š
    *   åŸºæœ¬ç±»å‹ï¼š`Z` (boolean), `B` (byte), `S` (short), `C` (char), `I` (int), `J` (long), `F` (float), `D` (double), `V` (void)
    *   å¯¹è±¡ç±»å‹ï¼š`Lpackage/name/ObjectName;` (ä¾‹å¦‚ `Ljava/lang/String;`)
    *   æ•°ç»„ç±»å‹ï¼š`[` (ä¸€ç»´æ•°ç»„ï¼Œä¾‹å¦‚ `[I` è¡¨ç¤º `int[]`)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_107.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_109.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_110.png)

**æ–¹æ³•è°ƒç”¨ç¤ºä¾‹ï¼š**
`invoke-virtual {v0}, Landroid/widget/TextView;->setText(Ljava/lang/CharSequence;)V`
è¿™è¡Œä»£ç è¡¨ç¤ºè°ƒç”¨ `v0` å¯„å­˜å™¨æ‰€æŒ‡å‘å¯¹è±¡ï¼ˆä¸€ä¸ªTextViewï¼‰çš„ `setText` æ–¹æ³•ï¼Œå‚æ•°ç±»å‹ä¸º `CharSequence`ï¼Œè¿”å›ç±»å‹ä¸º `void`ã€‚

![](img/cf495bfa417e2038cf8bee4cba13d2a2_112.png)

---

![](img/cf495bfa417e2038cf8bee4cba13d2a2_114.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_116.png)

## ä¿®æ”¹ä¸è°ƒè¯•Smaliä»£ç  ğŸ”§

![](img/cf495bfa417e2038cf8bee4cba13d2a2_118.png)

ç†è§£äº†Smaliç»“æ„åï¼Œæœ¬èŠ‚æˆ‘ä»¬å­¦ä¹ å¦‚ä½•ä¿®æ”¹å¹¶è°ƒè¯•å®ƒï¼Œè¿™æ˜¯é€†å‘å·¥ç¨‹çš„å…³é”®æ­¥éª¤ã€‚

![](img/cf495bfa417e2038cf8bee4cba13d2a2_120.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_122.png)

**1. ä¿®æ”¹Smaliä»£ç **
æˆ‘ä»¬å¯ä»¥ç›´æ¥ä¿®æ”¹åç¼–è¯‘åçš„Smaliæ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œæ‰¾åˆ°è®¾ç½®æ–‡æœ¬çš„ä»£ç ï¼Œä¿®æ”¹å…¶å­—ç¬¦ä¸²å¸¸é‡ã€‚å­—ç¬¦ä¸²åœ¨Smaliä¸­é€šå¸¸ä»¥UTF-8ç¼–ç å½¢å¼å­˜åœ¨ã€‚å¯ä»¥ä½¿ç”¨å·¥å…·ï¼ˆå¦‚Android Killerå†…çš„å­—ç¬¦ä¸²è½¬æ¢å·¥å…·ï¼‰è¿›è¡Œç¼–ç å’Œè§£ç ã€‚
ä¿®æ”¹åï¼Œéœ€è¦å›ç¼–è¯‘å¹¶ç­¾åAPKæ‰èƒ½å®‰è£…æµ‹è¯•ã€‚

![](img/cf495bfa417e2038cf8bee4cba13d2a2_124.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_126.png)

**2. è°ƒè¯•Smaliä»£ç ï¼ˆä¼ ç»Ÿæ–¹æ³•ï¼‰**
è°ƒè¯•å…è®¸æˆ‘ä»¬åŠ¨æ€è·Ÿè¸ªä»£ç æ‰§è¡Œæµç¨‹ã€‚ä¸€ä¸ªç»å…¸çš„æ–¹æ³•æ˜¯ä½¿ç”¨ `apktool` å¯¹APKè¿›è¡Œåç¼–è¯‘å¹¶æ³¨å…¥è°ƒè¯•ç­‰å¾…ä»£ç ã€‚

![](img/cf495bfa417e2038cf8bee4cba13d2a2_128.png)

ä»¥ä¸‹æ˜¯è°ƒè¯•æ­¥éª¤æ¦‚è¦ï¼š

![](img/cf495bfa417e2038cf8bee4cba13d2a2_130.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_132.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_134.png)

*   **åç¼–è¯‘**ï¼š`apktool d -d target.apk -o output_dir` (ä½¿ç”¨ `-d` å‚æ•°ç”Ÿæˆå¯è°ƒè¯•çš„Smali)ã€‚
*   **ä¿®æ”¹æ¸…å•æ–‡ä»¶**ï¼šåœ¨ `AndroidManifest.xml` çš„ `<application>` æ ‡ç­¾å†…æ·»åŠ  `android:debuggable="true"`ã€‚
*   **æ³¨å…¥è°ƒè¯•ç­‰å¾…**ï¼šåœ¨å…¥å£Activityçš„ `onCreate` æ–¹æ³•å¼€å§‹å¤„ï¼Œæ·»åŠ Smaliä»£ç  `invoke-static {}, Landroid/os/Debug;->waitForDebugger()V`ã€‚
*   **å›ç¼–è¯‘ä¸ç­¾å**ï¼šä½¿ç”¨ `apktool b` å›ç¼–è¯‘ï¼Œå¹¶å¯¹ç”Ÿæˆçš„APKè¿›è¡Œç­¾åã€‚
*   **é…ç½®IDEè°ƒè¯•**ï¼šåœ¨Android Studioä¸­é…ç½®è¿œç¨‹è°ƒè¯•ï¼ˆRemoteï¼‰ï¼Œä¸»æœºä¸º `localhost`ï¼Œç«¯å£ä¸º `8700`ã€‚
*   **å¯åŠ¨è°ƒè¯•**ï¼šå®‰è£…å¹¶è¿è¡Œä¿®æ”¹åçš„APKï¼Œåº”ç”¨ä¼šå¡åœ¨ç­‰å¾…è°ƒè¯•å™¨ç•Œé¢ã€‚ä½¿ç”¨ `DDMS` æˆ– `Monitor` å·¥å…·é€‰ä¸­å¯¹åº”è¿›ç¨‹ï¼Œç„¶ååœ¨Android Studioä¸­å¯åŠ¨è°ƒè¯•è¿æ¥ã€‚

![](img/cf495bfa417e2038cf8bee4cba13d2a2_136.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_137.png)

è¿æ¥æˆåŠŸåï¼Œå°±å¯ä»¥åœ¨Smaliä»£ç ä¸­è®¾ç½®æ–­ç‚¹ï¼Œå•æ­¥æ‰§è¡Œï¼ˆF8ï¼‰ï¼Œè§‚å¯Ÿå¯„å­˜å™¨å€¼çš„å˜åŒ–ï¼Œä»è€Œæ·±å…¥ç†è§£ç¨‹åºé€»è¾‘ã€‚

![](img/cf495bfa417e2038cf8bee4cba13d2a2_139.png)

---

![](img/cf495bfa417e2038cf8bee4cba13d2a2_141.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_143.png)

## æ€»ç»“ä¸ä½œä¸š ğŸ“š

æœ¬èŠ‚è¯¾æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†Androidå¼€å‘çš„åŸºç¡€ã€é¡¹ç›®ç»“æ„ã€Smaliè¯­æ³•ä»¥åŠå¦‚ä½•å¯¹APKè¿›è¡Œåç¼–è¯‘ã€ä¿®æ”¹å’Œè°ƒè¯•ã€‚

![](img/cf495bfa417e2038cf8bee4cba13d2a2_145.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_146.png)

**æ ¸å¿ƒè¦ç‚¹æ€»ç»“ï¼š**
1.  Androidåº”ç”¨ç”±Javaä»£ç ã€èµ„æºæ–‡ä»¶å’Œæ¸…å•æ–‡ä»¶æ„æˆï¼Œç¼–è¯‘åç”ŸæˆAPKã€‚
2.  Smaliæ˜¯Dalvikå­—èŠ‚ç çš„æ±‡ç¼–è¯­è¨€ï¼Œæ˜¯é€†å‘åˆ†æçš„ä¸»è¦å¯¹è±¡ã€‚
3.  Smaliæ–‡ä»¶æœ‰å›ºå®šçš„ç»“æ„ï¼ŒåŒ…æ‹¬ç±»å®šä¹‰ã€å­—æ®µå’Œæ–¹æ³•ã€‚
4.  é€šè¿‡ä¿®æ”¹Smaliä»£ç å¹¶å›ç¼–è¯‘ï¼Œå¯ä»¥æ”¹å˜åº”ç”¨è¡Œä¸ºã€‚
5.  é€šè¿‡ç»™APKæ·»åŠ è°ƒè¯•å±æ€§å¹¶æ³¨å…¥ç­‰å¾…ä»£ç ï¼Œå¯ä»¥å®ç°åŠ¨æ€è°ƒè¯•ã€‚

![](img/cf495bfa417e2038cf8bee4cba13d2a2_148.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_150.png)

**è¯¾åä½œä¸šï¼š**
1.  ä»¿ç…§æ•™ç¨‹ï¼Œåˆ›å»ºä¸€ä¸ªåŒ…å«æŒ‰é’®å¹¶èƒ½å¯åŠ¨å¦ä¸€ä¸ªActivityçš„APPã€‚
2.  å°†ç¬¬ä¸€ä¸ªé¡µé¢ä¸­çš„â€œHello Worldâ€æ–‡æœ¬ä¿®æ”¹ä¸ºâ€œä½ å¥½ä¸–ç•Œâ€ã€‚
3.  å°è¯•ä½¿ç”¨ `apktool` å’Œ Android Studio è°ƒè¯•ä¸€ä¸ªç®€å•çš„åº”ç”¨ï¼Œç†Ÿæ‚‰SmaliæŒ‡ä»¤çš„æ‰§è¡Œè¿‡ç¨‹ã€‚

![](img/cf495bfa417e2038cf8bee4cba13d2a2_152.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_154.png)

![](img/cf495bfa417e2038cf8bee4cba13d2a2_156.png)

ç†Ÿç»ƒæŒæ¡è¿™äº›åŸºç¡€ï¼Œå°†ä¸ºåç»­æ›´å¤æ‚çš„Androidé€†å‘åˆ†ææ‰“ä¸‹åšå®çš„åŸºç¡€ã€‚