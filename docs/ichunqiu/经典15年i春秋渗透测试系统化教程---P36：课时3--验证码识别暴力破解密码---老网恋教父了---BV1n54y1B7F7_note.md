# 经典15年i春秋渗透测试系统化教程 - P36：课时3 验证码识别暴力破解密码 🔐

![](img/db8cf305df5272301d453373750f3003_1.png)

![](img/db8cf305df5272301d453373750f3003_3.png)

在本节课中，我们将学习如何利用验证码识别技术，结合自动化工具对存在验证码的登录系统进行暴力破解。我们将通过一个具体的实战案例，演示从抓取数据包到配置工具、最终成功破解密码的完整流程。

![](img/db8cf305df5272301d453373750f3003_5.png)

![](img/db8cf305df5272301d453373750f3003_7.png)

---

![](img/db8cf305df5272301d453373750f3003_9.png)

## 工具与环境准备 🛠️

![](img/db8cf305df5272301d453373750f3003_11.png)

上一节我们介绍了暴力破解的基本概念，本节中我们来看看实战所需的工具和环境。

![](img/db8cf305df5272301d453373750f3003_13.png)

![](img/db8cf305df5272301d453373750f3003_15.png)

我们使用的主要工具是 **PKAV**。此外，还需要一个目标测试环境。本次演示在一个虚拟机中搭建了ASP环境，目标是一个“中心小学”的建站系统后台。

![](img/db8cf305df5272301d453373750f3003_17.png)

![](img/db8cf305df5272301d453373750f3003_19.png)

以下是操作前的准备工作：
1.  打开目标网站的后台登录页面。
2.  确保PKAV工具已就绪。

---

![](img/db8cf305df5272301d453373750f3003_21.png)

## 数据包抓取与分析 📦

![](img/db8cf305df5272301d453373750f3003_22.png)

![](img/db8cf305df5272301d453373750f3003_24.png)

![](img/db8cf305df5272301d453373750f3003_25.png)

PKAV工具本身具备抓包功能，但在本例中无法成功抓取数据包。因此，我们需要使用 **Burp Suite** 来辅助完成。

![](img/db8cf305df5272301d453373750f3003_27.png)

![](img/db8cf305df5272301d453373750f3003_29.png)

以下是使用Burp Suite抓取登录数据包的步骤：
1.  开启Burp Suite的代理拦截功能。
2.  在浏览器中设置代理，指向Burp Suite。
3.  在登录页面输入任意用户名、密码和验证码（验证码每次请求都会变动），然后提交表单。
4.  在Burp Suite中拦截到登录请求的数据包。
5.  将这个数据包的内容完整复制下来。

![](img/db8cf305df5272301d453373750f3003_31.png)

![](img/db8cf305df5272301d453373750f3003_33.png)

![](img/db8cf305df5272301d453373750f3003_35.png)

抓取到数据包后，即可关闭Burp Suite的代理。

![](img/db8cf305df5272301d453373750f3003_37.png)

---

![](img/db8cf305df5272301d453373750f3003_39.png)

## 配置PKAV进行暴力破解 ⚙️

成功获取数据包后，我们将其导入PKAV工具进行配置。本节中我们来看看如何设置各项参数以启动破解。

首先，需要填写“分析地址”，即目标后台的登录地址。

接着，在数据包内容中为需要暴力破解的字段添加标记：
*   **用户名**：保持不变（本例为`admin`）。
*   **密码**：添加标记，准备用字典进行遍历。
*   **验证码**：添加标记，工具将尝试自动识别。

![](img/db8cf305df5272301d453373750f3003_41.png)

然后，需要加载密码字典。PKAV工具内置了多种字典，例如`top100`等。我们可以选择并导入合适的字典，也可以手动添加特定的密码进行测试。

---

## 验证码识别设置 🖼️

验证码识别是本案例的核心。PKAV工具内置了OCR（光学字符识别）功能来处理图片验证码。

验证码识别设置的关键步骤如下：
1.  **填写验证码地址**：从网页源码中获取验证码图片的URL地址，填入工具相应位置。
2.  **选择识别模式**：工具提供多种OCR模式，如“单一文本”、“OSD”（方向和脚本检测）、“自动页面分割”等。根据验证码的样式（如纯数字、无干扰线）选择最合适的模式。本例验证码为纯数字，适合使用默认的“单一文本”模式。
3.  **限定字符集**：对于纯数字验证码，可以将识别字符集限定为`0-9`，以提高识别准确率。
4.  **测试识别**：点击“识别”按钮，观察工具是否能正确识别出示例验证码。若能成功识别，说明配置正确。
5.  **处理非图片验证码**：如果验证码是以文本形式返回（非图片），则需要在工具的其他相应模块进行设置。

---

## 高级参数与规则配置 🔧

完成基本设置后，我们还需要配置一些高级参数来优化破解过程并处理可能出现的错误。

以下是需要关注的高级设置项：
*   **HTTP请求头部**：通常保持默认。可以设置是否跟踪重定向。本例中，我们通过对比响应数据包的大小差异来判断登录成功与否。
*   **多线程与速度**：启用多线程模式可以显著提高破解速度。可以适当增加线程数（如10线程），并设置请求间隔延迟（如2秒）。
*   **验证码长度**：如果验证码长度固定（如本例为4位），可以在此处指定，帮助工具进行识别。
*   **重试规则（关键）**：这是非常重要的一步。我们需要设置字符串匹配规则。当服务器返回“验证码错误”等特定关键字时，工具应针对当前密码**重新获取并识别一个新的验证码**进行重试，而不是直接判定密码错误。这能有效应对因验证码识别偶然失败导致的漏报。
    *   匹配字符串示例：`验证码错误！`

---

## 执行破解与结果分析 🚀

所有配置完成后，即可启动暴力破解过程。破解速度很快，通常几秒钟内就能遍历完一个较小的字典。

破解完成后，我们需要在结果列表中寻找成功的登录尝试。可以通过以下特征进行判断：
1.  **HTTP状态码**：成功的登录通常会返回`302`状态码（重定向跳转）。
2.  **响应数据包长度**：登录成功和失败的页面内容不同，因此响应包的长度会有显著差异。
3.  **响应内容**：成功的响应可能包含跳转到后台的`Location`头部。

找到疑似成功的记录后，使用其对应的用户名、密码和工具识别的验证码进行手动登录验证。在本例中，我们使用破解出的密码`admin`成功登录了网站后台。

---

## 验证码安全防御建议 🛡️

![](img/db8cf305df5272301d453373750f3003_43.png)

在学习了如何利用验证码识别进行攻击后，本节中我们来看看如何从防御者的角度来加固系统。

![](img/db8cf305df5272301d453373750f3003_45.png)

针对验证码被识别和暴力破解，有以下四个主要的防御方向：
1.  **强制使用验证码**：所有关键操作（尤其是后台登录）必须配备验证码，这是增加攻击难度的第一道防线。对于无法添加验证码的遗留系统（如某些网络设备），必须实施严格的IP访问限制。
2.  **验证码一次性有效**：服务器端必须确保每个验证码在验证后立即失效，不能重复使用，防止“验证码复用”漏洞。
3.  **增强验证码复杂度**：避免使用简单的纯数字、无干扰的验证码。应采用以下措施增加机器识别难度：
    *   数字字母混合。
    *   添加干扰点、干扰线、扭曲变形。
    *   使用变化的背景色和字体。
    *   进行字符粘连或使用中文验证码。
4.  **实施账户安全策略**：
    *   **强密码策略**：强制要求后台密码为数字、字母、特殊符号组合，且长度足够（如8位以上）。
    *   **IP限制与防绕过**：限制仅允许特定IP段（如内网IP）访问后台。同时需注意检查该限制是否可能被HTTP请求头（如`X-Forwarded-For`）伪造绕过。
    *   **统一安全接口**：网站各处使用同一个经过安全加固的验证码生成与验证接口，便于集中管理和升级。

![](img/db8cf305df5272301d453373750f3003_47.png)

有关验证码安全实现的更多技术细节，可以参考OWASP、开源代码库等相关资料。

---

![](img/db8cf305df5272301d453373750f3003_49.png)

![](img/db8cf305df5272301d453373750f3003_50.png)

本节课中我们一起学习了验证码识别暴力破解的完整实战流程。我们使用PKAV工具，结合数据包抓取、验证码OCR识别和重试规则配置，成功对目标后台进行了密码破解。同时，我们也从防御角度总结了增强验证码安全性的多项关键措施。理解这些攻防技术，有助于更好地评估和提升Web应用的安全性。