![](img/4d723ba98ed02a64a789e9f24bfbe582_1.png)

# 经典15年i春秋渗透测试系统化教程 - P56：课时4 手机APP漏洞挖掘（下） 📱

在本节课中，我们将学习手机APP漏洞挖掘的实践方法，包括APP自身安全检测、交互式安全测试以及模拟器使用等核心内容。

![](img/4d723ba98ed02a64a789e9f24bfbe582_3.png)

![](img/4d723ba98ed02a64a789e9f24bfbe582_5.png)

## 概述

![](img/4d723ba98ed02a64a789e9f24bfbe582_7.png)

上一节我们介绍了APP漏洞挖掘的基本概念和自动化扫描平台。本节中，我们将深入讲解手工检测的具体流程和工具使用，帮助你掌握从反编译到动态抓包的完整技能。

![](img/4d723ba98ed02a64a789e9f24bfbe582_9.png)

## APP自身安全检测 🔍

![](img/4d723ba98ed02a64a789e9f24bfbe582_11.png)

APP自身安全主要关注其代码是否容易被逆向分析和篡改。以下是手工检测的常见方法。

### APK反编译与代码混淆分析

![](img/4d723ba98ed02a64a789e9f24bfbe582_13.png)

首先，我们需要对APK文件进行反编译，以查看其源代码是否经过混淆或加密保护。

以下是反编译APK的基本步骤：

1.  **提取DEX文件**：使用压缩软件（如WinRAR）打开APK文件，找到并提取出 `classes.dex` 文件。
2.  **反编译DEX**：使用 `dex2jar` 工具对提取出的 `classes.dex` 文件进行反编译。命令格式通常为：
    ```bash
    d2j-dex2jar.bat classes.dex
    ```
    执行后会生成一个 `classes-dex2jar.jar` 文件。
3.  **查看Java源码**：使用 `JD-GUI` 工具打开上一步生成的 `.jar` 文件，即可查看反编译后的Java源代码。

通过查看源码，我们可以判断APP是否进行了代码混淆：
*   **未混淆的代码**：变量、函数名具有明确的含义，逻辑清晰可读。
*   **混淆后的代码**：变量、函数名被替换为无意义的字符（如a, b, c1），逻辑难以理解，增加了分析难度。混淆能有效保护核心代码逻辑。

![](img/4d723ba98ed02a64a789e9f24bfbe582_15.png)

![](img/4d723ba98ed02a64a789e9f24bfbe582_17.png)

![](img/4d723ba98ed02a64a789e9f24bfbe582_18.png)

### APK二次打包与篡改风险

![](img/4d723ba98ed02a64a789e9f24bfbe582_20.png)

![](img/4d723ba98ed02a64a789e9f24bfbe582_22.png)

攻击者可以对反编译后的APP进行修改（如插入恶意代码、广告），然后重新打包并发布到第三方渠道，用户下载安装后即可能中招。

以下是二次打包的简要过程：

![](img/4d723ba98ed02a64a789e9f24bfbe582_24.png)

1.  **反编译APK**：使用 `apktool` 工具将APK反编译为资源文件和smali中间代码。
    ```bash
    apktool d target.apk -o output_dir
    ```
2.  **修改内容**：在反编译输出的目录中，修改资源文件或smali代码。
3.  **重新打包**：使用 `apktool` 将修改后的目录重新打包成APK文件。
    ```bash
    apktool b output_dir -o new.apk
    ```
4.  **签名**：对新生成的APK文件进行签名，使其可以在Android设备上安装。

![](img/4d723ba98ed02a64a789e9f24bfbe582_26.png)

**核心风险**：用户从非官方渠道下载的APP，可能是被植入后门或广告的二次打包应用。

![](img/4d723ba98ed02a64a789e9f24bfbe582_28.png)

![](img/4d723ba98ed02a64a789e9f24bfbe582_30.png)

## APP交互式安全测试 🛠️

![](img/4d723ba98ed02a64a789e9f24bfbe582_31.png)

交互式安全测试关注APP与服务器通信过程中的漏洞，其思路与Web渗透测试相似。

### 设置Burp Suite代理进行抓包

![](img/4d723ba98ed02a64a789e9f24bfbe582_33.png)

![](img/4d723ba98ed02a64a789e9f24bfbe582_35.png)

![](img/4d723ba98ed02a64a789e9f24bfbe582_37.png)

Burp Suite是进行交互式测试的核心工具，可以拦截和分析APP发出的所有网络请求。

![](img/4d723ba98ed02a64a789e9f24bfbe582_39.png)

![](img/4d723ba98ed02a64a789e9f24bfbe582_41.png)

![](img/4d723ba98ed02a64a789e9f24bfbe582_43.png)

以下是设置Burp代理抓取手机流量的步骤：

![](img/4d723ba98ed02a64a789e9f24bfbe582_45.png)

1.  **配置Burp代理**：打开Burp Suite，在 `Proxy` -> `Options` 中，确保代理监听在 `0.0.0.0:8080`（或其他端口）。
2.  **手机配置代理**：确保手机和电脑在同一局域网。在手机的Wi-Fi设置中，修改当前网络的代理为 **手动**，服务器地址填写电脑的IP地址，端口填写Burp监听的端口（如8080）。
3.  **安装Burp证书（关键）**：为了解密HTTPS流量，需要在手机中安装Burp的CA证书。
    *   在手机浏览器中访问 `http://burp` 或 `http://电脑IP:8080`，下载 `cacert.der` 证书文件。
    *   将证书文件后缀改为 `.cer` 或 `.crt`。
    *   在手机设置中找到“安全”或“隐私”选项，选择“从存储设备安装证书”，完成安装。

完成以上步骤后，手机APP的HTTP/HTTPS流量都将经过Burp Suite，你可以进行拦截、重放、修改请求等操作。

### 漏洞测试方法

当流量经过Burp后，就可以像测试Web应用一样进行漏洞挖掘：

*   **参数篡改**：在 `Proxy` -> `Intercept` 截获请求，修改参数值，观察响应变化，寻找逻辑漏洞、SQL注入等。
*   **重放攻击**：使用 `Repeater` 模块对单个请求进行多次重放和修改，精细测试漏洞。
*   **主动扫描**：将请求发送到 `Scanner` 模块，进行自动化漏洞扫描（但Burp的移动端扫描能力相对较弱）。
*   **信息泄露**：检查请求和响应中是否明文传输敏感信息（如密码、身份证号）。

### 使用浏览器插件模拟手机环境

![](img/4d723ba98ed02a64a789e9f24bfbe582_47.png)

![](img/4d723ba98ed02a64a789e9f24bfbe582_49.png)

![](img/4d723ba98ed02a64a789e9f24bfbe582_51.png)

有时我们需要在电脑上直接访问或扫描仅限手机访问的Web服务（APP内的H5页面）。这时可以修改浏览器User-Agent来模拟手机。

![](img/4d723ba98ed02a64a789e9f24bfbe582_53.png)

![](img/4d723ba98ed02a64a789e9f24bfbe582_55.png)

![](img/4d723ba98ed02a64a789e9f24bfbe582_56.png)

以下是使用Firefox浏览器的方法：

![](img/4d723ba98ed02a64a789e9f24bfbe582_58.png)

![](img/4d723ba98ed02a64a789e9f24bfbe582_60.png)

1.  安装插件：在Firefox附加组件管理中搜索并安装 `User-Agent Switcher` 等插件。
2.  配置UA：在插件中添加新的User-Agent，选择Android或iOS设备的典型UA字符串。
3.  切换访问：浏览网站时，通过插件切换为手机UA，即可模拟手机浏览器访问。

![](img/4d723ba98ed02a64a789e9f24bfbe582_62.png)

![](img/4d723ba98ed02a64a789e9f24bfbe582_64.png)

这样，你就可以方便地使用电脑上的各类Web扫描器对APP的Web端进行测试。

![](img/4d723ba98ed02a64a789e9f24bfbe582_66.png)

![](img/4d723ba98ed02a64a789e9f24bfbe582_68.png)

## 使用模拟器运行APP 💻

![](img/4d723ba98ed02a64a789e9f24bfbe582_70.png)

有些测试需要在可控环境中进行，或者方便在电脑上操作，可以使用Android模拟器。

以下是两种常见方法：

1.  **专用安卓模拟器软件**：如“靠谱助手”、“夜神模拟器”等。安装后，可以直接在模拟器界面中安装并运行APK文件，操作体验类似真机。
2.  **Android x86虚拟机**：下载Android x86的ISO镜像文件，在VMware或VirtualBox中像安装普通操作系统一样安装一个完整的Android系统。然后在该虚拟机中安装APK进行测试。这种方法更纯净，适合深度分析。

**注意**：部分APP会检测运行环境，如果在模拟器或虚拟机上运行，可能会触发保护机制导致功能失效或退出。

## 总结

![](img/4d723ba98ed02a64a789e9f24bfbe582_72.png)

本节课我们一起学习了手机APP漏洞挖掘下半部分的核心实践技能。

我们首先介绍了如何对APP进行反编译，分析其代码混淆情况，并理解了二次打包的安全风险。接着，我们详细讲解了如何配置Burp Suite代理来抓取和分析APP的网络流量，这是发现交互类漏洞（如逻辑漏洞、信息泄露）的关键。我们还学习了如何通过修改浏览器UA来模拟手机环境，以便于测试。最后，我们了解了使用安卓模拟器来运行和测试APP的两种方法。

掌握这些手工与工具结合的方法，能够帮助你更全面、深入地评估移动应用的安全性。后续的学习需要你在此基础上，结合具体的漏洞类型（如组件安全、数据存储安全等）进行大量的练习和实践。