# 天草流初级教程 - P27：初级班总结课 📚

![](img/85015787ca0c81d66ce7402c563ef58e_1.png)

在本节课中，我们将对天草流初级班的所有核心内容进行系统性的梳理和总结。课程涵盖了从脱壳、破解到补丁制作的全流程关键技术与思路。

---

## 课件与课程安排说明

上一节我们完成了具体的破解案例分析，本节中我们来看看整个初级课程的框架。

我们的前面几节课中，有几节关于汇编的课程后来没有加入。目前没有汇编基础的同学，需要先自学几节汇编基础课，然后在后续课程中慢慢吸收。单独讲解汇编课程非常枯燥，并且大家不知道如何运用，因此没有加入正式课程。

大家在课后需要下功夫学习汇编。这就是“脱课”的内容。

---

## 脱壳技术要点 🐚

脱壳是逆向分析的第一步。本课程中专门讲解了三节脱壳课。

以下是脱壳部分的核心要点：

1.  **五种常见语言的特征**
    *   大家需要自己手动查找并总结这五种语言的特征，这样印象会更深刻。这五种语言是：汇编、C、Delphi、VB、BC++。

2.  **附加数据的处理**
    *   方法是找到最后一个区段的 `R offset` 和 `R size` 并压栈，这代表附加数据。
    *   用到的工具有：`OneHex` 或 `HWalkSensor`。

3.  **自校验的处理**
    *   有两种主要方法：
        *   **F12堆栈调用法**：如果错误提示是“调用错误”，则运行程序，等错误提示出现时按F12暂停，然后分析调用堆栈。
        *   **双OD对比法**：如果是“文件或数据损坏”类错误提示，用两个OD同时打开程序，分别下 `ReadFile` 断点，等读取文件时返回，慢慢跟踪。

4.  **手动查找IAT（导入地址表）**
    *   这并非仅针对BC++程序。现在很多强壳都需要手动查找IAT，这是必须掌握的技能，否则后续课程将无法理解。

---

## 破解技术核心 🔓

我们在初级班中有不少破解课，共有12节。

一般程序的破解（非重启验证或网络验证），目标是找到注册相关的按钮事件。

以下是破解的常用方法：

*   **查找字符串法**：在OD中搜索可能的注册成功/失败字符串。
*   **消息断点法**：使用 `bp rtcMsgBox` 下断点，点击目标按钮后程序会中断，然后回溯找到关键代码。
*   **错误提示断点法**：如果有错误提示框，可以使用 `MessageBoxA/W` 断点法。

---

## 重启验证破解思路 🔄

重启验证的目标是首先找到验证信息的存储类型。

主要有两大类：

1.  **注册表类型**
2.  **文件类型**
    *   其中有一个特殊类型是 **.ini文件类型**。
    *   其他如.dll文件类型比较少见，因为编程上处理较难。

**方法如下：**

*   **针对注册表类型**：常用的API是 `RegOpenKeyExA/W` 和 `RegQueryValueExA/W`，其中最常用的是后者。
*   **针对文件类型**：常用的API是 `CreateFileA/W`。
*   **针对.ini文件类型**：常用的API是 `GetPrivateProfileStringA`（获取）和 `WritePrivateProfileStringA`（写入），在Delphi编写的程序中常调用。

**重启验证软件的通用分析思路：**

1.  试运行程序，输入假码。
2.  首先在程序安装目录中查找可疑的可写入文件，如.ini文件、配置文件或.data文件。
3.  可以通过系统“运行”输入 `regedit` 直接查看注册表。
4.  或者用OD查找字符串，看有无可疑的注册表路径或文件名信息。这需要一定的经验和直觉。

---

## 不脱壳破解与补丁制作 🛠️

上一节我们介绍了重启验证，本节中我们来看看不脱壳破解和后续的补丁制作。

**不脱壳破解步骤：**

1.  首先到达OEP（原始入口点），以便能查找字符串。
2.  或者直接使用F12堆栈调用法。
3.  注意：在可调试的情况下，找到相关按钮事件后，最好同时下“硬件执行断点”和普通的 `F2`（BP）断点，这样更保险。因为重新载入程序后，普通断点可能会失效。

**补丁制作手段：**

1.  **脚本补丁**：使用相关工具制作，例如课程中用到的工具。
2.  **手动补丁**：需要注意以下几点：
    *   尽量以改动最少的指令来达到破解目的。
    *   找到注入代码的地方。有几个关键点：
        *   SFX区段。
        *   跳向OEP的地方如果有空闲空间，此处是首选（例如UPX壳）。
    *   修改代码时，尽量只修改一个字节（`byte`）。如果修改双字（`dword`，4字节），要确保空间足够，否则会覆盖后续指令，导致错误。

**常用辅助工具：**

*   **DEDE**：对应Delphi和VC++程序。
*   **PE Explorer**：也可用于分析多种语言编写的程序，破解Delphi时经常使用。
*   **Keymake**：用于制作内存补丁机。最新版是2.0。注意其生成的补丁可能被卡巴斯基查杀，课程中讲解了免杀方法。

要求对这些工具进行非常熟练的操作，因为后续课程中会经常用到。

另外需留意：Delphi程序的事件调用技术 `call dword ptr [eax+$XX]`，在第22课“国外破解技术”中已有讲解。

---

## 学习习惯与方法 💡

最后，我们强调一下学习习惯和方法。

以下是给初学者的建议：

1.  **学习习惯**：遇到问题尽量先自己思考解决方案，实在不行再提问。通过自己思考并解决问题，可以积累宝贵经验。
2.  **学习方法**：推荐一个非常扎实的方法——每节课后都做内容总结。将老师讲的东西转化为自己的理解。如果只是听讲，知识可能左耳进右耳出。
3.  **注意事项**：请不要泄露教程内容。

---

## 总结与预告

本节课中，我们一起学习了天草流初级班的完整知识体系总结，包括脱壳的关键点、常规破解与重启验证的分析思路、不脱壳破解技巧、补丁制作方法以及重要的学习态度。

初级班课程至此全部结束。中级班课程预计将于近期（如3月28日或4月初）开课。希望继续学习的同学请留意通知。

![](img/85015787ca0c81d66ce7402c563ef58e_3.png)

再见。