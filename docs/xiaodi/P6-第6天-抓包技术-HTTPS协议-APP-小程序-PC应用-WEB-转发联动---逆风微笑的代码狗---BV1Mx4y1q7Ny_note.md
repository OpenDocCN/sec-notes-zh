# 🕵️‍♂️ 抓包技术入门（P6）：HTTP/HTTPS协议抓包实战

![](img/94e177ef7014579c3985c48a24920d33_1.png)

![](img/94e177ef7014579c3985c48a24920d33_3.png)

在本节课中，我们将学习网络安全中一项基础且重要的技能——抓包。我们将重点掌握针对HTTP和HTTPS协议的抓包技术，并了解如何将其应用于网站、APP、小程序和PC应用这四大常见目标。

![](img/94e177ef7014579c3985c48a24920d33_5.png)

![](img/94e177ef7014579c3985c48a24920d33_7.png)

## 📋 课程概述与目标

![](img/94e177ef7014579c3985c48a24920d33_9.png)

![](img/94e177ef7014579c3985c48a24920d33_11.png)

本节课是抓包技术系列的第一部分。抓包技术内容广泛，足以开设多次课程。今天，我们将专注于抓包工具的基础使用，特别是针对**HTTP**和**HTTPS**协议的抓包演示。

![](img/94e177ef7014579c3985c48a24920d33_13.png)

![](img/94e177ef7014579c3985c48a24920d33_15.png)

![](img/94e177ef7014579c3985c48a24920d33_17.png)

![](img/94e177ef7014579c3985c48a24920d33_19.png)

**核心知识点**：
*   抓包工具（Fiddler、Charles、Burp Suite）的安装与配置。
*   了解并掌握上述工具的基本使用方法。
*   学会针对网站、APP、小程序、PC应用进行HTTP/HTTPS协议抓包。
*   明确本节课所学技术仅适用于**HTTP/HTTPS协议**，不适用于其他网络协议。

![](img/94e177ef7014579c3985c48a24920d33_21.png)

![](img/94e177ef7014579c3985c48a24920d33_23.png)

![](img/94e177ef7014579c3985c48a24920d33_25.png)

![](img/94e177ef7014579c3985c48a24920d33_27.png)

---

![](img/94e177ef7014579c3985c48a24920d33_29.png)

![](img/94e177ef7014579c3985c48a24920d33_31.png)

![](img/94e177ef7014579c3985c48a24920d33_33.png)

![](img/94e177ef7014579c3985c48a24920d33_35.png)

![](img/94e177ef7014579c3985c48a24920d33_37.png)

## 🔧 前期准备：安装抓包证书

![](img/94e177ef7014579c3985c48a24920d33_39.png)

在开始抓包之前，有一个至关重要的步骤：安装抓包工具的根证书。如果不安装证书，将无法解密和查看**HTTPS**协议的数据包内容。

![](img/94e177ef7014579c3985c48a24920d33_41.png)

![](img/94e177ef7014579c3985c48a24920d33_43.png)

安装证书主要涉及两个环境：**本地电脑的浏览器**和**安卓模拟器**。

![](img/94e177ef7014579c3985c48a24920d33_45.png)

![](img/94e177ef7014579c3985c48a24920d33_47.png)

![](img/94e177ef7014579c3985c48a24920d33_49.png)

以下是针对三款抓包工具的证书安装通用流程：

![](img/94e177ef7014579c3985c48a24920d33_51.png)

![](img/94e177ef7014579c3985c48a24920d33_53.png)

![](img/94e177ef7014579c3985c48a24920d33_55.png)

![](img/94e177ef7014579c3985c48a24920d33_57.png)

![](img/94e177ef7014579c3985c48a24920d33_59.png)

### 1. 模拟器环境安装证书

![](img/94e177ef7014579c3985c48a24920d33_61.png)

![](img/94e177ef7014579c3985c48a24920d33_63.png)

无论使用哪款工具，在模拟器中安装证书的流程相似：

![](img/94e177ef7014579c3985c48a24920d33_65.png)

![](img/94e177ef7014579c3985c48a24920d33_67.png)

![](img/94e177ef7014579c3985c48a24920d33_69.png)

![](img/94e177ef7014579c3985c48a24920d33_71.png)

1.  **导出证书**：从抓包工具中导出根证书（通常为`.cer`或`.der`格式）到电脑桌面。
2.  **共享证书**：将证书文件拖入模拟器与电脑的共享文件夹。
3.  **安装证书**：在模拟器的`设置` -> `安全` -> `从SD卡安装`中，找到并选择共享的证书文件，设置一个名称后完成安装。

![](img/94e177ef7014579c3985c48a24920d33_73.png)

![](img/94e177ef7014579c3985c48a24920d33_75.png)

![](img/94e177ef7014579c3985c48a24920d33_77.png)

**以Fiddler为例**：
*   在Fiddler中：`Tools` -> `Options` -> `HTTPS` -> `Actions` -> `Export Root Certificate to Desktop`。
*   将导出的证书文件按上述步骤安装到模拟器。

![](img/94e177ef7014579c3985c48a24920d33_79.png)

![](img/94e177ef7014579c3985c48a24920d33_81.png)

**以Burp Suite为例**：
*   在Burp中：`Proxy` -> `Options` -> `Import / export CA certificate` -> `Export` -> `Certificate in DER format`。
*   将导出的`.der`文件按上述步骤安装到模拟器。若格式不被识别，可尝试在模拟器浏览器中访问 `http://burp代理IP:端口` 下载证书，或更改文件后缀为`.cer`。

![](img/94e177ef7014579c3985c48a24920d33_83.png)

![](img/94e177ef7014579c3985c48a24920d33_85.png)

![](img/94e177ef7014579c3985c48a24920d33_87.png)

### 2. 本地浏览器环境安装证书

为了让本地浏览器信任抓包工具，也需要安装证书。

**以Chrome浏览器为例**：
1.  打开浏览器`设置` -> `隐私设置和安全性` -> `安全` -> `管理设备证书`。
2.  在`受信任的根证书颁发机构`选项卡中，点击`导入`。
3.  选择之前从抓包工具导出的证书文件，完成导入。

**安装验证**：完成上述步骤后，尝试访问一个HTTPS网站（如 `https://www.baidu.com`），如果抓包工具能正常显示其请求和响应内容，说明证书安装成功。

![](img/94e177ef7014579c3985c48a24920d33_89.png)

---

![](img/94e177ef7014579c3985c48a24920d33_91.png)

## 🖥️ 实战一：网站（Web）抓包

上一节我们完成了抓包的准备工作，本节中我们来看看如何对浏览器访问的网站进行抓包。以下是三款工具的操作要点。

### Fiddler / Charles 抓包（无需设置系统代理）

这两款工具启动后默认监听本机流量，无需在浏览器中设置代理即可抓取本机浏览器发出的请求。

![](img/94e177ef7014579c3985c48a24920d33_93.png)

![](img/94e177ef7014579c3985c48a24920d33_95.png)

**操作流程**：
1.  启动Fiddler或Charles。
2.  直接使用浏览器访问任何HTTP或HTTPS网站。
3.  在抓包工具的会话列表中，即可看到所有网络请求，包括请求头、响应内容等详细信息。

**Fiddler关键配置**：确保在 `Tools` -> `Options` -> `HTTPS` 中勾选了 `Decrypt HTTPS traffic`，以解密HTTPS流量。

![](img/94e177ef7014579c3985c48a24920d33_97.png)

![](img/94e177ef7014579c3985c48a24920d33_99.png)

### Burp Suite 抓包（需设置系统代理）

![](img/94e177ef7014579c3985c48a24920d33_101.png)

![](img/94e177ef7014579c3985c48a24920d33_103.png)

![](img/94e177ef7014579c3985c48a24920d33_105.png)

Burp Suite的工作原理是作为代理服务器，需要浏览器将流量发送给它才能进行拦截和分析。

![](img/94e177ef7014579c3985c48a24920d33_107.png)

**操作流程**：
1.  **配置Burp监听**：打开Burp，在 `Proxy` -> `Options` 中，确保代理监听器（如 `127.0.0.1:8080`）处于运行状态。
2.  **配置浏览器代理**：在浏览器或系统网络设置中，手动设置代理服务器为 `127.0.0.1`，端口为 `8080`（与Burp监听端口一致）。**务必清空“请勿对以下地址使用代理服务器”列表**，否则本地地址可能无法被抓取。
3.  **开启拦截**：在Burp的 `Proxy` -> `Intercept` 中，点击 `Intercept is on` 开启拦截。此时浏览器的请求会被暂停在Burp中。
4.  **分析/修改请求**：你可以查看、修改被拦截的请求，然后点击 `Forward` 放行，或 `Drop` 丢弃。
5.  **查看历史**：即使不开启拦截，所有通过代理的请求也会记录在 `Proxy` -> `HTTP history` 中。

**重要原理**：设置了代理后，浏览器流量会先到达Burp。如果Burp未开启，则流量没有出口，会导致浏览器无法上网。因此，使用Burp时必须保持其运行。

---

![](img/94e177ef7014579c3985c48a24920d33_109.png)

![](img/94e177ef7014579c3985c48a24920d33_111.png)

![](img/94e177ef7014579c3985c48a24920d33_113.png)

![](img/94e177ef7014579c3985c48a24920d33_115.png)

![](img/94e177ef7014579c3985c48a24920d33_117.png)

![](img/94e177ef7014579c3985c48a24920d33_119.png)

![](img/94e177ef7014579c3985c48a24920d33_121.png)

## 📱 实战二：APP抓包

![](img/94e177ef7014579c3985c48a24920d33_123.png)

![](img/94e177ef7014579c3985c48a24920d33_125.png)

![](img/94e177ef7014579c3985c48a24920d33_127.png)

![](img/94e177ef7014579c3985c48a24920d33_129.png)

![](img/94e177ef7014579c3985c48a24920d33_131.png)

![](img/94e177ef7014579c3985c48a24920d33_133.png)

![](img/94e177ef7014579c3985c48a24920d33_135.png)

![](img/94e177ef7014579c3985c48a24920d33_137.png)

![](img/94e177ef7014579c3985c48a24920d33_139.png)

现在，我们将抓包目标从电脑浏览器转向运行在模拟器中的手机APP。核心思路是让模拟器内的网络流量经过我们电脑上的抓包工具。

![](img/94e177ef7014579c3985c48a24920d33_141.png)

![](img/94e177ef7014579c3985c48a24920d33_143.png)

![](img/94e177ef7014579c3985c48a24920d33_145.png)

![](img/94e177ef7014579c3985c48a24920d33_146.png)

![](img/94e177ef7014579c3985c48a24920d33_148.png)

### 关键步骤：为模拟器配置代理

![](img/94e177ef7014579c3985c48a24920d33_150.png)

模拟器相当于一个独立的设备，需要手动设置其网络走我们的抓包代理。

![](img/94e177ef7014579c3985c48a24920d33_152.png)

![](img/94e177ef7014579c3985c48a24920d33_154.png)

![](img/94e177ef7014579c3985c48a24920d33_156.png)

![](img/94e177ef7014579c3985c48a24920d33_158.png)

1.  **获取本机IP**：在电脑命令行输入 `ipconfig`，找到当前活跃网络连接（如以太网或WLAN）的IPv4地址（例如 `192.168.1.100`）。
2.  **设置模拟器代理**：在模拟器的 `设置` -> `WLAN` -> 长按当前网络 -> `修改网络` -> `高级选项` -> `代理` 中选择`手动`。
3.  **填写代理信息**：代理主机名填写步骤1中获取的**电脑IP**（不是127.0.0.1），代理端口填写抓包工具的监听端口（如Burp的8080）。

![](img/94e177ef7014579c3985c48a24920d33_160.png)

### 使用不同工具抓取APP流量

![](img/94e177ef7014579c3985c48a24920d33_162.png)

![](img/94e177ef7014579c3985c48a24920d33_164.png)

![](img/94e177ef7014579c3985c48a24920d33_166.png)

*   **Fiddler/Charles**：完成上述代理配置后，启动APP，即可在工具中看到APP发出的HTTP/HTTPS请求。
*   **Burp Suite**：同样需要完成模拟器代理配置。此外，在Burp的代理监听器中，需要添加一个监听项，绑定到**电脑的IP地址**（如 `192.168.1.100:8080`），而不仅仅是 `127.0.0.1`，以便接收来自模拟器的流量。

**测试与筛选**：启动APP后，在抓包工具中观察是否有请求产生。你可以使用工具内的过滤功能（如按域名 `Host` 过滤）来聚焦于目标APP的流量，排除其他无关请求。

![](img/94e177ef7014579c3985c48a24920d33_168.png)

![](img/94e177ef7014579c3985c48a24920d33_170.png)

---

## 🔄 实战三：小程序与PC应用抓包及工具联动

![](img/94e177ef7014579c3985c48a24920d33_172.png)

![](img/94e177ef7014579c3985c48a24920d33_174.png)

![](img/94e177ef7014579c3985c48a24920d33_176.png)

对于微信小程序或某些PC客户端，它们可能没有直接的代理设置选项。这时，我们需要使用一些技巧或工具联动来实现抓包。

### 场景：抓取微信小程序数据包

![](img/94e177ef7014579c3985c48a24920d33_178.png)

![](img/94e177ef7014579c3985c48a24920d33_180.png)

![](img/94e177ef7014579c3985c48a24920d33_182.png)

![](img/94e177ef7014579c3985c48a24920d33_184.png)

![](img/94e177ef7014579c3985c48a24920d33_185.png)

微信桌面版本身没有显式的代理设置入口。如果设置系统全局代理，会导致所有流量都经过代理，可能产生干扰。

![](img/94e177ef7014579c3985c48a24920d33_187.png)

![](img/94e177ef7014579c3985c48a24920d33_188.png)

![](img/94e177ef7014579c3985c48a24920d33_190.png)

![](img/94e177ef7014579c3985c48a24920d33_192.png)

**解决方案一：使用Fiddler/Charles转发至Burp**
1.  在Fiddler中配置：`Tools` -> `Options` -> `Connections` -> 勾选 `Allow remote computers to connect`。
2.  在Fiddler中配置规则，将所有流量转发到Burp的代理端口（`127.0.0.1:8080`）。
3.  启动Burp。此时，Fiddler会抓取流量并转发给Burp，在Burp中进行分析和测试。这样利用了Fiddler无需复杂配置即可抓取本地程序流量的特性。

![](img/94e177ef7014579c3985c48a24920d33_194.png)

**解决方案二：使用专业代理转发工具（如Proxifier）**
1.  在Proxifier中配置一个代理服务器，指向Burp（`127.0.0.1:8080`）。
2.  配置代理规则，指定只有微信进程（如`WeChat.exe`）的流量才使用这个代理。
3.  这样就能精准地将微信小程序的网络流量导向Burp，而不影响其他应用程序。

### 场景：抓取PC客户端数据包

![](img/94e177ef7014579c3985c48a24920d33_196.png)

![](img/94e177ef7014579c3985c48a24920d33_198.png)

![](img/94e177ef7014579c3985c48a24920d33_200.png)

![](img/94e177ef7014579c3985c48a24920d33_202.png)

![](img/94e177ef7014579c3985c48a24920d33_204.png)

PC客户端（如腾讯文档桌面版）的抓包方式与APP类似。
*   **有代理设置**：直接在客户端设置中配置代理指向Burp。
*   **无代理设置**：可以采用上述**解决方案二**，使用Proxifier等工具针对特定进程设置代理。
*   也可以使用Fiddler/Charles直接抓取，因为它们通常能捕获本机进程的流量。但某些权限较高的程序可能无法直接抓取。

![](img/94e177ef7014579c3985c48a24920d33_206.png)

![](img/94e177ef7014579c3985c48a24920d33_208.png)

![](img/94e177ef7014579c3985c48a24920d33_210.png)

![](img/94e177ef7014579c3985c48a24920d33_211.png)

![](img/94e177ef7014579c3985c48a24920d33_213.png)

![](img/94e177ef7014579c3985c48a24920d33_215.png)

---

![](img/94e177ef7014579c3985c48a24920d33_217.png)

![](img/94e177ef7014579c3985c48a24920d33_219.png)

![](img/94e177ef7014579c3985c48a24920d33_221.png)

![](img/94e177ef7014579c3985c48a24920d33_223.png)

## ⚠️ 重要总结与注意事项

本节课我们一起学习了针对HTTP/HTTPS协议的基础抓包技术。让我们回顾并明确以下几点：

![](img/94e177ef7014579c3985c48a24920d33_225.png)

![](img/94e177ef7014579c3985c48a24920d33_227.png)

![](img/94e177ef7014579c3985c48a24920d33_229.png)

![](img/94e177ef7014579c3985c48a24920d33_231.png)

![](img/94e177ef7014579c3985c48a24920d33_233.png)

1.  **协议范围**：今天所学的三款工具（Fiddler, Charles, Burp Suite）主要适用于**HTTP和HTTPS协议**。如果目标应用使用其他协议（如WebSocket、TCP自定义协议等），这些工具将无法抓取，需要用到如Wireshark等工具。
2.  **应用方向**：我们成功演示了对**网站(Web)、APP、小程序、PC应用**四大方向的抓包，但前提是它们的通信基于HTTP/HTTPS。
3.  **前提条件**：抓取HTTPS流量必须提前在**目标环境（浏览器/模拟器）** 正确安装抓包工具的根证书。
4.  **代理配置**：Burp Suite类工具需要显式配置代理；Fiddler/Charles类工具通常无需配置即可抓本机流量，但抓模拟器等“远程”设备时仍需在设备端配置代理。
5.  **后续深入**：实际的抓包工作还会遇到很多挑战，例如：
    *   **协议不同**：下节课我们将介绍如何抓取其他网络协议的数据包。
    *   **防护绕过**：很多APP会检测代理、校验证书，防止被抓包。这些绕过技术将在后续的APP安全、小程序安全等专项课程中详细讲解。

![](img/94e177ef7014579c3985c48a24920d33_235.png)

**抓包的目的**：简单来说，抓包是为了**看清数据流动**，从而获取测试目标（域名、API）、分析请求参数、寻找安全测试点（如SQL注入、越权），也是进行逆向分析、理解业务逻辑的第一步。

![](img/94e177ef7014579c3985c48a24920d33_237.png)

请记住，今天的内容是抓包技术的**入门基石**。掌握了这些基础原理和方法后，你才能更好地理解和应对未来更复杂的抓包场景和挑战。