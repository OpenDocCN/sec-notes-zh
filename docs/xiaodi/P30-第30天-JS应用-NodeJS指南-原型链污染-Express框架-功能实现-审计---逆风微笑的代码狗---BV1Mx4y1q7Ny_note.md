# ğŸš€ è¯¾ç¨‹P30ï¼šNode.jsåº”ç”¨å¼€å‘ä¸å®‰å…¨åŸºç¡€

![](img/a55db4f1f30eb046ad44ad00bbe619f7_1.png)

åœ¨æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ Node.jsçš„åŸºç¡€çŸ¥è¯†ï¼Œäº†è§£å…¶ä½œä¸ºæœåŠ¡ç«¯JavaScriptçš„è¿è¡Œç¯å¢ƒï¼Œå¹¶å®è·µå¦‚ä½•ç”¨å®ƒè¿›è¡ŒWebåº”ç”¨å¼€å‘ã€‚æˆ‘ä»¬è¿˜å°†æ¢è®¨åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„å®‰å…¨é—®é¢˜ï¼Œå¦‚SQLæ³¨å…¥ã€æ–‡ä»¶æ“ä½œæ¼æ´ã€å‘½ä»¤æ‰§è¡Œä»¥åŠNode.jsç‰¹æœ‰çš„åŸå‹é“¾æ±¡æŸ“æ¼æ´ã€‚

![](img/a55db4f1f30eb046ad44ad00bbe619f7_3.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_5.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_7.png)

---

![](img/a55db4f1f30eb046ad44ad00bbe619f7_9.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_11.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_13.png)

## ğŸ“š æ¦‚è¿°ï¼šNode.jsæ˜¯ä»€ä¹ˆï¼Ÿ

![](img/a55db4f1f30eb046ad44ad00bbe619f7_15.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_17.png)

Node.jsæ˜¯è¿è¡Œåœ¨æœåŠ¡ç«¯çš„JavaScriptç¯å¢ƒã€‚è¿™ä¸æˆ‘ä»¬ä¹‹å‰å­¦ä¹ çš„ã€è¿è¡Œåœ¨æµè§ˆå™¨å®¢æˆ·ç«¯ï¼ˆå‰ç«¯ï¼‰çš„åŸç”ŸJavaScriptæœ‰æœ¬è´¨åŒºåˆ«ã€‚

![](img/a55db4f1f30eb046ad44ad00bbe619f7_19.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_21.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_23.png)

**æ ¸å¿ƒå·®å¼‚**ï¼š
*   **åŸç”ŸJavaScript**ï¼šä»£ç åœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­æ‰§è¡Œï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡æŸ¥çœ‹ç½‘é¡µæºä»£ç çœ‹åˆ°æ‰€æœ‰é€»è¾‘ã€‚
*   **Node.js**ï¼šä»£ç åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼Œç”¨æˆ·è®¿é—®ç½‘ç«™æ—¶ï¼Œæµè§ˆå™¨æ¥æ”¶åˆ°çš„åªæ˜¯ä»£ç æ‰§è¡Œåçš„ç»“æœï¼ˆå¦‚HTMLï¼‰ï¼Œè€Œçœ‹ä¸åˆ°æœåŠ¡å™¨ç«¯çš„æºä»£ç ã€‚

![](img/a55db4f1f30eb046ad44ad00bbe619f7_25.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_27.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_29.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_31.png)

è¿™ç§å·®å¼‚æ„å‘³ç€Node.jså¼€å‘çš„ç½‘ç«™å±äºâ€œåç«¯â€åº”ç”¨ã€‚

![](img/a55db4f1f30eb046ad44ad00bbe619f7_33.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_35.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_37.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_39.png)

---

![](img/a55db4f1f30eb046ad44ad00bbe619f7_41.png)

## ğŸ› ï¸ ç¯å¢ƒæ­å»ºä¸åŸºç¡€å¼€å‘

![](img/a55db4f1f30eb046ad44ad00bbe619f7_43.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_45.png)

ä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†Node.jsçš„åŸºæœ¬æ¦‚å¿µï¼Œæœ¬èŠ‚ä¸­æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•æ­å»ºç¯å¢ƒå¹¶è¿›è¡Œç®€å•çš„Webå¼€å‘ã€‚

### ç¯å¢ƒå®‰è£…

é¦–å…ˆï¼Œéœ€è¦ä»Node.jså®˜ç½‘ä¸‹è½½å¹¶å®‰è£…é€‚åˆä½ æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬ã€‚å®‰è£…å®Œæˆåï¼Œé‡å¯ç”µè„‘ä»¥ç¡®ä¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆã€‚

éªŒè¯å®‰è£…ï¼š
```bash
node -v
npm -v
```

![](img/a55db4f1f30eb046ad44ad00bbe619f7_47.png)

### ä½¿ç”¨Expressæ¡†æ¶åˆ›å»ºWebåº”ç”¨

![](img/a55db4f1f30eb046ad44ad00bbe619f7_49.png)

Expressæ˜¯Node.jsä¸­ä¸€ä¸ªç®€æ´çš„Webåº”ç”¨å¼€å‘æ¡†æ¶ã€‚ä»¥ä¸‹æ˜¯åˆ›å»ºä¸€ä¸ªç®€å•æœåŠ¡å™¨çš„æ­¥éª¤ï¼š

![](img/a55db4f1f30eb046ad44ad00bbe619f7_51.png)

1.  **åˆå§‹åŒ–é¡¹ç›®å¹¶å®‰è£…Express**ï¼š
    ```bash
    npm init -y
    npm install express
    ```

2.  **åˆ›å»ºåŸºç¡€æœåŠ¡å™¨** (`server.js`)ï¼š
    ```javascript
    // 1. å¼•å…¥expressåº“
    const express = require('express');
    // 2. åˆ›å»ºåº”ç”¨å®ä¾‹
    const app = express();
    // 3. å®šä¹‰è·¯ç”±ï¼šå½“ç”¨æˆ·è®¿é—®ç½‘ç«™æ ¹è·¯å¾„æ—¶ï¼Œè¿”å›â€œé¦–é¡µé¡µé¢â€
    app.get('/', (req, res) => {
        res.send('é¦–é¡µé¡µé¢');
    });
    // 4. ç›‘å¬3000ç«¯å£
    const server = app.listen(3000, () => {
        console.log('WebæœåŠ¡å™¨ 3000ç«¯å£å·²å¯åŠ¨');
    });
    ```

3.  **è¿è¡ŒæœåŠ¡å™¨**ï¼š
    ```bash
    node server.js
    ```
    è®¿é—® `http://localhost:3000` å³å¯çœ‹åˆ°â€œé¦–é¡µé¡µé¢â€ã€‚

![](img/a55db4f1f30eb046ad44ad00bbe619f7_53.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_55.png)

---

![](img/a55db4f1f30eb046ad44ad00bbe619f7_57.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_59.png)

## ğŸ” å®ç°ç™»å½•åŠŸèƒ½ä¸æ•°æ®æ¥æ”¶

![](img/a55db4f1f30eb046ad44ad00bbe619f7_61.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_63.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_65.png)

ç°åœ¨ï¼Œæˆ‘ä»¬æ¥æ„å»ºä¸€ä¸ªå…·æœ‰ç™»å½•åŠŸèƒ½çš„é¡µé¢ï¼Œå¹¶å­¦ä¹ å¦‚ä½•æ¥æ”¶å‰ç«¯æäº¤çš„æ•°æ®ã€‚

![](img/a55db4f1f30eb046ad44ad00bbe619f7_67.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_69.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_71.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_73.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_75.png)

### åˆ›å»ºç™»å½•é¡µé¢

![](img/a55db4f1f30eb046ad44ad00bbe619f7_77.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_79.png)

é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªç®€å•çš„HTMLç™»å½•è¡¨å• (`login.html`)ï¼š
```html
<form action="/login" method="post">
    ç”¨æˆ·å: <input type="text" name="username"><br>
    å¯†ç : <input type="password" name="password"><br>
    <input type="submit" value="ç™»å½•">
</form>
```

![](img/a55db4f1f30eb046ad44ad00bbe619f7_81.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_83.png)

### å¤„ç†GETä¸POSTè¯·æ±‚

![](img/a55db4f1f30eb046ad44ad00bbe619f7_85.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_87.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_89.png)

åœ¨Node.jsä¸­ï¼Œå¤„ç†ä¸åŒHTTPæ–¹æ³•çš„è¯·æ±‚æ•°æ®æ–¹å¼ä¸åŒã€‚

![](img/a55db4f1f30eb046ad44ad00bbe619f7_91.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_93.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_95.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_97.png)

*   **å¤„ç†GETè¯·æ±‚å‚æ•°**ï¼šä½¿ç”¨ `req.query` å¯¹è±¡ã€‚
*   **å¤„ç†POSTè¯·æ±‚å‚æ•°**ï¼šéœ€è¦å€ŸåŠ© `body-parser` ä¸­é—´ä»¶æ¥è§£æ `req.body`ã€‚

![](img/a55db4f1f30eb046ad44ad00bbe619f7_99.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_101.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_103.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_105.png)

ä»¥ä¸‹æ˜¯å¤„ç†ç™»å½•é€»è¾‘çš„ä»£ç ç¤ºä¾‹ï¼š

![](img/a55db4f1f30eb046ad44ad00bbe619f7_107.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_109.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_111.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_113.png)

```javascript
const express = require('express');
const bodyParser = require('body-parser'); // å¼•å…¥body-parseråº“
const app = express();

![](img/a55db4f1f30eb046ad44ad00bbe619f7_115.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_117.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_119.png)

// ä½¿ç”¨body-parserä¸­é—´ä»¶æ¥è§£æPOSTè¯·æ±‚çš„`application/x-www-form-urlencoded`æ•°æ®
app.use(bodyParser.urlencoded({ extended: true }));

![](img/a55db4f1f30eb046ad44ad00bbe619f7_121.png)

// æ¸²æŸ“ç™»å½•é¡µé¢ (GETè¯·æ±‚)
app.get('/login', (req, res) => {
    res.sendFile(__dirname + '/login.html');
});

// å¤„ç†ç™»å½•æäº¤ (POSTè¯·æ±‚)
app.post('/login', (req, res) => {
    // ä»req.bodyä¸­è·å–POSTæäº¤çš„æ•°æ®
    const username = req.body.username;
    const password = req.body.password;
    
    console.log(`æ¥æ”¶åˆ°ç”¨æˆ·å: ${username}, å¯†ç : ${password}`);
    
    // ç®€å•çš„è´¦å·å¯†ç éªŒè¯é€»è¾‘
    if (username === 'admin' && password === '123456') {
        res.send('æ¬¢è¿è¿›å…¥åå°ç®¡ç†é¡µé¢');
    } else {
        res.send('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯');
    }
});

app.listen(3000);
```

![](img/a55db4f1f30eb046ad44ad00bbe619f7_123.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_125.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_127.png)

**å…³é”®ç‚¹**ï¼š
*   `req.query` ç”¨äºè·å–URLä¸­çš„æŸ¥è¯¢å‚æ•°ï¼ˆå¦‚ `?id=1`ï¼‰ã€‚
*   `req.body` ç”¨äºè·å–POSTè¯·æ±‚ä½“ä¸­çš„æ•°æ®ï¼Œä½†éœ€è¦ `body-parser` ä¸­é—´ä»¶å…ˆè¡Œè§£æã€‚

![](img/a55db4f1f30eb046ad44ad00bbe619f7_129.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_131.png)

---

![](img/a55db4f1f30eb046ad44ad00bbe619f7_133.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_135.png)

## ğŸ—„ï¸ è¿æ¥æ•°æ®åº“ä¸SQLæ³¨å…¥é£é™©

![](img/a55db4f1f30eb046ad44ad00bbe619f7_137.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_139.png)

åœ¨å®é™…åº”ç”¨ä¸­ï¼Œç”¨æˆ·æ•°æ®é€šå¸¸å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚Node.jså¯ä»¥æ–¹ä¾¿åœ°è¿æ¥MySQLç­‰æ•°æ®åº“ã€‚

![](img/a55db4f1f30eb046ad44ad00bbe619f7_141.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_143.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_145.png)

### è¿æ¥ä¸æŸ¥è¯¢MySQL

![](img/a55db4f1f30eb046ad44ad00bbe619f7_147.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_149.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_151.png)

1.  å®‰è£…MySQLé©±åŠ¨åº“ï¼š
    ```bash
    npm install mysql
    ```
2.  ç¼–å†™æ•°æ®åº“æ“ä½œä»£ç ï¼š
    ```javascript
    const mysql = require('mysql');
    
    // åˆ›å»ºæ•°æ®åº“è¿æ¥
    const connection = mysql.createConnection({
        host: 'localhost',
        user: 'root',
        password: 'yourpassword',
        database: 'demo01'
    });
    
    connection.connect();
    
    // æ‰§è¡ŒSQLæŸ¥è¯¢
    const sql = `SELECT * FROM admin WHERE username='admin'`;
    connection.query(sql, (error, results) => {
        if (error) throw error;
        console.log(results); // æ‰“å°æŸ¥è¯¢ç»“æœ
        // ä¾‹å¦‚ï¼Œè·å–ç¬¬ä¸€è¡Œæ•°æ®çš„ç”¨æˆ·åï¼šresults[0].username
    });
    
    connection.end();
    ```

![](img/a55db4f1f30eb046ad44ad00bbe619f7_153.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_155.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_157.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_159.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_161.png)

### ä¸å®‰å…¨çš„SQLæ‹¼æ¥ä¸æ³¨å…¥é£é™©

![](img/a55db4f1f30eb046ad44ad00bbe619f7_163.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_165.png)

å¦‚æœç›´æ¥å°†ç”¨æˆ·è¾“å…¥æ‹¼æ¥åˆ°SQLè¯­å¥ä¸­ï¼Œå°±ä¼šäº§ç”Ÿä¸¥é‡çš„SQLæ³¨å…¥æ¼æ´ã€‚

![](img/a55db4f1f30eb046ad44ad00bbe619f7_167.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_168.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_170.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_172.png)

**ä¸å®‰å…¨å†™æ³•ç¤ºä¾‹**ï¼š
```javascript
// å‡è®¾ç”¨æˆ·è¾“å…¥çš„usernameæ¥è‡ª req.body.username
const userInput = req.body.username;
const sql = `SELECT * FROM users WHERE username='${userInput}'`; // ç›´æ¥æ‹¼æ¥ï¼Œå±é™©ï¼
connection.query(sql, (error, results) => {
    // ...
});
```
æ”»å‡»è€…å¯ä»¥è¾“å…¥ `admin' OR '1'='1` ä½œä¸ºç”¨æˆ·åï¼Œä»è€Œæ„é€ å‡ºæ°¸çœŸæ¡ä»¶ï¼Œç»•è¿‡ç™»å½•éªŒè¯ã€‚

![](img/a55db4f1f30eb046ad44ad00bbe619f7_174.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_176.png)

**å®‰å…¨å†™æ³•ï¼ˆä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢/é¢„ç¼–è¯‘ï¼‰**ï¼š
```javascript
const sql = `SELECT * FROM users WHERE username=?`;
connection.query(sql, [userInput], (error, results) => { // ä½¿ç”¨å ä½ç¬¦ ?
    // ...
});
```
å‚æ•°åŒ–æŸ¥è¯¢èƒ½æœ‰æ•ˆé˜²æ­¢SQLæ³¨å…¥ï¼Œå› ä¸ºå®ƒå°†ç”¨æˆ·è¾“å…¥çš„æ•°æ®çº¯ç²¹å½“ä½œæ•°æ®å¤„ç†ï¼Œè€ŒéSQLä»£ç çš„ä¸€éƒ¨åˆ†ã€‚

![](img/a55db4f1f30eb046ad44ad00bbe619f7_178.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_180.png)

---

![](img/a55db4f1f30eb046ad44ad00bbe619f7_182.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_184.png)

## ğŸ“ æ–‡ä»¶ç³»ç»Ÿæ“ä½œä¸ç›®å½•éå†æ¼æ´

![](img/a55db4f1f30eb046ad44ad00bbe619f7_186.png)

Node.jsçš„ `fs` æ¨¡å—æä¾›äº†æ–‡ä»¶ç³»ç»Ÿæ“ä½œåŠŸèƒ½ã€‚

### è¯»å–ç›®å½•å†…å®¹

```javascript
const fs = require('fs');

fs.readdir('./', (err, files) => {
    if (err) throw err;
    console.log(files); // æ‰“å°å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹åˆ—è¡¨
});
```

![](img/a55db4f1f30eb046ad44ad00bbe619f7_188.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_190.png)

### ä¸å®‰å…¨çš„æ–‡ä»¶è·¯å¾„æ‹¼æ¥

å¦‚æœå°†ç”¨æˆ·å¯æ§çš„å‚æ•°ç›´æ¥ç”¨äºæ–‡ä»¶è·¯å¾„æ“ä½œï¼Œå¯èƒ½å¯¼è‡´ç›®å½•éå†æ¼æ´ã€‚

![](img/a55db4f1f30eb046ad44ad00bbe619f7_192.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_194.png)

**æ¼æ´ç¤ºä¾‹**ï¼š
```javascript
app.get('/readfile', (req, res) => {
    const filePath = req.query.path; // ç”¨æˆ·ä¼ å…¥è·¯å¾„ï¼Œå¦‚ `../../etc/passwd`
    fs.readFile(filePath, (err, data) => { // ç›´æ¥ä½¿ç”¨ï¼Œå±é™©ï¼
        if (err) return res.send('æ–‡ä»¶è¯»å–å¤±è´¥');
        res.send(data);
    });
});
```
æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€  `../` åºåˆ—æ¥è®¿é—®æœåŠ¡å™¨ä¸Šçš„æ•æ„Ÿæ–‡ä»¶ã€‚

**é˜²æŠ¤æªæ–½**ï¼šå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼çš„è·¯å¾„è§„èŒƒåŒ–ã€ç™½åå•è¿‡æ»¤ï¼Œæˆ–ä½¿ç”¨å®‰å…¨çš„APIé™åˆ¶è®¿é—®èŒƒå›´ã€‚

![](img/a55db4f1f30eb046ad44ad00bbe619f7_196.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_198.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_200.png)

---

## âš¡ å‘½ä»¤æ‰§è¡Œä¸ä»£ç æ‰§è¡Œæ¼æ´

![](img/a55db4f1f30eb046ad44ad00bbe619f7_202.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_204.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_206.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_208.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_210.png)

Node.jsä¸­å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤æˆ–åŠ¨æ€æ‰§è¡ŒJavaScriptä»£ç ï¼Œå¦‚æœä½¿ç”¨ä¸å½“ï¼Œä¼šå¯¼è‡´ä¸¥é‡çš„å®‰å…¨æ¼æ´ã€‚

![](img/a55db4f1f30eb046ad44ad00bbe619f7_212.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_214.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_216.png)

### å‘½ä»¤æ‰§è¡Œï¼ˆCommand Executionï¼‰

![](img/a55db4f1f30eb046ad44ad00bbe619f7_218.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_220.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_221.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_223.png)

ä½¿ç”¨ `child_process` æ¨¡å—å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚

![](img/a55db4f1f30eb046ad44ad00bbe619f7_225.png)

```javascript
const { exec } = require('child_process');
const userInput = req.query.cmd; // ç”¨æˆ·è¾“å…¥å‘½ä»¤

// å±é™©ï¼ç›´æ¥æ‰§è¡Œç”¨æˆ·è¾“å…¥
exec(userInput, (error, stdout, stderr) => {
    // ...
});
```
å¦‚æœ `userInput` æ˜¯ `rm -rf /` æˆ–åå¼¹Shellçš„å‘½ä»¤ï¼Œå°†é€ æˆç¾éš¾æ€§åæœã€‚

### ä»£ç æ‰§è¡Œï¼ˆCode Evaluationï¼‰

ä½¿ç”¨ `eval()` æˆ– `Function` æ„é€ å‡½æ•°å¯ä»¥åŠ¨æ€æ‰§è¡Œå­—ç¬¦ä¸²å½¢å¼çš„JavaScriptä»£ç ã€‚

```javascript
const userInput = req.query.code; // ç”¨æˆ·è¾“å…¥ä»£ç ï¼Œå¦‚ `process.exit()` æˆ– `require('child_process').exec('rm -rf /')`
// å±é™©ï¼ç›´æ¥æ‰§è¡Œç”¨æˆ·è¾“å…¥çš„ä»£ç 
const result = eval(userInput);
```
è¿™ç›¸å½“äºèµ‹äºˆäº†æ”»å‡»è€…åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„Node.jsä»£ç çš„èƒ½åŠ›ã€‚

![](img/a55db4f1f30eb046ad44ad00bbe619f7_227.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_229.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_231.png)

**é˜²æŠ¤æ ¸å¿ƒ**ï¼š**æ°¸è¿œä¸è¦**å°†ç”¨æˆ·å¯æ§çš„è¾“å…¥ç›´æ¥ä¼ é€’ç»™ `exec`ã€`eval`ã€`Function` ç­‰å‡½æ•°ã€‚å¿…é¡»ä½¿ç”¨æ—¶ï¼Œåº”è¿›è¡Œä¸¥æ ¼çš„å‘½ä»¤/ä»£ç ç™½åå•è¿‡æ»¤ã€‚

![](img/a55db4f1f30eb046ad44ad00bbe619f7_233.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_235.png)

---

![](img/a55db4f1f30eb046ad44ad00bbe619f7_237.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_239.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_241.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_243.png)

## â›“ï¸ Node.jsç‰¹æœ‰æ¼æ´ï¼šåŸå‹é“¾æ±¡æŸ“

![](img/a55db4f1f30eb046ad44ad00bbe619f7_245.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_247.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_249.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_251.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_252.png)

åŸå‹é“¾æ±¡æŸ“æ˜¯JavaScript/Node.jsä¸­ä¸€ç§ç‰¹æœ‰çš„æ¼æ´ï¼Œå¸¸å‡ºç°åœ¨CTFæ¯”èµ›ä¸­ï¼Œå®æˆ˜ä¸­æ¡ä»¶è¾ƒä¸ºè‹›åˆ»ã€‚

### åŸå‹é“¾åŸºç¡€

![](img/a55db4f1f30eb046ad44ad00bbe619f7_254.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_256.png)

JavaScriptä¸­æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå†…éƒ¨å±æ€§ `__proto__`ï¼ˆåŸå‹ï¼‰ï¼ŒæŒ‡å‘å…¶æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ã€‚å½“è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„å±æ€§æ—¶ï¼Œå¦‚æœå¯¹è±¡æœ¬èº«æ²¡æœ‰ï¼ŒJavaScriptä¼šæ²¿ç€åŸå‹é“¾å‘ä¸ŠæŸ¥æ‰¾ã€‚

![](img/a55db4f1f30eb046ad44ad00bbe619f7_258.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_260.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_262.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_264.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_266.png)

### æ±¡æŸ“åŸç†

![](img/a55db4f1f30eb046ad44ad00bbe619f7_268.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_270.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_272.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_274.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_276.png)

å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿæ§åˆ¶å¹¶ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„åŸå‹ï¼ˆ`__proto__`ï¼‰ï¼Œé‚£ä¹ˆæ‰€æœ‰ç»§æ‰¿è‡ªè¯¥åŸå‹çš„å¯¹è±¡éƒ½ä¼šå—åˆ°å½±å“ã€‚

![](img/a55db4f1f30eb046ad44ad00bbe619f7_278.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_280.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_282.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_284.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_286.png)

**æ±¡æŸ“ç¤ºä¾‹**ï¼š
```javascript
const obj1 = {};
const obj2 = {};

![](img/a55db4f1f30eb046ad44ad00bbe619f7_288.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_290.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_292.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_294.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_296.png)

// æ­£å¸¸æƒ…å†µä¸‹ï¼Œobj2æ²¡æœ‰fooå±æ€§
console.log(obj2.foo); // undefined

![](img/a55db4f1f30eb046ad44ad00bbe619f7_298.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_300.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_302.png)

// é€šè¿‡obj1çš„åŸå‹é“¾æ±¡æŸ“å…¨å±€ObjectåŸå‹
obj1.__proto__.foo = 'polluted value';

![](img/a55db4f1f30eb046ad44ad00bbe619f7_304.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_306.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_308.png)

// æ­¤æ—¶ï¼Œæ‰€æœ‰å¯¹è±¡ï¼ˆåŒ…æ‹¬obj2ï¼‰éƒ½æœ‰äº†fooå±æ€§
console.log(obj2.foo); // è¾“å‡º: polluted value
```

![](img/a55db4f1f30eb046ad44ad00bbe619f7_310.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_312.png)

### æ¼æ´åˆ©ç”¨åœºæ™¯

![](img/a55db4f1f30eb046ad44ad00bbe619f7_314.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_316.png)

å½“ç¨‹åºå­˜åœ¨å¯¹è±¡åˆå¹¶æ“ä½œï¼ˆå¦‚ `Object.assign`ã€`lodash.merge` ç­‰ï¼‰ï¼Œä¸”åˆå¹¶çš„å‚æ•°ç”¨æˆ·å¯æ§æ—¶ï¼Œå°±å¯èƒ½æ±¡æŸ“åŸå‹é“¾ã€‚å¦‚æœåç»­ä»£ç é€»è¾‘ä¾èµ–äºæŸä¸ªå¯¹è±¡çš„å±æ€§ï¼ˆä¾‹å¦‚ï¼Œåˆ¤æ–­ `if (obj.isAdmin)`ï¼‰ï¼Œæ±¡æŸ“å¯èƒ½å¯¼è‡´æƒé™ç»•è¿‡ç­‰å®‰å…¨é—®é¢˜ã€‚

**å…³é”®ç‚¹**ï¼šåŸå‹é“¾æ±¡æŸ“æœ¬èº«ä¸æ˜¯ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼Œè€Œæ˜¯é€šè¿‡ä¿®æ”¹ç¨‹åºè¿è¡Œæ—¶çš„å¯¹è±¡å±æ€§ï¼Œå½±å“ç¨‹åºé€»è¾‘ï¼Œå¯èƒ½ä¸å…¶ä»–æ¼æ´ç»“åˆäº§ç”Ÿæ›´å¤§å±å®³ã€‚

---

![](img/a55db4f1f30eb046ad44ad00bbe619f7_318.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_320.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_321.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_323.png)

## ğŸ¯ æ€»ç»“ä¸å­¦ä¹ æ„ä¹‰

![](img/a55db4f1f30eb046ad44ad00bbe619f7_325.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_327.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_329.png)

æœ¬èŠ‚è¯¾æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†Node.jsçš„æ ¸å¿ƒæ¦‚å¿µå’ŒåŸºç¡€å¼€å‘ã€‚

![](img/a55db4f1f30eb046ad44ad00bbe619f7_331.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_333.png)

![](img/a55db4f1f30eb046ad44ad00bbe619f7_335.png)

**æˆ‘ä»¬é‡ç‚¹æŒæ¡äº†**ï¼š
1.  Node.jsä½œä¸ºæœåŠ¡ç«¯JavaScriptç¯å¢ƒçš„ç‰¹ç‚¹ã€‚
2.  ä½¿ç”¨Expressæ¡†æ¶æ­å»ºWebæœåŠ¡å™¨ï¼Œå¤„ç†GET/POSTè¯·æ±‚ã€‚
3.  è¿æ¥æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶è®¤è¯†åˆ°ä¸å®‰å…¨çš„SQLæ‹¼æ¥ä¼šå¯¼è‡´æ³¨å…¥æ¼æ´ã€‚
4.  ä½¿ç”¨ `fs` æ¨¡å—è¿›è¡Œæ–‡ä»¶æ“ä½œï¼Œäº†è§£ä¸å®‰å…¨çš„è·¯å¾„æ‹¼æ¥ä¼šå¯¼è‡´ç›®å½•éå†ã€‚
5.  è®¤è¯†åˆ° `child_process.exec` å’Œ `eval` ç­‰å‡½æ•°è¯¯ç”¨ä¼šå¼•å‘å‘½ä»¤/ä»£ç æ‰§è¡Œæ¼æ´ã€‚
6.  ç†è§£äº†JavaScriptåŸå‹é“¾æœºåˆ¶å’ŒåŸå‹é“¾æ±¡æŸ“æ¼æ´çš„åŸç†ã€‚

![](img/a55db4f1f30eb046ad44ad00bbe619f7_337.png)

**å­¦ä¹ Node.jså®‰å…¨å¼€å‘çš„æ„ä¹‰**ï¼š
*   **ä»£ç å®¡è®¡**ï¼šèƒ½å¤Ÿå®¡è®¡ä½¿ç”¨Node.jsç¼–å†™çš„Webåº”ç”¨æºç ï¼Œå‘ç°æ½œåœ¨å®‰å…¨æ¼æ´ã€‚
*   **CTFç«èµ›**ï¼šè®¸å¤šCTFé¢˜ç›®æ¶‰åŠNode.jsä»£ç å®¡è®¡å’ŒåŸå‹é“¾æ±¡æŸ“ç­‰çŸ¥è¯†ç‚¹ã€‚
*   **å®æˆ˜æ¸—é€**ï¼šäº’è”ç½‘ä¸Šå­˜åœ¨å¤§é‡Node.jsåº”ç”¨ï¼ˆå¦‚YApiæ¥å£ç®¡ç†å¹³å°ï¼‰ï¼ŒæŒæ¡å…¶å®‰å…¨ç‰¹æ€§æœ‰åŠ©äºåœ¨æ¸—é€æµ‹è¯•æˆ–æ”»é˜²æ¼”ç»ƒä¸­å‘ç°ç‹¬å®¶æ¼æ´ã€‚

![](img/a55db4f1f30eb046ad44ad00bbe619f7_339.png)

é€šè¿‡å°†å¼€å‘çŸ¥è¯†ä¸å®‰å…¨é—®é¢˜ç»“åˆï¼Œæˆ‘ä»¬ä¸ºåç»­æ·±å…¥å­¦ä¹ Webæ¼æ´åŸç†å’Œä»£ç å®¡è®¡æ‰“ä¸‹äº†åšå®çš„åŸºç¡€ã€‚ä¸‹èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°†æ¢è®¨å‰ç«¯æ‰“åŒ…å·¥å…·ï¼ˆå¦‚Webpackï¼‰å’Œç¬¬ä¸‰æ–¹åº“çš„å®‰å…¨é—®é¢˜ã€‚