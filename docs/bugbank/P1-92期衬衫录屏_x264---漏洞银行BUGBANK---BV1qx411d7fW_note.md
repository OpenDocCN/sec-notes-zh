# 漏洞挖掘奇思妙想教程 🧠💡

在本教程中，我们将跟随衬衫的分享，学习一套从信息收集到漏洞挖掘与绕过的实战思路。课程内容基于实际案例，旨在为初学者提供清晰、实用的指导。

---

## 1️⃣ 快速且全面的信息收集 🔍

上一节我们介绍了课程概述，本节中我们来看看如何进行高效的信息收集。传统的信息收集方法存在局限性，例如依赖老旧视频和工具。现在，我们将采用更快速、全面的方法。

以下是当前推荐的信息收集方法：

1.  **子域名收集**
    *   使用证书反查（如 `crt.sh`、`censys.io`）。
    *   结合字典进行子域名爆破。
    *   利用搜索引擎语法（如 `Google dork`、`Baidu dork`）。

2.  **端口扫描**
    *   使用 `nmap` 的增强扫描策略，例如：
        ```bash
        nmap -sS -A -Pn -p- --script=http-title scanme.nmap.org
        ```

3.  **JS文件分析**
    *   从JS文件中寻找API端点（`endpoint`）和敏感信息。可以使用工具如 `LinkFinder`。

4.  **端点搜集**
    *   利用公共数据集（如 `Common Crawl`）和网络时光机（`Wayback Machine`）发现历史端点。
    *   自动化脚本示例（获取 `Wayback Machine` 数据）：
        ```bash
        curl -s "http://web.archive.org/cdx/search/cdx?url=example.com/*&output=json" | grep -o "http[s]*://[^\"']*" | sort -u
        ```

---

## 2️⃣ 精准且机巧的漏洞挖掘 🎯

完成了信息收集，我们获得了大量资产数据。本节中我们来看看如何精准地从中挖掘漏洞。

挖掘漏洞的核心在于关注细节和尝试非常规思路。

1.  **从JS文件中寻找端点**
    *   使用Burp Suite插件（如 `JS Link Finder`）或搭建自动化工具，从JS文件中提取隐藏的API端点。

2.  **针对业务寻找重点**
    *   重点收集请求中的参数。
    *   尝试测试那些别人可能忽略的参数。
    *   对参数进行“盲测”，即不依赖回显，测试其是否存在注入等漏洞。

![](img/b7ec76ef54e8f2a282568994acbc018d_1.png)

3.  **过去漏洞的再利用**
    *   研究目标资产历史上的漏洞报告，尝试在新的上下文或通过绕过修复方案进行再利用。

4.  **使用工具辅助盲测**
    *   例如 `CloudFlair` 工具可用于在盲测中寻找子域名接管等漏洞。其原理是尝试解析大量子域名来发现可被接管的记录。

5.  **寻找非常规参数**
    *   使用强大的参数字典进行爆破，可能会发现像 `imageURL` 这样的隐藏参数，从而找到SSRF等漏洞。

---

## 3️⃣ 省力且有效的限制绕过 🛡️➡️🚪

在挖掘漏洞时，我们常常会遇到各种安全限制。本节中我们来看看如何巧妙地绕过这些限制。

绕过限制的关键在于使用现成的Payload字典和了解各种绕过技巧。

1.  **利用Payload字典**
    *   整合多个来源的Payload字典（如 `SecLists`、`FuzzDB`），并进行去重，以提高测试覆盖率和效率。

2.  **自动化绕过工具**
    *   使用如 `ffuf` 等工具，可以方便地批量测试路径、参数和Payload。
    *   示例：使用 `ffuf` 测试路径遍历。
        ```bash
        ffuf -w payloads.txt -u https://target.com/FUZZ
        ```

3.  **WAF/限制绕过案例**
    *   **URL跳转绕过**：当遇到白名单限制时，可以尝试使用 `@` 符号、畸形URL编码等方式绕过。例如：`https://target.com/redirect?url=https://google.com@evil.com`。
    *   **CSRF Token绕过**：
        *   删除Token参数或置空其值。
        *   尝试修改HTTP请求方法（如POST改为GET）。
        *   使用与Token相同长度的任意字符串进行替换。
        *   尝试固定Token（即不同用户间Token复用）。

4.  **编码绕过**
    *   利用各种编码（如Unicode、URL编码、HTML实体编码）来混淆Payload，绕过基于关键词的过滤。
    *   例如，尖括号 `<` 和 `>` 可以编码为 `%3C` 和 `%3E`。

5.  **漏洞组合利用**
    *   将多个低危或中危漏洞组合，可能产生高危影响。
    *   **XSS + CSRF**：利用XSS窃取Token或发起CSRF攻击。
    *   **SSRF + Open Redirect**：利用SSRF访问内部Open Redirect端点，实现外部攻击链。
    *   **Self-XSS + 越权**：将需要用户交互的Self-XSS与越权漏洞结合，扩大影响范围。

---

## 4️⃣ 有趣且新奇的知识分享 🧩

掌握了基本方法后，我们来看看一些有趣且需要深入思考的高级技巧。本节将分享几个需要特定条件或巧妙思路的漏洞案例。

这些案例展示了漏洞挖掘中深度思考和知识结合的重要性。

1.  **CORS绕过新思路**
    *   利用浏览器对特殊字符（如 `_`, `-`）在域名中的支持差异。如果目标站点的CORS策略使用正则匹配 `*.target.com`，可以尝试注册包含特殊字符的子域名（如 `sub_domain.target.com`）来绕过。

![](img/b7ec76ef54e8f2a282568994acbc018d_3.png)

![](img/b7ec76ef54e8f2a282568994acbc018d_5.png)

2.  **相对路径覆盖（RPO）**
    *   利用服务器和浏览器解析路径的差异。例如，当服务器将 `api/../test.html` 中的 `../` 解析为目录回溯，而浏览器将其作为文件名的一部分时，可能导致CSS或JS文件被错误加载，从而引发XSS。

3.  **账户接管（ATO）新姿势**
    *   在修改账户信息的请求中，如果关键参数（如用户ID）被加密，可以尝试寻找其他接口来“加密”我们控制的输入，从而获得有效的加密值，再将其用于目标接口完成越权操作。

4.  **SSRF与Open Redirect组合**
    *   案例：首先发现一个SSRF，但其限制只能访问 `api.target.com` 域下。然后在该域下发现一个端点，会301跳转到主站 `www.target.com`。最后，在主站上找到一个Open Redirect漏洞。通过SSRF访问跳转端点，并指向Open Redirect的地址，最终实现将SSRF流量导向任意外部网站。

5.  **上传漏洞的奇技淫巧**
    *   案例：通过Fuzz发现上传点接收 `file”.gif` 这样的文件名。结合某些浏览器（如旧版IE）根据文件名而非内容类型（MIME Type）决定如何渲染文件的特性，上传一个包含HTML代码但名为 `file”.gif` 的文件，访问时可能被浏览器当作HTML解析，从而执行XSS。

6.  **IDOR（越权访问）的深入挖掘**
    *   当遇到加密参数时，不要轻易放弃。尝试寻找系统内其他可能生成或使用此加密值的接口，通过“加密-解密”或“获取-使用”的关联，构造出有效的越权请求。

---

![](img/b7ec76ef54e8f2a282568994acbc018d_7.png)

## 总结 📚

在本节课中，我们一起学习了衬衫分享的漏洞挖掘全流程思路：
1.  **信息收集**：告别传统低效方式，利用证书、JS文件、公共数据集和时光机进行快速全面的资产发现。
2.  **漏洞挖掘**：聚焦端点与参数，利用自动化工具进行盲测，并善于从历史漏洞和他人忽略的角落寻找机会。
3.  **限制绕过**：善用Payload字典和自动化工具，掌握编码、漏洞组合等技巧，有效突破WAF和各类防护。
4.  **高阶技巧**：通过CORS、RPO、漏洞链组合等案例，认识到深入理解系统逻辑和浏览器特性在挖掘复杂漏洞时的重要性。

![](img/b7ec76ef54e8f2a282568994acbc018d_9.png)

这套方法的核心在于**自动化、精细化思考和不断尝试新思路**。希望这些内容能为你打开漏洞挖掘的新视野。