# 课程 P1：初识域渗透 v2.0 🏰

![](img/55c47fb1b8593331d1e94bc4f624a467_1.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_3.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_4.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_5.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_6.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_7.png)

在本节课中，我们将要学习内网渗透的基础知识，特别是关于“域”环境的核心概念。我们将了解什么是域、域渗透的基本流程以及相关的关键术语，为后续深入学习打下基础。

![](img/55c47fb1b8593331d1e94bc4f624a467_8.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_9.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_10.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_11.png)

## 概述

![](img/55c47fb1b8593331d1e94bc4f624a467_12.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_13.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_14.png)

欢迎参加第105期漏洞银行安全技术直播“大咖面对面”。本次课程的主题是“初识域渗透”。我们将从一个简单的比喻开始，逐步深入到技术细节。

![](img/55c47fb1b8593331d1e94bc4f624a467_15.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_16.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_17.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_18.png)

## 什么是域？🌐

![](img/55c47fb1b8593331d1e94bc4f624a467_19.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_20.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_21.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_22.png)

上一节我们介绍了课程主题，本节中我们来看看“域”到底是什么。

![](img/55c47fb1b8593331d1e94bc4f624a467_23.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_24.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_25.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_26.png)

可以将“域”理解为一个大型公司的内部网络。在这个网络中，有一台核心服务器（域控制器）负责管理所有员工的电脑（域成员）账户和权限。这就像公司的人事部，掌握着所有员工的档案和门禁卡权限。

![](img/55c47fb1b8593331d1e94bc4f624a467_27.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_28.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_29.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_30.png)

**核心公式**：
```
域环境 = 域控制器 (DC) + 域成员 (Client) + 活动目录 (AD)
```

![](img/55c47fb1b8593331d1e94bc4f624a467_31.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_32.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_33.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_34.png)

## 域渗透的基本目标 🎯

![](img/55c47fb1b8593331d1e94bc4f624a467_35.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_36.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_37.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_38.png)

理解了域的概念后，我们来看看渗透测试人员在域环境中的主要目标。

![](img/55c47fb1b8593331d1e94bc4f624a467_39.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_40.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_41.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_42.png)

简单来说，最终目标是获取**域控制器**的最高控制权，即成为“域管理员”。一旦获得此权限，就意味着可以控制整个域内的所有计算机和资源。

![](img/55c47fb1b8593331d1e94bc4f624a467_43.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_44.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_45.png)

以下是渗透测试中常见的几个阶段性目标：
*   **获取本地管理员权限**：控制单台计算机。
*   **获取域普通用户权限**：能够以域用户身份登录域内其他机器。
*   **权限提升**：从普通用户提升为域管理员。
*   **横向移动**：从已控制的机器，向域内其他机器扩散控制权。
*   **持久化**：在目标系统中留下后门，保证长期控制。

![](img/55c47fb1b8593331d1e94bc4f624a467_46.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_47.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_48.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_49.png)

## 核心概念与术语 📖

![](img/55c47fb1b8593331d1e94bc4f624a467_50.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_51.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_52.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_53.png)

为了顺利进行后续学习，我们需要掌握一些关键术语。以下是域渗透中必须了解的基本概念：

![](img/55c47fb1b8593331d1e94bc4f624a467_54.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_55.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_56.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_57.png)

*   **活动目录 (AD)**：域控制器上用于存储所有网络对象（用户、组、计算机、策略）的数据库服务。它是域的“大脑”。
*   **域控制器 (DC)**：运行活动目录服务的服务器，负责域内所有认证和管理工作。
*   **域成员**：加入域并接受域控制器管理的计算机。
*   **组策略 (GPO)**：域控制器下发给域成员的统一配置和管理策略，如密码策略、软件安装等。
*   **信任关系**：不同域之间建立的桥梁，允许一个域的用户访问另一个域的资源。

![](img/55c47fb1b8593331d1e94bc4f624a467_58.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_59.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_60.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_61.png)

## 一个简单的渗透流程示例 🔄

![](img/55c47fb1b8593331d1e94bc4f624a467_62.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_63.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_64.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_65.png)

现在，让我们将上述概念串联起来，看一个简化的攻击流程示例。

![](img/55c47fb1b8593331d1e94bc4f624a467_66.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_67.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_68.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_69.png)

假设攻击者已经通过某种方式（如钓鱼邮件）进入内网，并控制了一台普通的域成员计算机。

![](img/55c47fb1b8593331d1e94bc4f624a467_70.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_71.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_72.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_73.png)

**基本流程代码描述**：
```plaintext
1. 信息收集 (Information Gathering)
   -> 执行命令：`net view /domain` 查看域名称
   -> 执行命令：`net group “domain computers” /domain` 查看域内计算机

![](img/55c47fb1b8593331d1e94bc4f624a467_74.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_75.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_76.png)

2. 权限提升 (Privilege Escalation)
   -> 在本地计算机寻找漏洞，从普通用户提权为本地管理员。

![](img/55c47fb1b8593331d1e94bc4f624a467_77.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_78.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_79.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_80.png)

3. 凭证窃取 (Credential Theft)
   -> 转储内存中的密码哈希：使用工具如 Mimikatz
   -> 代码示例（概念）：`sekurlsa::logonpasswords`

![](img/55c47fb1b8593331d1e94bc4f624a467_81.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_82.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_83.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_84.png)

4. 横向移动 (Lateral Movement)
   -> 利用窃取的凭证，尝试登录域内其他计算机。
   -> 例如使用：`psexec \\目标IP -u 域用户 -p 密码 cmd`

![](img/55c47fb1b8593331d1e94bc4f624a467_85.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_86.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_87.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_88.png)

5. 定位域管理员 (Find Domain Admin)
   -> 寻找域管理员登录的机器，并设法控制它。

![](img/55c47fb1b8593331d1e94bc4f624a467_89.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_90.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_91.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_92.png)

6. 攻击域控制器 (Attack Domain Controller)
   -> 利用获取的高权限，最终攻陷域控制器。
```

![](img/55c47fb1b8593331d1e94bc4f624a467_93.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_94.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_95.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_96.png)

这个过程清晰地展示了攻击者如何一步步从边缘位置渗透到网络核心。

![](img/55c47fb1b8593331d1e94bc4f624a467_97.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_98.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_99.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_100.png)

## 总结

![](img/55c47fb1b8593331d1e94bc4f624a467_101.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_102.png)

![](img/55c47fb1b8593331d1e94bc4f624a467_103.png)

本节课中我们一起学习了域渗透的基础知识。我们首先将“域”类比为公司的管理体系，理解了域控制器、活动目录等核心组件的作用。然后，我们明确了域渗透的终极目标是获取域控制器的最高权限，并梳理了达成此目标可能经历的步骤，如信息收集、权限提升和横向移动。最后，通过一个简化的流程示例，我们将这些概念和步骤串联起来，形成了一个初步的认知框架。掌握这些基础知识是后续学习具体渗透技术和工具的前提。