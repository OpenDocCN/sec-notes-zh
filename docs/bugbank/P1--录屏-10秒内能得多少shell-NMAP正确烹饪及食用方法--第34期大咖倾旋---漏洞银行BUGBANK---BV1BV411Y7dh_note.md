# ğŸ› ï¸ è¯¾ç¨‹ P1ï¼šNMAP çš„æ­£ç¡®çƒ¹é¥ªåŠé£Ÿç”¨æ–¹æ³•â€”â€”ç¬¬ 34 æœŸå¤§å’–å€¾æ—‹

![](img/a7df427e55f695eab8b0dd8069b1cc49_1.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_3.png)

åœ¨æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†è¦å­¦ä¹ å¦‚ä½•é«˜æ•ˆåœ°ä½¿ç”¨ NMAP è¿™æ¬¾å¼ºå¤§çš„ç½‘ç»œæ‰«æå·¥å…·ï¼Œå¹¶æ·±å…¥äº†è§£å…¶è„šæœ¬å¼•æ“ï¼ˆNSEï¼‰çš„æ‰©å±•èƒ½åŠ›ã€‚æˆ‘ä»¬å°†ä»èµ„äº§æ‰«æçš„åŸºæœ¬æ¦‚å¿µè®²èµ·ï¼Œé€æ­¥æ·±å…¥åˆ° NMAP çš„å†…éƒ¨ç»“æ„ã€æ‰«ææµç¨‹ï¼Œå¹¶æœ€ç»ˆå­¦ä¹ å¦‚ä½•ç¼–å†™è‡ªå®šä¹‰çš„ NSE è„šæœ¬æ¥å®ç°è‡ªåŠ¨åŒ–æ¼æ´æ£€æµ‹ç”šè‡³åˆ©ç”¨ã€‚

![](img/a7df427e55f695eab8b0dd8069b1cc49_5.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_7.png)

## ğŸ“– æ¦‚è¿°ï¼šèµ„äº§æ‰«æä¸ NMAP ç®€ä»‹

![](img/a7df427e55f695eab8b0dd8069b1cc49_9.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_11.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_13.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_15.png)

èµ„äº§æ‰«ææ˜¯ç½‘ç»œå®‰å…¨çš„åŸºç¡€å·¥ä½œã€‚å¯¹äºå‚å•†è€Œè¨€ï¼Œèµ„äº§æ‰«ææœ‰åŠ©äºè¯„ä¼°å†…éƒ¨ç½‘ç»œçš„å®‰å…¨ç­‰çº§ï¼Œå‘ç°æœªä¿®è¡¥çš„æ¼æ´ï¼Œä»è€Œé™ä½åŠå…¬ç½‘ç»œçš„é£é™©ã€‚å¯¹äºå®‰å…¨ç ”ç©¶äººå‘˜ï¼ˆç™½å¸½å­ï¼‰è€Œè¨€ï¼Œåˆ™å¯ä»¥åœ¨å‚å•†ä¿®å¤æ¼æ´ä¹‹å‰ï¼Œè¿…é€Ÿå®šä½æµ‹è¯•ç›®æ ‡ï¼Œå¯»æ‰¾çªç ´ç‚¹ã€‚

![](img/a7df427e55f695eab8b0dd8069b1cc49_17.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_19.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_21.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_23.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_25.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_27.png)

ä¸€ä¸ªå®Œæ•´çš„èµ„äº§æ‰«ææµç¨‹é€šå¸¸åŒ…æ‹¬ï¼šç¡®å®šç›®æ ‡ï¼ˆå¦‚åŸŸåæˆ– IP æ®µï¼‰ã€æ”¶é›†ä¿¡æ¯ï¼ˆå¦‚å­åŸŸåï¼‰ã€æ‰«ææ¢æµ‹ç«¯å£ã€ç”ŸæˆæŠ¥å‘Šã€åˆ†æè„†å¼±ç‚¹å¹¶è¿›ä¸€æ­¥æŒ–æ˜æ¼æ´ã€‚ä¸ºäº†æé«˜æ•ˆç‡å’Œæ•°æ®å¯æ“ä½œæ€§ï¼Œæ‰«æç»“æœé€šå¸¸ä¼šå­˜å…¥æ•°æ®åº“ï¼Œä»¥ä¾¿è¿›è¡Œçµæ´»çš„ç­›é€‰ã€æ±‡æ€»å’Œå¯¼å‡ºã€‚

![](img/a7df427e55f695eab8b0dd8069b1cc49_29.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_31.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_33.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_35.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_37.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_39.png)

åœ¨ä¼—å¤šæ‰«æå·¥å…·ä¸­ï¼ŒNMAP å› å…¶å¼ºå¤§å’Œçµæ´»è€Œå¹¿ä¸ºäººçŸ¥ã€‚å®ƒæ˜¯ä¸€æ¬¾å¼€æºçš„ç½‘ç»œæ¢æµ‹å’Œå®‰å…¨å®¡æ ¸å·¥å…·ï¼Œä»¥å…¶å¿«é€Ÿçš„æ‰«æé€Ÿåº¦ã€å¼ºå¤§çš„æŒ‡çº¹åº“å’Œå¯æ‰©å±•çš„è„šæœ¬å¼•æ“è€Œè‘—ç§°ã€‚

![](img/a7df427e55f695eab8b0dd8069b1cc49_41.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_43.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_45.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_47.png)

## ğŸ” NMAP æ ¸å¿ƒç»“æ„ä¸åŠŸèƒ½

![](img/a7df427e55f695eab8b0dd8069b1cc49_49.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_51.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_53.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_55.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_57.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_59.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_61.png)

ä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†èµ„äº§æ‰«æçš„åŸºæœ¬æ¦‚å¿µï¼Œæœ¬èŠ‚ä¸­æˆ‘ä»¬æ¥çœ‹çœ‹ NMAP è¿™æ¬¾å·¥å…·çš„å…·ä½“æ„æˆã€‚

![](img/a7df427e55f695eab8b0dd8069b1cc49_63.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_65.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_67.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_69.png)

NMAP ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç«¯å£æ‰«æå™¨ï¼Œå®ƒçš„å¼ºå¤§æºäºä¸‰ä¸ªæ ¸å¿ƒéƒ¨åˆ†ï¼š**åº•å±‚çš„æ‰«æå¼•æ“**ã€**ä¸°å¯Œçš„æŒ‡çº¹åº“** å’Œ **å¯æ‰©å±•çš„è„šæœ¬å¼•æ“ï¼ˆNSEï¼‰**ã€‚

![](img/a7df427e55f695eab8b0dd8069b1cc49_71.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_73.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_75.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_77.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_79.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_81.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_83.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_85.png)

### æ–‡ä»¶ç›®å½•ç»“æ„

![](img/a7df427e55f695eab8b0dd8069b1cc49_87.png)

åœ¨ Linux ç³»ç»Ÿä¸­ï¼ŒNMAP å®‰è£…åçš„ç›®å½•åŒ…å«å¤šä¸ªå…³é”®æ–‡ä»¶ï¼š

![](img/a7df427e55f695eab8b0dd8069b1cc49_89.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_91.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_93.png)

*   `nmap.dtd`: ç”¨äºå®šä¹‰ XML è¾“å‡ºæ ¼å¼ã€‚
*   `nmap-service-probes`, `nmap-os-db` ç­‰: è¿™äº›æ˜¯**æŒ‡çº¹åº“æ–‡ä»¶**ã€‚å®ƒä»¬åŒ…å«äº†ç”¨äºè¯†åˆ«æœåŠ¡ç±»å‹ã€ç‰ˆæœ¬ç”šè‡³æ“ä½œç³»ç»Ÿçš„ç‰¹å¾è§„åˆ™ã€‚NMAP é€šè¿‡å‘ç›®æ ‡ç«¯å£å‘é€ç‰¹å®šæ¢æµ‹åŒ…ï¼Œå¹¶å°†è¿”å›ç»“æœä¸è¿™äº›æŒ‡çº¹è¿›è¡Œæ­£åˆ™åŒ¹é…ï¼Œä»è€Œè¯†åˆ«å‡ºè¿è¡Œçš„æœåŠ¡å’Œç‰ˆæœ¬ã€‚
*   `nmap.xsl`: ç”¨äºæ ¼å¼åŒ– XML è¾“å‡ºæŠ¥å‘Šçš„æ¨¡æ¿ã€‚
*   `nse_main.lua`: è¿™æ˜¯ NSE è„šæœ¬å¼•æ“çš„**ä¸»åŠ è½½æ–‡ä»¶**ã€‚åœ¨æ‰§è¡Œä»»ä½• NSE è„šæœ¬ä¹‹å‰ï¼ŒNMAP ä¼šå…ˆåŠ è½½å¹¶æ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œå®Œæˆä¸€äº›åˆå§‹åŒ–å·¥ä½œã€‚
*   `nselib/` ç›®å½•: è¿™æ˜¯ NSE çš„**æ‰©å±•åº“ç›®å½•**ã€‚é‡Œé¢åŒ…å«äº†å¤§é‡å°è£…å¥½çš„å‡½æ•°æ¨¡å—ï¼ˆå¦‚ HTTPã€MySQL è¯·æ±‚åº“ï¼‰ï¼Œæå¤§æ–¹ä¾¿äº†è„šæœ¬ç¼–å†™ã€‚å¦‚æœæ²¡æœ‰è¿™äº›åº“ï¼ŒNMAP çš„æ‰©å±•èƒ½åŠ›å°†å¤§æ‰“æŠ˜æ‰£ã€‚
*   `scripts/` ç›®å½•: å­˜æ”¾äº†æ‰€æœ‰å†…ç½®çš„ **NSE è„šæœ¬**ï¼Œæ¶µç›–äº†æ¼æ´æ£€æµ‹ã€æš´åŠ›ç ´è§£ã€æœåŠ¡å‘ç°ç­‰å¤šç§åŠŸèƒ½ã€‚

![](img/a7df427e55f695eab8b0dd8069b1cc49_95.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_97.png)

### åŸºæœ¬æ‰«ææµç¨‹

![](img/a7df427e55f695eab8b0dd8069b1cc49_99.png)

NMAP æ‰§è¡Œä¸€æ¬¡æ‰«æï¼Œé€šå¸¸éµå¾ªä»¥ä¸‹æµç¨‹ï¼š
1.  **ä¸»æœºå‘ç°**: åˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯å¦åœ¨çº¿ï¼ˆä¾‹å¦‚é€šè¿‡ TCP SYNã€ACK åŒ…æˆ– ICMP è¯·æ±‚ï¼‰ã€‚
2.  **ç«¯å£æ‰«æ**: æ¢æµ‹ç›®æ ‡ä¸»æœºä¸Šå“ªäº›ç«¯å£æ˜¯å¼€æ”¾çš„ã€‚
3.  **æœåŠ¡ä¸ç‰ˆæœ¬ä¾¦æµ‹**: åˆ©ç”¨æŒ‡çº¹åº“ï¼Œè¯†åˆ«å¼€æ”¾ç«¯å£ä¸Šè¿è¡Œçš„æœåŠ¡åŠå…¶å…·ä½“ç‰ˆæœ¬ã€‚
4.  **æ“ä½œç³»ç»Ÿä¾¦æµ‹**: é€šè¿‡åˆ†æ TCP/IP åè®®æ ˆçš„ç»†å¾®å·®å¼‚ï¼ˆå¦‚ TTL å€¼ï¼‰ï¼ŒçŒœæµ‹ç›®æ ‡ä¸»æœºçš„æ“ä½œç³»ç»Ÿã€‚
5.  **è„šæœ¬æ‰«æ**: æ ¹æ®å‰é¢æ­¥éª¤çš„ç»“æœï¼Œè°ƒç”¨ç›¸åº”çš„ NSE è„šæœ¬è¿›è¡Œæ›´æ·±å±‚æ¬¡çš„æ£€æµ‹æˆ–åˆ©ç”¨ã€‚

![](img/a7df427e55f695eab8b0dd8069b1cc49_101.png)

## âš™ï¸ æ·±å…¥ NSE è„šæœ¬å¼•æ“

![](img/a7df427e55f695eab8b0dd8069b1cc49_103.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_105.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_107.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_109.png)

äº†è§£äº† NMAP çš„åŸºæœ¬ç»“æ„åï¼Œæœ¬èŠ‚æˆ‘ä»¬å°†é‡ç‚¹æ¢è®¨å…¶æœ€å¼ºå¤§çš„ç‰¹æ€§â€”â€”NSE è„šæœ¬å¼•æ“ã€‚

![](img/a7df427e55f695eab8b0dd8069b1cc49_111.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_113.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_115.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_117.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_119.png)

NSE å…è®¸ç”¨æˆ·ä½¿ç”¨ Lua è¯­è¨€ç¼–å†™è„šæœ¬ï¼Œå¯¹å‘ç°çš„ä¸»æœºå’Œç«¯å£è¿›è¡Œè‡ªå®šä¹‰æ“ä½œï¼ŒåŒ…æ‹¬æ¼æ´å‘ç°ã€éªŒè¯ã€åˆ©ç”¨ã€æš´åŠ›ç ´è§£ç­‰ã€‚è¿™ä½¿å¾— NMAP ä»ä¸€ä¸ªæ‰«æå·¥å…·è½¬å˜ä¸ºä¸€æ¬¾å¼ºå¤§çš„æ¸—é€æµ‹è¯•å·¥å…·ã€‚

![](img/a7df427e55f695eab8b0dd8069b1cc49_121.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_123.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_125.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_127.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_129.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_131.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_133.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_135.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_137.png)

### NSE è„šæœ¬æ‰§è¡Œæµç¨‹ä¸ API

![](img/a7df427e55f695eab8b0dd8069b1cc49_139.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_141.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_143.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_145.png)

ä¸€ä¸ª NSE è„šæœ¬çš„æ‰§è¡Œç”±å‡ ä¸ªç‰¹å®šçš„å‡½æ•°ï¼ˆè§„åˆ™ï¼‰æ§åˆ¶ï¼Œå®ƒä»¬æŒ‰é¡ºåºè¢«è°ƒç”¨ï¼š

![](img/a7df427e55f695eab8b0dd8069b1cc49_147.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_149.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_151.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_153.png)

1.  `prerule()`: åœ¨æ‰€æœ‰æ‰«æå¼€å§‹**ä¹‹å‰**æ‰§è¡Œã€‚å¸¸ç”¨äºåˆå§‹åŒ–å…¨å±€å˜é‡æˆ–æ£€æŸ¥è„šæœ¬å‚æ•°ã€‚
2.  `hostrule(host)`: åœ¨**ä¸»æœºå‘ç°**åï¼Œé’ˆå¯¹æ¯ä¸ªè¢«å‘ç°çš„ä¸»æœºæ‰§è¡Œä¸€æ¬¡ã€‚
3.  `portrule(host, port)`: åœ¨**ç«¯å£æ‰«æ**åï¼Œé’ˆå¯¹æ¯ä¸ªç¬¦åˆæ¡ä»¶çš„ä¸»æœºå’Œç«¯å£ç»„åˆæ‰§è¡Œä¸€æ¬¡ã€‚è¿™æ˜¯æœ€å¸¸ç”¨çš„è§„åˆ™ã€‚
4.  `action(host, port)`: å½“ `hostrule` æˆ– `portrule` å‡½æ•°è¿”å› `true` æ—¶ï¼Œä¼šæ‰§è¡Œå¯¹åº”çš„ `action` å‡½æ•°ã€‚è¿™é‡Œæ˜¯è„šæœ¬ä¸»è¦é€»è¾‘æ‰€åœ¨ã€‚
5.  `postrule()`: åœ¨æ‰€æœ‰æ‰«æ**ä¹‹å**æ‰§è¡Œã€‚å¸¸ç”¨äºæœ€ç»ˆçš„æ•°æ®è¾“å‡ºå’Œæ¸…ç†ã€‚

![](img/a7df427e55f695eab8b0dd8069b1cc49_155.png)

**æ ¸å¿ƒæ¦‚å¿µå…¬å¼**ï¼š
```
å¦‚æœ (hostrule(host) è¿”å› true) æˆ– (portrule(host, port) è¿”å› true)
åˆ™ æ‰§è¡Œ action(host, port)
```

![](img/a7df427e55f695eab8b0dd8069b1cc49_157.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_159.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_161.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_163.png)

### ç¼–å†™ä¸€ä¸ªç®€å•çš„ NSE è„šæœ¬

![](img/a7df427e55f695eab8b0dd8069b1cc49_165.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_167.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_169.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_171.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_173.png)

ä»¥ä¸‹æ˜¯åˆ›å»ºä¸€ä¸ªç®€å•æµ‹è¯•è„šæœ¬çš„æ­¥éª¤ï¼Œç”¨äºç†è§£æ‰§è¡Œæµç¨‹ï¼š

![](img/a7df427e55f695eab8b0dd8069b1cc49_175.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_177.png)

```lua
-- å®šä¹‰ä¸€ä¸ªç®€å•çš„æµ‹è¯•è„šæœ¬ test.nse
prerule = function()
    print("prerule æ‰§è¡Œ")
end

![](img/a7df427e55f695eab8b0dd8069b1cc49_179.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_181.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_183.png)

portrule = function(host, port)
    -- åªå¯¹å¼€æ”¾çŠ¶æ€çš„ TCP ç«¯å£æ‰§è¡Œæ“ä½œ
    if port.state == "open" and port.protocol == "tcp" then
        print("ç«¯å£æ‰«æåˆ°: " .. host.ip .. ":" .. port.number)
        return true -- è¿”å› true ä»¥è§¦å‘ action
    end
    return false
end

![](img/a7df427e55f695eab8b0dd8069b1cc49_185.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_187.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_189.png)

action = function(host, port)
    print("action æ‰§è¡Œäº " .. host.ip .. ":" .. port.number)
    -- è¿™é‡Œå¯ä»¥æ’å…¥å®é™…çš„æ‰«ææˆ–åˆ©ç”¨é€»è¾‘
end

![](img/a7df427e55f695eab8b0dd8069b1cc49_191.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_193.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_195.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_197.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_199.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_201.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_203.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_205.png)

postrule = function()
    print("postrule æ‰§è¡Œ")
end
```

![](img/a7df427e55f695eab8b0dd8069b1cc49_207.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_209.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_211.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_213.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_215.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_217.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_219.png)

ä½¿ç”¨å‘½ä»¤è¿è¡Œè¯¥è„šæœ¬ï¼š
```bash
nmap --script test.nse -p 80 127.0.0.1
```

![](img/a7df427e55f695eab8b0dd8069b1cc49_221.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_223.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_225.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_227.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_229.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_231.png)

## ğŸš€ å®æˆ˜æ¼”ç¤ºï¼š10 ç§’å†… Get Shell

![](img/a7df427e55f695eab8b0dd8069b1cc49_233.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_235.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_237.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_239.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_241.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_243.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_245.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_247.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_249.png)

ç†è®ºéœ€è¦å®è·µæ¥éªŒè¯ã€‚æœ¬èŠ‚æˆ‘ä»¬å°†é€šè¿‡ä¸€ä¸ªçœŸå®æ¼æ´æ¡ˆä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•åˆ©ç”¨ NSE è„šæœ¬å®ç°å¿«é€Ÿæ£€æµ‹å’Œåˆ©ç”¨ã€‚

![](img/a7df427e55f695eab8b0dd8069b1cc49_251.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_253.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_255.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_257.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_259.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_261.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_263.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_265.png)

æˆ‘ä»¬ä»¥ `Struts2 S2-045` è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ä¸ºä¾‹ã€‚NMAP å®˜æ–¹å·²æä¾›äº†æ£€æµ‹è„šæœ¬ (`http-vuln-cve2017-5638.nse`)ï¼Œå®ƒå¯ä»¥è¯†åˆ«ç›®æ ‡æ˜¯å¦å­˜åœ¨æ­¤æ¼æ´ã€‚

![](img/a7df427e55f695eab8b0dd8069b1cc49_267.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_269.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_271.png)

**ç„¶è€Œï¼Œæˆ‘ä»¬å¯ä»¥æ›´è¿›ä¸€æ­¥**ï¼Œç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰çš„åˆ©ç”¨è„šæœ¬ï¼Œåœ¨æ£€æµ‹åˆ°æ¼æ´çš„åŒæ—¶ï¼Œç›´æ¥ä¸Šä¼ ä¸€ä¸ª WebShellï¼Œå®ç°â€œ10ç§’å†…Get Shellâ€çš„ç›®æ ‡ï¼ˆå®é™…æ—¶é—´å–å†³äºç½‘ç»œå’Œå‚æ•°ï¼‰ã€‚

![](img/a7df427e55f695eab8b0dd8069b1cc49_273.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_275.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_277.png)

ä»¥ä¸‹æ˜¯è¯¥åˆ©ç”¨è„šæœ¬çš„æ ¸å¿ƒé€»è¾‘ç®€è¿°ï¼š
1.  **æ¼æ´æ£€æµ‹**: å‘ç›®æ ‡å‘é€ä¸€ä¸ªç‰¹æ®Šçš„ HTTP è¯·æ±‚ï¼Œè¯¥è¯·æ±‚åœ¨ `Content-Type` å¤´éƒ¨åŒ…å«ä¸€ä¸ªå¸¦éšæœºå­—ç¬¦ä¸²çš„æµ‹è¯•è½½è·ã€‚å¦‚æœå“åº”å¤´ä¸­åŒ…å«ç›¸åŒçš„å­—ç¬¦ä¸²ï¼Œåˆ™è¯æ˜æ¼æ´å­˜åœ¨ã€‚
2.  **æ¼æ´åˆ©ç”¨**: å¦‚æœæ¼æ´å­˜åœ¨ï¼Œåˆ™æ„é€ å¦ä¸€ä¸ª HTTP è¯·æ±‚åŒ…ï¼Œå…¶ä¸­åŒ…å«èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å¹¶å†™å…¥ WebShell æ–‡ä»¶çš„æ¶æ„è½½è·ã€‚
3.  **æ‰§è¡Œå‘½ä»¤**: è„šæœ¬ä¼šå‘é€ä¸Šä¼  WebShell çš„è¯·æ±‚ï¼Œå¦‚æœæˆåŠŸï¼Œæ”»å‡»è€…å°±èƒ½é€šè¿‡è®¿é—®ç‰¹å®šçš„ URL æ¥æ‰§è¡Œå‘½ä»¤ã€‚

![](img/a7df427e55f695eab8b0dd8069b1cc49_279.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_281.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_283.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_285.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_287.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_289.png)

**æ¼”ç¤ºå‘½ä»¤**ï¼š
```bash
# ä½¿ç”¨è‡ªå®šä¹‰çš„ Struts2 åˆ©ç”¨è„šæœ¬ï¼ŒæŒ‡å®šè¦å†™å…¥çš„ Webshell æ–‡ä»¶å
nmap -p 80 --script struts2-getshell --script-args webshell=colab.jsp 192.168.1.102
```
é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒNMAP ä¸å†æ˜¯å•çº¯çš„æ‰«æå™¨ï¼Œè€Œæˆä¸ºäº†è‡ªåŠ¨åŒ–æ”»å‡»é“¾ä¸­çš„ä¸€ç¯ã€‚

![](img/a7df427e55f695eab8b0dd8069b1cc49_291.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_293.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_295.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_297.png)

## ğŸ’¡ é«˜çº§åº”ç”¨ä¸æŠ€å·§

![](img/a7df427e55f695eab8b0dd8069b1cc49_299.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_301.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_303.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_305.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_307.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_309.png)

æŒæ¡äº†è„šæœ¬ç¼–å†™åŸºç¡€åï¼Œæˆ‘ä»¬å¯ä»¥æ¢ç´¢ NMAP æ›´é«˜çº§çš„ç”¨æ³•ï¼Œå°†å…¶é›†æˆåˆ°è‡ªåŠ¨åŒ–å·¥ä½œæµä¸­ã€‚

![](img/a7df427e55f695eab8b0dd8069b1cc49_311.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_313.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_315.png)

### ä¸æ•°æ®åº“é›†æˆ

å°† NMAP æ‰«æç»“æœå®æ—¶å­˜å…¥æ•°æ®åº“ï¼ˆå¦‚ MySQLï¼‰ï¼Œå¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œåç»­åˆ†æã€ç”ŸæˆæŠ¥å‘Šå’Œä»»åŠ¡è°ƒåº¦ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ `action` å‡½æ•°ä¸­ï¼Œä½¿ç”¨ `nselib` ä¸­çš„æ•°æ®åº“è¿æ¥åº“ï¼ˆå¦‚ `nselib/mysql.lua`ï¼‰æ¥æ‰§è¡Œ SQL æ’å…¥æ“ä½œã€‚

è¿™æ ·ï¼Œå½“è¿›è¡Œå¤§è§„æ¨¡ç½‘ç»œæ‰«ææ—¶ï¼Œæ‰€æœ‰å¼€æ”¾çš„ç«¯å£ã€æœåŠ¡ã€ç”šè‡³å‘ç°çš„æ¼æ´ä¿¡æ¯éƒ½èƒ½è¢«ç»“æ„åŒ–åœ°ä¿å­˜ä¸‹æ¥ã€‚

![](img/a7df427e55f695eab8b0dd8069b1cc49_317.png)

### æ„å»ºè‡ªåŠ¨åŒ–æ‰«æå¹³å°

ç»“åˆ Pythonï¼ˆDjango/Flaskï¼‰ã€ä»»åŠ¡é˜Ÿåˆ—ï¼ˆå¦‚ Celeryï¼‰å’Œ NMAPï¼Œå¯ä»¥æ„å»ºä¸€ä¸ªå¯è§†åŒ–çš„è‡ªåŠ¨åŒ–æ¼æ´æ‰«æå¹³å°ã€‚
*   **å‰ç«¯**ï¼šç”¨æˆ·é€šè¿‡ç½‘é¡µæäº¤æ‰«æä»»åŠ¡ï¼ˆç›®æ ‡ã€ç«¯å£ã€è¦ä½¿ç”¨çš„ NSE è„šæœ¬ï¼‰ã€‚
*   **åç«¯**ï¼šä½¿ç”¨ Python è°ƒç”¨ NMAP æ‰§è¡Œæ‰«æï¼Œå¹¶è§£æå…¶è¾“å‡ºï¼ˆXML æˆ–æ•°æ®åº“ï¼‰ã€‚
*   **ä»»åŠ¡è°ƒåº¦**ï¼šåˆ©ç”¨ Linux çš„ `cron` æˆ– Python çš„å®šæ—¶ä»»åŠ¡æ¡†æ¶ï¼Œå®ç°å®šæœŸå·¡æ£€æµ‹è¯•ã€‚
*   **ä¼˜åŠ¿**ï¼šåˆ©ç”¨ NMAP ç¨³å®šçš„åº•å±‚æ‰«æå¼•æ“å’Œä¸°å¯Œçš„æŒ‡çº¹ã€è„šæœ¬åº“ï¼Œæ¯”å®Œå…¨è‡ªå·±å®ç°æ‰«æé€»è¾‘æ›´é«˜æ•ˆã€æ›´å‡†ç¡®ã€‚

![](img/a7df427e55f695eab8b0dd8069b1cc49_319.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_321.png)

## ğŸ“š æ€»ç»“ä¸èµ„æº

![](img/a7df427e55f695eab8b0dd8069b1cc49_323.png)

æœ¬èŠ‚è¯¾ä¸­æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº† NMAP å·¥å…·çš„æ·±åº¦ä½¿ç”¨æ–¹æ³•ï¼š
1.  **èµ„äº§æ‰«æ**çš„æ¦‚å¿µå’Œæµç¨‹ï¼Œä»¥åŠ NMAP åœ¨å…¶ä¸­æ‰®æ¼”çš„è§’è‰²ã€‚
2.  **NMAP çš„æ ¸å¿ƒç»“æ„**ï¼ŒåŒ…æ‹¬å…¶æ‰«æå¼•æ“ã€æŒ‡çº¹åº“å’Œè‡³å…³é‡è¦çš„ NSE è„šæœ¬å¼•æ“ã€‚
3.  **NSE è„šæœ¬çš„ç¼–å†™**ï¼Œç†è§£äº† `prerule`, `hostrule`, `portrule`, `action`, `postrule` çš„æ‰§è¡Œæµç¨‹å’Œç”¨æ³•ã€‚
4.  **å®æˆ˜åº”ç”¨**ï¼Œé€šè¿‡ä¿®æ”¹ Struts2 æ¼æ´è„šæœ¬ï¼Œæ¼”ç¤ºäº†å¦‚ä½•å°† NMAP ç”¨äºè‡ªåŠ¨åŒ–æ¼æ´åˆ©ç”¨ã€‚
5.  **é«˜çº§é›†æˆ**ï¼Œæ¢è®¨äº†å°† NMAP ä¸æ•°æ®åº“ã€è‡ªåŠ¨åŒ–å¹³å°ç»“åˆçš„å¯èƒ½æ€§ã€‚

![](img/a7df427e55f695eab8b0dd8069b1cc49_325.png)

**å­¦ä¹ èµ„æº**ï¼š
*   **å®˜æ–¹æ–‡æ¡£**ï¼š[NMAP Official Documentation](https://nmap.org/docs.html) å’Œ [NSE Documentation](https://nmap.org/nsedoc/)ï¼Œè¿™æ˜¯æœ€æƒå¨çš„å‚è€ƒèµ„æ–™ï¼Œå°½ç®¡ä¸»è¦æ˜¯è‹±æ–‡ã€‚
*   **å†…ç½®è„šæœ¬**ï¼šå¤šç ”ç©¶ `scripts/` ç›®å½•ä¸‹çš„è„šæœ¬ï¼Œè¿™æ˜¯æœ€å¥½çš„å­¦ä¹ èŒƒä¾‹ã€‚
*   **ä¸­æ–‡ç¤¾åŒº**ï¼šå¯ä»¥å…³æ³¨å›½å†…å®‰å…¨ç¤¾åŒºã€è®ºå›çš„ç›¸å…³æ–‡ç« å’Œåˆ†äº«ï¼Œä¸å…¶ä»–çˆ±å¥½è€…å…±åŒå­¦ä¹ è¿›æ­¥ã€‚

![](img/a7df427e55f695eab8b0dd8069b1cc49_327.png)

![](img/a7df427e55f695eab8b0dd8069b1cc49_329.png)

NMAP æ˜¯ä¸€æ¬¾å†ç»æ—¶é—´è€ƒéªŒçš„ç»å…¸å·¥å…·ï¼Œæ·±å…¥ç†è§£å¹¶æŒæ¡å…¶æ‰©å±•èƒ½åŠ›ï¼Œå°†æå¤§æå‡ä½ åœ¨ç½‘ç»œæ¢æµ‹å’Œå®‰å…¨è¯„ä¼°æ–¹é¢çš„æ•ˆç‡å’Œæ·±åº¦ã€‚å¸Œæœ›æœ¬æ•™ç¨‹èƒ½ä¸ºä½ æ‰“å¼€ä¸€æ‰‡æ–°çš„å¤§é—¨ã€‚